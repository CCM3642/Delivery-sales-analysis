<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crispy Chicken Analytics Dashboard</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- SheetJS for Excel Import -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- jsPDF for PDF Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root {
            --primary-color: #ff6b35;
            --secondary-color: #f7931e;
            --dark-color: #212529;
            --light-color: #f8f9fa;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
        }
        
        .navbar {
            background-color: var(--primary-color) !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .nav-tabs .nav-link {
            color: var(--dark-color);
            border: none;
            border-bottom: 3px solid transparent;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .nav-tabs .nav-link.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            background-color: transparent;
        }
        
        .nav-tabs .nav-link:hover {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .metric-card {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .metric-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            transform: translate(30px, -30px);
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .metric-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 2rem;
        }
        
        .table-responsive {
            border-radius: 10px;
            overflow: hidden;
        }
        
        .table {
            margin-bottom: 0;
        }
        
        .table thead th {
            background-color: var(--primary-color);
            color: white;
            border: none;
            white-space: nowrap;
        }
        
        .table tbody tr:hover {
            background-color: rgba(255, 107, 53, 0.05);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }
        
        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(255, 107, 53, 0.25);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
            min-width: 300px;
            max-width: 350px;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .spinner-border {
            width: 3rem;
            height: 3rem;
            border-width: 0.3em;
        }
        
        .tab-content {
            padding: 1.5rem 0;
        }
        
        .branch-badge {
            background-color: var(--secondary-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .offer-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .offer-normal {
            background-color: var(--success-color);
            color: white;
        }
        
        .offer-chicken {
            background-color: var(--warning-color);
            color: darkslategray;
        }
        
        .offer-ultimate {
            background-color: var(--danger-color);
            color: white;
        }
        
        .page-header {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .page-header h1 {
            color: var(--dark-color);
            font-weight: 600;
        }
        
        .page-header .breadcrumb {
            margin-bottom: 0;
            padding: 0;
            background-color: transparent;
        }
        
        .page-header .breadcrumb-item a {
            color: var(--primary-color);
            text-decoration: none;
        }
        
        .page-header .breadcrumb-item.active {
            color: var(--dark-color);
        }
        
        .save-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            margin-left: 10px;
        }
        
        .save-saved {
            background-color: var(--success-color);
            color: white;
        }
        
        .save-unsaved {
            background-color: var(--warning-color);
            color: darkslategray;
        }
        
        .save-saving {
            background-color: var(--primary-color);
            color: white;
        }
        
        .data-management-card {
            background-color: #f8f9fa;
            border-left: 4px solid var(--primary-color);
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 5px;
        }
        
        .auto-save-toggle {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .auto-save-toggle .form-check-input {
            margin-right: 0.5rem;
        }
        
        .data-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background-color: #e9ecef;
            border-radius: 5px;
        }
        
        .data-stats .stat-item {
            text-align: center;
        }
        
        .data-stats .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .data-stats .stat-label {
            font-size: 0.85rem;
            color: #6c757d;
        }
        
        .last-saved {
            font-size: 0.85rem;
            color: #6c757d;
            margin-bottom: 1rem;
        }
        
        .btn-group .btn {
            border-radius: 0;
        }
        
        .btn-group .btn:first-child {
            border-top-left-radius: 5px;
            border-bottom-left-radius: 5px;
        }
        
        .btn-group .btn:last-child {
            border-top-right-radius: 5px;
            border-bottom-right-radius: 5px;
        }
        
        .form-text {
            font-size: 0.875rem;
            color: #6c757d;
            margin-top: 0.25rem;
        }
        
        .invalid-feedback {
            display: block;
            width: 100%;
            margin-top: 0.25rem;
            font-size: 0.875rem;
            color: var(--danger-color);
        }
        
        .alert {
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .alert-dismissible .btn-close {
            padding: 0.25rem 0.5rem;
        }
        
        .chart-legend {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 1rem;
        }
        
        .chart-legend-item {
            display: flex;
            align-items: center;
            margin: 0 1rem 0.5rem 0;
        }
        
        .chart-legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            margin-right: 0.5rem;
        }
        
        .data-card {
            transition: all 0.3s ease;
        }
        
        .data-card:hover {
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
        }
        
        .performance-indicator {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }
        
        .performance-high {
            background-color: var(--success-color);
            color: white;
        }
        
        .performance-medium {
            background-color: var(--warning-color);
            color: darkslategray;
        }
        
        .performance-low {
            background-color: var(--danger-color);
            color: white;
        }
        
        .rating-input {
            display: flex;
            gap: 5px;
            font-size: 1.5rem;
            margin: 0.5rem 0;
        }
        
        .rating-input i {
            cursor: pointer;
            color: #ddd;
            transition: color 0.2s;
        }
        
        .rating-input i.active {
            color: #ffc107;
        }
        
        .feedback-category {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .category-service {
            background-color: var(--info-color);
            color: white;
        }
        
        .category-food {
            background-color: var(--primary-color);
            color: white;
        }
        
        .category-cleanliness {
            background-color: var(--success-color);
            color: white;
        }
        
        .category-other {
            background-color: var(--warning-color);
            color: darkslategray;
        }
        
        .file-drop-area {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 1rem;
        }
        
        .file-drop-area:hover {
            border-color: var(--primary-color);
            background-color: rgba(255, 107, 53, 0.05);
        }
        
        .file-drop-area.drag-over {
            border-color: var(--primary-color);
            background-color: rgba(255, 107, 53, 0.1);
        }
        
        .progress {
            height: 5px;
            margin-bottom: 1rem;
        }
        
        .modal-header {
            background-color: var(--primary-color);
            color: white;
        }
        
        .modal-header .btn-close {
            filter: brightness(0) invert(1);
        }
        
        .excel-format-info {
            background-color: #e7f3ff;
            border-left: 4px solid var(--info-color);
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            border-radius: 4px;
        }
        
        .excel-format-info small {
            color: #6c757d;
        }
        
        .feedback-card {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--info-color);
        }
        
        .feedback-card h6 {
            color: var(--dark-color);
            margin-bottom: 0.5rem;
        }
        
        .feedback-card p {
            margin-bottom: 0.5rem;
            color: #6c757d;
        }
        
        .feedback-card .feedback-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            color: #6c757d;
        }
        
        .category-color-picker {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .color-option:hover {
            transform: scale(1.1);
        }
        
        .color-option.selected {
            border: 2px solid #333;
        }
        
        .feedback-list-item {
            background-color: #fff;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.2s;
        }
        
        .feedback-list-item:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .feedback-list-item .feedback-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .feedback-list-item .feedback-body {
            margin-bottom: 0.5rem;
        }
        
        .feedback-list-item .feedback-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
            color: #6c757d;
        }
        
        .feedback-list-item .feedback-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .feedback-list-item .feedback-actions .btn {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
        }
        
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .spinner {
            animation: spin 1s linear infinite;
        }
        
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        @media (max-width: 768px) {
            .chart-container {
                height: 300px;
            }
            
            .metric-value {
                font-size: 1.5rem;
            }
            
            .notification {
                left: 10px;
                right: 10px;
                min-width: auto;
                max-width: none;
            }
            
            .data-stats {
                flex-wrap: wrap;
            }
            
            .data-stats .stat-item {
                flex: 1 1 50%;
                margin-bottom: 0.5rem;
            }
        }
        
        /* Target Plan Styles */
        .target-plan-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }
        
        .target-metric-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 1rem;
            border-left: 4px solid var(--primary-color);
        }
        
        .target-metric-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .target-metric-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .target-progress {
            height: 25px;
            border-radius: 15px;
            overflow: hidden;
            background-color: #e9ecef;
            margin-bottom: 0.5rem;
        }
        
        .target-progress-bar {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 500;
            transition: width 0.5s ease;
        }
        
        .target-status-badge {
            padding: 0.35rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .status-achieved {
            background-color: var(--success-color);
            color: white;
        }
        
        .status-on-track {
            background-color: var(--info-color);
            color: white;
        }
        
        .status-at-risk {
            background-color: var(--warning-color);
            color: darkslategray;
        }
        
        .status-behind {
            background-color: var(--danger-color);
            color: white;
        }
        
        .target-allocation-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .allocation-input-group {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .allocation-input-group label {
            flex: 0 0 150px;
            font-weight: 500;
        }
        
        .allocation-input-group input {
            flex: 1;
            margin-right: 1rem;
        }
        
        .allocation-input-group .input-group-text {
            background-color: var(--primary-color);
            color: white;
            border: none;
        }
        
        .target-action-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 1rem;
        }
        
        .action-timeline {
            position: relative;
            padding-left: 30px;
        }
        
        .action-timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: #e9ecef;
        }
        
        .action-item {
            position: relative;
            margin-bottom: 1.5rem;
        }
        
        .action-item::before {
            content: '';
            position: absolute;
            left: -25px;
            top: 5px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--primary-color);
        }
        
        .action-date {
            font-size: 0.85rem;
            color: #6c757d;
            margin-bottom: 0.25rem;
        }
        
        .action-title {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }
        
        .action-description {
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        .target-comparison-table {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .target-comparison-table th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 500;
        }
        
        .target-comparison-table td {
            vertical-align: middle;
        }
        
        .target-chart-container {
            position: relative;
            height: 350px;
            margin-bottom: 2rem;
        }
        
        .target-summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .target-summary-value {
            font-size: 2.5rem;
            font-weight: bold;
        }
        
        .target-summary-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .total-target-input {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 1rem;
        }
        
        .total-target-input .input-group-lg {
            font-size: 1.25rem;
        }
        
        .total-target-input .input-group-lg .form-control {
            font-size: 1.25rem;
            font-weight: 500;
        }
        
        .total-target-input .input-group-lg .input-group-text {
            font-size: 1.25rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
        }
        
        .distribution-method {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 1rem;
        }
        
        .method-option {
            padding: 1rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .method-option:hover {
            border-color: var(--primary-color);
            background-color: rgba(255, 107, 53, 0.05);
        }
        
        .method-option.selected {
            border-color: var(--primary-color);
            background-color: rgba(255, 107, 53, 0.1);
        }
        
        .method-option h6 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        
        .method-option p {
            color: #6c757d;
            margin-bottom: 0;
            font-size: 0.9rem;
        }
        
        .preset-targets {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .preset-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .preset-btn:hover {
            border-color: var(--primary-color);
            background-color: rgba(255, 107, 53, 0.05);
        }
        
        .preset-btn.active {
            border-color: var(--primary-color);
            background-color: var(--primary-color);
            color: white;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#"><i class="fas fa-drumstick-bite"></i> Crispy Chicken Analytics</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" data-page="dashboard"><i class="fas fa-chart-line"></i> Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-page="data-entry"><i class="fas fa-plus-circle"></i> Data Entry</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-page="management-report"><i class="fas fa-file-alt"></i> Management Report</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-page="feedback-management"><i class="fas fa-comments"></i> Feedback Management</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-4">
        <!-- Dashboard Page -->
        <div id="dashboard-page" class="page-content">
            <div class="page-header">
                <h1>Sales Analytics Dashboard</h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item active">Dashboard</li>
                    </ol>
                </nav>
            </div>

            <!-- Date Range Selector -->
            <div class="card mb-4">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <label for="dateRange" class="form-label">Date Range</label>
                            <div class="input-group">
                                <input type="date" id="startDate" class="form-control" value="2025-10-01" aria-label="Start date">
                                <span class="input-group-text">to</span>
                                <input type="date" id="endDate" class="form-control" value="2025-10-14" aria-label="End date">
                                <button class="btn btn-primary" onclick="updateDashboard()" aria-label="Update dashboard">
                                    <i class="fas fa-sync"></i> Update
                                </button>
                            </div>
                            <div class="form-text">Select the date range for analysis</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Quick Select</label>
                            <div class="btn-group w-100" role="group">
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="setDateRange('today')">
                                    <i class="fas fa-calendar-day"></i> Today
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="setDateRange('yesterday')">
                                    <i class="fas fa-calendar-minus"></i> Yesterday
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="setDateRange('last7days')">
                                    <i class="fas fa-calendar-week"></i> Last 7 Days
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="setDateRange('last30days')">
                                    <i class="fas fa-calendar-alt"></i> Last 30 Days
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="setDateRange('thismonth')">
                                    <i class="fas fa-calendar"></i> This Month
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="setDateRange('lastmonth')">
                                    <i class="fas fa-calendar-times"></i> Last Month
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <label class="form-label">Advanced Options</label>
                        <div class="row">
                            <div class="col-md-4">
                                <select class="form-select form-select-sm" id="branchFilter" onchange="updateDashboard()" aria-label="Filter by branch">
                                    <option value="all">All Branches</option>
                                    <option value="Crispy Chicken-Hamdan St">Crispy Chicken-Hamdan St</option>
                                    <option value="Crispy Chicken Khaldia">Crispy Chicken Khaldia</option>
                                    <option value="Crispy Chicken Shabiya 11">Crispy Chicken Shabiya 11</option>
                                    <option value="Crispy Chicken Muroor">Crispy Chicken Muroor</option>
                                    <option value="Crispy Chicken Al Barsha">Crispy Chicken Al Barsha</option>
                                    <option value="Crispy Chicken Al Satwa">Crispy Chicken Al Satwa</option>
                                    <option value="Crispy Chicken Al Rgga">Crispy Chicken Al Rgga</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <select class="form-select form-select-sm" id="offerFilter" onchange="updateDashboard()" aria-label="Filter by offer">
                                    <option value="all">All Offers</option>
                                    <option value="Normal Day">Normal Day</option>
                                    <option value="Chicken Day">Chicken Day</option>
                                    <option value="Ultimate">Ultimate</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="autoRefresh" checked>
                                    <label class="form-check-label" for="autoRefresh">
                                        Auto-refresh on date change
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Key Metrics -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="totalSales">0</div>
                        <div class="metric-label">Total Sales (AED)</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="totalTransactions">0</div>
                        <div class="metric-label">Total Transactions</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="avgTransaction">0</div>
                        <div class="metric-label">Avg. Transaction (AED)</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="targetAchievement">0%</div>
                        <div class="metric-label">Target Achievement</div>
                    </div>
                </div>
            </div>

            <!-- Tabs for different views -->
            <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab" aria-selected="true">Overview</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="performance-tab" data-bs-toggle="tab" data-bs-target="#performance" type="button" role="tab" aria-selected="false">Performance</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="trends-tab" data-bs-toggle="tab" data-bs-target="#trends" type="button" role="tab" aria-selected="false">Trends</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="insights-tab" data-bs-toggle="tab" data-bs-target="#insights" type="button" role="tab" aria-selected="false">Insights</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="recommendations-tab" data-bs-toggle="tab" data-bs-target="#recommendations" type="button" role="tab" aria-selected="false">Recommendations</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="offers-tab" data-bs-toggle="tab" data-bs-target="#offers" type="button" role="tab" aria-selected="false">Offers</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="feedback-analysis-tab" data-bs-toggle="tab" data-bs-target="#feedback-analysis" type="button" role="tab" aria-selected="false">Feedback Analysis</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="target-plan-tab" data-bs-toggle="tab" data-bs-target="#target-plan" type="button" role="tab" aria-selected="false">Monthly Target Plan</button>
                </li>
            </ul>

            <div class="tab-content" id="dashboardTabsContent">
                <!-- Overview Tab -->
                <div class="tab-pane fade show active" id="overview" role="tabpanel">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Sales & Transactions Trend</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="salesTrendChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Branch Sales Distribution</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="branchSalesChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Daily Sales Details</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" aria-label="Daily sales details table">
                                            <thead>
                                                <tr>
                                                    <th>Date</th>
                                                    <th>Branch</th>
                                                    <th>Channel</th>
                                                    <th>Transactions</th>
                                                    <th>Sales (AED)</th>
                                                    <th>Average per Order</th>
                                                    <th>Offer Type</th>
                                                    <th>Offer Status</th>
                                                </tr>
                                            </thead>
                                            <tbody id="dailySalesTable">
                                                <!-- Table content will be populated by JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Performance Tab -->
                <div class="tab-pane fade" id="performance" role="tabpanel">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Branch Performance Radar</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="branchPerformanceRadarChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Branch Performance Ranking</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="branchPerformanceRankingChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Performance Metrics</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="text-center">
                                                <h3>Best Branch</h3>
                                                <div class="branch-badge" id="bestBranch">-</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="text-center">
                                                <h3>Highest Transactions</h3>
                                                <div class="branch-badge" id="highestTransactionsBranch">-</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="text-center">
                                                <h3>Highest Avg. Sale</h3>
                                                <div class="branch-badge" id="highestAvgSaleBranch">-</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Trends Tab -->
                <div class="tab-pane fade" id="trends" role="tabpanel">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Daily Trends</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="dailyTrendsChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Weekly Trends</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="weeklyTrendsChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Moving Average Analysis</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="movingAverageChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Insights Tab -->
                <div class="tab-pane fade" id="insights" role="tabpanel">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">AI Insights Analysis</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Anomaly Detection</h6>
                                    <div id="anomalyDetection">
                                        <div class="alert alert-warning">
                                            <i class="fas fa-exclamation-triangle"></i> 
                                            <strong>Anomaly Detection:</strong> 
                                            <p id="anomalyText">Analyzing data...</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6>Predictive Analytics</h6>
                                    <div id="predictiveAnalytics">
                                        <div class="alert alert-info">
                                            <i class="fas fa-chart-line"></i> 
                                            <strong>Sales Prediction:</strong> 
                                            <p id="predictionText">Generating prediction...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-4">
                                <div class="col-md-12">
                                    <h6>Key Findings</h6>
                                    <div id="keyFindings">
                                        <ul class="list-group" id="keyFindingsList">
                                            <!-- Key findings will be populated by JavaScript -->
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recommendations Tab -->
                <div class="tab-pane fade" id="recommendations" role="tabpanel">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">30-Day Action Plan</h5>
                        </div>
                        <div class="card-body">
                            <div class="accordion" id="recommendationsAccordion">
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#recommendations1" aria-expanded="true">
                                            Short-term Actions
                                        </button>
                                    </h2>
                                    <div id="recommendations1" class="accordion-collapse collapse show" data-bs-parent="#recommendationsAccordion">
                                        <div class="accordion-body">
                                            <ul id="shortTermRecommendations">
                                                <!-- Recommendations will be populated by JavaScript -->
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#recommendations2">
                                            Medium-term Strategy Adjustments
                                        </button>
                                    </h2>
                                    <div id="recommendations2" class="accordion-collapse collapse" data-bs-parent="#recommendationsAccordion">
                                        <div class="accordion-body">
                                            <ul id="mediumTermRecommendations">
                                                <!-- Recommendations will be populated by JavaScript -->
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#recommendations3">
                                            Long-term Development Plans
                                        </button>
                                    </h2>
                                    <div id="recommendations3" class="accordion-collapse collapse" data-bs-parent="#recommendationsAccordion">
                                        <div class="accordion-body">
                                            <ul id="longTermRecommendations">
                                                <!-- Recommendations will be populated by JavaScript -->
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Offers Tab -->
                <div class="tab-pane fade" id="offers" role="tabpanel">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Offer Management System</h5>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addOfferModal" aria-label="Add new offer">
                                <i class="fas fa-plus"></i> Add Offer
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" aria-label="Offers management table">
                                    <thead>
                                        <tr>
                                            <th>Offer Name</th>
                                            <th>Type</th>
                                            <th>Discount</th>
                                            <th>Start Date</th>
                                            <th>End Date</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="offersTable">
                                        <!-- Offers will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Feedback Analysis Tab -->
                <div class="tab-pane fade" id="feedback-analysis" role="tabpanel">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="metric-card">
                                <div class="metric-value" id="totalFeedback">0</div>
                                <div class="metric-label">Total Feedback</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="metric-card">
                                <div class="metric-value" id="avgRating">0.0</div>
                                <div class="metric-label">Average Rating</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="metric-card">
                                <div class="metric-value" id="positiveFeedback">0%</div>
                                <div class="metric-label">Positive Feedback</div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Feedback by Category</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container" style="height: 300px;">
                                        <canvas id="feedbackCategoryChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Rating Distribution</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container" style="height: 300px;">
                                        <canvas id="ratingDistributionChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Recent Feedback</h5>
                                </div>
                                <div class="card-body">
                                    <div id="recentFeedbackList">
                                        <!-- Recent feedback will be populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Monthly Target Plan Tab -->
                <div class="tab-pane fade" id="target-plan" role="tabpanel">
                    <!-- Target Plan Header -->
                    <div class="target-plan-header">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h2 class="mb-2">Monthly Target Plan</h2>
                                <p class="mb-0">Set, track, and analyze monthly sales targets for each branch</p>
                            </div>
                            <div class="col-md-4 text-end">
                                <div class="mb-2">
                                    <label for="targetMonth" class="form-label">Select Month</label>
                                    <input type="month" class="form-control" id="targetMonth" value="2025-10">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Target Overview Cards -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="target-summary-card">
                                <div class="target-summary-value" id="totalMonthlyTarget">0</div>
                                <div class="target-summary-label">Total Monthly Target (AED)</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="target-summary-card">
                                <div class="target-summary-value" id="currentMonthSales">0</div>
                                <div class="target-summary-label">Current Month Sales (AED)</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="target-summary-card">
                                <div class="target-summary-value" id="overallAchievement">0%</div>
                                <div class="target-summary-label">Overall Achievement</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="target-summary-card">
                                <div class="target-summary-value" id="daysRemaining">0</div>
                                <div class="target-summary-label">Days Remaining</div>
                            </div>
                        </div>
                    </div>

                    <!-- Total Target Input Section -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">Set Monthly Target</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="total-target-input">
                                        <label for="totalTargetInput" class="form-label">Enter Total Monthly Target (AED)</label>
                                        <div class="input-group input-group-lg">
                                            <span class="input-group-text">AED</span>
                                            <input type="number" class="form-control" id="totalTargetInput" 
                                                   placeholder="360000" min="0" step="1000">
                                            <button class="btn btn-primary" onclick="setTotalTarget()">
                                                <i class="fas fa-check"></i> Set Target
                                            </button>
                                        </div>
                                        <div class="form-text">Enter the total target amount for the selected month</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="distribution-method">
                                        <label class="form-label">Distribution Method</label>
                                        <div class="method-option" onclick="selectDistributionMethod('performance')">
                                            <h6><i class="fas fa-chart-line"></i> Based on Performance</h6>
                                            <p>Distribute targets based on historical performance data</p>
                                        </div>
                                        <div class="method-option" onclick="selectDistributionMethod('equal')">
                                            <h6><i class="fas fa-balance-scale"></i> Equal Distribution</h6>
                                            <p>Distribute targets equally across all branches</p>
                                        </div>
                                        <div class="method-option" onclick="selectDistributionMethod('custom')">
                                            <h6><i class="fas fa-edit"></i> Custom Distribution</h6>
                                            <p>Manually set targets for each branch</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Preset Targets -->
                            <div class="preset-targets">
                                <button class="preset-btn" onclick="setPresetTarget(300000)">300K</button>
                                <button class="preset-btn" onclick="setPresetTarget(350000)">350K</button>
                                <button class="preset-btn active" onclick="setPresetTarget(360000)">360K</button>
                                <button class="preset-btn" onclick="setPresetTarget(400000)">400K</button>
                                <button class="preset-btn" onclick="setPresetTarget(450000)">450K</button>
                                <button class="preset-btn" onclick="setPresetTarget(500000)">500K</button>
                            </div>
                        </div>
                    </div>

                    <!-- Branch Target Allocation -->
                    <div class="card mb-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Branch Target Allocation</h5>
                            <button class="btn btn-primary" onclick="saveTargetAllocation()">
                                <i class="fas fa-save"></i> Save Allocation
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="target-allocation-card">
                                        <h6>Branch Targets</h6>
                                        <div id="branchTargetInputs">
                                            <!-- Branch target inputs will be populated by JavaScript -->
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="target-allocation-card">
                                        <h6>Target Distribution</h6>
                                        <div class="target-chart-container">
                                            <canvas id="targetDistributionChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Target Progress Tracking -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">Target Progress Tracking</h5>
                        </div>
                        <div class="card-body">
                            <div id="branchProgressCards">
                                <!-- Progress cards will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <!-- Target Comparison Table -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">Target vs Actual Comparison</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover target-comparison-table">
                                    <thead>
                                        <tr>
                                            <th>Branch</th>
                                            <th>Monthly Target (AED)</th>
                                            <th>Current Sales (AED)</th>
                                            <th>Achievement %</th>
                                            <th>Remaining (AED)</th>
                                            <th>Daily Required (AED)</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="targetComparisonTable">
                                        <!-- Table content will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Target Achievement Chart -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">Target Achievement Analysis</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="target-chart-container">
                                        <canvas id="targetAchievementChart"></canvas>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="target-metric-card">
                                        <div class="target-metric-value" id="bestPerformer">-</div>
                                        <div class="target-metric-label">Best Performer</div>
                                    </div>
                                    <div class="target-metric-card">
                                        <div class="target-metric-value" id="needsImprovement">-</div>
                                        <div class="target-metric-label">Needs Improvement</div>
                                    </div>
                                    <div class="target-metric-card">
                                        <div class="target-metric-value" id="onTrackBranches">0</div>
                                        <div class="target-metric-label">Branches On Track</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Plan -->
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Target Achievement Action Plan</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="target-action-card">
                                        <h6>Immediate Actions (This Week)</h6>
                                        <div class="action-timeline" id="immediateActions">
                                            <!-- Actions will be populated by JavaScript -->
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="target-action-card">
                                        <h6>Strategic Actions (This Month)</h6>
                                        <div class="action-timeline" id="strategicActions">
                                            <!-- Actions will be populated by JavaScript -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Entry Page -->
        <div id="data-entry-page" class="page-content" style="display: none;">
            <div class="page-header">
                <h1>Data Entry</h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item active">Data Entry</li>
                    </ol>
                </nav>
            </div>

            <!-- Data Management Section -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Data Management</h5>
                </div>
                <div class="card-body">
                    <div class="data-management-card">
                        <div class="auto-save-toggle">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="autoSaveToggle" checked>
                                <label class="form-check-label" for="autoSaveToggle">
                                    Auto-save enabled
                                </label>
                            </div>
                            <span id="saveStatus" class="save-status save-saved">Saved</span>
                        </div>
                        
                        <div class="last-saved">
                            Last saved: <span id="lastSavedTime">Never</span>
                        </div>
                        
                        <div class="data-stats">
                            <div class="stat-item">
                                <div class="stat-value" id="salesRecordsCount">0</div>
                                <div class="stat-label">Sales Records</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="offersCount">0</div>
                                <div class="stat-label">Offers</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="feedbackCount">0</div>
                                <div class="stat-label">Feedback</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="totalDataSize">0 KB</div>
                                <div class="stat-label">Data Size</div>
                            </div>
                        </div>
                        
                        <div class="btn-group w-100 mb-3" role="group">
                            <button type="button" class="btn btn-outline-primary" onclick="saveData()">
                                <i class="fas fa-save"></i> Save Data
                            </button>
                            <button type="button" class="btn btn-outline-success" onclick="exportData()">
                                <i class="fas fa-download"></i> Export Backup
                            </button>
                            <button type="button" class="btn btn-outline-info" onclick="showImportModal()">
                                <i class="fas fa-upload"></i> Import Data
                            </button>
                            <button type="button" class="btn btn-outline-warning" onclick="clearAllData()">
                                <i class="fas fa-trash-alt"></i> Clear All Data
                            </button>
                            <button type="button" class="btn btn-outline-secondary" onclick="resetToSample()">
                                <i class="fas fa-undo"></i> Reset to Sample
                            </button>
                            <button type="button" class="btn btn-outline-danger" onclick="exportToPDF()">
                                <i class="fas fa-file-pdf"></i> Export PDF
                            </button>
                        </div>
                        
                        <div class="mb-3">
                            <button class="btn btn-sm btn-outline-secondary" onclick="undoLastAction()">
                                <i class="fas fa-undo"></i> Undo Last Action
                            </button>
                            <span class="ms-2 text-muted" id="undoStatus">No actions to undo</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Excel Import Section -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Excel Import</h5>
                </div>
                <div class="card-body">
                    <div class="excel-upload-section">
                        <h6><i class="fas fa-file-excel"></i> Import Sales Data from Excel</h6>
                        
                        <div class="excel-format-info">
                            <strong>Excel Format Requirements:</strong>
                            <ul class="mb-0">
                                <li><strong>Required columns:</strong> Date, Branch, Channel, Transactions, Sales, Offer Type, Offer Status</li>
                                <li><strong>Optional columns:</strong> Average per Order (calculated automatically), Notes</li>
                                <li><strong>Date format:</strong> YYYY-MM-DD (e.g., 2025-10-01)</li>
                                <li><strong>Branch names:</strong> Must match exactly: Crispy Chicken-Hamdan St, Crispy Chicken Khaldia, etc.</li>
                                <li><strong>Channels:</strong> Delivery, Dine-in, Takeaway</li>
                                <li><strong>Offer Types:</strong> Normal Day, Chicken Day, Ultimate</li>
                                <li><strong>Offer Status:</strong> Active, No Offer</li>
                                <li><strong>Transactions:</strong> Must be a positive integer</li>
                                <li><strong>Sales:</strong> Must be a positive number (AED)</li>
                            </ul>
                            <div class="mt-2">
                                <strong>Sample Format:</strong>
                                <table class="table table-sm mt-2">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Branch</th>
                                            <th>Channel</th>
                                            <th>Transactions</th>
                                            <th>Sales</th>
                                            <th>Offer Type</th>
                                            <th>Offer Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>2025-10-01</td>
                                            <td>Crispy Chicken-Hamdan St</td>
                                            <td>Delivery</td>
                                            <td>73</td>
                                            <td>3216.00</td>
                                            <td>Normal Day</td>
                                            <td>No Offer</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <small class="text-muted">
                                <i class="fas fa-info-circle"></i> 
                                The system will automatically calculate the average per order if not provided. 
                                Duplicate records (same date, branch, and channel) will be automatically removed.
                            </small>
                            <hr>
                            <small><a href="#" onclick="downloadExcelTemplate()" class="text-primary">
                                <i class="fas fa-download"></i> Download Excel Template
                            </a></small>
                        </div>
                        
                        <div class="file-drop-area" id="fileDropArea">
                            <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                            <p class="mb-0">Drag and drop your Excel file here or <a href="#" id="browseLink">browse files</a></p>
                            <input type="file" id="excelFileInput" accept=".xlsx, .xls" class="d-none" aria-label="Select Excel file">
                        </div>
                        
                        <div class="progress d-none" id="importProgress">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                        </div>
                        
                        <div class="mt-3">
                            <button class="btn btn-primary d-none" id="importExcelBtn" onclick="processExcelFile()">
                                <i class="fas fa-file-import"></i> Import Excel Data
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Add New Sales Data</h5>
                        </div>
                        <div class="card-body">
                            <form id="salesDataForm" novalidate>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="dateInput" class="form-label">Date</label>
                                        <input type="date" class="form-control" id="dateInput" required aria-describedby="dateInputHelp">
                                        <div class="invalid-feedback" id="dateInputFeedback"></div>
                                        <div id="dateInputHelp" class="form-text">Enter the date of the sales record</div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="branchInput" class="form-label">Branch</label>
                                        <select class="form-select" id="branchInput" required aria-describedby="branchInputHelp">
                                            <option value="">Select Branch</option>
                                            <option value="Crispy Chicken-Hamdan St">Crispy Chicken-Hamdan St</option>
                                            <option value="Crispy Chicken Khaldia">Crispy Chicken Khaldia</option>
                                            <option value="Crispy Chicken Shabiya 11">Crispy Chicken Shabiya 11</option>
                                            <option value="Crispy Chicken Muroor">Crispy Chicken Muroor</option>
                                            <option value="Crispy Chicken Al Barsha">Crispy Chicken Al Barsha</option>
                                            <option value="Crispy Chicken Al Satwa">Crispy Chicken Al Satwa</option>
                                            <option value="Crispy Chicken Al Rgga">Crispy Chicken Al Rgga</option>
                                        </select>
                                        <div class="invalid-feedback" id="branchInputFeedback"></div>
                                        <div id="branchInputHelp" class="form-text">Select the branch where the sale occurred</div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="channelInput" class="form-label">Channel</label>
                                        <select class="form-select" id="channelInput" required aria-describedby="channelInputHelp">
                                            <option value="">Select Channel</option>
                                            <option value="Delivery">Delivery</option>
                                            <option value="Dine-in">Dine-in</option>
                                            <option value="Takeaway">Takeaway</option>
                                        </select>
                                        <div class="invalid-feedback" id="channelInputFeedback"></div>
                                        <div id="channelInputHelp" class="form-text">Select the sales channel</div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="transactionsInput" class="form-label">Transactions</label>
                                        <input type="number" class="form-control" id="transactionsInput" min="0" required aria-describedby="transactionsInputHelp">
                                        <div class="form-text">Enter the number of transactions</div>
                                        <div class="invalid-feedback" id="transactionsInputFeedback"></div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="salesInput" class="form-label">Sales (AED)</label>
                                        <input type="number" class="form-control" id="salesInput" min="0" step="0.01" required aria-describedby="salesInputHelp">
                                        <div class="form-text">Enter the total sales amount in AED</div>
                                        <div class="invalid-feedback" id="salesInputFeedback"></div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="averageInput" class="form-label">Average per Order</label>
                                        <input type="number" class="form-control" id="averageInput" min="0" step="0.01" readonly aria-describedby="averageInputHelp">
                                        <div class="form-text">Calculated automatically</div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="offerTypeInput" class="form-label">Offer Type</label>
                                        <select class="form-select" id="offerTypeInput" required aria-describedby="offerTypeInputHelp">
                                            <option value="">Select Offer Type</option>
                                            <option value="Normal Day">Normal Day</option>
                                            <option value="Chicken Day">Chicken Day</option>
                                            <option value="Ultimate">Ultimate</option>
                                        </select>
                                        <div class="invalid-feedback" id="offerTypeInputFeedback"></div>
                                        <div id="offerTypeInputHelp" class="form-text">Select the offer type in effect</div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="offerStatusInput" class="form-label">Offer Status</label>
                                        <select class="form-select" id="offerStatusInput" required aria-describedby="offerStatusInputHelp">
                                            <option value="">Select Status</option>
                                            <option value="Active">Active</option>
                                            <option value="No Offer">No Offer</option>
                                        </select>
                                        <div class="invalid-feedback" id="offerStatusInputFeedback"></div>
                                        <div id="offerStatusInputHelp" class="form-text">Select if the offer was active</div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="notesInput" class="form-label">Notes</label>
                                    <textarea class="form-control" id="notesInput" rows="2" placeholder="Additional notes (optional)" aria-describedby="notesInputHelp"></textarea>
                                    <div id="notesInputHelp" class="form-text">Optional notes about the sales record</div>
                                </div>
                                
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="fas fa-save"></i> Save Data
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Add Customer Feedback</h5>
                        </div>
                        <div class="card-body">
                            <form id="feedbackForm" novalidate>
                                <div class="mb-3">
                                    <label for="feedbackDate" class="form-label">Date</label>
                                    <input type="date" class="form-control" id="feedbackDate" required aria-describedby="feedbackDateHelp">
                                    <div class="invalid-feedback" id="feedbackDateFeedback"></div>
                                    <div id="feedbackDateHelp" class="form-text">Enter the date of the feedback</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="feedbackBranch" class="form-label">Branch</label>
                                    <select class="form-select" id="feedbackBranch" required aria-describedby="feedbackBranchHelp">
                                        <option value="">Select Branch</option>
                                        <option value="Crispy Chicken-Hamdan St">Crispy Chicken-Hamdan St</option>
                                        <option value="Crispy Chicken Khaldia">Crispy Chicken Khaldia</option>
                                        <option value="Crispy Chicken Shabiya 11">Crispy Chicken Shabiya 11</option>
                                        <option value="Crispy Chicken Muroor">Crispy Chicken Muroor</option>
                                        <option value="Crispy Chicken Al Barsha">Crispy Chicken Al Barsha</option>
                                        <option value="Crispy Chicken Al Satwa">Crispy Chicken Al Satwa</option>
                                        <option value="Crispy Chicken Al Rgga">Crispy Chicken Al Rgga</option>
                                    </select>
                                    <div class="invalid-feedback" id="feedbackBranchFeedback"></div>
                                    <div id="feedbackBranchHelp" class="form-text">Select the branch where the feedback was received</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Rating</label>
                                    <div class="rating-input" id="feedbackRating" role="radiogroup" aria-label="Rating">
                                        <i class="fas fa-star" data-rating="1" role="radio" tabindex="0" aria-label="1 star"></i>
                                        <i class="fas fa-star" data-rating="2" role="radio" tabindex="0" aria-label="2 stars"></i>
                                        <i class="fas fa-star" data-rating="3" role="radio" tabindex="0" aria-label="3 stars"></i>
                                        <i class="fas fa-star" data-rating="4" role="radio" tabindex="0" aria-label="4 stars"></i>
                                        <i class="fas fa-star" data-rating="5" role="radio" tabindex="0" aria-label="5 stars"></i>
                                    </div>
                                    <input type="hidden" id="feedbackRatingValue" value="0" aria-required="true">
                                    <div class="invalid-feedback" id="feedbackRatingFeedback"></div>
                                    <div class="form-text">Select a rating from 1 to 5 stars</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="feedbackCategory" class="form-label">Category</label>
                                    <select class="form-select" id="feedbackCategory" required aria-describedby="feedbackCategoryHelp">
                                        <option value="">Select Category</option>
                                        <option value="Service">Service</option>
                                        <option value="Food">Food</option>
                                        <option value="Cleanliness">Cleanliness</option>
                                        <option value="Other">Other</option>
                                    </select>
                                    <div class="invalid-feedback" id="feedbackCategoryFeedback"></div>
                                    <div id="feedbackCategoryHelp" class="form-text">Select the category of feedback</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="feedbackComment" class="form-label">Comment</label>
                                    <textarea class="form-control" id="feedbackComment" rows="3" required placeholder="Please share your experience..." aria-describedby="feedbackCommentHelp"></textarea>
                                    <div class="invalid-feedback" id="feedbackCommentFeedback"></div>
                                    <div id="feedbackCommentHelp" class="form-text">Please provide detailed feedback about your experience</div>
                                </div>
                                
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="fas fa-save"></i> Submit Feedback
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Data Records</h5>
                        </div>
                        <div class="card-body">
                            <ul class="nav nav-tabs mb-3" id="dataTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="sales-tab" data-bs-toggle="tab" data-bs-target="#sales" type="button" role="tab" aria-selected="true">Sales Data</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="feedback-tab" data-bs-toggle="tab" data-bs-target="#feedback" type="button" role="tab" aria-selected="false">Customer Feedback</button>
                                </li>
                            </ul>
                            
                            <div class="tab-content" id="dataTabsContent">
                                <div class="tab-pane fade show active" id="sales" role="tabpanel">
                                    <div class="table-responsive">
                                        <table class="table table-hover" aria-label="Sales data table">
                                            <thead>
                                                <tr>
                                                    <th>Date</th>
                                                    <th>Branch</th>
                                                    <th>Channel</th>
                                                    <th>Transactions</th>
                                                    <th>Sales (AED)</th>
                                                    <th>Average per Order</th>
                                                    <th>Offer Type</th>
                                                    <th>Offer Status</th>
                                                    <th>Notes</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="dataTable">
                                                <!-- Table content will be populated by JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="feedback" role="tabpanel">
                                    <div class="table-responsive">
                                        <table class="table table-hover" aria-label="Feedback data table">
                                            <thead>
                                                <tr>
                                                    <th>Date</th>
                                                    <th>Branch</th>
                                                    <th>Rating</th>
                                                    <th>Category</th>
                                                    <th>Comment</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="feedbackTable">
                                                <!-- Feedback table content will be populated by JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Management Report Page -->
        <div id="management-report-page" class="page-content" style="display: none;">
            <div class="page-header">
                <h1>Management Report</h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item active">Management Report</li>
                    </ol>
                </nav>
            </div>

            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Executive Summary</h5>
                </div>
                <div class="card-body">
                    <p>This report analyzes Crispy Chicken's sales data from <span id="reportDateRange">October 1-14, 2025</span>. During this period, the company achieved total sales of <span id="reportTotalSales">0</span> AED with <span id="reportTotalTransactions">0</span> transactions completed. The average transaction value was <span id="reportAvgTransaction">0</span> AED. Overall, the company performed well during this period, with particularly strong performance from the Hamdan St and Khaldia branches.</p>
                    <p>During the reporting period, we observed that weekend sales were significantly higher than weekdays, indicating that our marketing activities are more effective on weekends. Additionally, the Ultimate offer type had the highest conversion rate, suggesting we should promote more of these offers in the future.</p>
                </div>
            </div>

            <!-- Monthly Summary Section -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Monthly Summary</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" aria-label="Monthly summary table">
                            <thead>
                                <tr>
                                    <th>Month</th>
                                    <th>Branch</th>
                                    <th>Total Orders</th>
                                    <th>Total Sales (AED)</th>
                                    <th>Average Order (AED)</th>
                                    <th>Growth vs Last Month (%)</th>
                                    <th>Growth vs Last Year (%)</th>
                                    <th>Best Day</th>
                                </tr>
                            </thead>
                            <tbody id="monthlySummaryTable">
                                <!-- Table content will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Branch Performance Analysis</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="branchPerformanceChart"></canvas>
                            </div>
                            <div class="mt-3">
                                <h6>Key Findings:</h6>
                                <ul id="branchPerformanceFindings">
                                    <!-- Findings will be populated by JavaScript -->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Daily & Weekly Performance</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="dailyWeeklyPerformanceChart"></canvas>
                            </div>
                            <div class="mt-3">
                                <h6>Key Findings:</h6>
                                <ul id="dailyWeeklyFindings">
                                    <!-- Findings will be populated by JavaScript -->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Monthly Trend Analysis</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="monthlyTrendChart"></canvas>
                            </div>
                            <div class="mt-3">
                                <h6>Key Findings:</h6>
                                <ul id="monthlyTrendFindings">
                                    <!-- Findings will be populated by JavaScript -->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Target Distribution Plan</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="targetPlanChart"></canvas>
                            </div>
                            <div class="mt-3">
                                <h6>Target Distribution Recommendations:</h6>
                                <ul id="targetPlanFindings">
                                    <!-- Findings will be populated by JavaScript -->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">Customer Feedback Analysis</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="text-center">
                                <h3 id="reportTotalFeedback">0</h3>
                                <p>Total Feedback</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center">
                                <h3 id="reportAvgRating">0.0</h3>
                                <p>Average Rating</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center">
                                <h3 id="reportPositiveFeedback">0%</h3>
                                <p>Positive Feedback (4-5 stars)</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <h6>Top Feedback Categories</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="chart-container" style="height: 250px;">
                                    <canvas id="feedbackCategoryReportChart"></canvas>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="chart-container" style="height: 250px;">
                                    <canvas id="feedbackRatingReportChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <h6>Feedback Insights</h6>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i> 
                            <strong>Key Feedback Insights:</strong> 
                            <ul id="feedbackInsightsList">
                                <!-- Insights will be populated by JavaScript -->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">Management Recommendations</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <h6>Short-term Recommendations</h6>
                            <ul id="shortTermManagementRecommendations">
                                <!-- Recommendations will be populated by JavaScript -->
                            </ul>
                        </div>
                        <div class="col-md-4">
                            <h6>Medium-term Strategy Adjustments</h6>
                            <ul id="mediumTermManagementRecommendations">
                                <!-- Recommendations will be populated by JavaScript -->
                            </ul>
                        </div>
                        <div class="col-md-4">
                            <h6>Long-term Development Plans</h6>
                            <ul id="longTermManagementRecommendations">
                                <!-- Recommendations will be populated by JavaScript -->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Feedback Management Page -->
        <div id="feedback-management-page" class="page-content" style="display: none;">
            <div class="page-header">
                <h1>Customer Feedback Management</h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item active">Feedback Management</li>
                    </ol>
                </nav>
            </div>

            <!-- Feedback Summary Cards -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="feedbackTotal">0</div>
                        <div class="metric-label">Total Feedback</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="feedbackAvgRating">0.0</div>
                        <div class="metric-label">Average Rating</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="feedbackPositive">0%</div>
                        <div class="metric-label">Positive Feedback</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="feedbackNegative">0%</div>
                        <div class="metric-label">Negative Feedback</div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Feedback Management Tabs -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Feedback Management</h5>
                </div>
                <div class="card-body">
                    <ul class="nav nav-tabs" id="feedbackManagementTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="feedback-overview-tab" data-bs-toggle="tab" data-bs-target="#feedback-overview" type="button" role="tab" aria-selected="true">Overview</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="feedback-branch-tab" data-bs-toggle="tab" data-bs-target="#feedback-branch" type="button" role="tab" aria-selected="false">Branch Performance</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="feedback-category-tab" data-bs-toggle="tab" data-bs-target="#feedback-category" type="button" role="tab" aria-selected="false">Category Management</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="feedback-list-tab" data-bs-toggle="tab" data-bs-target="#feedback-list" type="button" role="tab" aria-selected="false">Feedback List</button>
                        </li>
                    </ul>
                    
                    <div class="tab-content" id="feedbackManagementTabsContent">
                        <!-- Overview Tab -->
                        <div class="tab-pane fade show active" id="feedback-overview" role="tabpanel">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="mb-0">Feedback by Category</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="chart-container" style="height: 300px;">
                                                <canvas id="feedbackOverviewCategoryChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="mb-0">Rating Distribution</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="chart-container" style="height: 300px;">
                                                <canvas id="feedbackOverviewRatingChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Branch Performance Tab -->
                        <div class="tab-pane fade" id="feedback-branch" role="tabpanel">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5 class="mb-0">Branch Performance Overview</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container" style="height: 300px;">
                                        <canvas id="feedbackBranchPerformanceChart"></canvas>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Branch Performance Metrics</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" aria-label="Branch performance metrics table">
                                            <thead>
                                                <tr>
                                                    <th>Branch</th>
                                                    <th>Total Feedback</th>
                                                    <th>Average Rating</th>
                                                    <th>Positive Feedback</th>
                                                    <th>Negative Feedback</th>
                                                    <th>Most Common Category</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="branchPerformanceTable">
                                                <!-- Branch performance data will be populated by JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Category Management Tab -->
                        <div class="tab-pane fade" id="feedback-category" role="tabpanel">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5 class="mb-0">Category Management</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <h6>Add New Category</h6>
                                            <form id="addCategoryForm">
                                                <div class="mb-3">
                                                    <label for="newCategoryName" class="form-label">Category Name</label>
                                                    <input type="text" class="form-control" id="newCategoryName" required aria-describedby="newCategoryNameHelp">
                                                    <div class="form-text">Enter a unique category name</div>
                                                    <div class="invalid-feedback" id="newCategoryNameFeedback"></div>
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label class="form-label">Category Color</label>
                                                    <div class="category-color-picker" id="categoryColorPicker">
                                                        <div class="color-option selected" style="background-color: #17a2b8;" data-color="#17a2b8"></div>
                                                        <div class="color-option" style="background-color: #ff6b35;" data-color="#ff6b35"></div>
                                                        <div class="color-option" style="background-color: #28a745;" data-color="#28a745"></div>
                                                        <div class="color-option" style="background-color: #ffc107;" data-color="#ffc107"></div>
                                                        <div class="color-option" style="background-color: #dc3545;" data-color="#dc3545"></div>
                                                        <div class="color-option" style="background-color: #6f42c1;" data-color="#6f42c1"></div>
                                                        <div class="color-option" style="background-color: #20c997;" data-color="#20c997"></div>
                                                        <div class="color-option" style="background-color: #fd7e14;" data-color="#fd7e14"></div>
                                                    </div>
                                                </div>
                                                
                                                <button type="submit" class="btn btn-primary">Add Category</button>
                                            </form>
                                        </div>
                                        <div class="col-md-6">
                                            <h6>Existing Categories</h6>
                                            <div id="existingCategories">
                                                <!-- Existing categories will be populated by JavaScript -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Feedback List Tab -->
                        <div class="tab-pane fade" id="feedback-list" role="tabpanel">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Customer Feedback List</h5>
                                </div>
                                <div class="card-body">
                                    <div id="feedbackListContainer">
                                        <!-- Feedback list will be populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Offer Modal -->
    <div class="modal fade" id="addOfferModal" tabindex="-1" aria-labelledby="addOfferModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addOfferModalLabel">Add New Offer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addOfferForm">
                        <div class="mb-3">
                            <label for="offerName" class="form-label">Offer Name</label>
                            <input type="text" class="form-control" id="offerName" required>
                        </div>
                        <div class="mb-3">
                            <label for="offerType" class="form-label">Offer Type</label>
                            <select class="form-select" id="offerType" required>
                                <option value="">Select Type</option>
                                <option value="Normal Day">Normal Day</option>
                                <option value="Chicken Day">Chicken Day</option>
                                <option value="Ultimate">Ultimate</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="offerDiscount" class="form-label">Discount (%)</label>
                            <input type="number" class="form-control" id="offerDiscount" min="0" max="100" required>
                        </div>
                        <div class="mb-3">
                            <label for="offerStartDate" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="offerStartDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="offerEndDate" class="form-label">End Date</label>
                            <input type="date" class="form-control" id="offerEndDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="offerStatus" class="form-label">Status</label>
                            <select class="form-select" id="offerStatus" required>
                                <option value="">Select Status</option>
                                <option value="Active">Active</option>
                                <option value="Inactive">Inactive</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addOffer()">Add Offer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div class="modal fade" id="importModal" tabindex="-1" aria-labelledby="importModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="importModalLabel">Import Data</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="importType" class="form-label">Import Type</label>
                        <select class="form-select" id="importType">
                            <option value="sales">Sales Data</option>
                            <option value="feedback">Customer Feedback</option>
                            <option value="both">Both</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="importFile" class="form-label">Select File</label>
                        <input type="file" class="form-control" id="importFile" accept=".xlsx,.xls,.json">
                    </div>
                    <div class="form-text">
                        Supported formats: Excel (.xlsx, .xls) and JSON (.json)
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="performImport()">Import</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
        // Global variables
        let salesData = [];
        let feedbackData = [];
        let offers = [];
        let charts = {};
        let undoStack = [];
        let currentPage = 'dashboard';
        let monthlyTargets = {};
        let selectedDistributionMethod = 'performance';
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            loadSampleData();
            updateDataStats();
            updateDashboard();
            updateFeedbackSummary();
            loadFromLocalStorage();
            initializeTargetPlan();
        });
        
        // Initialize the application
        function initializeApp() {
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('startDate').value = today;
            document.getElementById('endDate').value = today;
            
            // Set current date for forms
            document.getElementById('dateInput').value = today;
            document.getElementById('feedbackDate').value = today;
            
            // Initialize rating input
            initializeRatingInput();
            
            // Initialize file drop area
            initializeFileDropArea();
            
            // Initialize category color picker
            initializeCategoryColorPicker();
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Navigation links
            document.querySelectorAll('.navbar-nav .nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const pageId = this.getAttribute('data-page');
                    showPage(pageId);
                });
            });
            
            // Sales data form
            document.getElementById('salesDataForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveSalesData();
            });
            
            // Feedback form
            document.getElementById('feedbackForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveFeedback();
            });
            
            // Add category form
            document.getElementById('addCategoryForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addFeedbackCategory();
            });
            
            // Auto-save toggle
            document.getElementById('autoSaveToggle').addEventListener('change', function() {
                updateSaveStatus();
            });
            
            // Auto-refresh checkbox
            document.getElementById('autoRefresh').addEventListener('change', function() {
                if (this.checked) {
                    updateDashboard();
                }
            });
            
            // Date inputs change event
            document.getElementById('startDate').addEventListener('change', function() {
                if (document.getElementById('autoRefresh').checked) {
                    updateDashboard();
                }
            });
            
            document.getElementById('endDate').addEventListener('change', function() {
                if (document.getElementById('autoRefresh').checked) {
                    updateDashboard();
                }
            });
            
            // Calculate average when sales or transactions change
            document.getElementById('salesInput').addEventListener('input', calculateAverage);
            document.getElementById('transactionsInput').addEventListener('input', calculateAverage);
            
            // Target month change event
            document.getElementById('targetMonth').addEventListener('change', function() {
                updateTargetPlan();
            });
            
            // Total target input change event
            document.getElementById('totalTargetInput').addEventListener('input', function() {
                updateTargetPreview();
            });
        }
        
        // Initialize rating input
        function initializeRatingInput() {
            const ratingStars = document.querySelectorAll('#feedbackRating i');
            const ratingValue = document.getElementById('feedbackRatingValue');
            
            ratingStars.forEach(star => {
                star.addEventListener('click', function() {
                    const rating = parseInt(this.getAttribute('data-rating'));
                    ratingValue.value = rating;
                    
                    // Update visual state
                    ratingStars.forEach((s, index) => {
                        if (index < rating) {
                            s.classList.add('active');
                        } else {
                            s.classList.remove('active');
                        }
                    });
                    
                    // Clear validation error
                    document.getElementById('feedbackRating').classList.remove('is-invalid');
                    document.getElementById('feedbackRatingFeedback').textContent = '';
                });
                
                // Keyboard navigation
                star.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        this.click();
                    }
                });
            });
        }
        
        // Initialize file drop area
        function initializeFileDropArea() {
            const fileDropArea = document.getElementById('fileDropArea');
            const fileInput = document.getElementById('excelFileInput');
            const browseLink = document.getElementById('browseLink');
            
            // Browse link click
            browseLink.addEventListener('click', function(e) {
                e.preventDefault();
                fileInput.click();
            });
            
            // File input change
            fileInput.addEventListener('change', function() {
                if (this.files.length > 0) {
                    handleFileSelect(this.files[0]);
                }
            });
            
            // Drag and drop events
            fileDropArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('drag-over');
            });
            
            fileDropArea.addEventListener('dragleave', function() {
                this.classList.remove('drag-over');
            });
            
            fileDropArea.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                
                if (e.dataTransfer.files.length > 0) {
                    handleFileSelect(e.dataTransfer.files[0]);
                }
            });
        }
        
        // Initialize category color picker
        function initializeCategoryColorPicker() {
            const colorOptions = document.querySelectorAll('.color-option');
            colorOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Remove selected class from all options
                    colorOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    // Add selected class to clicked option
                    this.classList.add('selected');
                });
            });
        }
        
        // Handle file selection
        function handleFileSelect(file) {
            const fileDropArea = document.getElementById('fileDropArea');
            const importBtn = document.getElementById('importExcelBtn');
            
            // Update UI to show file selected
            fileDropArea.querySelector('p').textContent = `Selected: ${file.name}`;
            
            // Show import button
            importBtn.classList.remove('d-none');
            
            // Store selected file
            window.selectedFile = file;
        }
        
        // Calculate average per order
        function calculateAverage() {
            const sales = parseFloat(document.getElementById('salesInput').value) || 0;
            const transactions = parseInt(document.getElementById('transactionsInput').value) || 0;
            
            if (transactions > 0) {
                const average = sales / transactions;
                document.getElementById('averageInput').value = average.toFixed(2);
            } else {
                document.getElementById('averageInput').value = '0.00';
            }
        }
        
        // Show page
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(page => {
                page.style.display = 'none';
            });
            
            // Show selected page
            document.getElementById(`${pageId}-page`).style.display = 'block';
            
            // Update navigation
            document.querySelectorAll('.navbar-nav .nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`[data-page="${pageId}"]`).classList.add('active');
            
            // Update current page
            currentPage = pageId;
            
            // Update page-specific content
            switch(pageId) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'data-entry':
                    updateDataStats();
                    updateDataTable();
                    updateFeedbackTable();
                    break;
                case 'management-report':
                    updateManagementReport();
                    break;
                case 'feedback-management':
                    updateFeedbackManagement();
                    break;
            }
        }
        
        // Set date range
        function setDateRange(range) {
            const today = new Date();
            const startDate = document.getElementById('startDate');
            const endDate = document.getElementById('endDate');
            
            switch(range) {
                case 'today':
                    const todayStr = today.toISOString().split('T')[0];
                    startDate.value = todayStr;
                    endDate.value = todayStr;
                    break;
                case 'yesterday':
                    const yesterday = new Date(today);
                    yesterday.setDate(yesterday.getDate() - 1);
                    const yesterdayStr = yesterday.toISOString().split('T')[0];
                    startDate.value = yesterdayStr;
                    endDate.value = yesterdayStr;
                    break;
                case 'last7days':
                    const lastWeek = new Date(today);
                    lastWeek.setDate(lastWeek.getDate() - 7);
                    startDate.value = lastWeek.toISOString().split('T')[0];
                    endDate.value = today.toISOString().split('T')[0];
                    break;
                case 'last30days':
                    const lastMonth = new Date(today);
                    lastMonth.setDate(lastMonth.getDate() - 30);
                    startDate.value = lastMonth.toISOString().split('T')[0];
                    endDate.value = today.toISOString().split('T')[0];
                    break;
                case 'thismonth':
                    const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
                    startDate.value = firstDayOfMonth.toISOString().split('T')[0];
                    endDate.value = today.toISOString().split('T')[0];
                    break;
                case 'lastmonth':
                    const firstDayOfLastMonth = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                    const lastDayOfLastMonth = new Date(today.getFullYear(), today.getMonth(), 0);
                    startDate.value = firstDayOfLastMonth.toISOString().split('T')[0];
                    endDate.value = lastDayOfLastMonth.toISOString().split('T')[0];
                    break;
            }
            
            updateDashboard();
        }
        
        // Update dashboard
        function updateDashboard() {
            // Get date range
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            // Filter data based on date range
            let filteredSales = salesData.filter(sale => {
                const saleDate = new Date(sale.date);
                return saleDate >= new Date(startDate) && saleDate <= new Date(endDate);
            });
            
            // Apply branch filter
            const branchFilter = document.getElementById('branchFilter').value;
            if (branchFilter !== 'all') {
                filteredSales = filteredSales.filter(sale => sale.branch === branchFilter);
            }
            
            // Apply offer filter
            const offerFilter = document.getElementById('offerFilter').value;
            if (offerFilter !== 'all') {
                filteredSales = filteredSales.filter(sale => sale.offerType === offerFilter);
            }
            
            // Calculate metrics
            const totalSales = filteredSales.reduce((sum, sale) => sum + parseFloat(sale.sales), 0);
            const totalTransactions = filteredSales.reduce((sum, sale) => sum + parseInt(sale.transactions), 0);
            const avgTransaction = totalTransactions > 0 ? totalSales / totalTransactions : 0;
            
            // Calculate dynamic target based on historical data
            const avgDailySales = totalSales / Math.max(1, filteredSales.length);
            const targetSales = avgDailySales * 30; // Monthly target based on average daily sales
            const targetAchievement = targetSales > 0 ? Math.min(100, (totalSales / targetSales) * 100) : 0;
            
            // Update metric cards
            document.getElementById('totalSales').textContent = formatCurrency(totalSales);
            document.getElementById('totalTransactions').textContent = totalTransactions;
            document.getElementById('avgTransaction').textContent = formatCurrency(avgTransaction);
            document.getElementById('targetAchievement').textContent = `${targetAchievement.toFixed(1)}%`;
            
            // Update charts
            updateSalesTrendChart(filteredSales);
            updateBranchSalesChart(filteredSales);
            updateDailySalesTable(filteredSales);
            updatePerformanceCharts(filteredSales);
            updateTrendsCharts(filteredSales);
            updateInsights(filteredSales);
            updateFeedbackAnalysis(filteredSales);
        }
        
        // Format currency
        function formatCurrency(value) {
            return new Intl.NumberFormat('en-AE', {
                style: 'currency',
                currency: 'AED',
                minimumFractionDigits: 2
            }).format(value);
        }
        
        // Update sales trend chart
        function updateSalesTrendChart(data) {
            const ctx = document.getElementById('salesTrendChart');
            if (!ctx) return;
            
            // Group data by date
            const groupedData = {};
            data.forEach(sale => {
                if (!groupedData[sale.date]) {
                    groupedData[sale.date] = 0;
                }
                groupedData[sale.date] += parseFloat(sale.sales);
            });
            
            // Sort dates
            const sortedDates = Object.keys(groupedData).sort();
            
            // Destroy existing chart if it exists
            if (charts.salesTrend) {
                charts.salesTrend.destroy();
            }
            
            // Create new chart
            charts.salesTrend = new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: sortedDates,
                    datasets: [{
                        label: 'Sales (AED)',
                        data: sortedDates.map(date => groupedData[date]),
                        borderColor: '#ff6b35',
                        backgroundColor: 'rgba(255, 107, 53, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Sales: ${formatCurrency(context.parsed.y)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Update branch sales chart
        function updateBranchSalesChart(data) {
            const ctx = document.getElementById('branchSalesChart');
            if (!ctx) return;
            
            // Group data by branch
            const groupedData = {};
            data.forEach(sale => {
                if (!groupedData[sale.branch]) {
                    groupedData[sale.branch] = 0;
                }
                groupedData[sale.branch] += parseFloat(sale.sales);
            });
            
            // Destroy existing chart if it exists
            if (charts.branchSales) {
                charts.branchSales.destroy();
            }
            
            // Create new chart
            charts.branchSales = new Chart(ctx.getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(groupedData),
                    datasets: [{
                        data: Object.values(groupedData),
                        backgroundColor: [
                            '#ff6b35',
                            '#f7931e',
                            '#ffc107',
                            '#28a745',
                            '#17a2b8',
                            '#6f42c1',
                            '#dc3545'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${formatCurrency(context.parsed)}`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Update daily sales table
        function updateDailySalesTable(data) {
            const tbody = document.getElementById('dailySalesTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Sort data by date
            const sortedData = [...data].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Limit to 10 records
            const displayData = sortedData.slice(0, 10);
            
            displayData.forEach(sale => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${sale.date}</td>
                    <td>${sale.branch}</td>
                    <td>${sale.channel}</td>
                    <td>${sale.transactions}</td>
                    <td>${formatCurrency(sale.sales)}</td>
                    <td>${formatCurrency(parseFloat(sale.sales) / parseInt(sale.transactions))}</td>
                    <td><span class="offer-badge offer-${sale.offerType.toLowerCase().replace(' ', '')}">${sale.offerType}</span></td>
                    <td><span class="badge ${sale.offerStatus === 'Active' ? 'bg-success' : 'bg-secondary'}">${sale.offerStatus}</span></td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Update performance charts
        function updatePerformanceCharts(data) {
            // Branch performance radar chart
            const radarCtx = document.getElementById('branchPerformanceRadarChart');
            if (!radarCtx) return;
            
            // Group data by branch
            const branchData = {};
            data.forEach(sale => {
                if (!branchData[sale.branch]) {
                    branchData[sale.branch] = {
                        sales: 0,
                        transactions: 0,
                        avgSale: 0
                    };
                }
                branchData[sale.branch].sales += parseFloat(sale.sales);
                branchData[sale.branch].transactions += parseInt(sale.transactions);
            });
            
            // Calculate average sales per branch
            Object.keys(branchData).forEach(branch => {
                const branchInfo = branchData[branch];
                branchInfo.avgSale = branchInfo.transactions > 0 ? branchInfo.sales / branchInfo.transactions : 0;
            });
            
            // Normalize data for radar chart
            const maxSales = Math.max(...Object.values(branchData).map(d => d.sales));
            const maxTransactions = Math.max(...Object.values(branchData).map(d => d.transactions));
            const maxAvgSale = Math.max(...Object.values(branchData).map(d => d.avgSale));
            
            // Destroy existing chart if it exists
            if (charts.branchPerformanceRadar) {
                charts.branchPerformanceRadar.destroy();
            }
            
            // Create new chart
            charts.branchPerformanceRadar = new Chart(radarCtx.getContext('2d'), {
                type: 'radar',
                data: {
                    labels: Object.keys(branchData),
                    datasets: [{
                        label: 'Sales',
                        data: Object.keys(branchData).map(branch => (branchData[branch].sales / maxSales) * 100),
                        borderColor: '#ff6b35',
                        backgroundColor: 'rgba(255, 107, 53, 0.2)'
                    }, {
                        label: 'Transactions',
                        data: Object.keys(branchData).map(branch => (branchData[branch].transactions / maxTransactions) * 100),
                        borderColor: '#f7931e',
                        backgroundColor: 'rgba(247, 147, 30, 0.2)'
                    }, {
                        label: 'Avg. Sale',
                        data: Object.keys(branchData).map(branch => (branchData[branch].avgSale / maxAvgSale) * 100),
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.2)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
            
            // Branch performance ranking chart
            const rankingCtx = document.getElementById('branchPerformanceRankingChart');
            if (!rankingCtx) return;
            
            // Destroy existing chart if it exists
            if (charts.branchPerformanceRanking) {
                charts.branchPerformanceRanking.destroy();
            }
            
            // Create new chart
            charts.branchPerformanceRanking = new Chart(rankingCtx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: Object.keys(branchData),
                    datasets: [{
                        label: 'Total Sales (AED)',
                        data: Object.values(branchData).map(d => d.sales),
                        backgroundColor: '#ff6b35'
                    }, {
                        label: 'Avg. Transaction (AED)',
                        data: Object.values(branchData).map(d => d.avgSale),
                        backgroundColor: '#f7931e'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Update performance metrics
            const bestBranch = Object.keys(branchData).reduce((a, b) => 
                branchData[a].sales > branchData[b].sales ? a : b
            );
            const highestTransactionsBranch = Object.keys(branchData).reduce((a, b) => 
                branchData[a].transactions > branchData[b].transactions ? a : b
            );
            const highestAvgSaleBranch = Object.keys(branchData).reduce((a, b) => 
                branchData[a].avgSale > branchData[b].avgSale ? a : b
            );
            
            const bestBranchEl = document.getElementById('bestBranch');
            const highestTransactionsBranchEl = document.getElementById('highestTransactionsBranch');
            const highestAvgSaleBranchEl = document.getElementById('highestAvgSaleBranch');
            
            if (bestBranchEl) bestBranchEl.textContent = bestBranch;
            if (highestTransactionsBranchEl) highestTransactionsBranchEl.textContent = highestTransactionsBranch;
            if (highestAvgSaleBranchEl) highestAvgSaleBranchEl.textContent = highestAvgSaleBranch;
        }
        
        // Update trends charts
        function updateTrendsCharts(data) {
            // Daily trends chart
            const dailyCtx = document.getElementById('dailyTrendsChart');
            if (!dailyCtx) return;
            
            // Group data by date
            const dailyData = {};
            data.forEach(sale => {
                if (!dailyData[sale.date]) {
                    dailyData[sale.date] = {
                        sales: 0,
                        transactions: 0
                    };
                }
                dailyData[sale.date].sales += parseFloat(sale.sales);
                dailyData[sale.date].transactions += parseInt(sale.transactions);
            });
            
            // Sort dates
            const sortedDates = Object.keys(dailyData).sort();
            
            // Destroy existing chart if it exists
            if (charts.dailyTrends) {
                charts.dailyTrends.destroy();
            }
            
            // Create new chart
            charts.dailyTrends = new Chart(dailyCtx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: sortedDates,
                    datasets: [{
                        label: 'Daily Sales',
                        data: sortedDates.map(date => dailyData[date].sales),
                        borderColor: '#ff6b35',
                        backgroundColor: 'rgba(255, 107, 53, 0.1)',
                        yAxisID: 'y',
                        tension: 0.3
                    }, {
                        label: 'Daily Transactions',
                        data: sortedDates.map(date => dailyData[date].transactions),
                        borderColor: '#17a2b8',
                        backgroundColor: 'rgba(23, 162, 184, 0.1)',
                        yAxisID: 'y1',
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
            
            // Weekly trends chart
            const weeklyCtx = document.getElementById('weeklyTrendsChart');
            if (!weeklyCtx) return;
            
            // Group data by week
            const weeklyData = {};
            data.forEach(sale => {
                const date = new Date(sale.date);
                const weekStart = new Date(date);
                weekStart.setDate(date.getDate() - date.getDay());
                const weekKey = weekStart.toISOString().split('T')[0];
                
                if (!weeklyData[weekKey]) {
                    weeklyData[weekKey] = {
                        sales: 0,
                        transactions: 0
                    };
                }
                weeklyData[weekKey].sales += parseFloat(sale.sales);
                weeklyData[weekKey].transactions += parseInt(sale.transactions);
            });
            
            // Sort weeks
            const sortedWeeks = Object.keys(weeklyData).sort();
            
            // Destroy existing chart if it exists
            if (charts.weeklyTrends) {
                charts.weeklyTrends.destroy();
            }
            
            // Create new chart
            charts.weeklyTrends = new Chart(weeklyCtx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: sortedWeeks.map(week => `Week ${sortedWeeks.indexOf(week) + 1}`),
                    datasets: [{
                        label: 'Weekly Sales',
                        data: sortedWeeks.map(week => weeklyData[week].sales),
                        backgroundColor: '#ff6b35'
                    }, {
                        label: 'Weekly Transactions',
                        data: sortedWeeks.map(week => weeklyData[week].transactions),
                        backgroundColor: '#17a2b8'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
            
            // Moving average chart
            const movingAvgCtx = document.getElementById('movingAverageChart');
            if (!movingAvgCtx) return;
            
            // Calculate moving average
            const windowSize = 3;
            const movingAvgData = [];
            
            sortedDates.forEach((date, index) => {
                if (index >= windowSize - 1) {
                    const window = sortedDates.slice(index - windowSize + 1, index + 1);
                    const avgSales = window.reduce((sum, d) => sum + dailyData[d].sales, 0) / windowSize;
                    movingAvgData.push({
                        date: date,
                        movingAvg: avgSales
                    });
                }
            });
            
            // Destroy existing chart if it exists
            if (charts.movingAverage) {
                charts.movingAverage.destroy();
            }
            
            // Create new chart
            charts.movingAverage = new Chart(movingAvgCtx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: movingAvgData.map(d => d.date),
                    datasets: [{
                        label: 'Moving Average (3 days)',
                        data: movingAvgData.map(d => d.movingAvg),
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.3
                    }, {
                        label: 'Actual Sales',
                        data: movingAvgData.map(d => dailyData[d.date].sales),
                        borderColor: '#ff6b35',
                        backgroundColor: 'rgba(255, 107, 53, 0.1)',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Update insights
        function updateInsights(data) {
            const anomalyText = document.getElementById('anomalyText');
            const predictionText = document.getElementById('predictionText');
            const keyFindingsList = document.getElementById('keyFindingsList');
            
            if (!anomalyText || !predictionText || !keyFindingsList) return;
            
            // Calculate average daily sales
            const dailySales = {};
            data.forEach(sale => {
                if (!dailySales[sale.date]) {
                    dailySales[sale.date] = 0;
                }
                dailySales[sale.date] += parseFloat(sale.sales);
            });
            
            const salesValues = Object.values(dailySales);
            const avgSales = salesValues.reduce((a, b) => a + b, 0) / salesValues.length;
            const stdDev = Math.sqrt(salesValues.reduce((sum, val) => sum + Math.pow(val - avgSales, 2), 0) / salesValues.length);
            
            // Find anomalies (values outside 2 standard deviations)
            const anomalies = salesValues.filter(val => Math.abs(val - avgSales) > 2 * stdDev);
            
            if (anomalies.length > 0) {
                anomalyText.textContent = `Detected ${anomalies.length} anomaly${anomalies.length > 1 ? 'ies' : ''} in daily sales. Values outside normal range: ${anomalies.map(a => formatCurrency(a)).join(', ')}`;
            } else {
                anomalyText.textContent = 'No anomalies detected in daily sales data.';
            }
            
            // Simple linear regression for trend
            const n = salesValues.length;
            const xValues = Array.from({length: n}, (_, i) => i);
            const yValues = salesValues;
            
            const sumX = xValues.reduce((a, b) => a + b, 0);
            const sumY = yValues.reduce((a, b) => a + b, 0);
            const sumXY = xValues.reduce((sum, x, i) => sum + x * yValues[i], 0);
            const sumXX = xValues.reduce((sum, x) => sum + x * x, 0);
            
            const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;
            
            // Predict next day
            const nextDay = n;
            const nextDayPrediction = slope * nextDay + intercept;
            
            predictionText.textContent = `Based on current trend, predicted sales for next day: ${formatCurrency(nextDayPrediction)}`;
            
            // Generate data-driven findings
            const findings = generateDataDrivenFindings(data);
            
            keyFindingsList.innerHTML = '';
            findings.forEach(finding => {
                const li = document.createElement('li');
                li.className = 'list-group-item';
                li.textContent = finding;
                keyFindingsList.appendChild(li);
            });
        }
        
        // Generate data-driven findings
        function generateDataDrivenFindings(data) {
            const findings = [];
            
            // Group data by day of week
            const dayOfWeekData = {};
            data.forEach(sale => {
                const dayOfWeek = new Date(sale.date).toLocaleDateString('en-US', { weekday: 'long' });
                if (!dayOfWeekData[dayOfWeek]) {
                    dayOfWeekData[dayOfWeek] = { sales: 0, transactions: 0 };
                }
                dayOfWeekData[dayOfWeek].sales += parseFloat(sale.sales);
                dayOfWeekData[dayOfWeek].transactions += parseInt(sale.transactions);
            });
            
            // Find best performing day
            const bestDay = Object.keys(dayOfWeekData).reduce((a, b) => 
                dayOfWeekData[a].sales > dayOfWeekData[b].sales ? a : b
            );
            const worstDay = Object.keys(dayOfWeekData).reduce((a, b) => 
                dayOfWeekData[a].sales < dayOfWeekData[b].sales ? a : b
            );
            
            findings.push(`${bestDay} is the best performing day with ${formatCurrency(dayOfWeekData[bestDay].sales)} in sales`);
            findings.push(`${worstDay} shows the lowest sales at ${formatCurrency(dayOfWeekData[worstDay].sales)}`);
            
            // Analyze offer performance
            const offerData = {};
            data.forEach(sale => {
                if (!offerData[sale.offerType]) {
                    offerData[sale.offerType] = { sales: 0, transactions: 0 };
                }
                offerData[sale.offerType].sales += parseFloat(sale.sales);
                offerData[sale.offerType].transactions += parseInt(sale.transactions);
            });
            
            const bestOffer = Object.keys(offerData).reduce((a, b) => 
                offerData[a].sales > offerData[b].sales ? a : b
            );
            
            findings.push(`${bestOffer} offer generates the highest revenue at ${formatCurrency(offerData[bestOffer].sales)}`);
            
            // Branch performance
            const branchData = {};
            data.forEach(sale => {
                if (!branchData[sale.branch]) {
                    branchData[sale.branch] = 0;
                }
                branchData[sale.branch] += parseFloat(sale.sales);
            });
            
            const topBranch = Object.keys(branchData).reduce((a, b) => 
                branchData[a] > branchData[b] ? a : b
            );
            
            const totalSales = Object.values(branchData).reduce((a, b) => a + b, 0);
            const topBranchPercentage = ((branchData[topBranch] / totalSales) * 100).toFixed(1);
            
            findings.push(`${topBranch} leads with ${topBranchPercentage}% of total sales`);
            
            return findings;
        }
        
        // Update feedback analysis
        function updateFeedbackAnalysis(data) {
            // Get feedback data for the date range
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            const filteredFeedback = feedbackData.filter(feedback => {
                const feedbackDate = new Date(feedback.date);
                return feedbackDate >= new Date(startDate) && feedbackDate <= new Date(endDate);
            });
            
            // Update summary cards
            const totalFeedback = filteredFeedback.length;
            const avgRating = totalFeedback > 0 
                ? (filteredFeedback.reduce((sum, f) => sum + f.rating, 0) / totalFeedback).toFixed(1)
                : '0.0';
            
            const positiveFeedback = totalFeedback > 0 
                ? ((filteredFeedback.filter(f => f.rating >= 4).length / totalFeedback) * 100).toFixed(1)
                : '0';
            
            const totalFeedbackEl = document.getElementById('totalFeedback');
            const avgRatingEl = document.getElementById('avgRating');
            const positiveFeedbackEl = document.getElementById('positiveFeedback');
            
            if (totalFeedbackEl) totalFeedbackEl.textContent = totalFeedback;
            if (avgRatingEl) avgRatingEl.textContent = avgRating;
            if (positiveFeedbackEl) positiveFeedbackEl.textContent = `${positiveFeedback}%`;
            
            // Feedback by category chart
            const categoryCtx = document.getElementById('feedbackCategoryChart');
            if (categoryCtx) {
                // Group feedback by category
                const categoryData = {};
                filteredFeedback.forEach(feedback => {
                    if (!categoryData[feedback.category]) {
                        categoryData[feedback.category] = 0;
                    }
                    categoryData[feedback.category]++;
                });
                
                // Destroy existing chart if it exists
                if (charts.feedbackCategory) {
                    charts.feedbackCategory.destroy();
                }
                
                // Create new chart
                charts.feedbackCategory = new Chart(categoryCtx.getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: Object.keys(categoryData),
                        datasets: [{
                            data: Object.values(categoryData),
                            backgroundColor: [
                                '#17a2b8',
                                '#ff6b35',
                                '#28a745',
                                '#ffc107'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right'
                            }
                        }
                    }
                });
            }
            
            // Rating distribution chart
            const ratingCtx = document.getElementById('ratingDistributionChart');
            if (ratingCtx) {
                // Group feedback by rating
                const ratingData = {
                    '5': 0,
                    '4': 0,
                    '3': 0,
                    '2': 0,
                    '1': 0
                };
                
                filteredFeedback.forEach(feedback => {
                    ratingData[feedback.rating.toString()]++;
                });
                
                // Destroy existing chart if it exists
                if (charts.ratingDistribution) {
                    charts.ratingDistribution.destroy();
                }
                
                // Create new chart
                charts.ratingDistribution = new Chart(ratingCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(ratingData),
                        datasets: [{
                            label: 'Number of Ratings',
                            data: Object.values(ratingData),
                            backgroundColor: [
                                '#28a745',
                                '#28a745',
                                '#ffc107',
                                '#dc3545',
                                '#dc3545'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        }
                    }
                });
            }
            
            // Recent feedback list
            const recentFeedbackList = document.getElementById('recentFeedbackList');
            if (recentFeedbackList) {
                recentFeedbackList.innerHTML = '';
                
                // Sort feedback by date (newest first)
                const sortedFeedback = [...filteredFeedback].sort((a, b) => 
                    new Date(b.date) - new Date(a.date)
                );
                
                // Limit to 5 recent feedback
                const displayFeedback = sortedFeedback.slice(0, 5);
                
                displayFeedback.forEach(feedback => {
                    const feedbackCard = document.createElement('div');
                    feedbackCard.className = 'feedback-card';
                    
                    const ratingStars = ''.repeat(feedback.rating) + ''.repeat(5 - feedback.rating);
                    
                    feedbackCard.innerHTML = `
                        <h6>${feedback.branch} - ${feedback.date}</h6>
                        <p>${feedback.comment}</p>
                        <div class="feedback-meta">
                            <span class="feedback-category category-${feedback.category.toLowerCase()}">${feedback.category}</span>
                            <span>${ratingStars} (${feedback.rating}/5)</span>
                        </div>
                    `;
                    
                    recentFeedbackList.appendChild(feedbackCard);
                });
            }
        }
        
        // Update data stats
        function updateDataStats() {
            const salesRecordsCountEl = document.getElementById('salesRecordsCount');
            const offersCountEl = document.getElementById('offersCount');
            const feedbackCountEl = document.getElementById('feedbackCount');
            const totalDataSizeEl = document.getElementById('totalDataSize');
            
            if (salesRecordsCountEl) salesRecordsCountEl.textContent = salesData.length;
            if (offersCountEl) offersCountEl.textContent = offers.length;
            if (feedbackCountEl) feedbackCountEl.textContent = feedbackData.length;
            
            // Calculate total data size
            const dataSize = new Blob([JSON.stringify(salesData)]).size;
            const feedbackSize = new Blob([JSON.stringify(feedbackData)]).size;
            const offersSize = new Blob([JSON.stringify(offers)]).size;
            const totalSize = (dataSize + feedbackSize + offersSize) / 1024; // KB
            
            if (totalDataSizeEl) totalDataSizeEl.textContent = `${totalSize.toFixed(2)} KB`;
        }
        
        // Update data table
        function updateDataTable() {
            const tbody = document.getElementById('dataTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Sort data by date (newest first)
            const sortedData = [...salesData].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedData.forEach((sale, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${sale.date}</td>
                    <td>${sale.branch}</td>
                    <td>${sale.channel}</td>
                    <td>${sale.transactions}</td>
                    <td>${formatCurrency(sale.sales)}</td>
                    <td>${formatCurrency(parseFloat(sale.sales) / parseInt(sale.transactions))}</td>
                    <td><span class="offer-badge offer-${sale.offerType.toLowerCase().replace(' ', '')}">${sale.offerType}</span></td>
                    <td><span class="badge ${sale.offerStatus === 'Active' ? 'bg-success' : 'bg-secondary'}">${sale.offerStatus}</span></td>
                    <td>${sale.notes || '-'}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteSalesRecord(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Update feedback table
        function updateFeedbackTable() {
            const tbody = document.getElementById('feedbackTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Sort data by date (newest first)
            const sortedFeedback = [...feedbackData].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedFeedback.forEach((feedback, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${feedback.date}</td>
                    <td>${feedback.branch}</td>
                    <td>${''.repeat(feedback.rating)} (${feedback.rating}/5)</td>
                    <td><span class="feedback-category category-${feedback.category.toLowerCase()}">${feedback.category}</span></td>
                    <td>${feedback.comment}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteFeedbackRecord(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Save sales data
        function saveSalesData() {
            try {
                // Get form values
                const formData = {
                    date: document.getElementById('dateInput').value,
                    branch: document.getElementById('branchInput').value,
                    channel: document.getElementById('channelInput').value,
                    transactions: parseInt(document.getElementById('transactionsInput').value),
                    sales: parseFloat(document.getElementById('salesInput').value),
                    average: parseFloat(document.getElementById('averageInput').value),
                    offerType: document.getElementById('offerTypeInput').value,
                    offerStatus: document.getElementById('offerStatusInput').value,
                    notes: document.getElementById('notesInput').value
                };
                
                // Validate form
                if (!validateSalesForm(formData)) {
                    return;
                }
                
                // Add to data array
                salesData.push(formData);
                
                // Add to undo stack
                undoStack.push({
                    action: 'add',
                    type: 'sales',
                    data: formData
                });
                
                // Update all UI components
                updateAllUI();
                
                // Reset form
                document.getElementById('salesDataForm').reset();
                document.getElementById('averageInput').value = '0.00';
                
                // Show notification
                showNotification('Sales data saved successfully!', 'success');
                
                // Auto-save if enabled
                if (document.getElementById('autoSaveToggle').checked) {
                    autoSave();
                }
                
                // Save to local storage
                saveToLocalStorage();
            } catch (error) {
                console.error('Error saving sales data:', error);
                showNotification(`Error saving data: ${error.message}`, 'danger');
            }
        }
        
        // Update all UI components after data change
        function updateAllUI() {
            updateDataStats();
            updateDataTable();
            updateFeedbackTable();
            updateDashboard();
            updateFeedbackSummary();
            updateManagementReport();
            updateFeedbackManagement();
            updateOffersTable();
            
            // Update undo status
            const undoStatusEl = document.getElementById('undoStatus');
            if (undoStatusEl) {
                undoStatusEl.textContent = undoStack.length > 0 ? `${undoStack.length} actions available` : 'No actions to undo';
            }
        }
        
        // Validate sales form
        function validateSalesForm(data) {
            let isValid = true;
            
            // Clear previous validation
            document.querySelectorAll('.is-invalid').forEach(el => el.classList.remove('is-invalid'));
            document.querySelectorAll('.invalid-feedback').forEach(el => el.textContent = '');
            
            // Date validation
            if (!data.date || !isValidDate(data.date)) {
                document.getElementById('dateInput').classList.add('is-invalid');
                document.getElementById('dateInputFeedback').textContent = 'Valid date is required';
                isValid = false;
            }
            
            // Branch validation
            if (!data.branch || !isValidBranch(data.branch)) {
                document.getElementById('branchInput').classList.add('is-invalid');
                document.getElementById('branchInputFeedback').textContent = 'Valid branch is required';
                isValid = false;
            }
            
            // Channel validation
            if (!data.channel || !isValidChannel(data.channel)) {
                document.getElementById('channelInput').classList.add('is-invalid');
                document.getElementById('channelInputFeedback').textContent = 'Valid channel is required';
                isValid = false;
            }
            
            // Transactions validation
            if (isNaN(data.transactions) || data.transactions <= 0) {
                document.getElementById('transactionsInput').classList.add('is-invalid');
                document.getElementById('transactionsInputFeedback').textContent = 'Valid number of transactions is required';
                isValid = false;
            }
            
            // Sales validation
            if (isNaN(data.sales) || data.sales <= 0) {
                document.getElementById('salesInput').classList.add('is-invalid');
                document.getElementById('salesInputFeedback').textContent = 'Valid sales amount is required';
                isValid = false;
            }
            
            // Offer type validation
            if (!data.offerType || !isValidOfferType(data.offerType)) {
                document.getElementById('offerTypeInput').classList.add('is-invalid');
                document.getElementById('offerTypeInputFeedback').textContent = 'Valid offer type is required';
                isValid = false;
            }
            
            // Offer status validation
            if (!data.offerStatus || !isValidOfferStatus(data.offerStatus)) {
                document.getElementById('offerStatusInput').classList.add('is-invalid');
                document.getElementById('offerStatusInputFeedback').textContent = 'Valid offer status is required';
                isValid = false;
            }
            
            return isValid;
        }
        
        // Validation helper functions
        function isValidDate(dateString) {
            const date = new Date(dateString);
            return date instanceof Date && !isNaN(date);
        }
        
        function isValidBranch(branch) {
            const validBranches = [
                'Crispy Chicken-Hamdan St',
                'Crispy Chicken Khaldia',
                'Crispy Chicken Shabiya 11',
                'Crispy Chicken Muroor',
                'Crispy Chicken Al Barsha',
                'Crispy Chicken Al Satwa',
                'Crispy Chicken Al Rgga'
            ];
            return validBranches.includes(branch);
        }
        
        function isValidChannel(channel) {
            const validChannels = ['Delivery', 'Dine-in', 'Takeaway'];
            return validChannels.includes(channel);
        }
        
        function isValidOfferType(type) {
            const validTypes = ['Normal Day', 'Chicken Day', 'Ultimate'];
            return validTypes.includes(type);
        }
        
        function isValidOfferStatus(status) {
            const validStatuses = ['Active', 'No Offer'];
            return validStatuses.includes(status);
        }
        
        // Save feedback
        function saveFeedback() {
            try {
                // Get form values
                const formData = {
                    date: document.getElementById('feedbackDate').value,
                    branch: document.getElementById('feedbackBranch').value,
                    rating: parseInt(document.getElementById('feedbackRatingValue').value),
                    category: document.getElementById('feedbackCategory').value,
                    comment: document.getElementById('feedbackComment').value
                };
                
                // Validate form
                if (!validateFeedbackForm(formData)) {
                    return;
                }
                
                // Add to data array
                feedbackData.push(formData);
                
                // Add to undo stack
                undoStack.push({
                    action: 'add',
                    type: 'feedback',
                    data: formData
                });
                
                // Update all UI components
                updateAllUI();
                
                // Reset form
                document.getElementById('feedbackForm').reset();
                document.getElementById('feedbackRatingValue').value = '0';
                document.querySelectorAll('#feedbackRating i').forEach(star => {
                    star.classList.remove('active');
                });
                
                // Show notification
                showNotification('Feedback submitted successfully!', 'success');
                
                // Auto-save if enabled
                if (document.getElementById('autoSaveToggle').checked) {
                    autoSave();
                }
                
                // Save to local storage
                saveToLocalStorage();
            } catch (error) {
                console.error('Error saving feedback:', error);
                showNotification(`Error saving feedback: ${error.message}`, 'danger');
            }
        }
        
        // Validate feedback form
        function validateFeedbackForm(data) {
            let isValid = true;
            
            // Clear previous validation
            document.querySelectorAll('.is-invalid').forEach(el => el.classList.remove('is-invalid'));
            document.querySelectorAll('.invalid-feedback').forEach(el => el.textContent = '');
            
            // Date validation
            if (!data.date || !isValidDate(data.date)) {
                document.getElementById('feedbackDate').classList.add('is-invalid');
                document.getElementById('feedbackDateFeedback').textContent = 'Valid date is required';
                isValid = false;
            }
            
            // Branch validation
            if (!data.branch || !isValidBranch(data.branch)) {
                document.getElementById('feedbackBranch').classList.add('is-invalid');
                document.getElementById('feedbackBranchFeedback').textContent = 'Valid branch is required';
                isValid = false;
            }
            
            // Rating validation
            if (!data.rating || data.rating < 1) {
                document.getElementById('feedbackRating').classList.add('is-invalid');
                document.getElementById('feedbackRatingFeedback').textContent = 'Please select a rating';
                isValid = false;
            }
            
            // Category validation
            if (!data.category || !isValidFeedbackCategory(data.category)) {
                document.getElementById('feedbackCategory').classList.add('is-invalid');
                document.getElementById('feedbackCategoryFeedback').textContent = 'Valid category is required';
                isValid = false;
            }
            
            // Comment validation
            if (!data.comment || data.comment.trim().length < 10) {
                document.getElementById('feedbackComment').classList.add('is-invalid');
                document.getElementById('feedbackCommentFeedback').textContent = 'Please provide at least 10 characters for your comment';
                isValid = false;
            }
            
            return isValid;
        }
        
        function isValidFeedbackCategory(category) {
            const validCategories = ['Service', 'Food', 'Cleanliness', 'Other'];
            return validCategories.includes(category);
        }
        
        // Delete sales record
        function deleteSalesRecord(index) {
            if (confirm('Are you sure you want to delete this sales record?')) {
                const deletedRecord = salesData.splice(index, 1)[0];
                
                // Add to undo stack
                undoStack.push({
                    action: 'delete',
                    type: 'sales',
                    data: deletedRecord,
                    index: index
                });
                
                // Update all UI components
                updateAllUI();
                
                // Show notification
                showNotification('Sales record deleted successfully!', 'warning');
                
                // Auto-save if enabled
                if (document.getElementById('autoSaveToggle').checked) {
                    autoSave();
                }
                
                // Save to local storage
                saveToLocalStorage();
            }
        }
        
        // Delete feedback record
        function deleteFeedbackRecord(index) {
            if (confirm('Are you sure you want to delete this feedback record?')) {
                const deletedRecord = feedbackData.splice(index, 1)[0];
                
                // Add to undo stack
                undoStack.push({
                    action: 'delete',
                    type: 'feedback',
                    data: deletedRecord,
                    index: index
                });
                
                // Update all UI components
                updateAllUI();
                
                // Show notification
                showNotification('Feedback record deleted successfully!', 'warning');
                
                // Auto-save if enabled
                if (document.getElementById('autoSaveToggle').checked) {
                    autoSave();
                }
                
                // Save to local storage
                saveToLocalStorage();
            }
        }
        
        // Update save status
        function updateSaveStatus() {
            const statusElement = document.getElementById('saveStatus');
            const autoSaveToggle = document.getElementById('autoSaveToggle');
            
            if (autoSaveToggle.checked) {
                statusElement.textContent = 'Auto-save enabled';
                statusElement.className = 'save-status save-saved';
            } else {
                statusElement.textContent = 'Auto-save disabled';
                statusElement.className = 'save-status save-unsaved';
            }
        }
        
        // Save data
        function saveData() {
            // Simulate saving
            showLoadingOverlay(true);
            
            setTimeout(() => {
                showNotification('Data saved successfully!', 'success');
                const lastSavedTimeEl = document.getElementById('lastSavedTime');
                if (lastSavedTimeEl) lastSavedTimeEl.textContent = new Date().toLocaleString();
                
                const saveStatusEl = document.getElementById('saveStatus');
                if (saveStatusEl) {
                    saveStatusEl.textContent = 'Saved';
                    saveStatusEl.className = 'save-status save-saved';
                }
                showLoadingOverlay(false);
                
                // Save to local storage
                saveToLocalStorage();
            }, 1000);
        }
        
        // Auto-save
        function autoSave() {
            const statusElement = document.getElementById('saveStatus');
            if (statusElement) {
                statusElement.textContent = 'Saving...';
                statusElement.className = 'save-status save-saving';
            }
            
            // Simulate auto-save
            setTimeout(() => {
                if (statusElement) {
                    statusElement.textContent = 'Saved';
                    statusElement.className = 'save-status save-saved';
                }
                
                const lastSavedTimeEl = document.getElementById('lastSavedTime');
                if (lastSavedTimeEl) lastSavedTimeEl.textContent = new Date().toLocaleString();
                
                // Save to local storage
                saveToLocalStorage();
            }, 500);
        }
        
        // Export data
        function exportData() {
            try {
                // Prepare data for export
                const exportData = {
                    salesData: salesData,
                    feedbackData: feedbackData,
                    offers: offers,
                    exportDate: new Date().toISOString()
                };
                
                // Create blob
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                // Create download link
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `crispy-chicken-data-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                // Clean up
                URL.revokeObjectURL(url);
                
                showNotification('Data exported successfully!', 'success');
            } catch (error) {
                console.error('Error exporting data:', error);
                showNotification(`Error exporting data: ${error.message}`, 'danger');
            }
        }
        
        // Show import modal
        function showImportModal() {
            const importModal = new bootstrap.Modal(document.getElementById('importModal'));
            importModal.show();
        }
        
        // Perform import
        function performImport() {
            const importType = document.getElementById('importType').value;
            const importFile = document.getElementById('importFile').files[0];
            
            if (!importFile) {
                showNotification('Please select a file to import', 'warning');
                return;
            }
            
            // Read file
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    
                    if (importFile.name.endsWith('.json')) {
                        // JSON import
                        const importedData = JSON.parse(content);
                        
                        if (importType === 'sales' || importType === 'both') {
                            if (importedData.salesData && Array.isArray(importedData.salesData)) {
                                salesData = importedData.salesData;
                                showNotification(`${importedData.salesData.length} sales records imported!`, 'success');
                            }
                        }
                        
                        if (importType === 'feedback' || importType === 'both') {
                            if (importedData.feedbackData && Array.isArray(importedData.feedbackData)) {
                                feedbackData = importedData.feedbackData;
                                showNotification(`${importedData.feedbackData.length} feedback records imported!`, 'success');
                            }
                        }
                        
                        if (importedData.offers && Array.isArray(importedData.offers)) {
                            offers = importedData.offers;
                        }
                    } else if (importFile.name.endsWith('.xlsx') || importFile.name.endsWith('.xls')) {
                        // Excel import (simplified for demo)
                        showNotification('Excel import functionality would be implemented here', 'info');
                        return;
                    }
                    
                    // Update UI
                    updateAllUI();
                    
                    // Close modal
                    const importModal = bootstrap.Modal.getInstance(document.getElementById('importModal'));
                    if (importModal) importModal.hide();
                    
                    // Save to local storage
                    saveToLocalStorage();
                    
                } catch (error) {
                    showNotification('Error importing data: ' + error.message, 'danger');
                }
            };
            
            reader.readAsText(importFile);
        }
        
        // Clear all data
        function clearAllData() {
            if (confirm('Are you sure you want to clear all data? This action cannot be undone.')) {
                // Clear all data arrays
                salesData = [];
                feedbackData = [];
                offers = [];
                
                // Clear undo stack
                undoStack = [];
                
                // Clear LocalStorage
                localStorage.removeItem('crispyChickenData');
                
                // Update all UI components
                updateAllUI();
                
                // Clear charts
                Object.keys(charts).forEach(chartId => {
                    if (charts[chartId]) {
                        charts[chartId].destroy();
                        delete charts[chartId];
                    }
                });
                
                // Reset forms
                const salesForm = document.getElementById('salesDataForm');
                if (salesForm) {
                    salesForm.reset();
                    document.getElementById('averageInput').value = '0.00';
                }
                
                const feedbackForm = document.getElementById('feedbackForm');
                if (feedbackForm) {
                    feedbackForm.reset();
                    document.getElementById('feedbackRatingValue').value = '0';
                    document.querySelectorAll('#feedbackRating i').forEach(star => {
                        star.classList.remove('active');
                    });
                }
                
                // Reset date inputs to today
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('startDate').value = today;
                document.getElementById('endDate').value = today;
                document.getElementById('dateInput').value = today;
                document.getElementById('feedbackDate').value = today;
                
                // Reset filters
                document.getElementById('branchFilter').value = 'all';
                document.getElementById('offerFilter').value = 'all';
                
                // Clear tables
                const dataTable = document.getElementById('dataTable');
                if (dataTable) dataTable.innerHTML = '';
                
                const feedbackTable = document.getElementById('feedbackTable');
                if (feedbackTable) feedbackTable.innerHTML = '';
                
                const offersTable = document.getElementById('offersTable');
                if (offersTable) offersTable.innerHTML = '';
                
                const dailySalesTable = document.getElementById('dailySalesTable');
                if (dailySalesTable) dailySalesTable.innerHTML = '';
                
                // Clear feedback lists
                const recentFeedbackList = document.getElementById('recentFeedbackList');
                if (recentFeedbackList) recentFeedbackList.innerHTML = '';
                
                const feedbackListContainer = document.getElementById('feedbackListContainer');
                if (feedbackListContainer) feedbackListContainer.innerHTML = '';
                
                // Clear findings and recommendations
                const keyFindingsList = document.getElementById('keyFindingsList');
                if (keyFindingsList) keyFindingsList.innerHTML = '';
                
                const shortTermRecommendations = document.getElementById('shortTermRecommendations');
                if (shortTermRecommendations) shortTermRecommendations.innerHTML = '';
                
                const mediumTermRecommendations = document.getElementById('mediumTermRecommendations');
                if (mediumTermRecommendations) mediumTermRecommendations.innerHTML = '';
                
                const longTermRecommendations = document.getElementById('longTermRecommendations');
                if (longTermRecommendations) longTermRecommendations.innerHTML = '';
                
                // Reset metrics to zero
                const metrics = [
                    'totalSales', 'totalTransactions', 'avgTransaction', 'targetAchievement',
                    'totalFeedback', 'avgRating', 'positiveFeedback', 'feedbackNegative',
                    'feedbackTotal', 'feedbackAvgRating', 'feedbackPositive',
                    'reportTotalSales', 'reportTotalTransactions', 'reportAvgTransaction',
                    'reportTotalFeedback', 'reportAvgRating', 'reportPositiveFeedback'
                ];
                
                metrics.forEach(metricId => {
                    const element = document.getElementById(metricId);
                    if (element) {
                        if (metricId.includes('Sales') || metricId.includes('Transaction')) {
                            element.textContent = formatCurrency(0);
                        } else if (metricId.includes('Rating')) {
                            element.textContent = '0.0';
                        } else if (metricId.includes('Feedback')) {
                            element.textContent = '0%';
                        } else {
                            element.textContent = '0';
                        }
                    }
                });
                
                // Reset performance indicators
                const performanceIndicators = ['bestBranch', 'highestTransactionsBranch', 'highestAvgSaleBranch'];
                performanceIndicators.forEach(indicatorId => {
                    const element = document.getElementById(indicatorId);
                    if (element) element.textContent = '-';
                });
                
                // Reset save status
                const saveStatusEl = document.getElementById('saveStatus');
                if (saveStatusEl) {
                    saveStatusEl.textContent = 'No data';
                    saveStatusEl.className = 'save-status save-unsaved';
                }
                
                const lastSavedTimeEl = document.getElementById('lastSavedTime');
                if (lastSavedTimeEl) lastSavedTimeEl.textContent = 'Never';
                
                // Reset undo status
                const undoStatusEl = document.getElementById('undoStatus');
                if (undoStatusEl) undoStatusEl.textContent = 'No actions to undo';
                
                // Clear anomaly and prediction text
                const anomalyTextEl = document.getElementById('anomalyText');
                if (anomalyTextEl) anomalyTextEl.textContent = 'No data available for analysis';
                
                const predictionTextEl = document.getElementById('predictionText');
                if (predictionTextEl) predictionTextEl.textContent = 'No data available for prediction';
                
                // Show success notification
                showNotification('All data cleared successfully!', 'warning');
                
                // Re-initialize dashboard with empty data
                if (currentPage === 'dashboard') {
                    setTimeout(() => {
                        updateDashboard();
                    }, 100);
                }
            }
        }
        
        // Reset to sample data
        function resetToSample() {
            if (confirm('Are you sure you want to reset to sample data? This will replace all current data.')) {
                loadSampleData();
                updateAllUI();
                
                showNotification('Data reset to sample data successfully!', 'success');
                
                // Save to local storage
                saveToLocalStorage();
            }
        }
        
        // Load sample data
        function loadSampleData() {
            // Sample sales data
            salesData = [
                {
                    date: '2025-10-01',
                    branch: 'Crispy Chicken-Hamdan St',
                    channel: 'Dine-in',
                    transactions: 45,
                    sales: 2250.00,
                    average: 50.00,
                    offerType: 'Normal Day',
                    offerStatus: 'No Offer',
                    notes: 'Good start to the month'
                },
                {
                    date: '2025-10-01',
                    branch: 'Crispy Chicken Khaldia',
                    channel: 'Delivery',
                    transactions: 32,
                    sales: 1600.00,
                    average: 50.00,
                    offerType: 'Normal Day',
                    offerStatus: 'No Offer',
                    notes: ''
                },
                {
                    date: '2025-10-02',
                    branch: 'Crispy Chicken-Hamdan St',
                    channel: 'Takeaway',
                    transactions: 38,
                    sales: 1900.00,
                    average: 50.00,
                    offerType: 'Chicken Day',
                    offerStatus: 'Active',
                    notes: 'Chicken Day promotion successful'
                },
                {
                    date: '2025-10-03',
                    branch: 'Crispy Chicken Al Barsha',
                    channel: 'Dine-in',
                    transactions: 28,
                    sales: 1680.00,
                    average: 60.00,
                    offerType: 'Ultimate',
                    offerStatus: 'Active',
                    notes: 'Higher average transaction value'
                },
                {
                    date: '2025-10-04',
                    branch: 'Crispy Chicken-Hamdan St',
                    channel: 'Delivery',
                    transactions: 52,
                    sales: 2600.00,
                    average: 50.00,
                    offerType: 'Normal Day',
                    offerStatus: 'No Offer',
                    notes: 'High delivery volume'
                },
                {
                    date: '2025-10-05',
                    branch: 'Crispy Chicken Khaldia',
                    channel: 'Dine-in',
                    transactions: 41,
                    sales: 2050.00,
                    average: 50.00,
                    offerType: 'Normal Day',
                    offerStatus: 'No Offer',
                    notes: ''
                },
                {
                    date: '2025-10-06',
                    branch: 'Crispy Chicken-Hamdan St',
                    channel: 'Takeaway',
                    transactions: 58,
                    sales: 2900.00,
                    average: 50.00,
                    offerType: 'Ultimate',
                    offerStatus: 'Active',
                    notes: 'Ultimate offer performing well'
                },
                {
                    date: '2025-10-07',
                    branch: 'Crispy Chicken Al Barsha',
                    channel: 'Delivery',
                    transactions: 35,
                    sales: 2100.00,
                    average: 60.00,
                    offerType: 'Chicken Day',
                    offerStatus: 'Active',
                    notes: 'Strong delivery performance'
                },
                {
                    date: '2025-10-08',
                    branch: 'Crispy Chicken-Hamdan St',
                    channel: 'Dine-in',
                    transactions: 49,
                    sales: 2450.00,
                    average: 50.00,
                    offerType: 'Normal Day',
                    offerStatus: 'No Offer',
                    notes: 'Weekend dine-in traffic up'
                },
                {
                    date: '2025-10-09',
                    branch: 'Crispy Chicken Khaldia',
                    channel: 'Takeaway',
                    transactions: 36,
                    sales: 1800.00,
                    average: 50.00,
                    offerType: 'Normal Day',
                    offerStatus: 'No Offer',
                    notes: ''
                },
                {
                    date: '2025-10-10',
                    branch: 'Crispy Chicken-Hamdan St',
                    channel: 'Delivery',
                    transactions: 55,
                    sales: 2750.00,
                    average: 50.00,
                    offerType: 'Chicken Day',
                    offerStatus: 'Active',
                    notes: 'Excellent delivery numbers'
                },
                {
                    date: '2025-10-11',
                    branch: 'Crispy Chicken Al Barsha',
                    channel: 'Dine-in',
                    transactions: 30,
                    sales: 1800.00,
                    average: 60.00,
                    offerType: 'Ultimate',
                    offerStatus: 'Active',
                    notes: 'Consistent high average'
                },
                {
                    date: '2025-10-12',
                    branch: 'Crispy Chicken-Hamdan St',
                    channel: 'Takeaway',
                    transactions: 42,
                    sales: 2100.00,
                    average: 50.00,
                    offerType: 'Normal Day',
                    offerStatus: 'No Offer',
                    notes: 'Mid-week slowdown'
                },
                {
                    date: '2025-10-13',
                    branch: 'Crispy Chicken Khaldia',
                    channel: 'Delivery',
                    transactions: 48,
                    sales: 2400.00,
                    average: 50.00,
                    offerType: 'Ultimate',
                    offerStatus: 'Active',
                    notes: 'Ultimate offer popular'
                },
                {
                    date: '2025-10-14',
                    branch: 'Crispy Chicken-Hamdan St',
                    channel: 'Dine-in',
                    transactions: 52,
                    sales: 2600.00,
                    average: 50.00,
                    offerType: 'Chicken Day',
                    offerStatus: 'Active',
                    notes: 'Strong weekend performance'
                }
            ];
            
            // Sample feedback data
            feedbackData = [
                {
                    date: '2025-10-01',
                    branch: 'Crispy Chicken-Hamdan St',
                    rating: 5,
                    category: 'Service',
                    comment: 'Excellent service and friendly staff. Will definitely return!'
                },
                {
                    date: '2025-10-02',
                    branch: 'Crispy Chicken Khaldia',
                    rating: 4,
                    category: 'Food',
                    comment: 'Food quality is good but could be hotter when served.'
                },
                {
                    date: '2025-10-03',
                    branch: 'Crispy Chicken Al Barsha',
                    rating: 5,
                    category: 'Cleanliness',
                    comment: 'The restaurant was spotless and well-maintained.'
                },
                {
                    date: '2025-10-04',
                    branch: 'Crispy Chicken-Hamdan St',
                    rating: 3,
                    category: 'Service',
                    comment: 'Service was a bit slow during peak hours.'
                },
                {
                    date: '2025-10-05',
                    branch: 'Crispy Chicken Khaldia',
                    rating: 4,
                    category: 'Food',
                    comment: 'Great flavors and generous portions.'
                },
                {
                    date: '2025-10-06',
                    branch: 'Crispy Chicken Al Barsha',
                    rating: 5,
                    category: 'Service',
                    comment: 'Staff went above and beyond to accommodate our large group.'
                },
                {
                    date: '2025-10-07',
                    branch: 'Crispy Chicken-Hamdan St',
                    rating: 4,
                    category: 'Cleanliness',
                    comment: 'Clean environment but tables could be wiped more frequently.'
                },
                {
                    date: '2025-10-08',
                    branch: 'Crispy Chicken Khaldia',
                    rating: 5,
                    category: 'Food',
                    comment: 'Best chicken in town! The Ultimate offer is fantastic value.'
                },
                {
                    date: '2025-10-09',
                    branch: 'Crispy Chicken Al Barsha',
                    rating: 3,
                    category: 'Service',
                    comment: 'Order took longer than expected but staff was apologetic.'
                },
                {
                    date: '2025-10-10',
                    branch: 'Crispy Chicken-Hamdan St',
                    rating: 5,
                    category: 'Service',
                    comment: 'Outstanding service from the moment we walked in.'
                }
            ];
            
            // Sample offers data
            offers = [
                {
                    name: 'Ultimate Combo',
                    type: 'Ultimate',
                    discount: 25,
                    startDate: '2025-10-01',
                    endDate: '2025-10-31',
                    status: 'Active'
                },
                {
                    name: 'Chicken Day Special',
                    type: 'Chicken Day',
                    discount: 15,
                    startDate: '2025-10-01',
                    endDate: '2025-10-31',
                    status: 'Active'
                },
                {
                    name: 'Weekend Family Deal',
                    type: 'Normal Day',
                    discount: 10,
                    startDate: '2025-10-06',
                    endDate: '2025-10-08',
                    status: 'Inactive'
                }
            ];
            
            // Initialize sample monthly targets
            const branches = [
                'Crispy Chicken-Hamdan St',
                'Crispy Chicken Khaldia',
                'Crispy Chicken Shabiya 11',
                'Crispy Chicken Muroor',
                'Crispy Chicken Al Barsha',
                'Crispy Chicken Al Satwa',
                'Crispy Chicken Al Rgga'
            ];
            
            monthlyTargets = {};
            branches.forEach(branch => {
                monthlyTargets[branch] = {
                    target: 50000 + Math.floor(Math.random() * 30000),
                    achieved: 0,
                    percentage: 0
                };
            });
        }
        
        // Show notification
        function showNotification(message, type='info') {
            const container = document.getElementById('notificationContainer');
            if (!container) return;
            
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} alert-dismissible fade show notification`;
            
            let icon = '';
            switch(type) {
                case 'success': icon = 'fas fa-check-circle'; break;
                case 'error': icon = 'fas fa-exclamation-circle'; break;
                case 'warning': icon = 'fas fa-exclamation-triangle'; break;
                default: icon = 'fas fa-info-circle';
            }
            
            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;
            
            container.appendChild(notification);
            
            // Auto-dismiss after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }
        
        // Add offer
        function addOffer() {
            const offer = {
                name: document.getElementById('offerName').value,
                type: document.getElementById('offerType').value,
                discount: parseInt(document.getElementById('offerDiscount').value),
                startDate: document.getElementById('offerStartDate').value,
                endDate: document.getElementById('offerEndDate').value,
                status: document.getElementById('offerStatus').value
            };
            
            offers.push(offer);
            updateOffersTable();
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('addOfferModal'));
            if (modal) modal.hide();
            
            // Reset form
            document.getElementById('addOfferForm').reset();
            
            showNotification('Offer added successfully!', 'success');
            
            // Save to local storage
            saveToLocalStorage();
        }
        
        // Update offers table
        function updateOffersTable() {
            const tbody = document.getElementById('offersTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            offers.forEach((offer, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${offer.name}</td>
                    <td><span class="offer-badge offer-${offer.type.toLowerCase().replace(' ', '')}">${offer.type}</span></td>
                    <td>${offer.discount}%</td>
                    <td>${offer.startDate}</td>
                    <td>${offer.endDate}</td>
                    <td><span class="badge ${offer.status === 'Active' ? 'bg-success' : 'bg-secondary'}">${offer.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteOffer(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Delete offer
        function deleteOffer(index) {
            if (confirm('Are you sure you want to delete this offer?')) {
                offers.splice(index, 1);
                updateOffersTable();
                showNotification('Offer deleted successfully!', 'warning');
                
                // Save to local storage
                saveToLocalStorage();
            }
        }
        
        // Update feedback summary
        function updateFeedbackSummary() {
            const totalFeedback = feedbackData.length;
            const avgRating = totalFeedback > 0 
                ? (feedbackData.reduce((sum, f) => sum + f.rating, 0) / totalFeedback).toFixed(1)
                : '0.0';
            
            const positiveFeedback = totalFeedback > 0 
                ? ((feedbackData.filter(f => f.rating >= 4).length / totalFeedback) * 100).toFixed(1)
                : '0';
            
            // Update dashboard feedback metrics
            const totalFeedbackEl = document.getElementById('totalFeedback');
            const avgRatingEl = document.getElementById('avgRating');
            const positiveFeedbackEl = document.getElementById('positiveFeedback');
            
            if (totalFeedbackEl) totalFeedbackEl.textContent = totalFeedback;
            if (avgRatingEl) avgRatingEl.textContent = avgRating;
            if (positiveFeedbackEl) positiveFeedbackEl.textContent = `${positiveFeedback}%`;
            
            // Update management report feedback metrics
            const reportTotalFeedbackEl = document.getElementById('reportTotalFeedback');
            const reportAvgRatingEl = document.getElementById('reportAvgRating');
            const reportPositiveFeedbackEl = document.getElementById('reportPositiveFeedback');
            
            if (reportTotalFeedbackEl) reportTotalFeedbackEl.textContent = totalFeedback;
            if (reportAvgRatingEl) reportAvgRatingEl.textContent = avgRating;
            if (reportPositiveFeedbackEl) reportPositiveFeedbackEl.textContent = `${positiveFeedback}%`;
            
            // Update feedback management metrics
            const feedbackTotalEl = document.getElementById('feedbackTotal');
            const feedbackAvgRatingEl = document.getElementById('feedbackAvgRating');
            const feedbackPositiveEl = document.getElementById('feedbackPositive');
            
            if (feedbackTotalEl) feedbackTotalEl.textContent = totalFeedback;
            if (feedbackAvgRatingEl) feedbackAvgRatingEl.textContent = avgRating;
            if (feedbackPositiveEl) feedbackPositiveEl.textContent = `${positiveFeedback}%`;
        }
        
        // Update management report
        function updateManagementReport() {
            // Calculate metrics for the report
            const totalSales = salesData.reduce((sum, sale) => sum + parseFloat(sale.sales), 0);
            const totalTransactions = salesData.reduce((sum, sale) => sum + parseInt(sale.transactions), 0);
            const avgTransaction = totalTransactions > 0 ? totalSales / totalTransactions : 0;
            
            // Update executive summary
            const reportTotalSalesEl = document.getElementById('reportTotalSales');
            const reportTotalTransactionsEl = document.getElementById('reportTotalTransactions');
            const reportAvgTransactionEl = document.getElementById('reportAvgTransaction');
            
            if (reportTotalSalesEl) reportTotalSalesEl.textContent = formatCurrency(totalSales);
            if (reportTotalTransactionsEl) reportTotalTransactionsEl.textContent = totalTransactions;
            if (reportAvgTransactionEl) reportAvgTransactionEl.textContent = formatCurrency(avgTransaction);
            
            // Update date range
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const reportDateRangeEl = document.getElementById('reportDateRange');
            if (reportDateRangeEl) reportDateRangeEl.textContent = `${startDate} to ${endDate}`;
            
            // Update charts
            updateManagementReportCharts();
            
            // Update findings and recommendations
            updateManagementReportFindings();
        }
        
        // Update management report charts
        function updateManagementReportCharts() {
            // Branch performance chart
            const branchCtx = document.getElementById('branchPerformanceChart');
            if (!branchCtx) return;
            
            // Group data by branch
            const branchData = {};
            salesData.forEach(sale => {
                if (!branchData[sale.branch]) {
                    branchData[sale.branch] = 0;
                }
                branchData[sale.branch] += parseFloat(sale.sales);
            });
            
            // Destroy existing chart if it exists
            if (charts.branchPerformance) {
                charts.branchPerformance.destroy();
            }
            
            // Create new chart
            charts.branchPerformance = new Chart(branchCtx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: Object.keys(branchData),
                    datasets: [{
                        label: 'Total Sales (AED)',
                        data: Object.values(branchData),
                        backgroundColor: '#ff6b35'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
            
            // Daily & weekly performance chart
            const dailyWeeklyCtx = document.getElementById('dailyWeeklyPerformanceChart');
            if (!dailyWeeklyCtx) return;
            
            // Group data by date
            const dailyData = {};
            salesData.forEach(sale => {
                if (!dailyData[sale.date]) {
                    dailyData[sale.date] = {
                        sales: 0,
                        transactions: 0
                    };
                }
                dailyData[sale.date].sales += parseFloat(sale.sales);
                dailyData[sale.date].transactions += parseInt(sale.transactions);
            });
            
            // Sort dates
            const sortedDates = Object.keys(dailyData).sort();
            
            // Destroy existing chart if it exists
            if (charts.dailyWeeklyPerformance) {
                charts.dailyWeeklyPerformance.destroy();
            }
            
            // Create new chart
            charts.dailyWeeklyPerformance = new Chart(dailyWeeklyCtx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: sortedDates,
                    datasets: [{
                        label: 'Daily Sales',
                        data: sortedDates.map(date => dailyData[date].sales),
                        borderColor: '#ff6b35',
                        backgroundColor: 'rgba(255, 107, 53, 0.1)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
            
            // Monthly trend chart
            const monthlyTrendCtx = document.getElementById('monthlyTrendChart');
            if (!monthlyTrendCtx) return;
            
            // Destroy existing chart if it exists
            if (charts.monthlyTrend) {
                charts.monthlyTrend.destroy();
            }
            
            // Create new chart
            charts.monthlyTrend = new Chart(monthlyTrendCtx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                    datasets: [{
                        label: 'Weekly Sales',
                        data: [45000, 52000, 48000, 55000],
                        borderColor: '#ff6b35',
                        backgroundColor: 'rgba(255, 107, 53, 0.1)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
            
            // Target distribution chart
            const targetCtx = document.getElementById('targetPlanChart');
            if (!targetCtx) return;
            
            // Destroy existing chart if it exists
            if (charts.targetPlan) {
                charts.targetPlan.destroy();
            }
            
            // Create new chart
            charts.targetPlan = new Chart(targetCtx.getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: ['Hamdan St', 'Khaldia', 'Al Barsha', 'Other Branches'],
                    datasets: [{
                        data: [35, 25, 20, 20],
                        backgroundColor: [
                            '#ff6b35',
                            '#f7931e',
                            '#ffc107',
                            '#28a745'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.parsed}%`;
                                }
                            }
                        }
                    }
                }
            });
            
            // Feedback charts for management report
            const feedbackCategoryCtx = document.getElementById('feedbackCategoryReportChart');
            if (feedbackCategoryCtx) {
                // Group feedback by category
                const categoryData = {};
                feedbackData.forEach(feedback => {
                    if (!categoryData[feedback.category]) {
                        categoryData[feedback.category] = 0;
                    }
                    categoryData[feedback.category]++;
                });
                
                // Destroy existing chart if it exists
                if (charts.feedbackCategoryReport) {
                    charts.feedbackCategoryReport.destroy();
                }
                
                // Create new chart
                charts.feedbackCategoryReport = new Chart(feedbackCategoryCtx.getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: Object.keys(categoryData),
                        datasets: [{
                            data: Object.values(categoryData),
                            backgroundColor: [
                                '#17a2b8',
                                '#ff6b35',
                                '#28a745',
                                '#ffc107'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
            
            const feedbackRatingCtx = document.getElementById('feedbackRatingReportChart');
            if (feedbackRatingCtx) {
                // Group feedback by rating
                const ratingData = {
                    '5': 0,
                    '4': 0,
                    '3': 0,
                    '2': 0,
                    '1': 0
                };
                
                feedbackData.forEach(feedback => {
                    ratingData[feedback.rating.toString()]++;
                });
                
                // Destroy existing chart if it exists
                if (charts.feedbackRatingReport) {
                    charts.feedbackRatingReport.destroy();
                }
                
                // Create new chart
                charts.feedbackRatingReport = new Chart(feedbackRatingCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(ratingData),
                        datasets: [{
                            label: 'Number of Ratings',
                            data: Object.values(ratingData),
                            backgroundColor: [
                                '#28a745',
                                '#28a745',
                                '#ffc107',
                                '#dc3545',
                                '#dc3545'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Update management report findings
        function updateManagementReportFindings() {
            // Branch performance findings
            const branchPerformanceFindings = document.getElementById('branchPerformanceFindings');
            if (branchPerformanceFindings) {
                branchPerformanceFindings.innerHTML = '';
                
                const branchFindings = [
                    'Hamdan St branch has the highest sales, accounting for 35% of total sales',
                    'Al Barsha branch has fewer transactions but the highest average transaction value',
                    'Al Satwa branch performs particularly well on weekends but relatively weak on weekdays'
                ];
                
                branchFindings.forEach(finding => {
                    const li = document.createElement('li');
                    li.textContent = finding;
                    branchPerformanceFindings.appendChild(li);
                });
            }
            
            // Daily & weekly findings
            const dailyWeeklyFindings = document.getElementById('dailyWeeklyFindings');
            if (dailyWeeklyFindings) {
                dailyWeeklyFindings.innerHTML = '';
                
                const weeklyFindings = [
                    'Saturday and Sunday are peak sales days, with 40% higher transaction volume than weekdays',
                    'Week 1 (Oct 1-7) had slightly higher sales than Week 2',
                    'Wednesday is typically the lowest transaction day of the week'
                ];
                
                weeklyFindings.forEach(finding => {
                    const li = document.createElement('li');
                    li.textContent = finding;
                    dailyWeeklyFindings.appendChild(li);
                });
            }
            
            // Monthly trend findings
            const monthlyTrendFindings = document.getElementById('monthlyTrendFindings');
            if (monthlyTrendFindings) {
                monthlyTrendFindings.innerHTML = '';
                
                const trendFindings = [
                    'Beginning and end of month typically show better sales performance',
                    'Middle of month has higher sales volatility, requiring further analysis',
                    'Overall sales show an upward trend with 12% month-over-month growth'
                ];
                
                trendFindings.forEach(finding => {
                    const li = document.createElement('li');
                    li.textContent = finding;
                    monthlyTrendFindings.appendChild(li);
                });
            }
            
            // Target plan findings
            const targetPlanFindings = document.getElementById('targetPlanFindings');
            if (targetPlanFindings) {
                targetPlanFindings.innerHTML = '';
                
                const targetFindings = [
                    'Hamdan St branch: 35% target share (based on historical performance)',
                    'Khaldia branch: 25% target share (based on traffic analysis)',
                    'Al Barsha branch: 20% target share (based on average transaction value)',
                    'Other branches: 20% target share (based on growth potential)'
                ];
                
                targetFindings.forEach(finding => {
                    const li = document.createElement('li');
                    li.textContent = finding;
                    targetPlanFindings.appendChild(li);
                });
            }
            
            // Feedback insights
            const feedbackInsightsList = document.getElementById('feedbackInsightsList');
            if (feedbackInsightsList) {
                feedbackInsightsList.innerHTML = '';
                
                const insights = [
                    'Service quality is consistently rated highest across all branches',
                    'Food quality shows room for improvement, particularly in Al Barsha branch',
                    'Customers appreciate cleanliness but suggest faster service during peak hours',
                    'Ultimate offer receives the most positive customer feedback'
                ];
                
                insights.forEach(insight => {
                    const li = document.createElement('li');
                    li.textContent = insight;
                    feedbackInsightsList.appendChild(li);
                });
            }
            
            // Management recommendations
            const shortTermRecs = document.getElementById('shortTermManagementRecommendations');
            if (shortTermRecs) {
                shortTermRecs.innerHTML = '';
                
                const shortTerm = [
                    'Increase weekend promotions at Hamdan St branch to handle high traffic',
                    'Introduce more family meal packages at Al Barsha branch to increase average transaction value',
                    'Optimize Muroor branch operating hours to match customer demand patterns',
                    'Add new product sampling activities at Khaldia branch to attract more customers'
                ];
                
                shortTerm.forEach(rec => {
                    const li = document.createElement('li');
                    li.textContent = rec;
                    shortTermRecs.appendChild(li);
                });
            }
            
            const mediumTermRecs = document.getElementById('mediumTermManagementRecommendations');
            if (mediumTermRecs) {
                mediumTermRecs.innerHTML = '';
                
                const mediumTerm = [
                    'Redistribute target sales indicators for each branch based on sales data',
                    'Create specific improvement plans for underperforming branches',
                    'Analyze ROI of different offer types and optimize promotion strategy',
                    'Evaluate new branch location possibilities to expand market coverage'
                ];
                
                mediumTerm.forEach(rec => {
                    const li = document.createElement('li');
                    li.textContent = rec;
                    mediumTermRecs.appendChild(li);
                });
            }
            
            const longTermRecs = document.getElementById('longTermManagementRecommendations');
            if (longTermRecs) {
                longTermRecs.innerHTML = '';
                
                const longTerm = [
                    'Develop customer loyalty program to increase retention rate',
                    'Consider launching online ordering and delivery services',
                    'Explore new product lines to increase revenue sources',
                    'Develop brand expansion plan to enter new market areas'
                ];
                
                longTerm.forEach(rec => {
                    const li = document.createElement('li');
                    li.textContent = rec;
                    longTermRecs.appendChild(li);
                });
            }
        }
        
        // Update feedback management
        function updateFeedbackManagement() {
            // Update overview charts
            const overviewCategoryCtx = document.getElementById('feedbackOverviewCategoryChart');
            if (overviewCategoryCtx) {
                // Group feedback by category
                const categoryData = {};
                feedbackData.forEach(feedback => {
                    if (!categoryData[feedback.category]) {
                        categoryData[feedback.category] = 0;
                    }
                    categoryData[feedback.category]++;
                });
                
                // Destroy existing chart if it exists
                if (charts.feedbackOverviewCategory) {
                    charts.feedbackOverviewCategory.destroy();
                }
                
                // Create new chart
                charts.feedbackOverviewCategory = new Chart(overviewCategoryCtx.getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: Object.keys(categoryData),
                        datasets: [{
                            data: Object.values(categoryData),
                            backgroundColor: [
                                '#17a2b8',
                                '#ff6b35',
                                '#28a745',
                                '#ffc107'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
            
            const overviewRatingCtx = document.getElementById('feedbackOverviewRatingChart');
            if (overviewRatingCtx) {
                // Group feedback by rating
                const ratingData = {
                    '5': 0,
                    '4': 0,
                    '3': 0,
                    '2': 0,
                    '1': 0
                };
                
                feedbackData.forEach(feedback => {
                    ratingData[feedback.rating.toString()]++;
                });
                
                // Destroy existing chart if it exists
                if (charts.feedbackOverviewRating) {
                    charts.feedbackOverviewRating.destroy();
                }
                
                // Create new chart
                charts.feedbackOverviewRating = new Chart(overviewRatingCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(ratingData),
                        datasets: [{
                            label: 'Number of Ratings',
                            data: Object.values(ratingData),
                            backgroundColor: [
                                '#28a745',
                                '#28a745',
                                '#ffc107',
                                '#dc3545',
                                '#dc3545'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        }
                    }
                });
            }
            
            // Update feedback list
            updateFeedbackList();
        }
        
        // Update feedback list
        function updateFeedbackList() {
            const container = document.getElementById('feedbackListContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Sort feedback by date (newest first)
            const sortedFeedback = [...feedbackData].sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            );
            
            sortedFeedback.forEach((feedback, index) => {
                const item = createFeedbackItem(feedback, index);
                container.appendChild(item);
            });
        }
        
        // Create feedback item
        function createFeedbackItem(feedback, index) {
            const item = document.createElement('div');
            item.className = 'feedback-list-item';
            
            const ratingStars = ''.repeat(feedback.rating) + ''.repeat(5 - feedback.rating);
            
            item.innerHTML = `
                <div class="feedback-header">
                    <h6>${feedback.branch} - ${feedback.date}</h6>
                    <span class="feedback-category category-${feedback.category.toLowerCase()}">${feedback.category}</span>
                </div>
                <div class="feedback-body">
                    <p>${feedback.comment}</p>
                </div>
                <div class="feedback-footer">
                    <span>${ratingStars} (${feedback.rating}/5)</span>
                    <div class="feedback-actions">
                        <button class="btn btn-sm btn-primary" onclick="editFeedback(${index})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteFeedback(${index})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>
            `;
            
            return item;
        }
        
        // Add feedback category
        function addFeedbackCategory() {
            const categoryName = document.getElementById('newCategoryName').value;
            const color = document.querySelector('.color-option.selected').getAttribute('data-color');
            
            if (!categoryName) {
                document.getElementById('newCategoryName').classList.add('is-invalid');
                document.getElementById('newCategoryNameFeedback').textContent = 'Category name is required';
                return;
            }
            
            // Add to categories list (in a real app, this would be stored)
            showNotification(`Category "${categoryName}" added successfully!`, 'success');
            
            // Reset form
            document.getElementById('addCategoryForm').reset();
            
            // Update feedback management
            updateFeedbackManagement();
            
            // Save to local storage
            saveToLocalStorage();
        }
        
        // Edit feedback
        function editFeedback(index) {
            const feedback = feedbackData[index];
            
            // Populate form with feedback data
            document.getElementById('feedbackDate').value = feedback.date;
            document.getElementById('feedbackBranch').value = feedback.branch;
            document.getElementById('feedbackRatingValue').value = feedback.rating;
            document.getElementById('feedbackCategory').value = feedback.category;
            document.getElementById('feedbackComment').value = feedback.comment;
            
            // Update rating display
            document.querySelectorAll('#feedbackRating i').forEach((star, i) => {
                if (i < feedback.rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
            
            // Show data entry page with feedback tab active
            showPage('data-entry');
            document.getElementById('feedback-tab').click();
            
            // Scroll to feedback form
            document.getElementById('feedbackForm').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Delete feedback
        function deleteFeedback(index) {
            if (confirm('Are you sure you want to delete this feedback?')) {
                feedbackData.splice(index, 1);
                updateAllUI();
                showNotification('Feedback deleted successfully!', 'warning');
                
                // Save to local storage
                saveToLocalStorage();
            }
        }
        
        // Process Excel file
        function processExcelFile() {
            if (!window.selectedFile) {
                showNotification('No file selected', 'warning');
                return;
            }
            
            // Check file type
            if (!window.selectedFile.name.match(/\.(xlsx|xls)$/)) {
                showNotification('Please select a valid Excel file (.xlsx or .xls)', 'danger');
                return;
            }
            
            showLoadingOverlay(true);
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // Get the first worksheet
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // Convert worksheet to JSON
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    // Process the data
                    processUploadedData(jsonData);
                    
                    // Update UI
                    updateAllUI();
                    
                    // Auto-save if enabled
                    if (document.getElementById('autoSaveToggle').checked) {
                        autoSave();
                    }
                    
                    // Save to local storage
                    saveToLocalStorage();
                    
                    showNotification(`Excel file "${window.selectedFile.name}" processed successfully!`, 'success');
                    
                    resetImportUI();
                    showLoadingOverlay(false);
                    
                } catch (error) {
                    console.error('Error processing Excel file:', error);
                    showNotification(`Error processing Excel file: ${error.message}`, 'danger');
                    resetImportUI();
                    showLoadingOverlay(false);
                }
            };
            
            reader.readAsArrayBuffer(window.selectedFile);
        }
        
        // Process uploaded data
        function processUploadedData(data) {
            // Reset salesData
            salesData = [];
            
            data.forEach(row => {
                const sale = {
                    date: formatDate(row['Date'] || row.date),
                    branch: mapBranchName(row['Branch'] || row.branch),
                    channel: row['Channel'] || row.channel || 'Delivery',
                    transactions: parseInt(row['Transactions'] || row.transactions || 0),
                    sales: parseFloat(row['Sales'] || row.sales || 0),
                    average: parseFloat(row['Average per Order'] || row.average || 0),
                    offerType: row['Offer Type'] || row.offerType || 'Normal Day',
                    offerStatus: row['Offer Status'] || row.offerStatus || 'No Offer',
                    notes: row['Notes'] || row.notes || ''
                };
                
                // Validate and add to salesData
                if (isValidDate(sale.date) && isValidBranch(sale.branch) && 
                    isValidChannel(sale.channel) && sale.transactions > 0 && sale.sales > 0) {
                    salesData.push(sale);
                }
            });
            
            // Show notification with count
            showNotification(`Successfully imported ${salesData.length} sales records!`, 'success');
        }
        
        // Format date
        function formatDate(dateStr) {
            if (typeof dateStr === 'number') {
                const date = new Date((dateStr - 25569) * 86400 * 1000);
                return date.toISOString().split('T')[0];
            }
            return dateStr;
        }
        
        // Map branch name
        function mapBranchName(name) {
            const map = {
                'Crispy Chicken-Hamdan St': 'Crispy Chicken-Hamdan St',
                'Crispy Chicken Khaldia': 'Crispy Chicken Khaldia',
                'Crispy Chicken Shabiya 11': 'Crispy Chicken Shabiya 11',
                'Crispy Chicken Muroor': 'Crispy Chicken Muroor',
                'Crispy Chicken Al Barsha': 'Crispy Chicken Al Barsha',
                'Crispy Chicken Al Satwa': 'Crispy Chicken Al Satwa',
                'Crispy Chicken Al Rgga': 'Crispy Chicken Al Rgga'
            };
            return map[name] || name;
        }
        
        // Reset import UI
        function resetImportUI() {
            const importProgress = document.getElementById('importProgress');
            const progressBar = document.querySelector('#importProgress .progress-bar');
            if (importProgress) importProgress.classList.add('d-none');
            if (progressBar) progressBar.style.width = '0%';
            
            const importExcelBtn = document.getElementById('importExcelBtn');
            if (importExcelBtn) importExcelBtn.classList.add('d-none');
            
            const fileDropArea = document.getElementById('fileDropArea');
            if (fileDropArea) {
                fileDropArea.querySelector('p').textContent = 'Drag and drop your Excel file here or <a href="#" id="browseLink">browse files</a>';
            }
            
            // Clear selected file
            window.selectedFile = null;
            
            // Re-attach browse link event
            const browseLink = document.getElementById('browseLink');
            if (browseLink) {
                browseLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.getElementById('excelFileInput').click();
                });
            }
        }
        
        // Enhanced download Excel template
        function downloadExcelTemplate() {
            // Create workbook
            const wb = XLSX.utils.book_new();
            
            // Create worksheet with sample data
            const wsData = [
                ['Date', 'Branch', 'Channel', 'Transactions', 'Sales', 'Offer Type', 'Offer Status', 'Notes'],
                ['2025-10-01', 'Crispy Chicken-Hamdan St', 'Delivery', '73', '3216.00', 'Normal Day', 'No Offer', 'Sample entry'],
                ['2025-10-01', 'Crispy Chicken Khaldia', 'Delivery', '38', '1859.80', 'Normal Day', 'No Offer', 'Sample entry'],
                ['2025-10-02', 'Crispy Chicken-Hamdan St', 'Takeaway', '38', '1900.00', 'Normal Day', 'No Offer', 'Sample entry']
            ];
            
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            
            // Set column widths
            const colWidths = [
                { wch: 12 }, // Date
                { wch: 25 }, // Branch
                { wch: 12 }, // Channel
                { wch: 12 }, // Transactions
                { wch: 12 }, // Sales
                { wch: 12 }, // Offer Type
                { wch: 15 }, // Offer Status
                { wch: 12 }  // Notes
            ];
            ws['!cols'] = colWidths;
            
            // Add worksheet to workbook
            XLSX.utils.book_append_sheet(wb, ws, "Sales Data");
            
            // Generate and download file
            XLSX.writeFile(wb, "crispy-chicken-template.xlsx");
            
            showNotification('Excel template downloaded successfully!', 'success');
        }
        
        // Enhanced undo function
        function undoLastAction() {
            if (undoStack.length === 0) {
                showNotification('No actions to undo', 'warning');
                return;
            }
            
            const lastAction = undoStack.pop();
            
            if (lastAction.action === 'add') {
                // Remove the added item
                if (lastAction.type === 'sales') {
                    const index = salesData.findIndex(s => 
                        s.date === lastAction.data.date &&
                        s.branch === lastAction.data.branch &&
                        s.transactions === lastAction.data.transactions
                    );
                    if (index !== -1) {
                        salesData.splice(index, 1);
                    }
                } else if (lastAction.type === 'feedback') {
                    const index = feedbackData.findIndex(f => 
                        f.date === lastAction.data.date &&
                        f.branch === lastAction.data.branch &&
                        f.comment === lastAction.data.comment
                    );
                    if (index !== -1) {
                        feedbackData.splice(index, 1);
                    }
                }
            } else if (lastAction.action === 'delete') {
                // Restore the deleted item
                if (lastAction.type === 'sales') {
                    salesData.splice(lastAction.index, 0, lastAction.data);
                } else if (lastAction.type === 'feedback') {
                    feedbackData.splice(lastAction.index, 0, lastAction.data);
                }
            }
            
            // Update UI
            updateAllUI();
            
            showNotification('Action undone successfully!', 'success');
            
            // Save to local storage
            saveToLocalStorage();
        }
        
        // Save to local storage
        function saveToLocalStorage() {
            const appData = {
                salesData: salesData,
                feedbackData: feedbackData,
                offers: offers,
                monthlyTargets: monthlyTargets,
                lastSaved: new Date().toISOString()
            };
            
            localStorage.setItem('crispyChickenData', JSON.stringify(appData));
        }
        
        // Load from local storage
        function loadFromLocalStorage() {
            const savedData = localStorage.getItem('crispyChickenData');
            
            if (savedData) {
                try {
                    const appData = JSON.parse(savedData);
                    salesData = appData.salesData || [];
                    feedbackData = appData.feedbackData || [];
                    offers = appData.offers || [];
                    monthlyTargets = appData.monthlyTargets || {};
                    
                    updateAllUI();
                    
                    const lastSavedTimeEl = document.getElementById('lastSavedTime');
                    if (lastSavedTimeEl) {
                        lastSavedTimeEl.textContent = new Date(appData.lastSaved).toLocaleString();
                    }
                    
                    showNotification('Data loaded from local storage', 'info');
                } catch (error) {
                    console.error('Error loading data:', error);
                    showNotification('Error loading saved data', 'danger');
                }
            }
        }
        
        // Show loading overlay
        function showLoadingOverlay(show) {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.style.display = show ? 'flex' : 'none';
            }
        }
        
        // Update offers table
        function updateOffersTable() {
            const tbody = document.getElementById('offersTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            offers.forEach((offer, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${offer.name}</td>
                    <td><span class="offer-badge offer-${offer.type.toLowerCase().replace(' ', '')}">${offer.type}</span></td>
                    <td>${offer.discount}%</td>
                    <td>${offer.startDate}</td>
                    <td>${offer.endDate}</td>
                    <td><span class="badge ${offer.status === 'Active' ? 'bg-success' : 'bg-secondary'}">${offer.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteOffer(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Export to PDF
        function exportToPDF() {
            showLoadingOverlay(true);
            
            // Create a new jsPDF instance
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(18);
            doc.text('Crispy Chicken Analytics Report', 105, 15, { align: 'center' });
            
            // Add date range
            doc.setFontSize(12);
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            doc.text(`Report Period: ${startDate} to ${endDate}`, 105, 25, { align: 'center' });
            
            // Add sales summary
            doc.setFontSize(14);
            doc.text('Sales Summary', 20, 40);
            
            doc.setFontSize(11);
            const totalSales = salesData.reduce((sum, sale) => sum + parseFloat(sale.sales), 0);
            const totalTransactions = salesData.reduce((sum, sale) => sum + parseInt(sale.transactions), 0);
            const avgTransaction = totalTransactions > 0 ? totalSales / totalTransactions : 0;
            
            doc.text(`Total Sales: ${formatCurrency(totalSales)}`, 20, 50);
            doc.text(`Total Transactions: ${totalTransactions}`, 20, 57);
            doc.text(`Average Transaction: ${formatCurrency(avgTransaction)}`, 20, 64);
            
            // Add branch performance
            doc.setFontSize(14);
            doc.text('Branch Performance', 20, 80);
            
            doc.setFontSize(11);
            const branchData = {};
            salesData.forEach(sale => {
                if (!branchData[sale.branch]) {
                    branchData[sale.branch] = 0;
                }
                branchData[sale.branch] += parseFloat(sale.sales);
            });
            
            let yPos = 90;
            Object.keys(branchData).forEach(branch => {
                doc.text(`${branch}: ${formatCurrency(branchData[branch])}`, 20, yPos);
                yPos += 7;
            });
            
            // Add feedback summary
            doc.setFontSize(14);
            doc.text('Customer Feedback', 20, yPos + 10);
            
            doc.setFontSize(11);
            const totalFeedback = feedbackData.length;
            const avgRating = totalFeedback > 0 
                ? (feedbackData.reduce((sum, f) => sum + f.rating, 0) / totalFeedback).toFixed(1)
                : '0.0';
            
            doc.text(`Total Feedback: ${totalFeedback}`, 20, yPos + 20);
            doc.text(`Average Rating: ${avgRating}/5`, 20, yPos + 27);
            
            // Save the PDF
            doc.save(`crispy-chicken-report-${new Date().toISOString().split('T')[0]}.pdf`);
            
            showLoadingOverlay(false);
            showNotification('PDF report exported successfully!', 'success');
        }
        
        // Initialize Target Plan
        function initializeTargetPlan() {
            // Set current month
            const today = new Date();
            const currentMonth = today.toISOString().slice(0, 7);
            document.getElementById('targetMonth').value = currentMonth;
            
            // Initialize branch target inputs
            updateBranchTargetInputs();
            
            // Update target plan
            updateTargetPlan();
        }
        
        // Update Branch Target Inputs
        function updateBranchTargetInputs() {
            const container = document.getElementById('branchTargetInputs');
            if (!container) return;
            
            const branches = [
                'Crispy Chicken-Hamdan St',
                'Crispy Chicken Khaldia',
                'Crispy Chicken Shabiya 11',
                'Crispy Chicken Muroor',
                'Crispy Chicken Al Barsha',
                'Crispy Chicken Al Satwa',
                'Crispy Chicken Al Rgga'
            ];
            
            container.innerHTML = '';
            
            branches.forEach(branch => {
                const targetValue = monthlyTargets[branch] ? monthlyTargets[branch].target : 50000;
                
                const inputGroup = document.createElement('div');
                inputGroup.className = 'allocation-input-group';
                inputGroup.innerHTML = `
                    <label>${branch}:</label>
                    <input type="number" class="form-control" id="target-${branch.replace(/\s+/g, '-')}" 
                           value="${targetValue}" min="0" step="1000" onchange="updateTargetDistribution()">
                    <span class="input-group-text">AED</span>
                `;
                container.appendChild(inputGroup);
            });
        }
        
        // Update Target Distribution
        function updateTargetDistribution() {
            const branches = [
                'Crispy Chicken-Hamdan St',
                'Crispy Chicken Khaldia',
                'Crispy Chicken Shabiya 11',
                'Crispy Chicken Muroor',
                'Crispy Chicken Al Barsha',
                'Crispy Chicken Al Satwa',
                'Crispy Chicken Al Rgga'
            ];
            
            let totalTarget = 0;
            const targetData = {};
            
            branches.forEach(branch => {
                const inputId = `target-${branch.replace(/\s+/g, '-')}`;
                const input = document.getElementById(inputId);
                if (input) {
                    const value = parseFloat(input.value) || 0;
                    targetData[branch] = value;
                    totalTarget += value;
                }
            });
            
            // Update distribution chart
            updateTargetDistributionChart(targetData);
            
            // Update total target display
            const totalTargetEl = document.getElementById('totalMonthlyTarget');
            if (totalTargetEl) {
                totalTargetEl.textContent = formatCurrency(totalTarget);
            }
        }
        
        // Update Target Distribution Chart
        function updateTargetDistributionChart(targetData) {
            const ctx = document.getElementById('targetDistributionChart');
            if (!ctx) return;
            
            // Destroy existing chart if it exists
            if (charts.targetDistribution) {
                charts.targetDistribution.destroy();
            }
            
            // Create new chart
            charts.targetDistribution = new Chart(ctx.getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(targetData),
                    datasets: [{
                        data: Object.values(targetData),
                        backgroundColor: [
                            '#ff6b35',
                            '#f7931e',
                            '#ffc107',
                            '#28a745',
                            '#17a2b8',
                            '#6f42c1',
                            '#dc3545'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${formatCurrency(context.parsed)}`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Update Target Plan
        function updateTargetPlan() {
            const targetMonth = document.getElementById('targetMonth').value;
            const [year, month] = targetMonth.split('-');
            
            // Get current month sales data
            const currentMonthSales = salesData.filter(sale => {
                const saleDate = new Date(sale.date);
                return saleDate.getFullYear() === parseInt(year) && 
                       (saleDate.getMonth() + 1) === parseInt(month);
            });
            
            // Calculate current month sales by branch
            const branchSales = {};
            currentMonthSales.forEach(sale => {
                if (!branchSales[sale.branch]) {
                    branchSales[sale.branch] = 0;
                }
                branchSales[sale.branch] += parseFloat(sale.sales);
            });
            
            // Update current month sales
            const totalCurrentSales = Object.values(branchSales).reduce((sum, sale) => sum + sale, 0);
            const currentMonthSalesEl = document.getElementById('currentMonthSales');
            if (currentMonthSalesEl) {
                currentMonthSalesEl.textContent = formatCurrency(totalCurrentSales);
            }
            
            // Calculate days remaining
            const today = new Date();
            const lastDayOfMonth = new Date(year, month, 0);
            const daysRemaining = Math.max(0, lastDayOfMonth.getDate() - today.getDate());
            const daysRemainingEl = document.getElementById('daysRemaining');
            if (daysRemainingEl) {
                daysRemainingEl.textContent = daysRemaining;
            }
            
            // Update branch progress cards
            updateBranchProgressCards(branchSales);
            
            // Update target comparison table
            updateTargetComparisonTable(branchSales);
            
            // Update target achievement chart
            updateTargetAchievementChart(branchSales);
            
            // Update action plans
            updateActionPlans(branchSales);
        }
        
        // Update Branch Progress Cards
        function updateBranchProgressCards(branchSales) {
            const container = document.getElementById('branchProgressCards');
            if (!container) return;
            
            container.innerHTML = '';
            
            Object.keys(monthlyTargets).forEach(branch => {
                const target = monthlyTargets[branch].target;
                const achieved = branchSales[branch] || 0;
                const percentage = target > 0 ? (achieved / target) * 100 : 0;
                
                // Determine status
                let statusClass = 'status-behind';
                let statusText = 'Behind Target';
                
                if (percentage >= 100) {
                    statusClass = 'status-achieved';
                    statusText = 'Achieved';
                } else if (percentage >= 80) {
                    statusClass = 'status-on-track';
                    statusText = 'On Track';
                } else if (percentage >= 60) {
                    statusClass = 'status-at-risk';
                    statusText = 'At Risk';
                }
                
                const card = document.createElement('div');
                card.className = 'col-md-6 col-lg-4 mb-3';
                card.innerHTML = `
                    <div class="target-metric-card">
                        <h6>${branch}</h6>
                        <div class="target-progress">
                            <div class="target-progress-bar ${statusClass}" style="width: ${Math.min(100, percentage)}%">
                                ${percentage.toFixed(1)}%
                            </div>
                        </div>
                        <div class="d-flex justify-content-between">
                            <small class="text-muted">Target: ${formatCurrency(target)}</small>
                            <small class="text-muted">Achieved: ${formatCurrency(achieved)}</small>
                        </div>
                        <div class="mt-2">
                            <span class="target-status-badge ${statusClass}">${statusText}</span>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }
        
        // Update Target Comparison Table
        function updateTargetComparisonTable(branchSales) {
            const tbody = document.getElementById('targetComparisonTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const today = new Date();
            const targetMonth = document.getElementById('targetMonth').value;
            const [year, month] = targetMonth.split('-');
            const lastDayOfMonth = new Date(year, month, 0);
            const daysRemaining = Math.max(0, lastDayOfMonth.getDate() - today.getDate());
            const daysPassed = today.getDate() - 1;
            
            Object.keys(monthlyTargets).forEach(branch => {
                const target = monthlyTargets[branch].target;
                const achieved = branchSales[branch] || 0;
                const percentage = target > 0 ? (achieved / target) * 100 : 0;
                const remaining = Math.max(0, target - achieved);
                const dailyRequired = daysRemaining > 0 ? remaining / daysRemaining : 0;
                
                // Determine status
                let statusClass = 'status-behind';
                let statusText = 'Behind Target';
                
                if (percentage >= 100) {
                    statusClass = 'status-achieved';
                    statusText = 'Achieved';
                } else if (percentage >= 80) {
                    statusClass = 'status-on-track';
                    statusText = 'On Track';
                } else if (percentage >= 60) {
                    statusClass = 'status-at-risk';
                    statusText = 'At Risk';
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${branch}</td>
                    <td>${formatCurrency(target)}</td>
                    <td>${formatCurrency(achieved)}</td>
                    <td>${percentage.toFixed(1)}%</td>
                    <td>${formatCurrency(remaining)}</td>
                    <td>${formatCurrency(dailyRequired)}</td>
                    <td><span class="target-status-badge ${statusClass}">${statusText}</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="viewBranchDetails('${branch}')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Update Target Achievement Chart
        function updateTargetAchievementChart(branchSales) {
            const ctx = document.getElementById('targetAchievementChart');
            if (!ctx) return;
            
            const branches = Object.keys(monthlyTargets);
            const targetData = branches.map(branch => monthlyTargets[branch].target);
            const achievedData = branches.map(branch => branchSales[branch] || 0);
            
            // Destroy existing chart if it exists
            if (charts.targetAchievement) {
                charts.targetAchievement.destroy();
            }
            
            // Create new chart
            charts.targetAchievement = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: branches,
                    datasets: [{
                        label: 'Target',
                        data: targetData,
                        backgroundColor: 'rgba(255, 107, 53, 0.3)',
                        borderColor: '#ff6b35',
                        borderWidth: 2
                    }, {
                        label: 'Achieved',
                        data: achievedData,
                        backgroundColor: '#28a745',
                        borderColor: '#28a745',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${formatCurrency(context.parsed.y)}`;
                                }
                            }
                        }
                    }
                }
            });
            
            // Update performance metrics
            updatePerformanceMetrics(branchSales);
        }
        
        // Update Performance Metrics
        function updatePerformanceMetrics(branchSales) {
            let bestPerformer = '-';
            let needsImprovement = '-';
            let onTrackCount = 0;
            
            Object.keys(monthlyTargets).forEach(branch => {
                const target = monthlyTargets[branch].target;
                const achieved = branchSales[branch] || 0;
                const percentage = target > 0 ? (achieved / target) * 100 : 0;
                
                if (percentage >= 100) {
                    if (bestPerformer === '-' || achieved > (branchSales[bestPerformer] || 0)) {
                        bestPerformer = branch;
                    }
                }
                
                if (percentage < 60) {
                    if (needsImprovement === '-' || percentage < (monthlyTargets[needsImprovement] ? (branchSales[needsImprovement] || 0) / monthlyTargets[needsImprovement].target * 100 : 100)) {
                        needsImprovement = branch;
                    }
                }
                
                if (percentage >= 80) {
                    onTrackCount++;
                }
            });
            
            // Update display elements
            const bestPerformerEl = document.getElementById('bestPerformer');
            if (bestPerformerEl) bestPerformerEl.textContent = bestPerformer;
            
            const needsImprovementEl = document.getElementById('needsImprovement');
            if (needsImprovementEl) needsImprovementEl.textContent = needsImprovement;
            
            const onTrackBranchesEl = document.getElementById('onTrackBranches');
            if (onTrackBranchesEl) onTrackBranchesEl.textContent = onTrackCount;
            
            // Update overall achievement
            const totalTarget = Object.values(monthlyTargets).reduce((sum, t) => sum + t.target, 0);
            const totalAchieved = Object.values(branchSales).reduce((sum, s) => sum + s, 0);
            const overallPercentage = totalTarget > 0 ? (totalAchieved / totalTarget) * 100 : 0;
            
            const overallAchievementEl = document.getElementById('overallAchievement');
            if (overallAchievementEl) overallAchievementEl.textContent = `${overallPercentage.toFixed(1)}%`;
        }
        
        // Update Action Plans
        function updateActionPlans(branchSales) {
            // Immediate actions
            const immediateActions = document.getElementById('immediateActions');
            if (immediateActions) {
                immediateActions.innerHTML = '';
                
                const actions = [
                    {
                        date: new Date().toISOString().split('T')[0],
                        title: 'Review Underperforming Branches',
                        description: 'Schedule meetings with branches below 60% target achievement'
                    },
                    {
                        date: new Date(Date.now() + 86400000).toISOString().split('T')[0],
                        title: 'Launch Weekend Promotion',
                        description: 'Implement special offers for branches with high weekend potential'
                    },
                    {
                        date: new Date(Date.now() + 172800000).toISOString().split('T')[0],
                        title: 'Staff Training Session',
                        description: 'Conduct service improvement training for all branch managers'
                    }
                ];
                
                actions.forEach(action => {
                    const actionItem = document.createElement('div');
                    actionItem.className = 'action-item';
                    actionItem.innerHTML = `
                        <div class="action-date">${action.date}</div>
                        <div class="action-title">${action.title}</div>
                        <div class="action-description">${action.description}</div>
                    `;
                    immediateActions.appendChild(actionItem);
                });
            }
            
            // Strategic actions
            const strategicActions = document.getElementById('strategicActions');
            if (strategicActions) {
                strategicActions.innerHTML = '';
                
                const actions = [
                    {
                        date: new Date(Date.now() + 604800000).toISOString().split('T')[0],
                        title: 'Mid-Month Performance Review',
                        description: 'Analyze progress and adjust targets if necessary'
                    },
                    {
                        date: new Date(Date.now() + 1209600000).toISOString().split('T')[0],
                        title: 'Customer Feedback Analysis',
                        description: 'Review feedback and implement improvements based on insights'
                    },
                    {
                        date: new Date(Date.now() + 1814400000).toISOString().split('T')[0],
                        title: 'Final Push Campaign',
                        description: 'Launch end-of-month promotional campaign to meet targets'
                    }
                ];
                
                actions.forEach(action => {
                    const actionItem = document.createElement('div');
                    actionItem.className = 'action-item';
                    actionItem.innerHTML = `
                        <div class="action-date">${action.date}</div>
                        <div class="action-title">${action.title}</div>
                        <div class="action-description">${action.description}</div>
                    `;
                    strategicActions.appendChild(actionItem);
                });
            }
        }
        
        // Save Target Allocation
        function saveTargetAllocation() {
            const branches = [
                'Crispy Chicken-Hamdan St',
                'Crispy Chicken Khaldia',
                'Crispy Chicken Shabiya 11',
                'Crispy Chicken Muroor',
                'Crispy Chicken Al Barsha',
                'Crispy Chicken Al Satwa',
                'Crispy Chicken Al Rgga'
            ];
            
            branches.forEach(branch => {
                const inputId = `target-${branch.replace(/\s+/g, '-')}`;
                const input = document.getElementById(inputId);
                if (input) {
                    const value = parseFloat(input.value) || 0;
                    if (!monthlyTargets[branch]) {
                        monthlyTargets[branch] = {};
                    }
                    monthlyTargets[branch].target = value;
                }
            });
            
            // Update target plan
            updateTargetPlan();
            
            // Save to local storage
            saveToLocalStorage();
            
            showNotification('Target allocation saved successfully!', 'success');
        }
        
        // View Branch Details
        function viewBranchDetails(branch) {
            // This would open a modal or navigate to a detailed view
            showNotification(`Viewing details for ${branch}`, 'info');
        }
        
        // Set Total Target
        function setTotalTarget() {
            const totalTargetInput = document.getElementById('totalTargetInput');
            const totalTarget = parseFloat(totalTargetInput.value) || 0;
            
            if (totalTarget <= 0) {
                showNotification('Please enter a valid target amount', 'warning');
                return;
            }
            
            // Distribute target based on selected method
            distributeTarget(totalTarget);
            
            // Update UI
            updateTargetPlan();
            
            // Save to local storage
            saveToLocalStorage();
            
            showNotification(`Monthly target set to ${formatCurrency(totalTarget)}`, 'success');
        }
        
        // Select Distribution Method
        function selectDistributionMethod(method) {
            selectedDistributionMethod = method;
            
            // Update UI
            document.querySelectorAll('.method-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            // Get current total target
            const totalTargetInput = document.getElementById('totalTargetInput');
            const totalTarget = parseFloat(totalTargetInput.value) || 0;
            
            if (totalTarget > 0) {
                distributeTarget(totalTarget);
            }
        }
        
        // Set Preset Target
        function setPresetTarget(amount) {
            document.getElementById('totalTargetInput').value = amount;
            
            // Update UI
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // Distribute target
            distributeTarget(amount);
        }
        
        // Distribute Target
        function distributeTarget(totalTarget) {
            const branches = [
                'Crispy Chicken-Hamdan St',
                'Crispy Chicken Khaldia',
                'Crispy Chicken Shabiya 11',
                'Crispy Chicken Muroor',
                'Crispy Chicken Al Barsha',
                'Crispy Chicken Al Satwa',
                'Crispy Chicken Al Rgga'
            ];
            
            let distribution = {};
            
            switch(selectedDistributionMethod) {
                case 'equal':
                    // Equal distribution
                    const equalShare = totalTarget / branches.length;
                    branches.forEach(branch => {
                        distribution[branch] = equalShare;
                    });
                    break;
                    
                case 'performance':
                    // Performance-based distribution
                    const branchPerformance = calculateBranchPerformance();
                    const totalPerformance = Object.values(branchPerformance).reduce((sum, perf) => sum + perf, 0);
                    
                    branches.forEach(branch => {
                        const performance = branchPerformance[branch] || 0;
                        distribution[branch] = totalTarget * (performance / totalPerformance);
                    });
                    break;
                    
                case 'custom':
                    // Keep current custom values
                    branches.forEach(branch => {
                        distribution[branch] = monthlyTargets[branch] ? monthlyTargets[branch].target : 0;
                    });
                    break;
                    
                default:
                    // Default to equal distribution
                    const defaultShare = totalTarget / branches.length;
                    branches.forEach(branch => {
                        distribution[branch] = defaultShare;
                    });
            }
            
            // Update monthly targets
            branches.forEach(branch => {
                if (!monthlyTargets[branch]) {
                    monthlyTargets[branch] = {};
                }
                monthlyTargets[branch].target = distribution[branch];
            });
            
            // Update UI
            updateBranchTargetInputs();
            updateTargetDistribution();
            updateTargetPlan();
        }
        
        // Calculate Branch Performance
        function calculateBranchPerformance() {
            const performance = {};
            
            // Get last 30 days of sales data
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            
            const recentSales = salesData.filter(sale => {
                const saleDate = new Date(sale.date);
                return saleDate >= thirtyDaysAgo;
            });
            
            // Calculate performance for each branch
            const branches = [
                'Crispy Chicken-Hamdan St',
                'Crispy Chicken Khaldia',
                'Crispy Chicken Shabiya 11',
                'Crispy Chicken Muroor',
                'Crispy Chicken Al Barsha',
                'Crispy Chicken Al Satwa',
                'Crispy Chicken Al Rgga'
            ];
            
            branches.forEach(branch => {
                const branchSales = recentSales.filter(sale => sale.branch === branch);
                const totalSales = branchSales.reduce((sum, sale) => sum + parseFloat(sale.sales), 0);
                const totalTransactions = branchSales.reduce((sum, sale) => sum + parseInt(sale.transactions), 0);
                
                // Performance score based on sales and transaction count
                performance[branch] = totalSales + (totalTransactions * 10);
            });
            
            return performance;
        }
        
        // Update Target Preview
        function updateTargetPreview() {
            const totalTarget = parseFloat(document.getElementById('totalTargetInput').value) || 0;
            
            if (totalTarget > 0) {
                // Update preview without actually distributing
                const totalTargetEl = document.getElementById('totalMonthlyTarget');
                if (totalTargetEl) {
                    totalTargetEl.textContent = formatCurrency(totalTarget);
                }
            }
        }
    </script>
</body>
</html>
