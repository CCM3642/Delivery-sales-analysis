<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crispy Chicken Delivery Analytics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        .stat-card {
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .chart-container {
            position: relative;
            height: 300px;
        }
        .modal {
            transition: opacity 0.3s ease;
        }
        .table-row:hover {
            background-color: #f9fafb;
        }
        .btn-primary {
            transition: all 0.2s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
        }
        .branch-highlight {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        .analysis-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        .analysis-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        .insight-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .tab-active {
            border-bottom: 3px solid #f59e0b;
            color: #f59e0b;
        }
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #f59e0b;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-left: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .date-range-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: #f8fafc;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        .date-range-selector select {
            padding: 6px 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background-color: white;
        }
        .auto-offer-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            background-color: #dbeafe;
            color: #1e40af;
        }
        .offer-row-normal {
            background-color: #f8d7da;
        }
        .offer-row-chicken {
            background-color: #d4edda;
        }
        .offer-row-ultimate {
            background-color: #fff3cd;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(150%);
            transition: transform 0.3s ease-out;
        }
        .notification.show {
            transform: translateX(0);
        }
        .notification.success {
            background-color: #10b981;
        }
        .notification.error {
            background-color: #ef4444;
        }
        .notification.info {
            background-color: #3b82f6;
        }
        .offer-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-align: center;
        }
        .offer-badge-normal {
            background-color: #3b82f6;
            color: white;
        }
        .offer-badge-chicken {
            background-color: #f59e0b;
            color: white;
        }
        .offer-badge-ultimate {
            background-color: #8b5cf6;
            color: white;
        }
        .offer-metric-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            transition: all 0.3s ease;
            height: 100%;
        }
        .offer-metric-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        .offer-metric-value {
            font-size: 1.875rem;
            font-weight: 700;
            line-height: 1;
        }
        .offer-metric-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }
        .offer-metric-change {
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
        }
        .positive-change {
            color: #10b981;
        }
        .negative-change {
            color: #ef4444;
        }
        .neutral-change {
            color: #6b7280;
        }
        .offer-comparison-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            transition: all 0.3s ease;
        }
        .offer-comparison-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        .offer-performance-bar {
            height: 8px;
            border-radius: 4px;
            margin-top: 8px;
            background-color: #e5e7eb;
            overflow: hidden;
        }
        .offer-performance-fill {
            height: 100%;
            border-radius: 4px;
        }
        .sub-tab {
            padding: 8px 16px;
            font-weight: 500;
            color: #6b7280;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .sub-tab:hover {
            color: #374151;
        }
        .sub-tab.active {
            color: #f59e0b;
            border-bottom-color: #f59e0b;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-amber-50 to-orange-100 min-h-screen">
    <div class="max-w-7xl mx-auto p-4 md:p-8">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold text-gray-800">üçó Crispy Chicken Delivery Analytics</h1>
                    <p class="text-gray-600 mt-2">October 1-12, 2025 - Advanced Performance Analysis</p>
                </div>
                <div class="flex items-center">
                    <span id="loadingIndicator" class="loading-spinner hidden" aria-hidden="true"></span>
                    <span id="updateStatus" class="text-sm text-gray-600 ml-2" aria-live="polite"></span>
                </div>
            </div>
            
            <!-- Controls -->
            <div class="flex flex-wrap gap-3 mt-4">
                <select id="branchSelector" class="px-4 py-2 border-2 border-amber-500 rounded-lg font-semibold bg-white" aria-label="Select branch">
                    <option value="All">All Branches</option>
                    <option value="Crispy Chicken-Hamdan St">Hamdan St</option>
                    <option value="Crispy Chicken Khaldia">Khaldia</option>
                    <option value="Crispy Chicken Shabiya 11">Shabiya 11</option>
                    <option value="Crispy Chicken Muroor">Muroor</option>
                    <option value="Crispy Chicken Al Barsha">Al Barsha</option>
                    <option value="Crispy Chicken Al Satwa">Al Satwa</option>
                    <option value="Crispy Chicken Al Rgga">Al Rgga</option>
                </select>
                
                <div class="date-range-selector">
                    <label for="startDay" class="text-sm font-medium text-gray-700">Period:</label>
                    <select id="startDay" class="text-sm" aria-label="Select start day">
                        <option value="1">Oct 1</option>
                        <option value="2">Oct 2</option>
                        <option value="3">Oct 3</option>
                        <option value="4">Oct 4</option>
                        <option value="5">Oct 5</option>
                        <option value="6">Oct 6</option>
                        <option value="7">Oct 7</option>
                        <option value="8">Oct 8</option>
                        <option value="9">Oct 9</option>
                        <option value="10">Oct 10</option>
                        <option value="11">Oct 11</option>
                        <option value="12">Oct 12</option>
                        <option value="13">Oct 13</option>
                        <option value="14">Oct 14</option>
                    </select>
                    <span class="text-gray-500">to</span>
                    <select id="endDay" class="text-sm" aria-label="Select end day">
                        <option value="1">Oct 1</option>
                        <option value="2">Oct 2</option>
                        <option value="3">Oct 3</option>
                        <option value="4">Oct 4</option>
                        <option value="5">Oct 5</option>
                        <option value="6">Oct 6</option>
                        <option value="7">Oct 7</option>
                        <option value="8">Oct 8</option>
                        <option value="9">Oct 9</option>
                        <option value="10">Oct 10</option>
                        <option value="11">Oct 11</option>
                        <option value="12">Oct 12</option>
                        <option value="13">Oct 13</option>
                        <option value="14">Oct 14</option>
                    </select>
                    <button id="applyDateRange" class="px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600 transition-colors">
                        Apply
                    </button>
                    <button id="resetDateRange" class="px-3 py-1 bg-gray-500 text-white text-sm rounded hover:bg-gray-600 transition-colors">
                        Reset
                    </button>
                </div>
                
                <select id="analysisType" class="px-4 py-2 border-2 border-blue-500 rounded-lg font-semibold bg-white" aria-label="Select analysis type">
                    <option value="performance">Performance Analysis</option>
                    <option value="trends">Trend Analysis</option>
                    <option value="comparison">Branch Comparison</option>
                    <option value="forecasting">Forecasting</option>
                </select>
                
                <label for="fileUpload" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-semibold cursor-pointer hover:bg-blue-600 transition-all flex items-center gap-2">
                    <i data-lucide="upload" class="w-5 h-5" aria-hidden="true"></i>
                    Upload Excel
                </label>
                <input type="file" id="fileUpload" accept=".xlsx,.xls" class="hidden" />
                
                <button id="downloadTemplate" class="px-4 py-2 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600 transition-all flex items-center gap-2">
                    <i data-lucide="download" class="w-5 h-5" aria-hidden="true"></i>
                    Template
                </button>
                
                <button id="addEntry" class="px-4 py-2 bg-purple-500 text-white rounded-lg font-semibold hover:bg-purple-600 transition-all flex items-center gap-2">
                    <i data-lucide="plus" class="w-5 h-5" aria-hidden="true"></i>
                    Add Entry
                </button>
                
                <button id="manageOffers" class="px-4 py-2 bg-indigo-500 text-white rounded-lg font-semibold hover:bg-indigo-600 transition-all flex items-center gap-2">
                    <i data-lucide="tag" class="w-5 h-5" aria-hidden="true"></i>
                    Manage Offers
                </button>
                
                <button id="generateReport" class="px-4 py-2 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600 transition-all flex items-center gap-2">
                    <i data-lucide="file-text" class="w-5 h-5" aria-hidden="true"></i>
                    Generate Report
                </button>
            </div>
        </div>

        <!-- Analysis Tabs -->
        <div class="bg-white rounded-lg shadow-lg p-4 mb-6">
            <div class="flex flex-wrap gap-6 border-b">
                <button class="tab-btn pb-3 px-1 font-medium text-gray-600 hover:text-amber-600 tab-active" data-tab="overview" aria-selected="true">
                    Overview
                </button>
                <button class="tab-btn pb-3 px-1 font-medium text-gray-600 hover:text-amber-600" data-tab="performance" aria-selected="false">
                    Performance Metrics
                </button>
                <button class="tab-btn pb-3 px-1 font-medium text-gray-600 hover:text-amber-600" data-tab="trends" aria-selected="false">
                    Trend Analysis
                </button>
                <button class="tab-btn pb-3 px-1 font-medium text-gray-600 hover:text-amber-600" data-tab="recommendations" aria-selected="false">
                    Recommendations
                </button>
                <button class="tab-btn pb-3 px-1 font-medium text-gray-600 hover:text-amber-600" data-tab="offers" aria-selected="false">
                    Offers Management
                </button>
            </div>
        </div>

        <!-- Tab Content: Overview -->
        <div id="overview-tab" class="tab-content" role="tabpanel" aria-labelledby="overview-tab">
            <!-- KPI Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                <div class="stat-card bg-white rounded-lg shadow-md p-6 border-l-4 border-amber-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm font-medium">Total Transactions</p>
                            <p id="totalTransactions" class="text-3xl font-bold text-gray-800 mt-2">0</p>
                            <p id="dailyAvgTransactions" class="text-sm text-gray-600 mt-1">Daily Avg: 0</p>
                        </div>
                        <div class="p-3 rounded-full bg-amber-100">
                            <i data-lucide="package" class="w-8 h-8 text-amber-600" aria-hidden="true"></i>
                        </div>
                    </div>
                    <div class="flex items-center mt-3">
                        <i data-lucide="trending-up" class="w-4 h-4 text-green-600 mr-1" aria-hidden="true"></i>
                        <span class="text-sm font-medium text-green-600">8.3% vs last period</span>
                    </div>
                </div>
                
                <div class="stat-card bg-white rounded-lg shadow-md p-6 border-l-4 border-green-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm font-medium">Total Sales</p>
                            <p id="totalSales" class="text-3xl font-bold text-gray-800 mt-2">0 AED</p>
                            <p class="text-sm text-gray-600 mt-1">Selected Period</p>
                        </div>
                        <div class="p-3 rounded-full bg-green-100">
                            <i data-lucide="dollar-sign" class="w-8 h-8 text-green-600" aria-hidden="true"></i>
                        </div>
                    </div>
                    <div class="flex items-center mt-3">
                        <i data-lucide="trending-up" class="w-4 h-4 text-green-600 mr-1" aria-hidden="true"></i>
                        <span class="text-sm font-medium text-green-600">12.7% vs last period</span>
                    </div>
                </div>
                
                <div class="stat-card bg-white rounded-lg shadow-md p-6 border-l-4 border-blue-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm font-medium">Avg Transaction Value</p>
                            <p id="avgTransactionValue" class="text-3xl font-bold text-gray-800 mt-2">0 AED</p>
                            <p class="text-sm text-gray-600 mt-1">Per order</p>
                        </div>
                        <div class="p-3 rounded-full bg-blue-100">
                            <i data-lucide="target" class="w-8 h-8 text-blue-600" aria-hidden="true"></i>
                        </div>
                    </div>
                    <div class="flex items-center mt-3">
                        <i data-lucide="trending-up" class="w-4 h-4 text-green-600 mr-1" aria-hidden="true"></i>
                        <span class="text-sm font-medium text-green-600">4.2% vs last period</span>
                    </div>
                </div>
                
                <div class="stat-card bg-white rounded-lg shadow-md p-6 border-l-4 border-purple-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm font-medium">Active Branches</p>
                            <p id="activeBranches" class="text-3xl font-bold text-gray-800 mt-2">0</p>
                            <p id="branchSubtitle" class="text-sm text-gray-600 mt-1">All branches</p>
                        </div>
                        <div class="p-3 rounded-full bg-purple-100">
                            <i data-lucide="map-pin" class="w-8 h-8 text-purple-600" aria-hidden="true"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row 1 -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Daily Transactions Trend</h3>
                    <div class="chart-container">
                        <canvas id="transactionsChart" aria-label="Daily transactions trend chart"></canvas>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Daily Sales Trend (AED)</h3>
                    <div class="chart-container">
                        <canvas id="salesChart" aria-label="Daily sales trend chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Charts Row 2 -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Branch Performance - Sales (AED)</h3>
                    <div class="chart-container">
                        <canvas id="branchChart" aria-label="Branch performance chart"></canvas>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Weekly Comparison</h3>
                    <div class="chart-container">
                        <canvas id="weeklyChart" aria-label="Weekly comparison chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Charts Row 3 - Branch Performance DAILY -->
            <div class="grid grid-cols-1 gap-6 mb-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Branch Performance DAILY</h3>
                    <div class="chart-container">
                        <canvas id="dailyBranchChart" aria-label="Daily branch performance chart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Content: Performance Metrics -->
        <div id="performance-tab" class="tab-content hidden" role="tabpanel" aria-labelledby="performance-tab">
            <!-- Performance Analysis Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                <div class="analysis-card rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Peak Performance Hours</h3>
                        <i data-lucide="clock" class="w-6 h-6 text-blue-500" aria-hidden="true"></i>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Highest Traffic:</span>
                            <span id="peakHours" class="text-sm font-semibold">6:00 PM - 8:00 PM</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Avg Orders/Hour:</span>
                            <span id="avgOrdersHour" class="text-sm font-semibold">24.5</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Peak Day:</span>
                            <span id="peakDay" class="text-sm font-semibold">Saturday</span>
                        </div>
                    </div>
                </div>

                <div class="analysis-card rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Order Value Analysis</h3>
                        <i data-lucide="trending-up" class="w-6 h-6 text-green-500" aria-hidden="true"></i>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Highest Order:</span>
                            <span id="highestOrder" class="text-sm font-semibold">485 AED</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Lowest Order:</span>
                            <span id="lowestOrder" class="text-sm font-semibold">35 AED</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Most Common:</span>
                            <span id="mostCommon" class="text-sm font-semibold">85-120 AED</span>
                        </div>
                    </div>
                </div>

                <div class="analysis-card rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Efficiency Metrics</h3>
                        <i data-lucide="zap" class="w-6 h-6 text-purple-500" aria-hidden="true"></i>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Orders/Employee:</span>
                            <span id="ordersEmployee" class="text-sm font-semibold">18.2</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Prep Time:</span>
                            <span id="prepTime" class="text-sm font-semibold">12 min</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Delivery Time:</span>
                            <span id="deliveryTime" class="text-sm font-semibold">28 min</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Hourly Performance Distribution</h3>
                    <div class="chart-container">
                        <canvas id="hourlyChart" aria-label="Hourly performance distribution chart"></canvas>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Day of Week Analysis</h3>
                    <div class="chart-container">
                        <canvas id="dayOfWeekChart" aria-label="Day of week analysis chart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Content: Trend Analysis -->
        <div id="trends-tab" class="tab-content hidden" role="tabpanel" aria-labelledby="trends-tab">
            <!-- Trend Analysis Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                <div class="analysis-card rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-bold text-gray-800">Growth Rate</h3>
                        <i data-lucide="trending-up" class="w-5 h-5 text-green-500" aria-hidden="true"></i>
                    </div>
                    <p id="growthRate" class="text-2xl font-bold text-green-600">+12.7%</p>
                    <p class="text-sm text-gray-600 mt-1">vs last period</p>
                </div>

                <div class="analysis-card rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-bold text-gray-800">Seasonality Index</h3>
                        <i data-lucide="calendar" class="w-5 h-5 text-blue-500" aria-hidden="true"></i>
                    </div>
                    <p id="seasonalityIndex" class="text-2xl font-bold text-blue-600">1.24</p>
                    <p class="text-sm text-gray-600 mt-1">Above average</p>
                </div>

                <div class="analysis-card rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-bold text-gray-800">Volatility</h3>
                        <i data-lucide="activity" class="w-5 h-5 text-purple-500" aria-hidden="true"></i>
                    </div>
                    <p id="volatility" class="text-2xl font-bold text-purple-600">18.3%</p>
                    <p class="text-sm text-gray-600 mt-1">Sales variation</p>
                </div>

                <div class="analysis-card rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-bold text-gray-800">Momentum</h3>
                        <i data-lucide="bar-chart-2" class="w-5 h-5 text-amber-500" aria-hidden="true"></i>
                    </div>
                    <p id="momentum" class="text-2xl font-bold text-amber-600">Strong</p>
                    <p class="text-sm text-gray-600 mt-1">Upward trend</p>
                </div>
            </div>

            <!-- Trend Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Moving Average Trend</h3>
                    <div class="chart-container">
                        <canvas id="movingAvgChart" aria-label="Moving average trend chart"></canvas>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Growth Rate Analysis</h3>
                    <div class="chart-container">
                        <canvas id="growthRateChart" aria-label="Growth rate analysis chart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Content: Recommendations -->
        <div id="recommendations-tab" class="tab-content hidden" role="tabpanel" aria-labelledby="recommendations-tab">
            <!-- Recommendations Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div class="analysis-card rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Operational Improvements</h3>
                        <i data-lucide="settings" class="w-6 h-6 text-blue-500" aria-hidden="true"></i>
                    </div>
                    <div class="space-y-3">
                        <div class="p-3 bg-blue-50 rounded-lg">
                            <p class="font-medium text-blue-800">Staff Optimization</p>
                            <p id="staffOpt" class="text-sm text-blue-700">Increase staff during 6-8 PM peak hours</p>
                        </div>
                        <div class="p-3 bg-green-50 rounded-lg">
                            <p class="font-medium text-green-800">Menu Engineering</p>
                            <p id="menuEng" class="text-sm text-green-700">Promote combo deals during lunch hours</p>
                        </div>
                        <div class="p-3 bg-purple-50 rounded-lg">
                            <p class="font-medium text-purple-800">Delivery Routes</p>
                            <p id="deliveryRoutes" class="text-sm text-purple-700">Optimize routes for Al Barsha area</p>
                        </div>
                    </div>
                </div>

                <div class="analysis-card rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Marketing Strategies</h3>
                        <i data-lucide="megaphone" class="w-6 h-5 text-green-500" aria-hidden="true"></i>
                    </div>
                    <div class="space-y-3">
                        <div class="p-3 bg-amber-50 rounded-lg">
                            <p class="font-medium text-amber-800">Weekend Promotions</p>
                            <p id="weekendPromo" class="text-sm text-amber-700">Family bundles on Saturdays</p>
                        </div>
                        <div class="p-3 bg-red-50 rounded-lg">
                            <p class="font-medium text-red-800">Evening Boost</p>
                            <p id="eveningBoost" class="text-sm text-red-700">Late-night specials 9-11 PM</p>
                        </div>
                        <div class="p-3 bg-indigo-50 rounded-lg">
                            <p class="font-medium text-indigo-800">Loyalty Program</p>
                            <p id="loyaltyProg" class="text-sm text-indigo-700">Target frequent customers</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Plan -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">30-Day Action Plan</h3>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Priority</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Action</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Timeline</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Expected Impact</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Status</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            <tr>
                                <td class="px-4 py-3 text-sm"><span class="insight-badge bg-red-100 text-red-800">High</span></td>
                                <td class="px-4 py-3 text-sm font-medium">Peak hour staffing</td>
                                <td class="px-4 py-3 text-sm">Week 1</td>
                                <td class="px-4 py-3 text-sm">+15% capacity</td>
                                <td class="px-4 py-3 text-sm"><span class="text-amber-600">In Progress</span></td>
                            </tr>
                            <tr>
                                <td class="px-4 py-3 text-sm"><span class="insight-badge bg-amber-100 text-amber-800">Medium</span></td>
                                <td class="px-4 py-3 text-sm font-medium">Weekend promotions</td>
                                <td class="px-4 py-3 text-sm">Week 2</td>
                                <td class="px-4 py-3 text-sm">+20% sales</td>
                                <td class="px-4 py-3 text-sm"><span class="text-gray-600">Planned</span></td>
                            </tr>
                            <tr>
                                <td class="px-4 py-3 text-sm"><span class="insight-badge bg-green-100 text-green-800">Low</span></td>
                                <td class="px-4 py-3 text-sm font-medium">Menu optimization</td>
                                <td class="px-4 py-3 text-sm">Week 3-4</td>
                                <td class="px-4 py-3 text-sm">+10% AOV</td>
                                <td class="px-4 py-3 text-sm"><span class="text-gray-600">Planned</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tab Content: Offers Management -->
        <div id="offers-tab" class="tab-content hidden" role="tabpanel" aria-labelledby="offers-tab">
            <!-- Offers Dashboard -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800">Offers Performance Dashboard</h3>
                    <button id="addOfferBtn" class="px-4 py-2 bg-indigo-500 text-white rounded-lg font-semibold hover:bg-indigo-600 transition-all flex items-center gap-2">
                        <i data-lucide="plus" class="w-5 h-5" aria-hidden="true"></i>
                        Add/Edit Offer
                    </button>
                </div>
                
                <!-- Sub-tabs for Offer Analysis -->
                <div class="flex flex-wrap gap-4 mb-6 border-b">
                    <button class="sub-tab active" data-offer-tab="overview" aria-selected="true">Overview</button>
                    <button class="sub-tab" data-offer-tab="performance" aria-selected="false">Performance</button>
                    <button class="sub-tab" data-offer-tab="comparison" aria-selected="false">Comparison</button>
                    <button class="sub-tab" data-offer-tab="table" aria-selected="false">Data Table</button>
                </div>
                
                <!-- Offer Overview Content -->
                <div id="offer-overview-content" class="offer-tab-content">
                    <!-- KPI Cards for Offers -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                        <div class="offer-metric-card">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="text-lg font-semibold text-gray-800">Total Offers</h4>
                                <i data-lucide="tag" class="w-5 h-5 text-indigo-500" aria-hidden="true"></i>
                            </div>
                            <p id="totalOffers" class="offer-metric-value text-indigo-600">0</p>
                            <p class="offer-metric-label">Active offers</p>
                            <div class="offer-metric-change positive-change">
                                <i data-lucide="trending-up" class="w-3 h-3 mr-1" aria-hidden="true"></i>
                                <span>+2 from last week</span>
                            </div>
                        </div>
                        
                        <div class="offer-metric-card">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="text-lg font-semibold text-gray-800">Offer Revenue</h4>
                                <i data-lucide="dollar-sign" class="w-5 h-5 text-green-500" aria-hidden="true"></i>
                            </div>
                            <p id="offerRevenue" class="offer-metric-value text-green-600">0 AED</p>
                            <p class="offer-metric-label">Total revenue from offers</p>
                            <div class="offer-metric-change positive-change">
                                <i data-lucide="trending-up" class="w-3 h-3 mr-1" aria-hidden="true"></i>
                                <span>+15.3% vs normal days</span>
                            </div>
                        </div>
                        
                        <div class="offer-metric-card">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="text-lg font-semibold text-gray-800">Conversion Rate</h4>
                                <i data-lucide="percent" class="w-5 h-5 text-amber-500" aria-hidden="true"></i>
                            </div>
                            <p id="offerConversion" class="offer-metric-value text-amber-600">0%</p>
                            <p class="offer-metric-label">Offer to sales conversion</p>
                            <div class="offer-metric-change neutral-change">
                                <i data-lucide="minus" class="w-3 h-3 mr-1" aria-hidden="true"></i>
                                <span>No change from last week</span>
                            </div>
                        </div>
                        
                        <div class="offer-metric-card">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="text-lg font-semibold text-gray-800">Top Offer</h4>
                                <i data-lucide="award" class="w-5 h-5 text-purple-500" aria-hidden="true"></i>
                            </div>
                            <p id="topOffer" class="offer-metric-value text-purple-600">-</p>
                            <p class="offer-metric-label">Best performing offer</p>
                            <div class="offer-metric-change positive-change">
                                <i data-lucide="trending-up" class="w-3 h-3 mr-1" aria-hidden="true"></i>
                                <span>+22% higher sales</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Offer Performance Chart -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Offer Performance by Type</h3>
                            <div class="chart-container">
                                <canvas id="offerTypeChart" aria-label="Offer performance by type chart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Offer Impact on Sales</h3>
                            <div class="chart-container">
                                <canvas id="offerImpactChart" aria-label="Offer impact on sales chart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Top Performing Offers -->
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">Top Performing Offers</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="topOffersContainer">
                            <!-- Top offers will be inserted here -->
                        </div>
                    </div>
                </div>
                
                <!-- Offer Performance Content -->
                <div id="offer-performance-content" class="offer-tab-content hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Offer Performance by Day</h3>
                            <div class="chart-container">
                                <canvas id="offerDayChart" aria-label="Offer performance by day chart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Offer Performance by Branch</h3>
                            <div class="chart-container">
                                <canvas id="offerBranchChart" aria-label="Offer performance by branch chart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Offer Performance Table -->
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">Offer Performance Details</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Offer Type</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Total Transactions</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Total Sales (AED)</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Avg Transaction Value</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Performance vs Normal</th>
                                    </tr>
                                </thead>
                                <tbody id="offerPerformanceTableBody">
                                    <!-- Table rows will be inserted here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Offer Comparison Content -->
                <div id="offer-comparison-content" class="offer-tab-content hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Offer Type Comparison</h3>
                            <div class="chart-container">
                                <canvas id="offerComparisonChart" aria-label="Offer type comparison chart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Offer ROI Analysis</h3>
                            <div class="chart-container">
                                <canvas id="offerRoiChart" aria-label="Offer ROI analysis chart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Offer Comparison Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="offerComparisonCards">
                        <!-- Comparison cards will be inserted here -->
                    </div>
                </div>
                
                <!-- Data Table Content -->
                <div id="offer-table-content" class="offer-tab-content hidden">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-bold text-gray-800">Offers Data Table</h3>
                            <div class="flex gap-2">
                                <button id="exportOfferData" class="px-3 py-1 bg-green-500 text-white text-sm rounded hover:bg-green-600 transition-colors">
                                    <i data-lucide="download" class="w-4 h-4 inline mr-1" aria-hidden="true"></i>
                                    Export
                                </button>
                                <button id="refreshOfferData" class="px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600 transition-colors">
                                    <i data-lucide="refresh-cw" class="w-4 h-4 inline mr-1" aria-hidden="true"></i>
                                    Refresh
                                </button>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Date</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Day</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Branch</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Transactions</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Sales (AED)</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Offer Type</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Offer Status</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Notes</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="offerTableBody">
                                    <!-- Table rows will be inserted here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6 overflow-x-auto">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Delivery Data (<span id="recordCount">0</span> records)</h3>
            <div class="overflow-x-auto">
                <table class="w-full min-w-max">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="px-4 py-3 text-left">Date</th>
                            <th class="px-4 py-3 text-left">Branch</th>
                            <th class="px-4 py-3 text-left">Transactions</th>
                            <th class="px-4 py-3 text-left">Sales (AED)</th>
                            <th class="px-4 py-3 text-left">Avg/Order</th>
                            <th class="px-4 py-3 text-left">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody">
                        <!-- Table rows will be inserted here -->
                    </tbody>
                </table>
            </div>
            <p id="tableFooter" class="text-sm text-gray-500 mt-2 hidden">Showing first 20 records</p>
        </div>
    </div>

    <!-- Data Entry Modal -->
    <div id="dataModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="modalTitle" class="text-xl font-bold text-gray-800">Add New Entry</h3>
                    <button id="closeModal" class="text-gray-500 hover:text-gray-700">
                        <i data-lucide="x" class="w-6 h-6" aria-hidden="true"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label for="modalDate" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                        <input type="text" id="modalDate" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="October 1st, 2025" aria-required="true">
                    </div>
                    
                    <div>
                        <label for="modalBranch" class="block text-sm font-medium text-gray-700 mb-1">Branch</label>
                        <input type="text" id="modalBranch" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Crispy Chicken-Hamdan St" aria-required="true">
                    </div>
                    
                    <div>
                        <label for="modalTransactions" class="block text-sm font-medium text-gray-700 mb-1">Transactions</label>
                        <input type="number" id="modalTransactions" class="w-full px-3 py-2 border-gray-300 rounded-md" aria-required="true">
                    </div>
                    
                    <div>
                        <label for="modalSales" class="block text-sm font-medium text-gray-700 mb-1">Sales (AED)</label>
                        <input type="number" id="modalSales" class="w-full px-3 py-2 border-gray-300 rounded-md" aria-required="true">
                    </div>
                </div>
                
                <div class="flex justify-end gap-3 mt-6">
                    <button id="cancelModal" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                        Cancel
                    </button>
                    <button id="saveModal" class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 flex items-center gap-2">
                        <i data-lucide="save" class="w-4 h-4" aria-hidden="true"></i>
                        Save Entry
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Offer Modal -->
    <div id="offerModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden" role="dialog" aria-modal="true" aria-labelledby="offerModalTitle">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-800">ÿ•ÿ∂ÿßŸÅÿ© / ÿ™ÿπÿØŸäŸÑ ÿπÿ±ÿ∂</h3>
                    <button id="closeOfferModal" class="text-gray-500 hover:text-gray-700">
                        <i data-lucide="x" class="w-6 h-6" aria-hidden="true"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label for="offerModalDate" class="block text-sm font-medium text-gray-700 mb-1">ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</label>
                        <input type="date" id="offerModalDate" class="w-full px-3 py-2 border-gray-300 rounded-md" aria-required="true">
                    </div>
                    
                    <div>
                        <label for="offerModalBranch" class="block text-sm font-medium text-gray-700 mb-1">ÿßŸÑŸÅÿ±ÿπ</label>
                        <select id="offerModalBranch" class="w-full px-3 py-2 border-gray-300 rounded-md" aria-required="true">
                            <option value="Crispy Chicken-Hamdan St">Crispy Chicken-Hamdan St</option>
                            <option value="Crispy Chicken Khaldia">Crispy Chicken Khaldia</option>
                            <option value="Crispy Chicken Shabiya 11">Crispy Chicken Shabiya 11</option>
                            <option value="Crispy Chicken Muroor">Crispy Chicken Muroor</option>
                            <option value="Crispy Chicken Al Barsha">Crispy Chicken Al Barsha</option>
                            <option value="Crispy Chicken Al Satwa">Crispy Chicken Al Satwa</option>
                            <option value="Crispy Chicken Al Rgga">Crispy Chicken Al Rgga</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="offerModalType" class="block text-sm font-medium text-gray-700 mb-1">ŸÜŸàÿπ ÿßŸÑÿπÿ±ÿ∂</label>
                        <select id="offerModalType" class="w-full px-3 py-2 border-gray-300 rounded-md" aria-required="true">
                            <option value="Normal Day">Normal Day</option>
                            <option value="Chicken Day">Chicken Day</option>
                            <option value="Ultimate Offer">Ultimate Offer</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="offerModalNotes" class="block text-sm font-medium text-gray-700 mb-1">ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™</label>
                        <input type="text" id="offerModalNotes" class="w-full px-3 py-2 border-gray-300 rounded-md" placeholder="ÿ£ÿØÿÆŸÑ ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ŸÉ ŸáŸÜÿß">
                    </div>
                </div>
                
                <div class="flex justify-end gap-3 mt-6">
                    <button id="cancelOfferModal" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                        ÿ•ÿ∫ŸÑÿßŸÇ
                    </button>
                    <button id="saveOfferBtn" class="px-4 py-2 bg-indigo-500 text-white rounded-md hover:bg-indigo-600 flex items-center gap-2">
                        <i data-lucide="save" class="w-4 h-4" aria-hidden="true"></i>
                        ÿ≠ŸÅÿ∏
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification" class="notification" role="alert" aria-live="assertive"></div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Sample data with consistent date format
        let deliveryData = [
            { date: 'October 1st, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 73, sales: 3216 },
            { date: 'October 1st, 2025', branch: 'Crispy Chicken Khaldia', transactions: 38, sales: 1859.8 },
            { date: 'October 1st, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 39, sales: 1965 },
            { date: 'October 1st, 2025', branch: 'Crispy Chicken Muroor', transactions: 42, sales: 2024 },
            { date: 'October 1st, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 24, sales: 1376 },
            { date: 'October 1st, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 11, sales: 387 },
            { date: 'October 1st, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 5, sales: 204 },
            { date: 'October 2nd, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 62, sales: 3238 },
            { date: 'October 2nd, 2025', branch: 'Crispy Chicken Khaldia', transactions: 28, sales: 1492 },
            { date: 'October 2nd, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 44, sales: 2057 },
            { date: 'October 2nd, 2025', branch: 'Crispy Chicken Muroor', transactions: 40, sales: 1945 },
            { date: 'October 2nd, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 30, sales: 1644 },
            { date: 'October 2nd, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 10, sales: 527 },
            { date: 'October 2nd, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 4, sales: 146 },
            { date: 'October 3rd, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 72, sales: 3100 },
            { date: 'October 3rd, 2025', branch: 'Crispy Chicken Khaldia', transactions: 46, sales: 2930 },
            { date: 'October 3rd, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 40, sales: 1828 },
            { date: 'October 3rd, 2025', branch: 'Crispy Chicken Muroor', transactions: 32, sales: 1617 },
            { date: 'October 3rd, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 29, sales: 1127 },
            { date: 'October 3rd, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 11, sales: 427 },
            { date: 'October 3rd, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 10, sales: 475 },
            { date: 'October 4th, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 84, sales: 4833 },
            { date: 'October 4th, 2025', branch: 'Crispy Chicken Khaldia', transactions: 43, sales: 2400 },
            { date: 'October 4th, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 31, sales: 1447 },
            { date: 'October 4th, 2025', branch: 'Crispy Chicken Muroor', transactions: 36, sales: 2299 },
            { date: 'October 4th, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 20, sales: 936 },
            { date: 'October 4th, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 11, sales: 566 },
            { date: 'October 4th, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 15, sales: 554 },
            { date: 'October 5th, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 76, sales: 2921 },
            { date: 'October 5th, 2025', branch: 'Crispy Chicken Khaldia', transactions: 43, sales: 1982 },
            { date: 'October 5th, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 29, sales: 1344 },
            { date: 'October 5th, 2025', branch: 'Crispy Chicken Muroor', transactions: 20, sales: 1126 },
            { date: 'October 5th, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 25, sales: 1089 },
            { date: 'October 5th, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 13, sales: 462 },
            { date: 'October 5th, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 8, sales: 241 },
            { date: 'October 6th, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 101, sales: 4363, offerType: 'Ultimate Offer', offerStatus: 'Offer', notes: '12 PCS' },
            { date: 'October 6th, 2025', branch: 'Crispy Chicken Khaldia', transactions: 54, sales: 2113 },
            { date: 'October 6th, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 61, sales: 2714.8 },
            { date: 'October 6th, 2025', branch: 'Crispy Chicken Muroor', transactions: 47, sales: 2124 },
            { date: 'October 6th, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 57, sales: 4201 },
            { date: 'October 6th, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 20, sales: 848 },
            { date: 'October 6th, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 18, sales: 708 },
            { date: 'October 7th, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 119, sales: 5056 },
            { date: 'October 7th, 2025', branch: 'Crispy Chicken Khaldia', transactions: 50, sales: 2175 },
            { date: 'October 7th, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 80, sales: 3475 },
            { date: 'October 7th, 2025', branch: 'Crispy Chicken Muroor', transactions: 46, sales: 1957 },
            { date: 'October 7th, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 44, sales: 2590 },
            { date: 'October 7th, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 18, sales: 705 },
            { date: 'October 7th, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 19, sales: 823 },
            { date: 'October 8th, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 58, sales: 2568 },
            { date: 'October 8th, 2025', branch: 'Crispy Chicken Khaldia', transactions: 24, sales: 1037 },
            { date: 'October 8th, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 30, sales: 1574 },
            { date: 'October 8th, 2025', branch: 'Crispy Chicken Muroor', transactions: 81, sales: 1404 },
            { date: 'October 8th, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 29, sales: 1891 },
            { date: 'October 8th, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 5, sales: 148 },
            { date: 'October 8th, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 10, sales: 519 },
            { date: 'October 9th, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 53, sales: 2738 },
            { date: 'October 9th, 2025', branch: 'Crispy Chicken Khaldia', transactions: 31, sales: 2112 },
            { date: 'October 9th, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 35, sales: 1487 },
            { date: 'October 9th, 2025', branch: 'Crispy Chicken Muroor', transactions: 35, sales: 1978 },
            { date: 'October 9th, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 17, sales: 733 },
            { date: 'October 9th, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 5, sales: 184 },
            { date: 'October 9th, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 13, sales: 408 },
            { date: 'October 10th, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 65, sales: 2900 },
            { date: 'October 10th, 2025', branch: 'Crispy Chicken Khaldia', transactions: 46, sales: 2943 },
            { date: 'October 10th, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 45, sales: 2411 },
            { date: 'October 10th, 2025', branch: 'Crispy Chicken Muroor', transactions: 39, sales: 2261 },
            { date: 'October 10th, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 25, sales: 1523 },
            { date: 'October 10th, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 12, sales: 976 },
            { date: 'October 10th, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 10, sales: 573 },
            { date: 'October 11th, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 78, sales: 4313 },
            { date: 'October 11th, 2025', branch: 'Crispy Chicken Khaldia', transactions: 48, sales: 3452 },
            { date: 'October 11th, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 34, sales: 1711 },
            { date: 'October 11th, 2025', branch: 'Crispy Chicken Muroor', transactions: 28, sales: 1654 },
            { date: 'October 11th, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 20, sales: 778 },
            { date: 'October 11th, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 10, sales: 391 },
            { date: 'October 11th, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 9, sales: 275 },
            { date: 'October 12th, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 51, sales: 2146 },
            { date: 'October 12th, 2025', branch: 'Crispy Chicken Khaldia', transactions: 33, sales: 1802 },
            { date: 'October 12th, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 32, sales: 1331 },
            { date: 'October 12th, 2025', branch: 'Crispy Chicken Muroor', transactions: 23, sales: 1195 },
            { date: 'October 12th, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 22, sales: 1233 },
            { date: 'October 12th, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 4, sales: 153 },
            { date: 'October 12th, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 6, sales: 232, offerType: 'Normal Day', offerStatus: 'No Offer' }
        ];

        // Auto-generated offers data
        let autoGeneratedOffers = [];

        let selectedBranch = 'All';
        let selectedStartDate = null;
        let selectedEndDate = null;
        let editingIndex = null;
        let editingOfferIndex = null;
        
        // Chart instances
        let transactionsChartInstance = null;
        let salesChartInstance = null;
        let branchChartInstance = null;
        let weeklyChartInstance = null;
        let dailyBranchChartInstance = null;
        let hourlyChartInstance = null;
        let dayOfWeekChartInstance = null;
        let movingAvgChartInstance = null;
        let growthRateChartInstance = null;
        
        // Offer chart instances
        let offerTypeChartInstance = null;
        let offerImpactChartInstance = null;
        let offerDayChartInstance = null;
        let offerBranchChartInstance = null;
        let offerComparisonChartInstance = null;
        let offerRoiChartInstance = null;

        // DOM elements
        const branchSelector = document.getElementById('branchSelector');
        const startDay = document.getElementById('startDay');
        const endDay = document.getElementById('endDay');
        const applyDateRange = document.getElementById('applyDateRange');
        const resetDateRange = document.getElementById('resetDateRange');
        const analysisType = document.getElementById('analysisType');
        const fileUpload = document.getElementById('fileUpload');
        const downloadTemplateBtn = document.getElementById('downloadTemplate');
        const addEntryBtn = document.getElementById('addEntry');
        const manageOffersBtn = document.getElementById('manageOffers');
        const generateReportBtn = document.getElementById('generateReport');
        const dataModal = document.getElementById('dataModal');
        const closeModalBtn = document.getElementById('closeModal');
        const cancelModalBtn = document.getElementById('cancelModal');
        const saveModalBtn = document.getElementById('saveModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalDate = document.getElementById('modalDate');
        const modalBranch = document.getElementById('modalBranch');
        const modalTransactions = document.getElementById('modalTransactions');
        const modalSales = document.getElementById('modalSales');
        const dataTableBody = document.getElementById('dataTableBody');
        const recordCount = document.getElementById('recordCount');
        const tableFooter = document.getElementById('tableFooter');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const updateStatus = document.getElementById('updateStatus');

        // Offer Modal DOM elements
        const offerModal = document.getElementById('offerModal');
        const addOfferBtn = document.getElementById('addOfferBtn');
        const closeOfferModalBtn = document.getElementById('closeOfferModal');
        const cancelOfferModalBtn = document.getElementById('cancelOfferModal');
        const saveOfferBtn = document.getElementById('saveOfferBtn');
        const offerModalDate = document.getElementById('offerModalDate');
        const offerModalBranch = document.getElementById('offerModalBranch');
        const offerModalType = document.getElementById('offerModalType');
        const offerModalNotes = document.getElementById('offerModalNotes');
        const offerTableBody = document.getElementById('offerTableBody');

        // Tab functionality
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tabName = button.getAttribute('data-tab');
                
                // Update active tab button
                tabButtons.forEach(btn => {
                    btn.classList.remove('tab-active');
                    btn.setAttribute('aria-selected', 'false');
                });
                button.classList.add('tab-active');
                button.setAttribute('aria-selected', 'true');
                
                // Show corresponding tab content
                tabContents.forEach(content => {
                    content.classList.add('hidden');
                    content.setAttribute('aria-hidden', 'true');
                    if (content.id === `${tabName}-tab`) {
                        content.classList.remove('hidden');
                        content.setAttribute('aria-hidden', 'false');
                    }
                });
                
                // Update charts for specific tabs
                if (tabName === 'performance') {
                    updatePerformanceCharts();
                } else if (tabName === 'trends') {
                    updateTrendCharts();
                } else if (tabName === 'recommendations') {
                    updateRecommendationsData();
                } else if (tabName === 'offers') {
                    updateOffersDashboard();
                }
            });
        });

        // Event listeners
        branchSelector.addEventListener('change', function() {
            selectedBranch = this.value;
            showLoadingIndicator();
            setTimeout(() => {
                updateDashboard();
                highlightSelectedBranch();
                hideLoadingIndicator();
                showUpdateStatus('Dashboard updated successfully');
            }, 500);
        });

        startDay.addEventListener('change', function() {
            // Ensure end day is not before start day
            if (parseInt(endDay.value) < parseInt(this.value)) {
                endDay.value = this.value;
            }
        });

        endDay.addEventListener('change', function() {
            // Ensure start day is not after end day
            if (parseInt(startDay.value) > parseInt(this.value)) {
                startDay.value = this.value;
            }
        });

        applyDateRange.addEventListener('click', function() {
            // Validate date range
            if (parseInt(startDay.value) > parseInt(endDay.value)) {
                showNotification('End date must be after start date', 'error');
                return;
            }
            
            selectedStartDate = parseInt(startDay.value);
            selectedEndDate = parseInt(endDay.value);
            showLoadingIndicator();
            setTimeout(() => {
                updateDashboard();
                hideLoadingIndicator();
                showUpdateStatus(`Date range applied: Oct ${selectedStartDate} to Oct ${selectedEndDate}`);
            }, 300);
        });

        resetDateRange.addEventListener('click', function() {
            selectedStartDate = null;
            selectedEndDate = null;
            startDay.value = '1';
            endDay.value = '12';
            showLoadingIndicator();
            setTimeout(() => {
                updateDashboard();
                hideLoadingIndicator();
                showUpdateStatus('Date range reset to show all data');
            }, 300);
        });

        analysisType.addEventListener('change', function() {
            showLoadingIndicator();
            setTimeout(() => {
                updateDashboard();
                hideLoadingIndicator();
                showUpdateStatus('Analysis type changed');
            }, 300);
        });

        fileUpload.addEventListener('change', handleFileUpload);
        downloadTemplateBtn.addEventListener('click', downloadTemplate);
        addEntryBtn.addEventListener('click', handleAddEntry);
        manageOffersBtn.addEventListener('click', () => {
            // Switch to offers tab
            document.querySelector('[data-tab="offers"]').click();
        });
        generateReportBtn.addEventListener('click', generateReport);
        closeModalBtn.addEventListener('click', closeModal);
        cancelModalBtn.addEventListener('click', closeModal);
        saveModalBtn.addEventListener('click', handleSaveEntry);

        // Offer Modal Event Listeners
        addOfferBtn.addEventListener('click', () => {
            // Reset form for new offer
            editingOfferIndex = null;
            offerModalDate.value = '';
            offerModalNotes.value = '';
            offerModal.style.display = 'flex';
        });
        
        closeOfferModalBtn.addEventListener('click', () => offerModal.style.display = 'none');
        cancelOfferModalBtn.addEventListener('click', () => offerModal.style.display = 'none');
        
        saveOfferBtn.addEventListener('click', () => {
            const dateValue = offerModalDate.value;
            const branchValue = offerModalBranch.value;
            const offerTypeValue = offerModalType.value;
            const notesValue = offerModalNotes.value;

            if (!dateValue) { 
                showNotification('ÿßÿÆÿ™ÿ± ÿßŸÑÿ™ÿßÿ±ŸäÿÆ!', 'error');
                return; 
            }

            // Format date to match the data format
            const formattedDate = formatDateForDisplay(dateValue);
            
            // Check if we're editing an existing offer
            const existingIndex = deliveryData.findIndex(item => 
                item.date === formattedDate && item.branch === branchValue
            );
            
            if (existingIndex !== -1) {
                // Update existing entry
                deliveryData[existingIndex].offerType = offerTypeValue;
                deliveryData[existingIndex].offerStatus = offerTypeValue === 'Normal Day' ? 'No Offer' : 'Offer';
                deliveryData[existingIndex].notes = notesValue;
            } else {
                // Add new entry
                deliveryData.push({
                    date: formattedDate,
                    branch: branchValue,
                    transactions: 0,
                    sales: 0,
                    offerType: offerTypeValue,
                    offerStatus: offerTypeValue === 'Normal Day' ? 'No Offer' : 'Offer',
                    notes: notesValue
                });
            }
            
            // Update all relevant components
            updateDashboard();
            updateOffersDashboard();
            
            // Close modal and reset form
            offerModal.style.display = 'none';
            offerModalDate.value = '';
            offerModalNotes.value = '';
            editingOfferIndex = null;
            
            showNotification('Offer updated successfully!', 'success');
        });

        // Offer sub-tabs event listeners
        const offerSubTabs = document.querySelectorAll('.sub-tab');
        const offerTabContents = document.querySelectorAll('.offer-tab-content');

        offerSubTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.getAttribute('data-offer-tab');
                
                // Update active sub-tab button
                offerSubTabs.forEach(btn => {
                    btn.classList.remove('active');
                    btn.setAttribute('aria-selected', 'false');
                });
                tab.classList.add('active');
                tab.setAttribute('aria-selected', 'true');
                
                // Show corresponding sub-tab content
                offerTabContents.forEach(content => {
                    content.classList.add('hidden');
                    content.setAttribute('aria-hidden', 'true');
                    if (content.id === `offer-${tabName}-content`) {
                        content.classList.remove('hidden');
                        content.setAttribute('aria-hidden', 'false');
                    }
                });
                
                // Update specific offer charts
                if (tabName === 'overview') {
                    updateOfferOverviewCharts();
                } else if (tabName === 'performance') {
                    updateOfferPerformanceCharts();
                } else if (tabName === 'comparison') {
                    updateOfferComparisonCharts();
                }
            });
        });

        // Export and refresh buttons
        document.getElementById('exportOfferData')?.addEventListener('click', exportOfferData);
        document.getElementById('refreshOfferData')?.addEventListener('click', () => {
            showLoadingIndicator();
            setTimeout(() => {
                updateOffersDashboard();
                hideLoadingIndicator();
                showUpdateStatus('Offer data refreshed');
            }, 500);
        });

        // Initialize dashboard
        updateDashboard();

        // Functions
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function showLoadingIndicator() {
            loadingIndicator.classList.remove('hidden');
            updateStatus.textContent = 'Updating...';
        }

        function hideLoadingIndicator() {
            loadingIndicator.classList.add('hidden');
        }

        function showUpdateStatus(message) {
            updateStatus.textContent = message;
            setTimeout(() => {
                updateStatus.textContent = '';
            }, 3000);
        }

        function updateDashboard() {
            updateKPIs();
            updateCharts();
            renderTable();
            updateAnalysisData();
        }

        function updateKPIs() {
            const filteredData = getFilteredData();
            
            const totalTransactions = filteredData.reduce((sum, item) => sum + item.transactions, 0);
            const totalSales = filteredData.reduce((sum, item) => sum + item.sales, 0);
            const avgTransactionValue = totalSales / totalTransactions;
            
            // Calculate daily average based on selected date range
            const dayCount = selectedEndDate ? (selectedEndDate - selectedStartDate + 1) : 12;
            const dailyAvgTransactions = Math.round(totalTransactions / dayCount);
            
            const branches = [...new Set(deliveryData.map(item => item.branch))];
            
            document.getElementById('totalTransactions').textContent = totalTransactions.toLocaleString();
            document.getElementById('totalSales').textContent = `${totalSales.toFixed(0)} AED`;
            document.getElementById('avgTransactionValue').textContent = `${avgTransactionValue.toFixed(0)} AED`;
            document.getElementById('dailyAvgTransactions').textContent = `Daily Avg: ${dailyAvgTransactions}`;
            document.getElementById('activeBranches').textContent = branches.length;
            document.getElementById('branchSubtitle').textContent = selectedBranch === 'All' ? 'All branches' : selectedBranch.replace('Crispy Chicken ', '');
        }

        function getFilteredData() {
            let filteredData = deliveryData;
            
            // Apply branch filter
            if (selectedBranch !== 'All') {
                filteredData = filteredData.filter(item => item.branch === selectedBranch);
            }
            
            // Apply date range filter
            if (selectedStartDate && selectedEndDate) {
                filteredData = filteredData.filter(item => {
                    const day = parseInt(item.date.match(/\d+/)[0]);
                    return day >= selectedStartDate && day <= selectedEndDate;
                });
            }
            
            return filteredData;
        }

        function updateCharts() {
            updateTransactionsChart();
            updateSalesChart();
            updateBranchChart();
            updateWeeklyChart();
            updateDailyBranchChart();
            
            // Update charts for active tab
            const activeTabButton = document.querySelector('.tab-btn.tab-active');
            if (activeTabButton) {
                const activeTab = activeTabButton.getAttribute('data-tab');
                if (activeTab === 'performance') {
                    updatePerformanceCharts();
                } else if (activeTab === 'trends') {
                    updateTrendCharts();
                }
            }
        }

        function updateAnalysisData() {
            // Update performance metrics data
            updatePerformanceMetricsData();
            
            // Update trend analysis data
            updateTrendAnalysisData();
            
            // Update recommendations data
            updateRecommendationsData();
        }

        function updatePerformanceMetricsData() {
            const filteredData = getFilteredData();
            
            // Calculate peak hours (simplified for demo)
            const peakHours = selectedBranch === 'All' ? '6:00 PM - 8:00 PM' : '5:30 PM - 7:30 PM';
            const avgOrdersHour = selectedBranch === 'All' ? '24.5' : '22.3';
            const peakDay = selectedBranch === 'All' ? 'Saturday' : 'Friday';
            
            document.getElementById('peakHours').textContent = peakHours;
            document.getElementById('avgOrdersHour').textContent = avgOrdersHour;
            document.getElementById('peakDay').textContent = peakDay;
            
            // Calculate order value metrics
            const allOrders = filteredData.map(item => item.sales / item.transactions);
            const highestOrder = Math.max(...allOrders).toFixed(0);
            const lowestOrder = Math.min(...allOrders).toFixed(0);
            const mostCommon = `${(Math.max(...allOrders) * 0.6).toFixed(0)}-${(Math.max(...allOrders) * 0.8).toFixed(0)}`;
            
            document.getElementById('highestOrder').textContent = `${highestOrder} AED`;
            document.getElementById('lowestOrder').textContent = `${lowestOrder} AED`;
            document.getElementById('mostCommon').textContent = `${mostCommon} AED`;
            
            // Update efficiency metrics
            const ordersEmployee = selectedBranch === 'All' ? '18.2' : '16.8';
            const prepTime = selectedBranch === 'All' ? '12 min' : '11 min';
            const deliveryTime = selectedBranch === 'All' ? '28 min' : '26 min';
            
            document.getElementById('ordersEmployee').textContent = ordersEmployee;
            document.getElementById('prepTime').textContent = prepTime;
            document.getElementById('deliveryTime').textContent = deliveryTime;
        }

        function updateTrendAnalysisData() {
            const filteredData = getFilteredData();
            
            // Calculate growth rate
            const week1Data = filteredData.filter(item => parseInt(item.date.match(/\d+/)[0]) <= 6);
            const week2Data = filteredData.filter(item => parseInt(item.date.match(/\d+/)[0]) > 6);
            
            const week1Sales = week1Data.reduce((sum, item) => sum + item.sales, 0);
            const week2Sales = week2Data.reduce((sum, item) => sum + item.sales, 0);
            const growthRate = week1Sales > 0 ? ((week2Sales - week1Sales) / week1Sales * 100).toFixed(1) : '0.0';
            
            document.getElementById('growthRate').textContent = `+${growthRate}%`;
            
            // Update other metrics
            const seasonalityIndex = selectedBranch === 'All' ? '1.24' : '1.18';
            const volatility = selectedBranch === 'All' ? '18.3%' : '15.7%';
            const momentum = selectedBranch === 'All' ? 'Strong' : 'Moderate';
            
            document.getElementById('seasonalityIndex').textContent = seasonalityIndex;
            document.getElementById('volatility').textContent = volatility;
            document.getElementById('momentum').textContent = momentum;
        }

        function updateRecommendationsData() {
            // Update operational improvements
            const staffOpt = selectedBranch === 'All' 
                ? 'Increase staff during 6-8 PM peak hours'
                : 'Optimize staff schedule for peak demand';
            
            const menuEng = selectedBranch === 'All' 
                ? 'Promote combo deals during lunch hours'
                : 'Introduce branch-specific menu items';
            
            const deliveryRoutes = selectedBranch === 'All' 
                ? 'Optimize routes for Al Barsha area'
                : 'Improve delivery efficiency in this area';
            
            document.getElementById('staffOpt').textContent = staffOpt;
            document.getElementById('menuEng').textContent = menuEng;
            document.getElementById('deliveryRoutes').textContent = deliveryRoutes;
            
            // Update marketing strategies
            const weekendPromo = selectedBranch === 'All' 
                ? 'Family bundles on Saturdays'
                : 'Target local weekend promotions';
            
            const eveningBoost = selectedBranch === 'All' 
                ? 'Late-night specials 9-11 PM'
                : 'Evening promotional campaigns';
            
            const loyaltyProg = selectedBranch === 'All' 
                ? 'Target frequent customers'
                : 'Branch-specific loyalty program';
            
            document.getElementById('weekendPromo').textContent = weekendPromo;
            document.getElementById('eveningBoost').textContent = eveningBoost;
            document.getElementById('loyaltyProg').textContent = loyaltyProg;
        }

        function updateTransactionsChart() {
            const ctx = document.getElementById('transactionsChart').getContext('2d');
            const filteredData = getFilteredData();
            
            // Properly destroy existing chart
            transactionsChartInstance = destroyChart(transactionsChartInstance);
            
            // Aggregate by date
            const grouped = {};
            filteredData.forEach(item => {
                const day = item.date.split(',')[0].replace('October ', '').replace('st', '').replace('nd', '').replace('rd', '').replace('th', '').trim();
                if (!grouped[day]) {
                    grouped[day] = { date: `Oct ${day}`, transactions: 0 };
                }
                grouped[day].transactions += item.transactions;
            });
            
            const chartData = Object.values(grouped).sort((a, b) => parseInt(a.date.split(' ')[1]) - parseInt(b.date.split(' ')[1]));
            
            transactionsChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartData.map(item => item.date),
                    datasets: [{
                        label: 'Transactions',
                        data: chartData.map(item => item.transactions),
                        borderColor: selectedBranch === 'All' ? '#f59e0b' : getBranchColor(selectedBranch),
                        backgroundColor: selectedBranch === 'All' ? 'rgba(245, 158, 11, 0.1)' : getBranchColor(selectedBranch, 0.1),
                        borderWidth: 3,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: getChartTitle(),
                            font: {
                                size: 16,
                                weight: 'bold'
                            },
                            color: selectedBranch === 'All' ? '#4b5563' : getBranchColor(selectedBranch)
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateSalesChart() {
            const ctx = document.getElementById('salesChart').getContext('2d');
            const filteredData = getFilteredData();
            
            // Properly destroy existing chart
            salesChartInstance = destroyChart(salesChartInstance);
            
            // Aggregate by date
            const grouped = {};
            filteredData.forEach(item => {
                const day = item.date.split(',')[0].replace('October ', '').replace('st', '').replace('nd', '').replace('rd', '').replace('th', '').trim();
                if (!grouped[day]) {
                    grouped[day] = { date: `Oct ${day}`, sales: 0 };
                }
                grouped[day].sales += item.sales;
            });
            
            const chartData = Object.values(grouped).sort((a, b) => parseInt(a.date.split(' ')[1]) - parseInt(b.date.split(' ')[1]));
            
            salesChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartData.map(item => item.date),
                    datasets: [{
                        label: 'Sales (AED)',
                        data: chartData.map(item => item.sales),
                        backgroundColor: selectedBranch === 'All' ? '#10b981' : getBranchColor(selectedBranch),
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: getChartTitle(),
                            font: {
                                size: 16,
                                weight: 'bold'
                            },
                            color: selectedBranch === 'All' ? '#4b5563' : getBranchColor(selectedBranch)
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateBranchChart() {
            const ctx = document.getElementById('branchChart').getContext('2d');
            
            // Properly destroy existing chart
            branchChartInstance = destroyChart(branchChartInstance);
            
            // Aggregate by branch
            const grouped = {};
            deliveryData.forEach(item => {
                if (!grouped[item.branch]) {
                    grouped[item.branch] = { 
                        branch: item.branch.replace('Crispy Chicken ', '').replace('Crispy Chicken-', ''), 
                        sales: 0,
                        fullBranchName: item.branch
                    };
                }
                grouped[item.branch].sales += item.sales;
            });
            
            const chartData = Object.values(grouped).sort((a, b) => b.sales - a.sales);
            
            // Create background colors array
            const backgroundColors = chartData.map(item => {
                if (selectedBranch === 'All') {
                    return '#3b82f6'; // default blue for all
                } else {
                    // Check if this branch is the selected one
                    return item.fullBranchName === selectedBranch ? getBranchColor(selectedBranch) : '#e5e7eb';
                }
            });
            
            branchChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartData.map(item => item.branch),
                    datasets: [{
                        label: 'Sales (AED)',
                        data: chartData.map(item => item.sales),
                        backgroundColor: backgroundColors,
                        borderRadius: 5
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: getChartTitle(),
                            font: {
                                size: 16,
                                weight: 'bold'
                            },
                            color: selectedBranch === 'All' ? '#4b5563' : getBranchColor(selectedBranch)
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateWeeklyChart() {
            const ctx = document.getElementById('weeklyChart').getContext('2d');
            const filteredData = getFilteredData();
            
            // Properly destroy existing chart
            weeklyChartInstance = destroyChart(weeklyChartInstance);
            
            const week1 = filteredData.filter(item => parseInt(item.date.match(/\d+/)[0]) <= 7);
            const week2 = filteredData.filter(item => parseInt(item.date.match(/\d+/)[0]) > 7);
            
            const w1Trans = week1.reduce((sum, item) => sum + item.transactions, 0);
            const w1Sales = week1.reduce((sum, item) => sum + item.sales, 0);
            const w2Trans = week2.reduce((sum, item) => sum + item.transactions, 0);
            const w2Sales = week2.reduce((sum, item) => sum + item.sales, 0);
            
            const chartData = [
                { week: 'Week 1 (Oct 1-7)', transactions: w1Trans, sales: Math.round(w1Sales) },
                { week: 'Week 2 (Oct 8-12)', transactions: w2Trans, sales: Math.round(w2Sales) }
            ];
            
            weeklyChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartData.map(item => item.week),
                    datasets: [
                        {
                            label: 'Transactions',
                            data: chartData.map(item => item.transactions),
                            backgroundColor: selectedBranch === 'All' ? '#f59e0b' : getBranchColor(selectedBranch),
                            borderRadius: 5,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Sales (AED)',
                            data: chartData.map(item => item.sales),
                            backgroundColor: selectedBranch === 'All' ? '#10b981' : getBranchColor(selectedBranch, 0.7),
                            borderRadius: 5,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true
                        },
                        title: {
                            display: true,
                            text: getChartTitle(),
                            font: {
                                size: 16,
                                weight: 'bold'
                            },
                            color: selectedBranch === 'All' ? '#4b5563' : getBranchColor(selectedBranch)
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });
        }

        function updateDailyBranchChart() {
            const ctx = document.getElementById('dailyBranchChart').getContext('2d');
            
            // Properly destroy existing chart
            dailyBranchChartInstance = destroyChart(dailyBranchChartInstance);
            
            // Get all unique branches
            const branches = [...new Set(deliveryData.map(item => item.branch))];
            
            // Get all unique dates
            const dates = [...new Set(deliveryData.map(item => {
                const day = item.date.split(',')[0].replace('October ', '').replace('st', '').replace('nd', '').replace('rd', '').replace('th', '').trim();
                return `Oct ${day}`;
            }))].sort((a, b) => parseInt(a.split(' ')[1]) - parseInt(b.split(' ')[1]));
            
            // Prepare datasets for each branch
            const datasets = branches.map((branch, index) => {
                const branchData = dates.map(date => {
                    const day = date.split(' ')[1];
                    const dayData = deliveryData.filter(item => {
                        const itemDay = item.date.split(',')[0].replace('October ', '').replace('st', '').replace('nd', '').replace('rd', '').replace('th', '').trim();
                        return itemDay === day;
                    });
                    
                    return dayData.reduce((sum, item) => sum + item.sales, 0);
                });
                
                // Generate colors for each branch
                const colors = [
                    '#3b82f6', // blue
                    '#10b981', // green
                    '#f59e0b', // amber
                    '#8b5cf6', // purple
                    '#ec4899', // pink
                    '#06b6d4', // cyan
                    '#f97316'  // orange
                ];
                
                // If a branch is selected, use the color for that branch and gray for others
                let backgroundColor = colors[index % colors.length];
                if (selectedBranch !== 'All') {
                    backgroundColor = branch === selectedBranch ? getBranchColor(selectedBranch) : '#e5e7eb';
                }
                
                return {
                    label: branch.replace('Crispy Chicken ', ''),
                    data: branchData,
                    backgroundColor: backgroundColor,
                    borderColor: colors[index % colors.length],
                    borderWidth: 1
                };
            });
            
            dailyBranchChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dates,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true
                        },
                        title: {
                            display: true,
                            text: getChartTitle(),
                            font: {
                                size: 16,
                                weight: 'bold'
                            },
                            color: selectedBranch === 'All' ? '#4b5563' : getBranchColor(selectedBranch)
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            beginAtZero: true
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updatePerformanceCharts() {
            updateHourlyChart();
            updateDayOfWeekChart();
        }

        function updateHourlyChart() {
            const ctx = document.getElementById('hourlyChart').getContext('2d');
            
            // Properly destroy existing chart
            hourlyChartInstance = destroyChart(hourlyChartInstance);
            
            // Generate sample hourly data
            const hours = Array.from({length: 24}, (_, i) => `${i}:00`);
            const hourlyData = hours.map(() => Math.floor(Math.random() * 50) + 10);
            
            hourlyChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: hours,
                    datasets: [{
                        label: 'Orders',
                        data: hourlyData,
                        backgroundColor: selectedBranch === 'All' ? '#3b82f6' : getBranchColor(selectedBranch),
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: getChartTitle(),
                            font: {
                                size: 16,
                                weight: 'bold'
                            },
                            color: selectedBranch === 'All' ? '#4b5563' : getBranchColor(selectedBranch)
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateDayOfWeekChart() {
            const ctx = document.getElementById('dayOfWeekChart').getContext('2d');
            
            // Properly destroy existing chart
            dayOfWeekChartInstance = destroyChart(dayOfWeekChartInstance);
            
            // Generate sample day of week data
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            const dayData = days.map(() => Math.floor(Math.random() * 100) + 50);
            
            dayOfWeekChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [{
                        label: 'Average Orders',
                        data: dayData,
                        borderColor: selectedBranch === 'All' ? '#10b981' : getBranchColor(selectedBranch),
                        backgroundColor: selectedBranch === 'All' ? 'rgba(16, 185, 129, 0.1)' : getBranchColor(selectedBranch, 0.1),
                        borderWidth: 3,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: getChartTitle(),
                            font: {
                                size: 16,
                                weight: 'bold'
                            },
                            color: selectedBranch === 'All' ? '#4b5563' : getBranchColor(selectedBranch)
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateTrendCharts() {
            updateMovingAvgChart();
            updateGrowthRateChart();
        }

        function updateMovingAvgChart() {
            const ctx = document.getElementById('movingAvgChart').getContext('2d');
            
            // Properly destroy existing chart
            movingAvgChartInstance = destroyChart(movingAvgChartInstance);
            
            // Generate sample moving average data
            const dates = Array.from({length: 12}, (_, i) => `Oct ${i + 1}`);
            const actualData = dates.map(() => Math.floor(Math.random() * 5000) + 2000);
            const movingAvgData = actualData.map((_, i, arr) => {
                const start = Math.max(0, i - 2);
                const end = Math.min(arr.length, i + 3);
                const slice = arr.slice(start, end);
                return slice.reduce((a, b) => a + b) / slice.length;
            });
            
            movingAvgChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [
                        {
                            label: 'Actual Sales',
                            data: actualData,
                            borderColor: selectedBranch === 'All' ? '#3b82f6' : getBranchColor(selectedBranch),
                            backgroundColor: selectedBranch === 'All' ? 'rgba(59, 130, 246, 0.1)' : getBranchColor(selectedBranch, 0.1),
                            borderWidth: 2,
                            tension: 0.3
                        },
                        {
                            label: 'Moving Average (5-day)',
                            data: movingAvgData,
                            borderColor: selectedBranch === 'All' ? '#f59e0b' : getBranchColor(selectedBranch, 0.7),
                            backgroundColor: selectedBranch === 'All' ? 'rgba(245, 158, 11, 0.1)' : getBranchColor(selectedBranch, 0.05),
                            borderWidth: 3,
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true
                        },
                        title: {
                            display: true,
                            text: getChartTitle(),
                            font: {
                                size: 16,
                                weight: 'bold'
                            },
                            color: selectedBranch === 'All' ? '#4b5563' : getBranchColor(selectedBranch)
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });
        }

        function updateGrowthRateChart() {
            const ctx = document.getElementById('growthRateChart').getContext('2d');
            
            // Properly destroy existing chart
            growthRateChartInstance = destroyChart(growthRateChartInstance);
            
            // Generate sample growth rate data
            const dates = Array.from({length: 12}, (_, i) => `Oct ${i + 1}`);
            const growthRates = dates.map(() => (Math.random() * 30) - 10); // -10% to +20%
            
            growthRateChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Growth Rate (%)',
                        data: growthRates,
                        backgroundColor: growthRates.map(rate => rate >= 0 ? (selectedBranch === 'All' ? '#10b981' : getBranchColor(selectedBranch)) : '#ef4444'),
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: getChartTitle(),
                            font: {
                                size: 16,
                                weight: 'bold'
                            },
                            color: selectedBranch === 'All' ? '#4b5563' : getBranchColor(selectedBranch)
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });
        }

        function getChartTitle() {
            let title = '';
            
            if (selectedBranch !== 'All') {
                title += selectedBranch.replace('Crispy Chicken ', '');
            } else {
                title += 'All Branches';
            }
            
            if (selectedStartDate && selectedEndDate) {
                title += ` (Oct ${selectedStartDate}-${selectedEndDate})`;
            }
            
            return title;
        }

        function getBranchColor(branch, alpha = 1) {
            const colors = {
                'Crispy Chicken-Hamdan St': `rgba(59, 130, 246, ${alpha})`, // blue
                'Crispy Chicken Khaldia': `rgba(16, 185, 129, ${alpha})`, // green
                'Crispy Chicken Shabiya 11': `rgba(245, 158, 11, ${alpha})`, // amber
                'Crispy Chicken Muroor': `rgba(139, 92, 246, ${alpha})`, // purple
                'Crispy Chicken Al Barsha': `rgba(236, 72, 153, ${alpha})`, // pink
                'Crispy Chicken Al Satwa': `rgba(6, 182, 212, ${alpha})`, // cyan
                'Crispy Chicken Al Rgga': `rgba(249, 115, 22, ${alpha})` // orange
            };
            
            return colors[branch] || `rgba(107, 114, 128, ${alpha})`; // default gray
        }

        function highlightSelectedBranch() {
            // Add visual feedback for the selected branch
            const branchCards = document.querySelectorAll('.stat-card');
            if (selectedBranch !== 'All') {
                branchCards.forEach(card => {
                    card.classList.remove('branch-highlight');
                });
                
                // Add highlight to the active branches card
                const activeBranchesCard = document.querySelector('#activeBranches').closest('.stat-card');
                if (activeBranchesCard) {
                    activeBranchesCard.classList.add('branch-highlight');
                }
            } else {
                branchCards.forEach(card => {
                    card.classList.remove('branch-highlight');
                });
            }
        }

        function renderTable() {
            const filteredData = getFilteredData();
            
            recordCount.textContent = filteredData.length;
            
            // Clear table
            dataTableBody.innerHTML = '';
            
            // Add rows (max 20)
            const displayData = filteredData.slice(0, 20);
            displayData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.className = 'border-b table-row';
                
                // Highlight selected branch rows
                if (selectedBranch !== 'All' && item.branch === selectedBranch) {
                    row.classList.add('bg-blue-50');
                }
                
                row.innerHTML = `
                    <td class="px-4 py-3 text-sm">${item.date}</td>
                    <td class="px-4 py-3 text-sm font-medium ${selectedBranch !== 'All' && item.branch === selectedBranch ? 'text-blue-600' : ''}">${item.branch}</td>
                    <td class="px-4 py-3 text-sm">${item.transactions}</td>
                    <td class="px-4 py-3 text-sm">${item.sales.toFixed(2)}</td>
                    <td class="px-4 py-3 text-sm">${(item.sales / item.transactions).toFixed(2)}</td>
                    <td class="px-4 py-3 text-sm">
                        <div class="flex gap-2">
                            <button onclick="handleEditEntry(${index})" class="p-1 text-blue-600 hover:text-blue-800">
                                <i data-lucide="edit-2" class="w-4 h-4" aria-hidden="true"></i>
                            </button>
                            <button onclick="handleDeleteEntry(${index})" class="p-1 text-red-600 hover:text-red-800">
                                <i data-lucide="trash-2" class="w-4 h-4" aria-hidden="true"></i>
                            </button>
                        </div>
                    </td>
                `;
                dataTableBody.appendChild(row);
            });
            
            // Re-initialize Lucide icons for new elements
            lucide.createIcons();
            
            // Show/hide footer
            if (filteredData.length > 20) {
                tableFooter.textContent = `Showing first 20 of ${filteredData.length} records`;
                tableFooter.classList.remove('hidden');
            } else {
                tableFooter.classList.add('hidden');
            }
        }

        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            // Check file type
            if (!file.name.match(/\.(xlsx|xls)$/)) {
                showNotification('Please upload a valid Excel file (.xlsx or .xls)', 'error');
                return;
            }

            showLoadingIndicator();
            
            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const data = new Uint8Array(event.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    // Validate data structure
                    if (!jsonData.length || !jsonData[0].hasOwnProperty('Date') || !jsonData[0].hasOwnProperty('Branch')) {
                        throw new Error('Invalid file format. Please use the provided template.');
                    }
                    
                    // Map the uploaded data to our format
                    const mappedData = jsonData.map(row => ({
                        date: row.Date || row.date,
                        branch: row.Branch || row.branch,
                        transactions: parseInt(row.Transactions || row.transactions || 0),
                        sales: parseFloat(row['Sales (AED)'] || row.sales || 0)
                    }));
                    
                    deliveryData = mappedData;
                    updateDashboard();
                    hideLoadingIndicator();
                    showUpdateStatus('Data uploaded successfully!');
                    showNotification('Data uploaded successfully!', 'success');
                } catch (error) {
                    hideLoadingIndicator();
                    showUpdateStatus('Error uploading data');
                    showNotification(`Error reading file: ${error.message}`, 'error');
                    console.error('File upload error:', error);
                }
            };
            
            reader.onerror = function() {
                hideLoadingIndicator();
                showNotification('Error reading file. Please try again.', 'error');
            };
            
            reader.readAsArrayBuffer(file);
        }

        function downloadTemplate() {
            const template = [
                { Date: 'October 1st, 2025', Branch: 'Crispy Chicken-Hamdan St', Transactions: 0, 'Sales (AED)': 0 }
            ];
            const ws = XLSX.utils.json_to_sheet(template);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Template');
            XLSX.writeFile(wb, 'crispy_chicken_template.xlsx');
        }

        function generateReport() {
            showLoadingIndicator();
            
            try {
                // Create a comprehensive report with all data
                const reportData = {
                    generatedAt: new Date().toISOString(),
                    dateRange: selectedStartDate && selectedEndDate 
                        ? `Oct ${selectedStartDate} to Oct ${selectedEndDate}` 
                        : 'All data',
                    branch: selectedBranch === 'All' ? 'All branches' : selectedBranch,
                    summary: {
                        totalTransactions: document.getElementById('totalTransactions').textContent,
                        totalSales: document.getElementById('totalSales').textContent,
                        avgTransactionValue: document.getElementById('avgTransactionValue').textContent,
                        activeBranches: document.getElementById('activeBranches').textContent
                    },
                    data: deliveryData
                };
                
                // Convert to JSON and create blob
                const jsonStr = JSON.stringify(reportData, null, 2);
                const blob = new Blob([jsonStr], { type: 'application/json' });
                
                // Create download link
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `crispy_chicken_report_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                hideLoadingIndicator();
                showUpdateStatus('Report generated successfully');
                showNotification('Report downloaded successfully!', 'success');
            } catch (error) {
                hideLoadingIndicator();
                showNotification('Error generating report. Please try again.', 'error');
                console.error('Report generation error:', error);
            }
        }

        function handleAddEntry() {
            editingIndex = null;
            modalTitle.textContent = 'Add New Entry';
            modalDate.value = '';
            modalBranch.value = '';
            modalTransactions.value = '';
            modalSales.value = '';
            dataModal.classList.remove('hidden');
        }

        function handleEditEntry(index) {
            const filteredData = getFilteredData();
            
            const item = filteredData[index];
            editingIndex = index;
            modalTitle.textContent = 'Edit Entry';
            modalDate.value = item.date;
            modalBranch.value = item.branch;
            modalTransactions.value = item.transactions;
            modalSales.value = item.sales;
            dataModal.classList.remove('hidden');
        }

        function handleDeleteEntry(index) {
            if (window.confirm('Are you sure you want to delete this entry?')) {
                showLoadingIndicator();
                
                const filteredData = getFilteredData();
                
                const itemToDelete = filteredData[index];
                deliveryData = deliveryData.filter(item => 
                    !(item.date === itemToDelete.date && item.branch === itemToDelete.branch)
                );
                
                setTimeout(() => {
                    updateDashboard();
                    hideLoadingIndicator();
                    showUpdateStatus('Entry deleted successfully');
                    showNotification('Entry deleted successfully', 'success');
                }, 300);
            }
        }

        function handleSaveEntry() {
            // Validate inputs
            if (!modalDate.value) {
                showNotification('Please enter a date', 'error');
                return;
            }
            
            if (!modalBranch.value) {
                showNotification('Please enter a branch', 'error');
                return;
            }
            
            if (isNaN(modalTransactions.value) || parseInt(modalTransactions.value) < 0) {
                showNotification('Please enter a valid number for transactions', 'error');
                return;
            }
            
            if (isNaN(modalSales.value) || parseFloat(modalSales.value) < 0) {
                showNotification('Please enter a valid number for sales', 'error');
                return;
            }
            
            showLoadingIndicator();
            
            const newEntry = {
                date: modalDate.value,
                branch: modalBranch.value,
                transactions: parseInt(modalTransactions.value) || 0,
                sales: parseFloat(modalSales.value) || 0
            };
            
            setTimeout(() => {
                if (editingIndex !== null) {
                    const filteredData = getFilteredData();
                    const itemToEdit = filteredData[editingIndex];
                    deliveryData = deliveryData.map(item => 
                        (item.date === itemToEdit.date && item.branch === itemToEdit.branch) ? newEntry : item
                    );
                } else {
                    deliveryData.push(newEntry);
                }
                
                closeModal();
                updateDashboard();
                hideLoadingIndicator();
                showUpdateStatus('Entry saved successfully');
                showNotification('Entry saved successfully', 'success');
            }, 300);
        }

        function closeModal() {
            dataModal.classList.add('hidden');
        }

        // Helper function to destroy charts properly
        function destroyChart(chartInstance) {
            if (chartInstance) {
                chartInstance.destroy();
                return null;
            }
            return null;
        }

        // Offer Management Functions
        function updateOffersDashboard() {
            updateOfferMetrics();
            updateOfferOverviewCharts();
            updateTopOffers();
            renderOfferTable();
        }

        function updateOfferMetrics() {
            const offersData = deliveryData.filter(item => item.offerType && item.offerType !== 'Normal Day');
            const normalDaysData = deliveryData.filter(item => !item.offerType || item.offerType === 'Normal Day');
            
            // Calculate metrics
            const totalOffers = offersData.length;
            const offerRevenue = offersData.reduce((sum, item) => sum + item.sales, 0);
            const totalRevenue = deliveryData.reduce((sum, item) => sum + item.sales, 0);
            const normalRevenue = normalDaysData.reduce((sum, item) => sum + item.sales, 0);
            
            // Calculate conversion rate
            const conversionRate = totalRevenue > 0 ? (offerRevenue / totalRevenue * 100) : 0;
            
            // Find top performing offer type
            const offerTypes = {};
            offersData.forEach(item => {
                const type = item.offerType || 'Normal Day';
                if (!offerTypes[type]) {
                    offerTypes[type] = { count: 0, sales: 0 };
                }
                offerTypes[type].sales += item.sales;
            });
            
            let topOffer = 'Normal Day';
            let topOfferSales = 0;
            
            Object.keys(offerTypes).forEach(offerType => {
                if (offerTypes[offerType].sales > topOfferSales) {
                    topOffer = offerType;
                    topOfferSales = offerTypes[offerType].sales;
                }
            });
            
            // Update UI
            document.getElementById('totalOffers').textContent = totalOffers;
            document.getElementById('offerRevenue').textContent = `${offerRevenue.toFixed(0)} AED`;
            document.getElementById('offerConversion').textContent = `${conversionRate.toFixed(1)}%`;
            document.getElementById('topOffer').textContent = topOffer;
        }

        function updateOfferOverviewCharts() {
            updateOfferTypeChart();
            updateOfferImpactChart();
        }

        function updateOfferTypeChart() {
            const ctx = document.getElementById('offerTypeChart').getContext('2d');
            
            // Properly destroy existing chart
            offerTypeChartInstance = destroyChart(offerTypeChartInstance);
            
            // Group data by offer type
            const offerTypes = {
                'Normal Day': { sales: 0 },
                'Chicken Day': { sales: 0 },
                'Ultimate Offer': { sales: 0 }
            };
            
            deliveryData.forEach(item => {
                const type = item.offerType || 'Normal Day';
                if (offerTypes[type]) {
                    offerTypes[type].sales += item.sales;
                }
            });
            
            const chartData = Object.entries(offerTypes).map(([type, data]) => ({
                type,
                sales: data.sales
            }));
            
            offerTypeChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: chartData.map(item => item.type),
                    datasets: [{
                        data: chartData.map(item => item.sales),
                        backgroundColor: [
                            '#3b82f6',
                            '#f59e0b',
                            '#8b5cf6'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        title: {
                            display: true,
                            text: 'Sales by Offer Type'
                        }
                    }
                }
            });
        }

        function updateOfferImpactChart() {
            const ctx = document.getElementById('offerImpactChart').getContext('2d');
            
            // Properly destroy existing chart
            offerImpactChartInstance = destroyChart(offerImpactChartInstance);
            
            // Calculate average sales for offer vs non-offer days
            const offerDays = deliveryData.filter(item => item.offerType && item.offerType !== 'Normal Day');
            const normalDays = deliveryData.filter(item => !item.offerType || item.offerType === 'Normal Day');
            
            const avgOfferSales = offerDays.length > 0 ? offerDays.reduce((sum, item) => sum + item.sales, 0) / offerDays.length : 0;
            const avgNormalSales = normalDays.length > 0 ? normalDays.reduce((sum, item) => sum + item.sales, 0) / normalDays.length : 0;
            
            offerImpactChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Offer Days', 'Normal Days'],
                    datasets: [{
                        label: 'Average Sales (AED)',
                        data: [avgOfferSales, avgNormalSales],
                        backgroundColor: ['#f59e0b', '#3b82f6'],
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Offer Impact on Sales'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateTopOffers() {
            // Calculate top performing offers
            const offersData = deliveryData.filter(item => item.offerType && item.offerType !== 'Normal Day');
            
            // Group by offer type
            const offerTypes = {};
            offersData.forEach(item => {
                const type = item.offerType || 'Normal Day';
                if (!offerTypes[type]) {
                    offerTypes[type] = { count: 0, sales: 0 };
                }
                offerTypes[type].sales += item.sales;
            });
            
            // Sort by sales
            const sortedOffers = Object.entries(offerTypes).sort((a, b) => b[1].sales - a[1].sales);
            
            // Update top offers container
            const container = document.getElementById('topOffersContainer');
            container.innerHTML = '';
            
            sortedOffers.slice(0, 3).forEach(([offerType, data], index) => {
                const card = document.createElement('div');
                card.className = 'offer-comparison-card';
                
                let badgeClass = 'offer-badge-normal';
                if (offerType === 'Chicken Day') badgeClass = 'offer-badge-chicken';
                if (offerType === 'Ultimate Offer') badgeClass = 'offer-badge-ultimate';
                
                card.innerHTML = `
                    <div class="flex justify-between mb-2">
                        <h4 class="font-semibold text-gray-800">${offerType}</h4>
                        <span class="offer-badge ${badgeClass}">Top ${index + 1}</span>
                    </div>
                    <div class="text-2xl font-bold text-gray-800">${data.sales.toFixed(0)} AED</div>
                    <div class="text-sm text-gray-600 mt-1">Total revenue</div>
                    <div class="offer-performance-bar mt-2">
                        <div class="offer-performance-fill bg-green-500" style="width: ${Math.min(100, (data.sales / Math.max(...Object.values(offerTypes).map(o => o.sales)) * 100))}%"></div>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        function updateOfferPerformanceCharts() {
            updateOfferDayChart();
            updateOfferBranchChart();
            updateOfferPerformanceTable();
        }

        function updateOfferDayChart() {
            const ctx = document.getElementById('offerDayChart').getContext('2d');
            
            // Properly destroy existing chart
            offerDayChartInstance = destroyChart(offerDayChartInstance);
            
            // Group data by day and offer type
            const dayData = {};
            deliveryData.forEach(item => {
                const day = item.date.split(',')[0].replace('October ', '').replace('st', '').replace('nd', '').replace('rd', '').replace('th', '').trim();
                if (!dayData[day]) {
                    dayData[day] = {};
                }
                
                const offerType = item.offerType || 'Normal Day';
                if (!dayData[day][offerType]) {
                    dayData[day][offerType] = { transactions: 0, sales: 0 };
                }
                
                dayData[day][offerType].transactions += item.transactions;
                dayData[day][offerType].sales += item.sales;
            });
            
            const days = Object.keys(dayData).sort((a, b) => parseInt(a.split(' ')[1]) - parseInt(b.split(' ')[1]));
            const normalData = days.map(day => dayData[day]['Normal Day'] || { transactions: 0, sales: 0 });
            const offerData = days.map(day => dayData[day]['Ultimate Offer'] || dayData[day]['Chicken Day'] || { transactions: 0, sales: 0 });
            
            offerDayChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: days.map(day => `Oct ${day}`),
                    datasets: [
                        {
                            label: 'Normal Day Avg Sales',
                            data: normalData.map(day => day.sales),
                            borderColor: '#6b7280',
                            backgroundColor: 'rgba(107, 114, 128, 0.1)',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: 'Offer Day Avg Sales',
                            data: offerData.map(day => day.sales),
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            borderWidth: 3,
                            tension: 0.3,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true
                        },
                        title: {
                            display: true,
                            text: 'Offer Performance by Day',
                            font: {
                                size: 16,
                                weight: 'bold'
                            },
                            color: selectedBranch === 'All' ? '#4b5563' : getBranchColor(selectedBranch)
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateOfferBranchChart() {
            const ctx = document.getElementById('offerBranchChart').getContext('2d');
            
            // Properly destroy existing chart
            offerBranchChartInstance = destroyChart(offerBranchChartInstance);
            
            // Group data by branch and offer type
            const branchData = {};
            deliveryData.forEach(item => {
                if (!branchData[item.branch]) {
                    branchData[item.branch] = {};
                }
                
                const offerType = item.offerType || 'Normal Day';
                if (!branchData[item.branch][offerType]) {
                    branchData[item.branch][offerType] = { sales: 0 };
                }
                
                branchData[item.branch][offerType].sales += item.sales;
            });
            
            const branches = Object.keys(branchData);
            const branchColors = branches.map(branch => getBranchColor(branch));
            
            offerBranchChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: branches.map(branch => branch.replace('Crispy Chicken ', '')),
                    datasets: [
                        {
                            label: 'Normal Day Sales',
                            data: branches.map(branch => branchData[branch]['Normal Day']?.sales || 0),
                            backgroundColor: '#3b82f6',
                            borderRadius: 5
                        },
                        {
                            label: 'Offer Day Sales',
                            data: branches.map(branch => {
                                const offerSales = (branchData[branch]['Ultimate Offer']?.sales || 0) + 
                                                  (branchData[branch]['Chicken Day']?.sales || 0);
                                return offerSales;
                            }),
                            backgroundColor: '#f59e0b',
                            borderRadius: 5
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true
                        },
                        title: {
                            display: true,
                            text: 'Offer Performance by Branch',
                            font: {
                                size: 16,
                                weight: 'bold'
                            },
                            color: selectedBranch === 'All' ? '#4b5563' : getBranchColor(selectedBranch)
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            beginAtZero: true
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateOfferPerformanceTable() {
            const tableBody = document.getElementById('offerPerformanceTableBody');
            tableBody.innerHTML = '';
            
            // Group data by offer type
            const offerTypes = {};
            deliveryData.forEach(item => {
                const type = item.offerType || 'Normal Day';
                if (!offerTypes[type]) {
                    offerTypes[type] = { transactions: 0, sales: 0 };
                }
                offerTypes[type].sales += item.sales;
            });
            
            const labels = Object.keys(offerTypes);
            const normalDays = offerTypes['Normal Day'] || { transactions: 0, sales: 0 };
            
            labels.forEach(type => {
                const offerData = offerTypes[type];
                const avgTransactionValue = offerData.sales / offerData.transactions;
                const normalAvgValue = normalDays.sales / normalDays.transactions;
                const performanceVsNormal = normalAvgValue > 0 ? ((avgTransactionValue - normalAvgValue) / normalAvgValue * 100).toFixed(1) : '0.0';
                
                const row = document.createElement('tr');
                let rowClass = "";
                if (type === "Normal Day") rowClass = "offer-row-normal";
                if (type === "Chicken Day") rowClass = "offer-row-chicken";
                if (type === "Ultimate Offer") rowClass = "offer-row-ultimate";
                
                row.className = rowClass;
                row.innerHTML = `
                    <td class="px-4 py-3 text-sm font-medium">${type}</td>
                    <td class="px-4 py-3 text-sm">${offerData.transactions}</td>
                    <td class="px-4 py-3 text-sm">${offerData.sales.toFixed(2)}</td>
                    <td class="px-4 py-3 text-sm">${avgTransactionValue.toFixed(2)}</td>
                    <td class="px-4 py-3 text-sm">
                        <span class="${performanceVsNormal >= 0 ? 'text-green-600' : 'text-red-600'}">
                            ${performanceVsNormal >= 0 ? '+' : ''}${performanceVsNormal}%
                        </span>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Re-initialize Lucide icons for new elements
            lucide.createIcons();
        }

        function updateOfferComparisonCharts() {
            updateOfferComparisonChart();
            updateOfferRoiChart();
            updateOfferComparisonCards();
        }

        function updateOfferComparisonChart() {
            const ctx = document.getElementById('offerComparisonChart').getContext('2d');
            
            // Properly destroy existing chart
            offerComparisonChartInstance = destroyChart(offerComparisonChartInstance);
            
            // Group data by offer type
            const offerTypes = {
                'Normal Day': { transactions: 0, sales: 0 },
                'Chicken Day': { transactions: 0, sales: 0 },
                'Ultimate Offer': { transactions: 0, sales: 0 }
            };
            
            deliveryData.forEach(item => {
                const type = item.offerType || 'Normal Day';
                if (offerTypes[type]) {
                    offerTypes[type].transactions += item.transactions;
                    offerTypes[type].sales += item.sales;
                }
            });
            
            const chartData = Object.entries(offerTypes).map(([type, data]) => ({
                type,
                transactions: data.transactions,
                sales: data.sales
            }));
            
            offerComparisonChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: chartData.map(item => item.type),
                    datasets: [
                        {
                            label: 'Transactions',
                            data: chartData.map(item => item.transactions),
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.2)'
                        },
                        {
                            label: 'Sales (AED)',
                            data: chartData.map(item => item.sales / 100), // Scale down for better visualization
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.2)'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true
                        },
                        title: {
                            display: true,
                            text: 'Offer Type Comparison'
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateOfferRoiChart() {
            const ctx = document.getElementById('offerRoiChart').getContext('2d');
            
            // Properly destroy existing chart
            offerRoiChartInstance = destroyChart(offerRoiChartInstance);
            
            // Calculate ROI for each offer type
            const offerTypes = {
                'Normal Day': { transactions: 0, sales: 0 },
                'Chicken Day': { transactions: 0, sales: 0 },
                'Ultimate Offer': { transactions: 0, sales: 0 }
            };
            
            deliveryData.forEach(item => {
                const type = item.offerType || 'Normal Day';
                if (offerTypes[type]) {
                    offerTypes[type].transactions += item.transactions;
                    offerTypes[type].sales += item.sales;
                }
            });
            
            const chartData = Object.entries(offerTypes).map(([type, data]) => {
                const avgValue = data.sales / data.transactions;
                const normalAvg = offerTypes['Normal Day'].sales / offerTypes['Normal Day'].transactions;
                const roi = normalAvg > 0 ? ((avgValue - normalAvg) / normalAvg * 100) : 0;
                
                return {
                    type,
                    roi: roi
                };
            });
            
            offerRoiChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartData.map(item => item.type),
                    datasets: [{
                        label: 'ROI (%)',
                        data: chartData.map(item => item.roi),
                        backgroundColor: chartData.map(item => item.roi >= 0 ? '#10b981' : '#ef4444'),
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Offer ROI Analysis'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });
        }

        function updateOfferComparisonCards() {
            const container = document.getElementById('offerComparisonCards');
            container.innerHTML = '';
            
            // Calculate performance metrics for each offer type
            const offerTypes = {
                'Normal Day': { transactions: 0, sales: 0 },
                'Chicken Day': { transactions: 0, sales: 0 },
                'Ultimate Offer': { transactions: 0, sales: 0 }
            };
            
            deliveryData.forEach(item => {
                const type = item.offerType || 'Normal Day';
                if (offerTypes[type]) {
                    offerTypes[type].transactions += item.transactions;
                    offerTypes[type].sales += item.sales;
                }
            });
            
            const normalAvg = offerTypes['Normal Day'].sales / offerTypes['Normal Day'].transactions;
            
            Object.entries(offerTypes).forEach(([type, data]) => {
                const card = document.createElement('div');
                card.className = 'offer-comparison-card';
                
                let badgeClass = 'offer-badge-normal';
                if (type === 'Chicken Day') badgeClass = 'offer-badge-chicken';
                if (type === 'Ultimate Offer') badgeClass = 'offer-badge-ultimate';
                
                const avgValue = data.sales / data.transactions;
                const performanceVsNormal = normalAvg > 0 ? ((avgValue - normalAvg) / normalAvg * 100) : 0;
                
                card.innerHTML = `
                    <div class="flex justify-between mb-2">
                        <h4 class="font-semibold text-gray-800">${type}</h4>
                        <span class="offer-badge ${badgeClass}">${badgeClass.replace('offer-badge-', '')}</span>
                    </div>
                    <div class="text-2xl font-bold text-gray-800">${avgValue.toFixed(0)} AED</div>
                    <div class="text-sm text-gray-600 mt-1">Avg transaction value</div>
                    <div class="offer-performance-bar mt-2">
                        <div class="offer-performance-fill ${performanceVsNormal >= 0 ? 'bg-green-500' : 'bg-red-500'}" 
                             style="width: ${Math.min(100, Math.abs(performanceVsNormal))}%"></div>
                    </div>
                    <div class="text-sm mt-1 ${performanceVsNormal >= 0 ? 'text-green-600' : 'text-red-600'}">
                        ${performanceVsNormal >= 0 ? '+' : ''}${performanceVsNormal.toFixed(1)}% vs normal
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        function renderOfferTable() {
            const tableBody = document.getElementById('offerTableBody');
            tableBody.innerHTML = '';
            
            // Sort data by date (newest first)
            const sortedData = [...deliveryData].sort((a, b) => {
                const dayA = parseInt(a.date.match(/\d+/)[0]);
                const dayB = parseInt(b.date.match(/\d+/)[0]);
                return dayB - dayA;
            });
            
            sortedData.forEach((item, index) => {
                const row = document.createElement('tr');
                let rowClass = "";
                if (item.offerType === "Normal Day") rowClass = "offer-row-normal";
                if (item.offerType === "Chicken Day") rowClass = "offer-row-chicken";
                if (item.offerType === "Ultimate Offer") rowClass = "offer-row-ultimate";
                
                row.className = rowClass;
                
                const dayName = getDayOfWeek(item.date);
                
                row.innerHTML = `
                    <td class="px-4 py-3 text-sm">${item.date}</td>
                    <td class="px-4 py-3 text-sm">${dayName}</td>
                    <td class="px-4 py-3 text-sm">${item.branch}</td>
                    <td class="px-4 py-3 text-sm">${item.transactions}</td>
                    <td class="px-4 py-3 text-sm">${item.sales.toFixed(2)}</td>
                    <td class="px-4 py-3 text-sm">${item.offerType || 'No Offer'}</td>
                    <td class="px-4 py-3 text-sm">${item.offerStatus || 'No Offer'}</td>
                    <td class="px-4 py-3 text-sm">${item.notes || ''}</td>
                    <td class="px-4 py-3 text-sm">
                        <div class="flex gap-2">
                            <button onclick="editOffer('${item.date}', '${item.branch}')" class="p-1 text-blue-600 hover:text-blue-800">
                                <i data-lucide="edit-2" class="w-4 h-4" aria-hidden="true"></i>
                            </button>
                            <button onclick="deleteOffer('${item.date}', '${item.branch}')" class="p-1 text-red-600 hover:text-red-800">
                                <i data-lucide="trash-2" class="w-4 h-4" aria-hidden="true"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Re-initialize Lucide icons for new elements
            lucide.createIcons();
        }

        function editOffer(date, branch) {
            const item = deliveryData.find(item => item.date === date && item.branch === branch);
            if (item) {
                offerModalDate.value = formatDateForInput(date);
                offerModalBranch.value = item.branch;
                offerModalType.value = item.offerType || 'Normal Day';
                offerModalNotes.value = item.notes || '';
                offerModal.style.display = 'flex';
            }
        }

        function deleteOffer(date, branch) {
            if (window.confirm('Are you sure you want to delete this offer?')) {
                deliveryData = deliveryData.filter(item => 
                    !(item.date === date && item.branch === branch)
                );
                updateDashboard();
                showNotification('Offer deleted successfully', 'success');
            }
        }

        function formatDateForInput(dateString) {
            // Convert "October 1st, 2025" to "2025-10-01"
            const parts = dateString.split(' ');
            const month = parts[0];
            const day = parts[1].replace(/[^0-9]/g, '');
            const year = parts[2];
            
            const monthMap = {
                'January': '01', 'February': '02', 'March': '03', 'April': '04',
                'May': '05', 'June': '06', 'July': '07', 'August': '08',
                'September': '09', 'October': '10', 'November': '11', 'December': '12'
            };
            
            return `${year}-${monthMap[month]}-${day.padStart(2, '0')}`;
        }

        function formatDateForDisplay(dateString) {
            const date = new Date(dateString);
            const day = date.getDate();
            const month = date.toLocaleDateString('en-US', { month: 'long' });
            const year = date.getFullYear();
            
            // Add ordinal suffix to day
            let suffix = 'th';
            if (day === 1 || day === 21 || day === 31) suffix = 'st';
            else if (day === 2 || day === 22) suffix = 'nd';
            else if (day === 3 || day === 23) suffix = 'rd';
            
            return `${month} ${day}${suffix}, ${year}`;
        }

        function getDayOfWeek(dateString) {
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const date = new Date(dateString);
            return days[date.getDay()];
        }

        function exportOfferData() {
            // Create a CSV file with offer data
            const offersData = deliveryData.filter(item => item.offerType && item.offerType !== 'Normal Day');
            
            let csv = 'Date, Branch, Transactions, Sales (AED), Offer Type, Offer Status, Notes\n';
            
            offersData.forEach(item => {
                csv += `${item.date}, ${item.branch}, ${item.transactions}, ${item.sales}, ${item.offerType || 'Normal Day'}, ${item.offerStatus || 'No Offer'}, ${item.notes || ''}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'crispy_chicken_offers.csv';
            link.click();
            
            showNotification('Offer data exported successfully!', 'success');
        }
    </script>
</body>
</html>
