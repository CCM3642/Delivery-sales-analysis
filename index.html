<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Crispy Chicken Sales Dashboard</title>
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- SheetJS for Excel handling -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  
  <style>
    :root {
      --primary-color: #ff6f61;
      --secondary-color: #ff8a80;
      --dark-color: #333;
      --light-color: #f9f9f9;
      --success-color: #4caf50;
      --warning-color: #ff9800;
      --danger-color: #f44336;
      --info-color: #2196f3;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f4f4f4;
      color: var(--dark-color);
    }
    .container {
      width: 95%;
      max-width: 1400px;
      margin: 20px auto;
    }
    header {
      background-color: var(--primary-color);
      padding: 20px;
      text-align: center;
      color: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      margin-bottom: 25px;
    }
    header h1 {
      font-size: 2.2em;
      font-weight: 600;
    }
    .dashboard-nav {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .nav-item {
      margin: 0 10px;
    }
    .nav-link {
      display: block;
      padding: 10px 20px;
      background-color: #fff;
      color: var(--primary-color);
      border-radius: 30px;
      text-decoration: none;
      font-weight: 500;
      transition: all 0.3s ease;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .nav-link:hover, .nav-link.active {
      background-color: var(--primary-color);
      color: #fff;
    }
    .dashboard-section {
      display: none;
      animation: fadeIn 0.5s;
    }
    .dashboard-section.active {
      display: block;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .metrics-row {
      display: flex;
      gap: 20px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }
    .metric-card {
      flex: 1;
      min-width: 200px;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      text-align: center;
    }
    .metric-value {
      font-size: 2.5rem;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .metric-label {
      font-size: 1rem;
      opacity: 0.9;
    }
    .section {
      background-color: #fff;
      margin-top: 20px;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }
    .section h2 {
      margin-bottom: 20px;
      color: var(--primary-color);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .data-management {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }
    .box {
      background-color: var(--light-color);
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .box:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.1);
    }
    .box h3 {
      color: var(--primary-color);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    button {
      background-color: var(--primary-color);
      color: #fff;
      border: none;
      padding: 12px 24px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1em;
      margin-top: 10px;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #ff3b2e;
    }
    .btn-secondary {
      background-color: var(--secondary-color);
    }
    .btn-success {
      background-color: var(--success-color);
    }
    .btn-info {
      background-color: var(--info-color);
    }
    .table-container {
      overflow-x: auto;
      margin-top: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    th {
      background-color: var(--light-color);
      font-weight: 600;
    }
    .chart-container {
      height: 300px;
      margin-top: 20px;
    }
    .feedback-item {
      background-color: var(--light-color);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      border-left: 4px solid var(--primary-color);
    }
    .feedback-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    .feedback-rating {
      color: #ffc107;
    }
    .filter-container {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .filter-container select, .filter-container input {
      padding: 8px 12px;
      border-radius: 4px;
      border: 1px solid #ddd;
    }
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
    }
    .toast {
      background-color: #333;
      color: white;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 10px;
      min-width: 250px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      animation: slideIn 0.3s ease;
    }
    @keyframes slideIn {
      from { transform: translateX(100%); }
      to { transform: translateX(0); }
    }
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background-color: white;
      padding: 30px;
      border-radius: 8px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    .close-btn {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
    }
    .form-group input, .form-group select, .form-group textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .upload-area {
      border: 2px dashed var(--primary-color);
      border-radius: 8px;
      padding: 40px;
      text-align: center;
      background-color: var(--light-color);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .upload-area:hover {
      background-color: #fff;
      border-color: var(--secondary-color);
    }
    .upload-area i {
      font-size: 3rem;
      color: var(--primary-color);
      margin-bottom: 15px;
    }
    .report-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .report-card {
      background-color: var(--light-color);
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .report-card h4 {
      color: var(--primary-color);
      margin-bottom: 15px;
    }
    .stat-value {
      font-size: 1.8rem;
      font-weight: bold;
      color: var(--dark-color);
    }
    .stat-label {
      color: #666;
      font-size: 0.9rem;
    }
    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    .data-table th {
      background-color: var(--primary-color);
      color: white;
    }
    .data-table tr:nth-child(even) {
      background-color: var(--light-color);
    }
    .action-buttons {
      display: flex;
      gap: 10px;
    }
    .btn-sm {
      padding: 5px 10px;
      font-size: 0.875rem;
    }
    @media(max-width: 768px) {
      .data-management {
        grid-template-columns: 1fr;
      }
      .metrics-row {
        flex-direction: column;
      }
      .dashboard-nav {
        flex-direction: column;
        align-items: center;
      }
      .nav-item {
        margin: 5px 0;
        width: 100%;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header>
      <h1><i class="fas fa-drumstick-bite"></i> Crispy Chicken Sales Dashboard</h1>
    </header>

    <!-- Navigation -->
    <nav class="dashboard-nav">
      <div class="nav-item"><a href="#" class="nav-link active" data-section="overview">Overview</a></div>
      <div class="nav-item"><a href="#" class="nav-link" data-section="sales">Sales Management</a></div>
      <div class="nav-item"><a href="#" class="nav-link" data-section="data">Data Management</a></div>
      <div class="nav-item"><a href="#" class="nav-link" data-section="reports">Reports</a></div>
      <div class="nav-item"><a href="#" class="nav-link" data-section="feedback">Customer Feedback</a></div>
    </nav>

    <!-- Overview Section -->
    <section id="overview" class="dashboard-section active">
      <!-- Key Metrics -->
      <div class="metrics-row">
        <div class="metric-card">
          <div class="metric-value" id="totalSales">AED 0</div>
          <div class="metric-label">Total Sales</div>
        </div>
        <div class="metric-card">
          <div class="metric-value" id="totalOrders">0</div>
          <div class="metric-label">Total Orders</div>
        </div>
        <div class="metric-card">
          <div class="metric-value" id="avgOrderValue">AED 0</div>
          <div class="metric-label">Average Order Value</div>
        </div>
        <div class="metric-card">
          <div class="metric-value" id="customerRating">0.0</div>
          <div class="metric-label">Customer Rating</div>
        </div>
      </div>

      <!-- Sales Chart -->
      <div class="section">
        <h2><i class="fas fa-chart-line"></i> Sales Trend</h2>
        <div class="filter-container">
          <select id="periodFilter">
            <option value="7">Last 7 Days</option>
            <option value="30">Last 30 Days</option>
            <option value="90">Last 3 Months</option>
          </select>
          <select id="branchFilter">
            <option value="all">All Branches</option>
            <option value="hamdan">Hamdan St</option>
            <option value="khaldia">Khaldia</option>
            <option value="shabiya">Shabiya 11</option>
            <option value="muroor">Muroor</option>
            <option value="albarsha">Al Barsha</option>
            <option value="alsatwa">Al Satwa</option>
            <option value="alrgga">Al Rgga</option>
          </select>
          <button id="applyFilters">Apply Filters</button>
        </div>
        <div class="chart-container">
          <canvas id="salesChart"></canvas>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="section data-management">
        <div class="box">
          <h3><i class="fas fa-plus-circle"></i> Add New Sale</h3>
          <p>Record a new sales transaction.</p>
          <button id="addSaleBtn">Add Sale</button>
        </div>
        <div class="box">
          <h3><i class="fas fa-file-excel"></i> Upload Excel</h3>
          <p>Import sales data from Excel file.</p>
          <button id="uploadExcelBtn">Upload Excel</button>
        </div>
        <div class="box">
          <h3><i class="fas fa-tags"></i> Promotions</h3>
          <p>Manage current promotions and offers.</p>
          <button id="managePromotionsBtn">Manage Promotions</button>
        </div>
        <div class="box">
          <h3><i class="fas fa-boxes"></i> Inventory</h3>
          <p>Check stock levels and reorder supplies.</p>
          <button id="checkInventoryBtn">Check Inventory</button>
        </div>
      </div>
    </section>

    <!-- Sales Management Section -->
    <section id="sales" class="dashboard-section">
      <div class="section">
        <h2><i class="fas fa-shopping-cart"></i> Sales Management</h2>
        <div class="filter-container">
          <input type="date" id="salesDateFrom" placeholder="From" />
          <input type="date" id="salesDateTo" placeholder="To" />
          <select id="salesBranchFilter">
            <option value="all">All Branches</option>
            <option value="hamdan">Hamdan St</option>
            <option value="khaldia">Khaldia</option>
            <option value="shabiya">Shabiya 11</option>
            <option value="muroor">Muroor</option>
            <option value="albarsha">Al Barsha</option>
            <option value="alsatwa">Al Satwa</option>
            <option value="alrgga">Al Rgga</option>
          </select>
          <button id="filterSales">Filter</button>
          <button id="exportSales">Export</button>
        </div>
        <div class="table-container">
          <table id="salesTable" class="table table-striped table-bordered">
            <thead>
              <tr>
                <th>Date</th>
                <th>Branch</th>
                <th>Channel</th>
                <th>Transactions</th>
                <th>Sales (AED)</th>
                <th>Avg Order</th>
                <th>Offer Type</th>
                <th>Offer Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Data Management Section -->
    <section id="data" class="dashboard-section">
      <div class="section">
        <h2><i class="fas fa-database"></i> Data Management</h2>
        <div class="box">
          <h3><i class="fas fa-file-upload"></i> Upload Excel File</h3>
          <div class="upload-area" id="uploadArea">
            <i class="fas fa-cloud-upload-alt"></i>
            <h4>Drop Excel file here or click to browse</h4>
            <p>Supported formats: .xlsx, .xls</p>
            <input type="file" id="fileInput" accept=".xlsx,.xls" style="display:none;">
          </div>
          <div id="uploadStatus" style="margin-top:15px;"></div>
        </div>
        <div class="box" style="margin-top:20px;">
          <h3><i class="fas fa-history"></i> Recent Uploads</h3>
          <div id="recentUploads"><p>No recent uploads</p></div>
        </div>
        <div class="box" style="margin-top:20px;">
          <h3><i class="fas fa-cog"></i> Data Settings</h3>
          <div class="form-group">
            <label for="dateFormat">Date Format</label>
            <select id="dateFormat">
              <option value="YYYY-MM-DD">YYYY-MM-DD</option>
              <option value="DD/MM/YYYY">DD/MM/YYYY</option>
              <option value="MM/DD/YYYY">MM/DD/YYYY</option>
            </select>
          </div>
          <div class="form-group">
            <label for="currency">Currency</label>
            <select id="currency">
              <option value="AED">AED</option>
              <option value="USD">USD</option>
              <option value="EUR">EUR</option>
            </select>
          </div>
          <button id="saveSettings">Save Settings</button>
        </div>
      </div>
    </section>

    <!-- Reports Section -->
    <section id="reports" class="dashboard-section">
      <div class="section">
        <h2><i class="fas fa-file-alt"></i> Comprehensive Reports</h2>
        <div class="filter-container">
          <select id="reportPeriod">
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
            <option value="monthly">Monthly</option>
            <option value="custom">Custom Range</option>
          </select>
          <input type="date" id="reportDateFrom" style="display:none;">
          <input type="date" id="reportDateTo" style="display:none;">
          <select id="reportBranch">
            <option value="all">All Branches</option>
            <option value="hamdan">Hamdan St</option>
            <option value="khaldia">Khaldia</option>
            <option value="shabiya">Shabiya 11</option>
            <option value="muroor">Muroor</option>
            <option value="albarsha">Al Barsha</option>
            <option value="alsatwa">Al Satwa</option>
            <option value="alrgga">Al Rgga</option>
          </select>
          <button id="generateReport">Generate Report</button>
          <button id="downloadReport" class="btn btn-success">Download PDF</button>
        </div>
        <div class="report-grid">
          <div class="report-card">
            <h4>Sales Summary</h4>
            <div class="stat-value" id="reportTotalSales">AED 0</div>
            <div class="stat-label">Total Sales</div>
          </div>
          <div class="report-card">
            <h4>Transactions</h4>
            <div class="stat-value" id="reportTotalTransactions">0</div>
            <div class="stat-label">Total Transactions</div>
          </div>
          <div class="report-card">
            <h4>Average Order Value</h4>
            <div class="stat-value" id="reportAvgOrder">AED 0</div>
            <div class="stat-label">Per Order</div>
          </div>
          <div class="report-card">
            <h4>Best Performing Branch</h4>
            <div class="stat-value" id="reportBestBranch">-</div>
            <div class="stat-label">By Sales</div>
          </div>
        </div>
        <div class="data-management" style="margin-top:30px;">
          <div class="box">
            <h3><i class="fas fa-chart-pie"></i> Sales by Branch</h3>
            <div class="chart-container"><canvas id="branchSalesChart"></canvas></div>
          </div>
          <div class="box">
            <h3><i class="fas fa-chart-bar"></i> Daily Transactions</h3>
            <div class="chart-container"><canvas id="transactionsChart"></canvas></div>
          </div>
        </div>
        <div class="data-management" style="margin-top:20px;">
          <div class="box">
            <h3><i class="fas fa-chart-line"></i> Offer Performance</h3>
            <div class="chart-container"><canvas id="offerPerformanceChart"></canvas></div>
          </div>
          <div class="box">
            <h3><i class="fas fa-chart-area"></i> Sales Trend</h3>
            <div class="chart-container"><canvas id="salesTrendChart"></canvas></div>
          </div>
        </div>
        <div class="section" style="margin-top:20px;">
          <h3><i class="fas fa-table"></i> Detailed Report Table</h3>
          <div class="table-container">
            <table class="data-table" id="reportTable">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Branch</th>
                  <th>Transactions</th>
                  <th>Sales</th>
                  <th>Avg Order</th>
                  <th>Offer Type</th>
                  <th>Growth %</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- Customer Feedback Section -->
    <section id="feedback" class="dashboard-section">
      <div class="section">
        <h2><i class="fas fa-comments"></i> Customer Feedback</h2>
        <div class="filter-container">
          <select id="feedbackBranchFilter">
            <option value="all">All Branches</option>
            <option value="hamdan">Hamdan St</option>
            <option value="khaldia">Khaldia</option>
            <option value="shabiya">Shabiya 11</option>
            <option value="muroor">Muroor</option>
            <option value="albarsha">Al Barsha</option>
            <option value="alsatwa">Al Satwa</option>
            <option value="alrgga">Al Rgga</option>
          </select>
          <select id="feedbackRatingFilter">
            <option value="all">All Ratings</option>
            <option value="5">5 Stars</option>
            <option value="4">4 Stars</option>
            <option value="3">3 Stars</option>
            <option value="2">2 Stars</option>
            <option value="1">1 Star</option>
          </select>
          <button id="filterFeedback">Filter</button>
          <button id="addFeedbackBtn">Add Feedback</button>
        </div>
        <div id="feedbackList"></div>
      </div>
    </section>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- Add Sale Modal -->
  <div class="modal" id="addSaleModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Add New Sale</h3>
        <button class="close-btn">&times;</button>
      </div>
      <form id="addSaleForm">
        <div class="form-group">
          <label for="saleDate">Date</label>
          <input type="date" id="saleDate" required>
        </div>
        <div class="form-group">
          <label for="saleBranch">Branch</label>
          <select id="saleBranch" required>
            <option value="">Select Branch</option>
            <option value="hamdan">Hamdan St</option>
            <option value="khaldia">Khaldia</option>
            <option value="shabiya">Shabiya 11</option>
            <option value="muroor">Muroor</option>
            <option value="albarsha">Al Barsha</option>
            <option value="alsatwa">Al Satwa</option>
            <option value="alrgga">Al Rgga</option>
          </select>
        </div>
        <div class="form-group">
          <label for="saleChannel">Channel</label>
          <select id="saleChannel" required>
            <option value="">Select Channel</option>
            <option value="delivery">Delivery</option>
            <option value="dinein">Dine In</option>
            <option value="takeaway">Takeaway</option>
          </select>
        </div>
        <div class="form-group">
          <label for="saleTransactions">Transactions</label>
          <input type="number" id="saleTransactions" min="1" required>
        </div>
        <div class="form-group">
          <label for="saleTotal">Total Sales (AED)</label>
          <input type="number" id="saleTotal" step="0.01" required>
        </div>
        <div class="form-group">
          <label for="saleOfferType">Offer Type</label>
          <select id="saleOfferType">
            <option value="Normal Day">Normal Day</option>
            <option value="ultimate">Ultimate</option>
            <option value="Chicken Day">Chicken Day</option>
          </select>
        </div>
        <div class="form-group">
          <label for="saleOfferStatus">Offer Status</label>
          <select id="saleOfferStatus">
            <option value="No Offer">No Offer</option>
            <option value="Active">Active</option>
          </select>
        </div>
        <button type="submit">Save Sale</button>
      </form>
    </div>
  </div>

  <!-- Add Feedback Modal -->
  <div class="modal" id="addFeedbackModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Add Customer Feedback</h3>
        <button class="close-btn">&times;</button>
      </div>
      <form id="addFeedbackForm">
        <div class="form-group">
          <label for="feedbackDate">Date</label>
          <input type="date" id="feedbackDate" required>
        </div>
        <div class="form-group">
          <label for="feedbackBranch">Branch</label>
          <select id="feedbackBranch" required>
            <option value="">Select Branch</option>
            <option value="hamdan">Hamdan St</option>
            <option value="khaldia">Khaldia</option>
            <option value="shabiya">Shabiya 11</option>
            <option value="muroor">Muroor</option>
            <option value="albarsha">Al Barsha</option>
            <option value="alsatwa">Al Satwa</option>
            <option value="alrgga">Al Rgga</option>
          </select>
        </div>
        <div class="form-group">
          <label for="feedbackRating">Rating</label>
          <select id="feedbackRating" required>
            <option value="">Select Rating</option>
            <option value="5">5 Stars</option>
            <option value="4">4 Stars</option>
            <option value="3">3 Stars</option>
            <option value="2">2 Stars</option>
            <option value="1">1 Star</option>
          </select>
        </div>
        <div class="form-group">
          <label for="feedbackComment">Comment</label>
          <textarea id="feedbackComment" rows="4" required></textarea>
        </div>
        <button type="submit">Save Feedback</button>
      </form>
    </div>
  </div>

  <script>
    // Initialize variables
    let salesData = [];
    let feedbackData = [];
    let uploadHistory = [];
    let salesChart, branchSalesChart, transactionsChart, offerPerformanceChart, salesTrendChart;

    // Utility functions
    function showToast(message, type='info') {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className='toast';
      toast.textContent=message;
      if(type==='success'){ toast.style.backgroundColor='var(--success-color)'; }
      else if(type==='error'){ toast.style.backgroundColor='var(--danger-color)'; }
      else if(type==='warning'){ toast.style.backgroundColor='var(--warning-color)'; }
      container.appendChild(toast);
      setTimeout(()=>{ toast.remove(); }, 3000);
    }

    function getBranchName(branch) {
      const map = {
        'hamdan':'Crispy Chicken-Hamdan St',
        'khaldia':'Crispy Chicken Khaldia',
        'shabiya':'Crispy Chicken Shabiya 11',
        'muroor':'Crispy Chicken Muroor',
        'albarsha':'Crispy Chicken Al Barsha',
        'alsatwa':'Crispy Chicken Al Satwa',
        'alrgga':'Crispy Chicken Al Rgga'
      };
      return map[branch] || branch;
    }

    function updateMetrics() {
      const totalSales = salesData.reduce((sum,sale)=>sum+sale.sales,0);
      const totalOrders = salesData.reduce((sum,sale)=>sum+sale.transactions,0);
      const avgOrder = totalOrders>0 ? totalSales/totalOrders : 0;
      const avgRating = feedbackData.length >0 ? feedbackData.reduce((sum,f)=>sum+f.rating,0)/feedbackData.length : 0;
      document.getElementById('totalSales').textContent=`AED ${totalSales.toFixed(2)}`;
      document.getElementById('totalOrders').textContent=totalOrders;
      document.getElementById('avgOrderValue').textContent=`AED ${avgOrder.toFixed(2)}`;
      document.getElementById('customerRating').textContent=avgRating.toFixed(1);
    }

    // Chart rendering functions
    function renderSalesChart() {
      const ctx = document.getElementById('salesChart').getContext('2d');
      if(salesChart){ salesChart.destroy(); }
      const salesByDate = {};
      salesData.forEach(sale => {
        salesByDate[sale.date] = (salesByDate[sale.date] || 0) + sale.sales;
      });
      const labels=Object.keys(salesByDate).sort();
      const data=labels.map(d=>salesByDate[d]);
      salesChart=new Chart(ctx,{
        type:'line',
        data:{
          labels:labels,
          datasets:[{
            label:'Daily Sales (AED)',
            data:data,
            backgroundColor:'rgba(255,111,97,0.2)',
            borderColor:'rgba(255,111,97,1)',
            borderWidth:2,
            tension:0.4
          }]
        },
        options:{
          responsive:true,
          maintainAspectRatio:false,
          scales:{ y:{ beginAtZero:true } }
        }
      });
    }

    function renderSalesTable() {
      const tbody=document.querySelector('#salesTable tbody');
      tbody.innerHTML='';
      salesData.forEach((sale,i)=>{
        const row=document.createElement('tr');
        row.innerHTML=`
          <td>${sale.date}</td>
          <td>${getBranchName(sale.branch)}</td>
          <td>${sale.channel}</td>
          <td>${sale.transactions}</td>
          <td>AED ${sale.sales.toFixed(2)}</td>
          <td>AED ${sale.avgOrder.toFixed(2)}</td>
          <td>${sale.offerType}</td>
          <td>${sale.offerStatus}</td>
          <td>
            <div class="action-buttons">
              <button class="btn-sm btn-info" onclick="editSale(${i})">Edit</button>
              <button class="btn-sm" style="background-color:var(--danger-color);" onclick="deleteSale(${i})">Delete</button>
            </div>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function renderFeedbackList() {
      const container=document.getElementById('feedbackList');
      container.innerHTML='';
      feedbackData.forEach((f,i)=>{
        const div=document.createElement('div');
        div.className='feedback-item';
        const stars='★'.repeat(f.rating)+'☆'.repeat(5-f.rating);
        div.innerHTML=`
          <div class="feedback-header">
            <div>${f.date} - ${getBranchName(f.branch)}</div>
            <div class="feedback-rating">${stars}</div>
          </div>
          <div>${f.comment}</div>
          <div class="action-buttons" style="margin-top:10px;">
            <button class="btn-sm btn-info" onclick="editFeedback(${i})">Edit</button>
            <button class="btn-sm" style="background-color:var(--danger-color);" onclick="deleteFeedback(${i})">Delete</button>
          </div>
        `;
        container.appendChild(div);
      });
    }

    function renderReportsCharts() {
      // Branch sales pie
      const ctxBranch=document.getElementById('branchSalesChart').getContext('2d');
      if(branchSalesChart){ branchSalesChart.destroy(); }
      const salesByBranch={};
      salesData.forEach(sale=>{
        salesByBranch[sale.branch]= (salesByBranch[sale.branch] ||0)+sale.sales;
      });
      branchSalesChart=new Chart(ctxBranch,{
        type:'pie',
        data:{
          labels:Object.keys(salesByBranch).map(b=>getBranchName(b)),
          datasets:[{
            data:Object.values(salesByBranch),
            backgroundColor:[
              'rgba(255,111,97,0.8)',
              'rgba(255,138,128,0.8)',
              'rgba(255,167,159,0.8)',
              'rgba(255,111,97,0.6)',
              'rgba(255,138,128,0.6)',
              'rgba(255,167,159,0.6)',
              'rgba(255,111,97,0.4)'
            ]
          }]
        },
        options:{ responsive:true, maintainAspectRatio:false }
      });

      // Transactions bar
      const ctxTrans=document.getElementById('transactionsChart').getContext('2d');
      if(transactionsChart){ transactionsChart.destroy(); }
      const transByDate={};
      salesData.forEach(sale=>{
        transByDate[sale.date]= (transByDate[sale.date] || 0)+sale.transactions;
      });
      const transLabels=Object.keys(transByDate).sort();
      const transData=transLabels.map(d=>transByDate[d]);
      transactionsChart=new Chart(ctxTrans,{
        type:'bar',
        data:{
          labels:transLabels,
          datasets:[{
            label:'Daily Transactions',
            data:transData,
            backgroundColor:'rgba(255,111,97,0.8)'
          }]
        },
        options:{
          responsive:true,
          maintainAspectRatio:false,
          scales:{ y:{ beginAtZero:true } }
        }
      });

      // Offer performance doughnut
      const ctxOffer=document.getElementById('offerPerformanceChart').getContext('2d');
      if(offerPerformanceChart){ offerPerformanceChart.destroy(); }
      const salesByOffer={};
      salesData.forEach(sale=>{
        salesByOffer[sale.offerType]= (salesByOffer[sale.offerType] ||0)+sale.sales;
      });
      offerPerformanceChart=new Chart(ctxOffer,{
        type:'doughnut',
        data:{
          labels:Object.keys(salesByOffer),
          datasets:[{
            data: Object.values(salesByOffer),
            backgroundColor:[
              'rgba(255,111,97,0.8)',
              'rgba(76,175,80,0.8)',
              'rgba(33,150,243,0.8)'
            ]
          }]
        },
        options:{ responsive:true, maintainAspectRatio:false }
      });

      // Sales trend weekly
      const ctxTrend=document.getElementById('salesTrendChart').getContext('2d');
      if(salesTrendChart){ salesTrendChart.destroy(); }
      const weeklySales={};
      salesData.forEach(sale=>{
        const week=getWeekNumber(sale.date);
        weeklySales[week]= (weeklySales[week] ||0)+sale.sales;
      });
      const weekLabels=Object.keys(weeklySales).sort();
      const weekData=weekLabels.map(w=>weeklySales[w]);
      salesTrendChart=new Chart(ctxTrend,{
        type:'line',
        data:{
          labels:weekLabels.map(w=>`Week ${w}`),
          datasets:[{
            label:'Weekly Sales (AED)',
            data:weekData,
            backgroundColor:'rgba(255,111,97,0.2)',
            borderColor:'rgba(255,111,97,1)',
            borderWidth:2,
            tension:0.4,
            fill:true
          }]
        },
        options:{
          responsive:true,
          maintainAspectRatio:false,
          scales:{ y:{ beginAtZero:true } }
        }
      });
    }

    function getWeekNumber(d) {
      const date=new Date(d);
      const firstDay=new Date(date.getFullYear(),0,1);
      const pastDays=(date - firstDay)/86400000;
      return Math.ceil( (pastDays + firstDay.getDay() +1)/7 );
    }

    function updateReportStats() {
      const totalSales = salesData.reduce((sum,sale)=>sum+sale.sales,0);
      const totalTransactions = salesData.reduce((sum,sale)=>sum+sale.transactions,0);
      const avgOrder = totalTransactions>0 ? totalSales/totalTransactions : 0;
      
      // Find best performing branch
      const salesByBranch={};
      salesData.forEach(sale=>{
        salesByBranch[sale.branch]= (salesByBranch[sale.branch] ||0)+sale.sales;
      });
      const bestBranch = Object.keys(salesByBranch).reduce((a,b)=>
        salesByBranch[a] > salesByBranch[b] ? a : b, null);
      
      document.getElementById('reportTotalSales').textContent=`AED ${totalSales.toFixed(2)}`;
      document.getElementById('reportTotalTransactions').textContent=totalTransactions;
      document.getElementById('reportAvgOrder').textContent=`AED ${avgOrder.toFixed(2)}`;
      document.getElementById('reportBestBranch').textContent=bestBranch ? getBranchName(bestBranch) : '-';
      
      // Update report table
      const tbody=document.querySelector('#reportTable tbody');
      tbody.innerHTML='';
      salesData.forEach((sale,i)=>{
        const prevSale = salesData[i-1];
        const growth = prevSale ? ((sale.sales - prevSale.sales) / prevSale.sales * 100).toFixed(1) : 0;
        const row=document.createElement('tr');
        row.innerHTML=`
          <td>${sale.date}</td>
          <td>${getBranchName(sale.branch)}</td>
          <td>${sale.transactions}</td>
          <td>AED ${sale.sales.toFixed(2)}</td>
          <td>AED ${sale.avgOrder.toFixed(2)}</td>
          <td>${sale.offerType}</td>
          <td>${growth}%</td>
        `;
        tbody.appendChild(row);
      });
    }

    // Initialize sample data
    function initializeSampleData() {
      // Sample sales data
      salesData = [
        { date: '2023-10-01', branch: 'hamdan', channel: 'delivery', transactions: 45, sales: 2250, avgOrder: 50, offerType: 'Normal Day', offerStatus: 'No Offer' },
        { date: '2023-10-01', branch: 'khaldia', channel: 'dinein', transactions: 32, sales: 1600, avgOrder: 50, offerType: 'Chicken Day', offerStatus: 'Active' },
        { date: '2023-10-02', branch: 'shabiya', channel: 'takeaway', transactions: 28, sales: 1400, avgOrder: 50, offerType: 'Normal Day', offerStatus: 'No Offer' },
        { date: '2023-10-02', branch: 'muroor', channel: 'delivery', transactions: 52, sales: 2600, avgOrder: 50, offerType: 'ultimate', offerStatus: 'Active' },
        { date: '2023-10-03', branch: 'albarsha', channel: 'dinein', transactions: 38, sales: 1900, avgOrder: 50, offerType: 'Normal Day', offerStatus: 'No Offer' },
        { date: '2023-10-03', branch: 'alsatwa', channel: 'takeaway', transactions: 41, sales: 2050, avgOrder: 50, offerType: 'Chicken Day', offerStatus: 'Active' },
        { date: '2023-10-04', branch: 'alrgga', channel: 'delivery', transactions: 55, sales: 2750, avgOrder: 50, offerType: 'Normal Day', offerStatus: 'No Offer' },
        { date: '2023-10-05', branch: 'hamdan', channel: 'dinein', transactions: 48, sales: 2400, avgOrder: 50, offerType: 'ultimate', offerStatus: 'Active' },
        { date: '2023-10-06', branch: 'khaldia', channel: 'takeaway', transactions: 35, sales: 1750, avgOrder: 50, offerType: 'Normal Day', offerStatus: 'No Offer' },
        { date: '2023-10-07', branch: 'shabiya', channel: 'delivery', transactions: 42, sales: 2100, avgOrder: 50, offerType: 'Chicken Day', offerStatus: 'Active' }
      ];
      
      // Sample feedback data
      feedbackData = [
        { date: '2023-10-01', branch: 'hamdan', rating: 5, comment: 'Excellent service and delicious chicken!' },
        { date: '2023-10-02', branch: 'khaldia', rating: 4, comment: 'Good food but delivery was a bit late.' },
        { date: '2023-10-03', branch: 'shabiya', rating: 5, comment: 'Best crispy chicken in the city!' },
        { date: '2023-10-04', branch: 'muroor', rating: 3, comment: 'Average experience, could be better.' },
        { date: '2023-10-05', branch: 'albarsha', rating: 4, comment: 'Great taste and friendly staff.' },
        { date: '2023-10-06', branch: 'alsatwa', rating: 5, comment: 'Outstanding quality and service!' },
        { date: '2023-10-07', branch: 'alrgga', rating: 2, comment: 'Food was cold when delivered.' }
      ];
    }

    // Initialize dashboard
    function initDashboard() {
      updateMetrics();
      renderSalesChart();
      renderSalesTable();
      renderFeedbackList();
      renderReportsCharts();
      updateReportStats();
      updateUploadHistory();
    }

    // Event handlers
    document.addEventListener('DOMContentLoaded', () => {
      // Load saved settings
      const savedDateFormat=localStorage.getItem('dateFormat');
      const savedCurrency=localStorage.getItem('currency');
      if(savedDateFormat){ document.getElementById('dateFormat').value= savedDateFormat; }
      if(savedCurrency){ document.getElementById('currency').value=savedCurrency; }

      // Initialize sample data
      initializeSampleData();
      
      // Render dashboard
      initDashboard();

      // Navigation
      document.querySelectorAll('.nav-link').forEach(link => {
        link.onclick=e=>{
          e.preventDefault();
          document.querySelectorAll('.nav-link').forEach(l=>l.classList.remove('active'));
          link.classList.add('active');
          document.querySelectorAll('.dashboard-section').forEach(sec=>sec.classList.remove('active'));
          document.getElementById(link.dataset.section).classList.add('active');
        };
      });

      // Modal close buttons
      document.querySelectorAll('.close-btn').forEach(btn=>{
        btn.onclick=()=>{ btn.closest('.modal').style.display='none'; };
      });
      window.onclick=e=>{
        if(e.target.classList.contains('modal')){
          e.target.style.display='none';
        }
      };

      // Upload area events
      document.getElementById('uploadArea').addEventListener('click',()=>{ document.getElementById('fileInput').click(); });
      document.getElementById('fileInput').addEventListener('change',e=>{
        if(e.target.files.length>0){ handleFileUpload(e.target.files[0]); }
      });
      document.getElementById('uploadArea').addEventListener('dragover',e=>{ e.preventDefault(); });
      document.getElementById('uploadArea').addEventListener('drop',e=>{
        e.preventDefault();
        if(e.dataTransfer.files.length>0){ handleFileUpload(e.dataTransfer.files[0]); }
      });

      // Add new sale
      document.getElementById('addSaleBtn').onclick=()=>{ 
        document.getElementById('saleDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('addSaleModal').style.display='flex'; 
      };
      document.getElementById('addSaleForm').onsubmit=e=>{
        e.preventDefault();
        const sale={
          date:document.getElementById('saleDate').value,
          branch:document.getElementById('saleBranch').value,
          channel:document.getElementById('saleChannel').value,
          transactions:parseInt(document.getElementById('saleTransactions').value),
          sales:parseFloat(document.getElementById('saleTotal').value),
          avgOrder: parseFloat(document.getElementById('saleTotal').value)/parseInt(document.getElementById('saleTransactions').value),
          offerType:document.getElementById('saleOfferType').value,
          offerStatus:document.getElementById('saleOfferStatus').value
        };
        salesData.push(sale);
        renderSalesTable();
        updateMetrics();
        renderReportsCharts();
        updateReportStats();
        document.getElementById('addSaleModal').style.display='none';
        document.getElementById('addSaleForm').reset();
        showToast('Sale added successfully!','success');
      };

      // Add feedback
      document.getElementById('addFeedbackBtn').onclick=()=>{ 
        document.getElementById('feedbackDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('addFeedbackModal').style.display='flex'; 
      };
      document.getElementById('addFeedbackForm').onsubmit=e=>{
        e.preventDefault();
        const feedback={
          date:document.getElementById('feedbackDate').value,
          branch:document.getElementById('feedbackBranch').value,
          rating:parseInt(document.getElementById('feedbackRating').value),
          comment:document.getElementById('feedbackComment').value
        };
        feedbackData.push(feedback);
        renderFeedbackList();
        updateMetrics();
        document.getElementById('addFeedbackModal').style.display='none';
        document.getElementById('addFeedbackForm').reset();
        showToast('Feedback added successfully!','success');
      };

      // Apply filters
      document.getElementById('applyFilters').onclick=()=>{
        showToast('Filters applied!', 'info');
        renderSalesChart();
      };
      document.getElementById('filterSales').onclick=()=>{
        showToast('Sales filtered!', 'info');
        renderSalesTable();
      };

      // Export sales data
      document.getElementById('exportSales').onclick=()=>{
        const wb=XLSX.utils.book_new();
        const ws=XLSX.utils.json_to_sheet(salesData);
        XLSX.utils.book_append_sheet(wb,'Sales Data',ws);
        XLSX.writeFile(wb,'Crispy_Chicken_Sales_Data.xlsx');
        showToast('Sales data exported successfully!','success');
      };

      // Filter report period
      document.getElementById('reportPeriod').onchange=e=>{
        if(e.target.value==='custom'){
          document.getElementById('reportDateFrom').style.display='inline-block';
          document.getElementById('reportDateTo').style.display='inline-block';
        } else{
          document.getElementById('reportDateFrom').style.display='none';
          document.getElementById('reportDateTo').style.display='none';
        }
      };

      // Generate report
      document.getElementById('generateReport').onclick=()=>{
        showToast('Report generated!','success');
        updateReportStats();
        renderReportsCharts();
      };

      // Download report
      document.getElementById('downloadReport').onclick=()=>{
        const wb=XLSX.utils.book_new();
        const ws=XLSX.utils.json_to_sheet(salesData);
        XLSX.utils.book_append_sheet(wb,'Sales Report',ws);
        XLSX.writeFile(wb,'Crispy_Chicken_Sales_Report.xlsx');
        showToast('Report downloaded!','success');
      };

      // Save settings
      document.getElementById('saveSettings').onclick=()=>{
        localStorage.setItem('dateFormat',document.getElementById('dateFormat').value);
        localStorage.setItem('currency',document.getElementById('currency').value);
        showToast('Settings saved!','success');
      };

    });

    // File upload handling
    function handleFileUpload(file) {
      const reader=new FileReader();
      reader.onload=function(e){
        try{
          const data=new Uint8Array(e.target.result);
          const workbook=XLSX.read(data,{type:'array'});
          const firstSheet=workbook.Sheets[workbook.SheetNames[0]];
          const jsonData=XLSX.utils.sheet_to_json(firstSheet);
          processUploadedData(jsonData);
          addToUploadHistory(file.name,jsonData.length);
          showToast(`Successfully uploaded ${jsonData.length} records!`, 'success');
        }catch(err){
          showToast('Error processing file. Please check format.','error');
        }
      };
      reader.readAsArrayBuffer(file);
    }

    function processUploadedData(data) {
      // Reset salesData
      salesData=[];
      data.forEach(row=>{
        const sale={
          date:formatDate(row['Date']||row.date),
          branch:mapBranchName(row['Branch']||row.branch),
          channel:row['Channel']||row.channel||'Delivery',
          transactions:parseInt(row['Transactions']||row.transactions||0),
          sales:parseFloat(row['Sales']||row.sales||0),
          avgOrder:parseFloat(row['Average per Order']||row.avgOrder||0),
          offerType:row['Offer Type']||row.offerType||'Normal Day',
          offerStatus:row['Offer Status']||row.offerStatus||'No Offer'
        };
        salesData.push(sale);
      });
      updateMetrics();
      renderSalesChart();
      renderSalesTable();
      renderReportsCharts();
      updateReportStats();
    }

    function formatDate(dateStr) {
      if(typeof dateStr==='number'){
        const date=new Date((dateStr-25569)*86400*1000);
        return date.toISOString().split('T')[0];
      }
      return dateStr;
    }

    function mapBranchName(name){
      const map={
        'Crispy Chicken-Hamdan St':'hamdan',
        'Crispy Chicken Khaldia':'khaldia',
        'Crispy Chicken Shabiya 11':'shabiya',
        'Crispy Chicken Muroor':'muroor',
        'Crispy Chicken Al Barsha':'albarsha',
        'Crispy Chicken Al Satwa':'alsatwa',
        'Crispy Chicken Al Rgga':'alrgga'
      };
      if(Object.values(map).includes(name)){ return name; }
      return map[name]||name.toLowerCase().replace(/\s+/g,'');
    }

    function addToUploadHistory(fileName, recordCount){
      uploadHistory.unshift({ fileName, recordCount, date:new Date().toLocaleString() });
      if(uploadHistory.length>5){ uploadHistory.pop(); }
      updateUploadHistory();
    }

    function updateUploadHistory() {
      const container=document.getElementById('recentUploads');
      if(uploadHistory.length===0){
        container.innerHTML='<p>No recent uploads</p>';
        return;
      }
      let html='';
      uploadHistory.forEach(u=>{
        html+=`<div class="feedback-item"><div><strong>${u.fileName}</strong></div><div>${u.recordCount} records - ${u.date}</div></div>`;
      });
      container.innerHTML=html;
    }

    // Editing and deleting
    function editSale(index) {
      const sale=salesData[index];
      document.getElementById('saleDate').value=sale.date;
      document.getElementById('saleBranch').value=sale.branch;
      document.getElementById('saleChannel').value=sale.channel;
      document.getElementById('saleTransactions').value=sale.transactions;
      document.getElementById('saleTotal').value=sale.sales;
      document.getElementById('saleOfferType').value=sale.offerType;
      document.getElementById('saleOfferStatus').value=sale.offerStatus;
      document.getElementById('addSaleModal').style.display='flex';
      salesData.splice(index,1);
    }

    function deleteSale(index) {
      if(confirm('Are you sure?')){
        salesData.splice(index,1);
        renderSalesTable();
        updateMetrics();
        renderReportsCharts();
        updateReportStats();
        showToast('Sale deleted!','success');
      }
    }

    function editFeedback(index) {
      const f=feedbackData[index];
      document.getElementById('feedbackDate').value=f.date;
      document.getElementById('feedbackBranch').value=f.branch;
      document.getElementById('feedbackRating').value=f.rating;
      document.getElementById('feedbackComment').value=f.comment;
      document.getElementById('addFeedbackModal').style.display='flex';
      feedbackData.splice(index,1);
    }

    function deleteFeedback(index){
      if(confirm('Are you sure?')){
        feedbackData.splice(index,1);
        renderFeedbackList();
        updateMetrics();
        showToast('Feedback deleted!','success');
      }
    }

  </script>
</body>
</html>
