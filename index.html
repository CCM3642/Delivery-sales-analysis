<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crispy Chicken Delivery Analytics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        .stat-card {
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .chart-container {
            position: relative;
            height: 300px;
        }
        .modal {
            transition: opacity 0.3s ease;
        }
        .table-row:hover {
            background-color: #f9fafb;
        }
        .btn-primary {
            transition: all 0.2s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-amber-50 to-orange-100 min-h-screen">
    <div class="max-w-7xl mx-auto p-4 md:p-8">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold text-gray-800">üçó Crispy Chicken Delivery Analytics</h1>
                    <p class="text-gray-600 mt-2">October 1-12, 2025 - Real Performance Data</p>
                </div>
            </div>
            
            <!-- Controls -->
            <div class="flex flex-wrap gap-3 mt-4">
                <select id="branchSelector" class="px-4 py-2 border-2 border-amber-500 rounded-lg font-semibold bg-white">
                    <option value="All">All Branches</option>
                    <option value="Crispy Chicken-Hamdan St">Hamdan St</option>
                    <option value="Crispy Chicken Khaldia">Khaldia</option>
                    <option value="Crispy Chicken Shabiya 11">Shabiya 11</option>
                    <option value="Crispy Chicken Muroor">Muroor</option>
                    <option value="Crispy Chicken Al Barsha">Al Barsha</option>
                    <option value="Crispy Chicken Al Satwa">Al Satwa</option>
                    <option value="Crispy Chicken Al Rgga">Al Rgga</option>
                </select>
                
                <label class="px-4 py-2 bg-blue-500 text-white rounded-lg font-semibold cursor-pointer hover:bg-blue-600 transition-all flex items-center gap-2">
                    <i data-lucide="upload" class="w-5 h-5"></i>
                    Upload Excel
                    <input type="file" id="fileUpload" accept=".xlsx,.xls" class="hidden" />
                </label>
                
                <button id="downloadTemplate" class="px-4 py-2 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600 transition-all flex items-center gap-2">
                    <i data-lucide="download" class="w-5 h-5"></i>
                    Template
                </button>
                
                <button id="addEntry" class="px-4 py-2 bg-purple-500 text-white rounded-lg font-semibold hover:bg-purple-600 transition-all flex items-center gap-2">
                    <i data-lucide="plus" class="w-5 h-5"></i>
                    Add Entry
                </button>
            </div>
        </div>

        <!-- KPI Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
            <div class="stat-card bg-white rounded-lg shadow-md p-6 border-l-4 border-amber-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Total Transactions</p>
                        <p id="totalTransactions" class="text-3xl font-bold text-gray-800 mt-2">0</p>
                        <p id="dailyAvgTransactions" class="text-sm text-gray-600 mt-1">Daily Avg: 0</p>
                    </div>
                    <div class="p-3 rounded-full bg-amber-100">
                        <i data-lucide="package" class="w-8 h-8 text-amber-600"></i>
                    </div>
                </div>
                <div class="flex items-center mt-3">
                    <i data-lucide="trending-up" class="w-4 h-4 text-green-600 mr-1"></i>
                    <span class="text-sm font-medium text-green-600">8.3% vs last period</span>
                </div>
            </div>
            
            <div class="stat-card bg-white rounded-lg shadow-md p-6 border-l-4 border-green-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Total Sales</p>
                        <p id="totalSales" class="text-3xl font-bold text-gray-800 mt-2">0 AED</p>
                        <p class="text-sm text-gray-600 mt-1">October 1-12, 2025</p>
                    </div>
                    <div class="p-3 rounded-full bg-green-100">
                        <i data-lucide="dollar-sign" class="w-8 h-8 text-green-600"></i>
                    </div>
                </div>
                <div class="flex items-center mt-3">
                    <i data-lucide="trending-up" class="w-4 h-4 text-green-600 mr-1"></i>
                    <span class="text-sm font-medium text-green-600">12.7% vs last period</span>
                </div>
            </div>
            
            <div class="stat-card bg-white rounded-lg shadow-md p-6 border-l-4 border-blue-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Avg Transaction Value</p>
                        <p id="avgTransactionValue" class="text-3xl font-bold text-gray-800 mt-2">0 AED</p>
                        <p class="text-sm text-gray-600 mt-1">Per order</p>
                    </div>
                    <div class="p-3 rounded-full bg-blue-100">
                        <i data-lucide="target" class="w-8 h-8 text-blue-600"></i>
                    </div>
                </div>
                <div class="flex items-center mt-3">
                    <i data-lucide="trending-up" class="w-4 h-4 text-green-600 mr-1"></i>
                    <span class="text-sm font-medium text-green-600">4.2% vs last period</span>
                </div>
            </div>
            
            <div class="stat-card bg-white rounded-lg shadow-md p-6 border-l-4 border-purple-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Active Branches</p>
                        <p id="activeBranches" class="text-3xl font-bold text-gray-800 mt-2">0</p>
                        <p id="branchSubtitle" class="text-sm text-gray-600 mt-1">All branches</p>
                    </div>
                    <div class="p-3 rounded-full bg-purple-100">
                        <i data-lucide="map-pin" class="w-8 h-8 text-purple-600"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Row 1 -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Daily Transactions Trend</h3>
                <div class="chart-container">
                    <canvas id="transactionsChart"></canvas>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Daily Sales Trend (AED)</h3>
                <div class="chart-container">
                    <canvas id="salesChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Charts Row 2 -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Branch Performance - Sales (AED)</h3>
                <div class="chart-container">
                    <canvas id="branchChart"></canvas>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Weekly Comparison</h3>
                <div class="chart-container">
                    <canvas id="weeklyChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6 overflow-x-auto">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Delivery Data (<span id="recordCount">0</span> records)</h3>
            <div class="overflow-x-auto">
                <table class="w-full min-w-max">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="px-4 py-3 text-left">Date</th>
                            <th class="px-4 py-3 text-left">Branch</th>
                            <th class="px-4 py-3 text-left">Transactions</th>
                            <th class="px-4 py-3 text-left">Sales (AED)</th>
                            <th class="px-4 py-3 text-left">Avg/Order</th>
                            <th class="px-4 py-3 text-left">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody">
                        <!-- Table rows will be inserted here -->
                    </tbody>
                </table>
            </div>
            <p id="tableFooter" class="text-sm text-gray-500 mt-2 hidden">Showing first 20 records</p>
        </div>
    </div>

    <!-- Data Entry Modal -->
    <div id="dataModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="modalTitle" class="text-xl font-bold text-gray-800">Add New Entry</h3>
                    <button id="closeModal" class="text-gray-500 hover:text-gray-700">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                        <input type="text" id="modalDate" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="October 1st, 2025">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Branch</label>
                        <input type="text" id="modalBranch" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Crispy Chicken-Hamdan St">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Transactions</label>
                        <input type="number" id="modalTransactions" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Sales (AED)</label>
                        <input type="number" id="modalSales" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                    </div>
                </div>
                
                <div class="flex justify-end gap-3 mt-6">
                    <button id="cancelModal" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                        Cancel
                    </button>
                    <button id="saveModal" class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 flex items-center gap-2">
                        <i data-lucide="save" class="w-4 h-4"></i>
                        Save Entry
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Sample data
        let deliveryData = [
            { date: 'October 1st, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 73, sales: 3216 },
            { date: 'October 1st, 2025', branch: 'Crispy Chicken Khaldia', transactions: 38, sales: 1859.8 },
            { date: 'October 1st, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 39, sales: 1965 },
            { date: 'October 1st, 2025', branch: 'Crispy Chicken Muroor', transactions: 42, sales: 2024 },
            { date: 'October 1st, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 24, sales: 1376 },
            { date: 'October 1st, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 11, sales: 387 },
            { date: 'October 1st, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 5, sales: 204 },
            { date: 'October 2st, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 62, sales: 3238 },
            { date: 'October 2st, 2025', branch: 'Crispy Chicken Khaldia', transactions: 28, sales: 1492 },
            { date: 'October 2st, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 44, sales: 2057 },
            { date: 'October 2st, 2025', branch: 'Crispy Chicken Muroor', transactions: 40, sales: 1945 },
            { date: 'October 2st, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 30, sales: 1644 },
            { date: 'October 2st, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 10, sales: 527 },
            { date: 'October 2st, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 4, sales: 146 },
            { date: 'October 3st, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 72, sales: 3100 },
            { date: 'October 3st, 2025', branch: 'Crispy Chicken Khaldia', transactions: 46, sales: 2930 },
            { date: 'October 3st, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 40, sales: 1828 },
            { date: 'October 3st, 2025', branch: 'Crispy Chicken Muroor', transactions: 32, sales: 1617 },
            { date: 'October 3st, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 29, sales: 1127 },
            { date: 'October 3st, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 11, sales: 427 },
            { date: 'October 3st, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 10, sales: 475 },
            { date: 'October 4st, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 84, sales: 4833 },
            { date: 'October 4st, 2025', branch: 'Crispy Chicken Khaldia', transactions: 43, sales: 2400 },
            { date: 'October 4st, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 31, sales: 1447 },
            { date: 'October 4st, 2025', branch: 'Crispy Chicken Muroor', transactions: 36, sales: 2299 },
            { date: 'October 4st, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 20, sales: 936 },
            { date: 'October 4st, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 11, sales: 566 },
            { date: 'October 4st, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 15, sales: 554 },
            { date: 'October 5st, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 76, sales: 2921 },
            { date: 'October 5st, 2025', branch: 'Crispy Chicken Khaldia', transactions: 43, sales: 1982 },
            { date: 'October 5st, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 29, sales: 1344 },
            { date: 'October 5st, 2025', branch: 'Crispy Chicken Muroor', transactions: 20, sales: 1126 },
            { date: 'October 5st, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 25, sales: 1089 },
            { date: 'October 5st, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 13, sales: 462 },
            { date: 'October 5st, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 8, sales: 241 },
            { date: 'October 6 st, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 101, sales: 4363 },
            { date: 'October 6 st, 2025', branch: 'Crispy Chicken Khaldia', transactions: 54, sales: 2113 },
            { date: 'October 6 st, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 61, sales: 2714.8 },
            { date: 'October 6 st, 2025', branch: 'Crispy Chicken Muroor', transactions: 47, sales: 2124 },
            { date: 'October 6 st, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 57, sales: 4201 },
            { date: 'October 6 st, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 20, sales: 848 },
            { date: 'October 6 st, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 18, sales: 708 },
            { date: 'October 7 st, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 119, sales: 5056 },
            { date: 'October 7 st, 2025', branch: 'Crispy Chicken Khaldia', transactions: 50, sales: 2175 },
            { date: 'October 7 st, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 80, sales: 3475 },
            { date: 'October 7 st, 2025', branch: 'Crispy Chicken Muroor', transactions: 46, sales: 1957 },
            { date: 'October 7 st, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 44, sales: 2590 },
            { date: 'October 7 st, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 18, sales: 705 },
            { date: 'October 7 st, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 19, sales: 823 },
            { date: 'October 8 st, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 58, sales: 2568 },
            { date: 'October 8 st, 2025', branch: 'Crispy Chicken Khaldia', transactions: 24, sales: 1037 },
            { date: 'October 8 st, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 30, sales: 1574 },
            { date: 'October 8 st, 2025', branch: 'Crispy Chicken Muroor', transactions: 81, sales: 1404 },
            { date: 'October 8 st, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 29, sales: 1891 },
            { date: 'October 8 st, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 5, sales: 148 },
            { date: 'October 8 st, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 10, sales: 519 },
            { date: 'October 9 st, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 53, sales: 2738 },
            { date: 'October 9 st, 2025', branch: 'Crispy Chicken Khaldia', transactions: 31, sales: 2112 },
            { date: 'October 9 st, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 35, sales: 1487 },
            { date: 'October 9 st, 2025', branch: 'Crispy Chicken Muroor', transactions: 35, sales: 1978 },
            { date: 'October 9 st, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 17, sales: 733 },
            { date: 'October 9 st, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 5, sales: 184 },
            { date: 'October 9 st, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 13, sales: 408 },
            { date: 'October 10 st, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 65, sales: 2900 },
            { date: 'October 10 st, 2025', branch: 'Crispy Chicken Khaldia', transactions: 46, sales: 2943 },
            { date: 'October 10 st, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 45, sales: 2411 },
            { date: 'October 10 st, 2025', branch: 'Crispy Chicken Muroor', transactions: 39, sales: 2261 },
            { date: 'October 10 st, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 25, sales: 1523 },
            { date: 'October 10 st, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 12, sales: 976 },
            { date: 'October 10 st, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 10, sales: 573 },
            { date: 'October 11 st, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 78, sales: 4313 },
            { date: 'October 11 st, 2025', branch: 'Crispy Chicken Khaldia', transactions: 48, sales: 3452 },
            { date: 'October 11 st, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 34, sales: 1711 },
            { date: 'October 11 st, 2025', branch: 'Crispy Chicken Muroor', transactions: 28, sales: 1654 },
            { date: 'October 11 st, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 20, sales: 778 },
            { date: 'October 11 st, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 10, sales: 391 },
            { date: 'October 11 st, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 9, sales: 275 },
            { date: 'October 12 st, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 51, sales: 2146 },
            { date: 'October 12 st, 2025', branch: 'Crispy Chicken Khaldia', transactions: 33, sales: 1802 },
            { date: 'October 12 st, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 32, sales: 1331 },
            { date: 'October 12 st, 2025', branch: 'Crispy Chicken Muroor', transactions: 23, sales: 1195 },
            { date: 'October 12 st, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 22, sales: 1233 },
            { date: 'October 12 st, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 4, sales: 153 },
            { date: 'October 12 st, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 6, sales: 232 }
        ];

        let selectedBranch = 'All';
        let editingIndex = null;

        // DOM elements
        const branchSelector = document.getElementById('branchSelector');
        const fileUpload = document.getElementById('fileUpload');
        const downloadTemplateBtn = document.getElementById('downloadTemplate');
        const addEntryBtn = document.getElementById('addEntry');
        const dataModal = document.getElementById('dataModal');
        const closeModalBtn = document.getElementById('closeModal');
        const cancelModalBtn = document.getElementById('cancelModal');
        const saveModalBtn = document.getElementById('saveModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalDate = document.getElementById('modalDate');
        const modalBranch = document.getElementById('modalBranch');
        const modalTransactions = document.getElementById('modalTransactions');
        const modalSales = document.getElementById('modalSales');
        const dataTableBody = document.getElementById('dataTableBody');
        const recordCount = document.getElementById('recordCount');
        const tableFooter = document.getElementById('tableFooter');

        // Event listeners
        branchSelector.addEventListener('change', function() {
            selectedBranch = this.value;
            updateDashboard();
        });

        fileUpload.addEventListener('change', handleFileUpload);
        downloadTemplateBtn.addEventListener('click', downloadTemplate);
        addEntryBtn.addEventListener('click', handleAddEntry);
        closeModalBtn.addEventListener('click', closeModal);
        cancelModalBtn.addEventListener('click', closeModal);
        saveModalBtn.addEventListener('click', handleSaveEntry);

        // Initialize dashboard
        updateDashboard();

        // Functions
        function updateDashboard() {
            updateKPIs();
            updateCharts();
            updateTable();
        }

        function updateKPIs() {
            const filteredData = selectedBranch === 'All' 
                ? deliveryData 
                : deliveryData.filter(item => item.branch === selectedBranch);
            
            const totalTransactions = filteredData.reduce((sum, item) => sum + item.transactions, 0);
            const totalSales = filteredData.reduce((sum, item) => sum + item.sales, 0);
            const avgTransactionValue = totalSales / totalTransactions;
            const dailyAvgTransactions = Math.round(totalTransactions / 12);
            
            const branches = [...new Set(deliveryData.map(item => item.branch))];
            
            document.getElementById('totalTransactions').textContent = totalTransactions.toLocaleString();
            document.getElementById('totalSales').textContent = `${totalSales.toFixed(0)} AED`;
            document.getElementById('avgTransactionValue').textContent = `${avgTransactionValue.toFixed(0)} AED`;
            document.getElementById('dailyAvgTransactions').textContent = `Daily Avg: ${dailyAvgTransactions}`;
            document.getElementById('activeBranches').textContent = branches.length;
            document.getElementById('branchSubtitle').textContent = selectedBranch === 'All' ? 'All branches' : selectedBranch.replace('Crispy Chicken ', '');
        }

        function updateCharts() {
            updateTransactionsChart();
            updateSalesChart();
            updateBranchChart();
            updateWeeklyChart();
        }

        function updateTransactionsChart() {
            const ctx = document.getElementById('transactionsChart').getContext('2d');
            const filteredData = selectedBranch === 'All' 
                ? deliveryData 
                : deliveryData.filter(item => item.branch === selectedBranch);
            
            // Aggregate by date
            const grouped = {};
            filteredData.forEach(item => {
                const day = item.date.split(',')[0].replace('October ', '').replace('st', '').replace('nd', '').replace('rd', '').replace('th', '').trim();
                if (!grouped[day]) {
                    grouped[day] = { date: `Oct ${day}`, transactions: 0 };
                }
                grouped[day].transactions += item.transactions;
            });
            
            const chartData = Object.values(grouped).sort((a, b) => parseInt(a.date.split(' ')[1]) - parseInt(b.date.split(' ')[1]));
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartData.map(item => item.date),
                    datasets: [{
                        label: 'Transactions',
                        data: chartData.map(item => item.transactions),
                        borderColor: '#f59e0b',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        borderWidth: 3,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateSalesChart() {
            const ctx = document.getElementById('salesChart').getContext('2d');
            const filteredData = selectedBranch === 'All' 
                ? deliveryData 
                : deliveryData.filter(item => item.branch === selectedBranch);
            
            // Aggregate by date
            const grouped = {};
            filteredData.forEach(item => {
                const day = item.date.split(',')[0].replace('October ', '').replace('st', '').replace('nd', '').replace('rd', '').replace('th', '').trim();
                if (!grouped[day]) {
                    grouped[day] = { date: `Oct ${day}`, sales: 0 };
                }
                grouped[day].sales += item.sales;
            });
            
            const chartData = Object.values(grouped).sort((a, b) => parseInt(a.date.split(' ')[1]) - parseInt(b.date.split(' ')[1]));
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartData.map(item => item.date),
                    datasets: [{
                        label: 'Sales (AED)',
                        data: chartData.map(item => item.sales),
                        backgroundColor: '#10b981',
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateBranchChart() {
            const ctx = document.getElementById('branchChart').getContext('2d');
            
            // Aggregate by branch
            const grouped = {};
            deliveryData.forEach(item => {
                if (!grouped[item.branch]) {
                    grouped[item.branch] = { 
                        branch: item.branch.replace('Crispy Chicken ', '').replace('Crispy Chicken-', ''), 
                        sales: 0 
                    };
                }
                grouped[item.branch].sales += item.sales;
            });
            
            const chartData = Object.values(grouped).sort((a, b) => b.sales - a.sales);
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartData.map(item => item.branch),
                    datasets: [{
                        label: 'Sales (AED)',
                        data: chartData.map(item => item.sales),
                        backgroundColor: '#3b82f6',
                        borderRadius: 5
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateWeeklyChart() {
            const ctx = document.getElementById('weeklyChart').getContext('2d');
            const filteredData = selectedBranch === 'All' 
                ? deliveryData 
                : deliveryData.filter(item => item.branch === selectedBranch);
            
            const week1 = filteredData.filter(item => parseInt(item.date.match(/\d+/)[0]) <= 7);
            const week2 = filteredData.filter(item => parseInt(item.date.match(/\d+/)[0]) > 7);
            
            const w1Trans = week1.reduce((sum, item) => sum + item.transactions, 0);
            const w1Sales = week1.reduce((sum, item) => sum + item.sales, 0);
            const w2Trans = week2.reduce((sum, item) => sum + item.transactions, 0);
            const w2Sales = week2.reduce((sum, item) => sum + item.sales, 0);
            
            const chartData = [
                { week: 'Week 1 (Oct 1-7)', transactions: w1Trans, sales: Math.round(w1Sales) },
                { week: 'Week 2 (Oct 8-12)', transactions: w2Trans, sales: Math.round(w2Sales) }
            ];
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartData.map(item => item.week),
                    datasets: [
                        {
                            label: 'Transactions',
                            data: chartData.map(item => item.transactions),
                            backgroundColor: '#f59e0b',
                            borderRadius: 5,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Sales (AED)',
                            data: chartData.map(item => item.sales),
                            backgroundColor: '#10b981',
                            borderRadius: 5,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });
        }

        function updateTable() {
            const filteredData = selectedBranch === 'All' 
                ? deliveryData 
                : deliveryData.filter(item => item.branch === selectedBranch);
            
            recordCount.textContent = filteredData.length;
            
            // Clear table
            dataTableBody.innerHTML = '';
            
            // Add rows (max 20)
            const displayData = filteredData.slice(0, 20);
            displayData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.className = 'border-b table-row';
                row.innerHTML = `
                    <td class="px-4 py-3 text-sm">${item.date}</td>
                    <td class="px-4 py-3 text-sm">${item.branch}</td>
                    <td class="px-4 py-3 text-sm">${item.transactions}</td>
                    <td class="px-4 py-3 text-sm">${item.sales.toFixed(2)}</td>
                    <td class="px-4 py-3 text-sm">${(item.sales / item.transactions).toFixed(2)}</td>
                    <td class="px-4 py-3 text-sm">
                        <div class="flex gap-2">
                            <button onclick="handleEditEntry(${index})" class="p-1 text-blue-600 hover:text-blue-800">
                                <i data-lucide="edit-2" class="w-4 h-4"></i>
                            </button>
                            <button onclick="handleDeleteEntry(${index})" class="p-1 text-red-600 hover:text-red-800">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </td>
                `;
                dataTableBody.appendChild(row);
            });
            
            // Re-initialize Lucide icons for new elements
            lucide.createIcons();
            
            // Show/hide footer
            if (filteredData.length > 20) {
                tableFooter.textContent = `Showing first 20 of ${filteredData.length} records`;
                tableFooter.classList.remove('hidden');
            } else {
                tableFooter.classList.add('hidden');
            }
        }

        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const data = new Uint8Array(event.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    // Map the uploaded data to our format
                    const mappedData = jsonData.map(row => ({
                        date: row.Date || row.date,
                        branch: row.Branch || row.branch,
                        transactions: parseInt(row.Transactions || row.transactions || 0),
                        sales: parseFloat(row['Sales (AED)'] || row.sales || 0)
                    }));
                    
                    deliveryData = mappedData;
                    updateDashboard();
                    alert('Data uploaded successfully!');
                } catch (error) {
                    alert('Error reading file. Please ensure it matches the template format.');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function downloadTemplate() {
            const template = [
                { Date: 'October 1st, 2025', Branch: 'Crispy Chicken-Hamdan St', Channel: 'Delivery', Transactions: 0, 'Sales (AED)': 0 }
            ];
            const ws = XLSX.utils.json_to_sheet(template);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Template');
            XLSX.writeFile(wb, 'crispy_chicken_template.xlsx');
        }

        function handleAddEntry() {
            editingIndex = null;
            modalTitle.textContent = 'Add New Entry';
            modalDate.value = '';
            modalBranch.value = '';
            modalTransactions.value = '';
            modalSales.value = '';
            dataModal.classList.remove('hidden');
        }

        function handleEditEntry(index) {
            const filteredData = selectedBranch === 'All' 
                ? deliveryData 
                : deliveryData.filter(item => item.branch === selectedBranch);
            
            const item = filteredData[index];
            editingIndex = index;
            modalTitle.textContent = 'Edit Entry';
            modalDate.value = item.date;
            modalBranch.value = item.branch;
            modalTransactions.value = item.transactions;
            modalSales.value = item.sales;
            dataModal.classList.remove('hidden');
        }

        function handleDeleteEntry(index) {
            if (window.confirm('Are you sure you want to delete this entry?')) {
                const filteredData = selectedBranch === 'All' 
                    ? deliveryData 
                    : deliveryData.filter(item => item.branch === selectedBranch);
                
                const itemToDelete = filteredData[index];
                deliveryData = deliveryData.filter(item => 
                    !(item.date === itemToDelete.date && item.branch === itemToDelete.branch)
                );
                
                updateDashboard();
            }
        }

        function handleSaveEntry() {
            const newEntry = {
                date: modalDate.value,
                branch: modalBranch.value,
                transactions: parseInt(modalTransactions.value) || 0,
                sales: parseFloat(modalSales.value) || 0
            };
            
            if (editingIndex !== null) {
                const filteredData = selectedBranch === 'All' 
                    ? deliveryData 
                    : deliveryData.filter(item => item.branch === selectedBranch);
                
                const itemToEdit = filteredData[editingIndex];
                deliveryData = deliveryData.map(item => 
                    (item.date === itemToEdit.date && item.branch === itemToEdit.branch) ? newEntry : item
                );
            } else {
                deliveryData.push(newEntry);
            }
            
            closeModal();
            updateDashboard();
        }

        function closeModal() {
            dataModal.classList.add('hidden');
        }
    </script>
</body>
</html>
