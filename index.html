<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crispy Chicken Analytics Dashboard</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- SheetJS for Excel Import -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- jsPDF for PDF Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- LZ-String for Compression -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    
    <style>
        :root {
            --primary-color: #ff6b35;
            --secondary-color: #f7931e;
            --dark-color: #212529;
            --light-color: #f8f9fa;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
        }
        
        .navbar {
            background-color: var(--primary-color) !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .nav-tabs .nav-link {
            color: var(--dark-color);
            border: none;
            border-bottom: 3px solid transparent;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .nav-tabs .nav-link.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            background-color: transparent;
        }
        
        .nav-tabs .nav-link:hover {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .metric-card {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .metric-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            transform: translate(30px, -30px);
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .metric-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 2rem;
        }
        
        .table-responsive {
            border-radius: 10px;
            overflow: hidden;
        }
        
        .table {
            margin-bottom: 0;
        }
        
        .table thead th {
            background-color: var(--primary-color);
            color: white;
            border: none;
            white-space: nowrap;
        }
        
        .table tbody tr:hover {
            background-color: rgba(255, 107, 53, 0.05);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }
        
        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(255, 107, 53, 0.25);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
            min-width: 300px;
            max-width: 350px;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .spinner-border {
            width: 3rem;
            height: 3rem;
            border-width: 0.3em;
        }
        
        .tab-content {
            padding: 1.5rem 0;
        }
        
        .branch-badge {
            background-color: var(--secondary-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .offer-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .offer-normal {
            background-color: var(--success-color);
            color: white;
        }
        
        .offer-chicken {
            background-color: var(--warning-color);
            color: darkslategray;
        }
        
        .offer-ultimate {
            background-color: var(--danger-color);
            color: white;
        }
        
        .page-header {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .page-header h1 {
            color: var(--dark-color);
            font-weight: 600;
        }
        
        .page-header .breadcrumb {
            margin-bottom: 0;
            padding: 0;
            background-color: transparent;
        }
        
        .page-header .breadcrumb-item a {
            color: var(--primary-color);
            text-decoration: none;
        }
        
        .page-header .breadcrumb-item.active {
            color: var(--dark-color);
        }
        
        .save-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            margin-left: 10px;
        }
        
        .save-saved {
            background-color: var(--success-color);
            color: white;
        }
        
        .save-unsaved {
            background-color: var(--warning-color);
            color: darkslategray;
        }
        
        .save-saving {
            background-color: var(--primary-color);
            color: white;
        }
        
        .data-management-card {
            background-color: #f8f9fa;
            border-left: 4px solid var(--primary-color);
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 5px;
        }
        
        .auto-save-toggle {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .auto-save-toggle .form-check-input {
            margin-right: 0.5rem;
        }
        
        .data-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background-color: #e9ecef;
            border-radius: 5px;
        }
        
        .data-stats .stat-item {
            text-align: center;
        }
        
        .data-stats .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .data-stats .stat-label {
            font-size: 0.85rem;
            color: #6c757d;
        }
        
        .last-saved {
            font-size: 0.85rem;
            color: #6c757d;
            margin-bottom: 1rem;
        }
        
        .btn-group .btn {
            border-radius: 0;
        }
        
        .btn-group .btn:first-child {
            border-top-left-radius: 5px;
            border-bottom-left-radius: 5px;
        }
        
        .btn-group .btn:last-child {
            border-top-right-radius: 5px;
            border-bottom-right-radius: 5px;
        }
        
        .form-text {
            font-size: 0.875rem;
            color: #6c757d;
            margin-top: 0.25rem;
        }
        
        .invalid-feedback {
            display: block;
            width: 100%;
            margin-top: 0.25rem;
            font-size: 0.875rem;
            color: var(--danger-color);
        }
        
        .alert {
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .alert-dismissible .btn-close {
            padding: 0.25rem 0.5rem;
        }
        
        .chart-legend {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 1rem;
        }
        
        .chart-legend-item {
            display: flex;
            align-items: center;
            margin: 0 1rem 0.5rem 0;
        }
        
        .chart-legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            margin-right: 0.5rem;
        }
        
        .data-card {
            transition: all 0.3s ease;
        }
        
        .data-card:hover {
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
        }
        
        .performance-indicator {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }
        
        .performance-high {
            background-color: var(--success-color);
            color: white;
        }
        
        .performance-medium {
            background-color: var(--warning-color);
            color: darkslategray;
        }
        
        .performance-low {
            background-color: var(--danger-color);
            color: white;
        }
        
        .rating-input {
            display: flex;
            gap: 5px;
            font-size: 1.5rem;
            margin: 0.5rem 0;
        }
        
        .rating-input i {
            cursor: pointer;
            color: #ddd;
            transition: color 0.2s;
        }
        
        .rating-input i.active {
            color: #ffc107;
        }
        
        .feedback-category {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .category-service {
            background-color: var(--info-color);
            color: white;
        }
        
        .category-food {
            background-color: var(--primary-color);
            color: white;
        }
        
        .category-cleanliness {
            background-color: var(--success-color);
            color: white;
        }
        
        .category-other {
            background-color: var(--warning-color);
            color: darkslategray;
        }
        
        .file-drop-area {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 1rem;
        }
        
        .file-drop-area:hover {
            border-color: var(--primary-color);
            background-color: rgba(255, 107, 53, 0.05);
        }
        
        .file-drop-area.drag-over {
            border-color: var(--primary-color);
            background-color: rgba(255, 107, 53, 0.1);
        }
        
        .progress {
            height: 5px;
            margin-bottom: 1rem;
        }
        
        .modal-header {
            background-color: var(--primary-color);
            color: white;
        }
        
        .modal-header .btn-close {
            filter: brightness(0) invert(1);
        }
        
        .excel-format-info {
            background-color: #e7f3ff;
            border-left: 4px solid var(--info-color);
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            border-radius: 4px;
        }
        
        .excel-format-info small {
            color: #6c757d;
        }
        
        .feedback-card {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--info-color);
        }
        
        .feedback-card h6 {
            color: var(--dark-color);
            margin-bottom: 0.5rem;
        }
        
        .feedback-card p {
            margin-bottom: 0.5rem;
            color: #6c757d;
        }
        
        .feedback-card .feedback-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            color: #6c757d;
        }
        
        .category-color-picker {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .color-option:hover {
            transform: scale(1.1);
        }
        
        .color-option.selected {
            border: 2px solid #333;
        }
        
        .feedback-list-item {
            background-color: #fff;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.2s;
        }
        
        .feedback-list-item:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .feedback-list-item .feedback-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .feedback-list-item .feedback-body {
            margin-bottom: 0.5rem;
        }
        
        .feedback-list-item .feedback-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
            color: #6c757d;
        }
        
        .feedback-list-item .feedback-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .feedback-list-item .feedback-actions .btn {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
        }
        
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .spinner {
            animation: spin 1s linear infinite;
        }
        
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        @media (max-width: 768px) {
            .chart-container {
                height: 300px;
            }
            
            .metric-value {
                font-size: 1.5rem;
            }
            
            .notification {
                left: 10px;
                right: 10px;
                min-width: auto;
                max-width: none;
            }
            
            .data-stats {
                flex-wrap: wrap;
            }
            
            .data-stats .stat-item {
                flex: 1 1 50%;
                margin-bottom: 0.5rem;
            }
        }
        
        /* Target Plan Specific Styles */
        .target-plan-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }
        
        .target-progress {
            height: 30px;
            border-radius: 15px;
            background-color: rgba(255, 255, 255, 0.2);
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        
        .target-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 15px;
            transition: width 0.6s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .target-metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .target-metric:last-child {
            border-bottom: none;
        }
        
        .target-metric-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .target-metric-value {
            font-size: 1.1rem;
            font-weight: bold;
        }
        
        .branch-target-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            border-left: 4px solid var(--primary-color);
            transition: all 0.3s ease;
        }
        
        .branch-target-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }
        
        .branch-target-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .branch-target-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .branch-target-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .target-achieved {
            background-color: var(--success-color);
            color: white;
        }
        
        .target-pending {
            background-color: var(--warning-color);
            color: darkslategray;
        }
        
        .target-critical {
            background-color: var(--danger-color);
            color: white;
        }
        
        .target-summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .target-summary-item {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
        }
        
        .target-summary-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        
        .target-summary-label {
            font-size: 0.9rem;
            color: var(--dark-color);
        }
        
        .target-allocation-chart {
            height: 350px;
            margin-bottom: 2rem;
        }
        
        .target-timeline {
            position: relative;
            padding: 2rem 0;
        }
        
        .timeline-item {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .timeline-date {
            min-width: 100px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .timeline-content {
            flex: 1;
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin-left: 1rem;
        }
        
        .target-action-btn {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .target-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .target-input-group {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .target-input-group label {
            min-width: 150px;
            font-weight: 500;
            margin-right: 1rem;
        }
        
        .target-input-group input {
            flex: 1;
        }
        
        .target-percentage-display {
            background: #e9ecef;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            font-weight: 600;
            color: var(--primary-color);
            min-width: 80px;
            text-align: center;
            margin-left: 1rem;
        }
        
        /* Data Management Styles */
        .save-slot {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            border-left: 4px solid var(--primary-color);
            transition: all 0.3s ease;
        }
        
        .save-slot:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }
        
        .save-slot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .save-slot-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .save-slot-date {
            font-size: 0.85rem;
            color: #6c757d;
        }
        
        .save-slot-description {
            color: #6c757d;
            margin-bottom: 0.5rem;
        }
        
        .save-slot-stats {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 0.85rem;
            color: #6c757d;
        }
        
        .save-slot-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .backup-item {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            border-left: 4px solid var(--info-color);
            transition: all 0.3s ease;
        }
        
        .backup-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }
        
        .backup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .backup-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .backup-date {
            font-size: 0.85rem;
            color: #6c757d;
        }
        
        .backup-details {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
            color: #6c757d;
        }
        
        .backup-stats {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 0.85rem;
            color: #6c757d;
        }
        
        .backup-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .recovery-point {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            border-left: 4px solid var(--warning-color);
            transition: all 0.3s ease;
        }
        
        .recovery-point:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }
        
        .recovery-point-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .recovery-point-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .recovery-point-date {
            font-size: 0.85rem;
            color: #6c757d;
        }
        
        .recovery-point-details {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
            color: #6c757d;
        }
        
        .recovery-point-stats {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 0.85rem;
            color: #6c757d;
        }
        
        .recovery-point-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .integrity-results {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        
        .integrity-summary {
            margin-bottom: 1.5rem;
        }
        
        .integrity-stat {
            text-align: center;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
        }
        
        .integrity-stat.passed {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
        }
        
        .integrity-stat.warning {
            background: linear-gradient(135deg, #fff3cd, #ffeeba);
            color: #856404;
        }
        
        .integrity-stat.failed {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24;
        }
        
        .integrity-stat .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .integrity-stat .stat-label {
            font-size: 0.9rem;
        }
        
        .integrity-details {
            margin-top: 1.5rem;
        }
        
        .integrity-category {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .integrity-category.passed {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }
        
        .integrity-category.warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        
        .integrity-category.failed {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        
        .integrity-category h6 {
            margin-bottom: 0.5rem;
        }
        
        .integrity-category ul {
            margin-bottom: 0;
        }
        
        .scheduled-backup {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            border-left: 4px solid var(--success-color);
        }
        
        .scheduled-backup h6 {
            color: var(--dark-color);
            margin-bottom: 1rem;
        }
        
        .scheduled-backup p {
            margin-bottom: 0.5rem;
            color: #6c757d;
        }
        
        .scheduled-backup-history {
            margin-top: 1.5rem;
        }
        
        .scheduled-backup-history h6 {
            color: var(--dark-color);
            margin-bottom: 1rem;
        }
        
        .cloud-storage-status {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            border-left: 4px solid var(--info-color);
        }
        
        .cloud-storage-status h6 {
            color: var(--dark-color);
            margin-bottom: 1rem;
        }
        
        .cloud-storage-status p {
            margin-bottom: 0.5rem;
            color: #6c757d;
        }
        
        .cloud-backup-history {
            margin-top: 1.5rem;
        }
        
        .cloud-backup-history h6 {
            color: var(--dark-color);
            margin-bottom: 1rem;
        }
        
        .data-comparison {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        
        .comparison-header {
            margin-bottom: 1rem;
        }
        
        .comparison-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 0.5rem;
        }
        
        .comparison-dates {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .comparison-table {
            width: 100%;
            margin-bottom: 0;
        }
        
        .comparison-table th {
            padding: 0.5rem;
            border-bottom: 1px solid #dee2e6;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .comparison-table td {
            padding: 0.5rem;
            border-bottom: 1px solid #dee2e6;
        }
        
        .comparison-table .added {
            color: var(--success-color);
            font-weight: 600;
        }
        
        .comparison-table .removed {
            color: var(--danger-color);
            font-weight: 600;
        }
        
        .comparison-table .modified {
            color: var(--warning-color);
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#"><i class="fas fa-drumstick-bite"></i> Crispy Chicken Analytics</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" data-page="dashboard"><i class="fas fa-chart-line"></i> Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-page="data-entry"><i class="fas fa-plus-circle"></i> Data Entry</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-page="management-report"><i class="fas fa-file-alt"></i> Management Report</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-page="target-plan"><i class="fas fa-bullseye"></i> Target Plan</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-page="feedback-management"><i class="fas fa-comments"></i> Feedback Management</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-page="data-management"><i class="fas fa-database"></i> Data Management</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-4">
        <!-- Dashboard Page -->
        <div id="dashboard-page" class="page-content">
            <div class="page-header">
                <h1>Sales Analytics Dashboard</h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item active">Dashboard</li>
                    </ol>
                </nav>
            </div>

            <!-- Date Range Selector -->
            <div class="card mb-4">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <label for="dateRange" class="form-label">Date Range</label>
                            <div class="input-group">
                                <input type="date" id="startDate" class="form-control" value="2025-10-01" aria-label="Start date">
                                <span class="input-group-text">to</span>
                                <input type="date" id="endDate" class="form-control" value="2025-10-14" aria-label="End date">
                                <button class="btn btn-primary" onclick="updateDashboard()" aria-label="Update dashboard">
                                    <i class="fas fa-sync"></i> Update
                                </button>
                            </div>
                            <div class="form-text">Select the date range for analysis</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Quick Select</label>
                            <div class="btn-group w-100" role="group">
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="setDateRange('today')">
                                    <i class="fas fa-calendar-day"></i> Today
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="setDateRange('yesterday')">
                                    <i class="fas fa-calendar-minus"></i> Yesterday
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="setDateRange('last7days')">
                                    <i class="fas fa-calendar-week"></i> Last 7 Days
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="setDateRange('last30days')">
                                    <i class="fas fa-calendar-alt"></i> Last 30 Days
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="setDateRange('thismonth')">
                                    <i class="fas fa-calendar"></i> This Month
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="setDateRange('lastmonth')">
                                    <i class="fas fa-calendar-times"></i> Last Month
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <label class="form-label">Advanced Options</label>
                        <div class="row">
                            <div class="col-md-4">
                                <select class="form-select form-select-sm" id="branchFilter" onchange="updateDashboard()" aria-label="Filter by branch">
                                    <option value="all">All Branches</option>
                                    <option value="Crispy Chicken-Hamdan St">Crispy Chicken-Hamdan St</option>
                                    <option value="Crispy Chicken Khaldia">Crispy Chicken Khaldia</option>
                                    <option value="Crispy Chicken Shabiya 11">Crispy Chicken Shabiya 11</option>
                                    <option value="Crispy Chicken Muroor">Crispy Chicken Muroor</option>
                                    <option value="Crispy Chicken Al Barsha">Crispy Chicken Al Barsha</option>
                                    <option value="Crispy Chicken Al Satwa">Crispy Chicken Al Satwa</option>
                                    <option value="Crispy Chicken Al Rgga">Crispy Chicken Al Rgga</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <select class="form-select form-select-sm" id="offerFilter" onchange="updateDashboard()" aria-label="Filter by offer">
                                    <option value="all">All Offers</option>
                                    <option value="Normal Day">Normal Day</option>
                                    <option value="Chicken Day">Chicken Day</option>
                                    <option value="Ultimate">Ultimate</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="autoRefresh" checked>
                                    <label class="form-check-label" for="autoRefresh">
                                        Auto-refresh on date change
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Key Metrics -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="totalSales">0</div>
                        <div class="metric-label">Total Sales (AED)</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="totalTransactions">0</div>
                        <div class="metric-label">Total Transactions</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="avgTransaction">0</div>
                        <div class="metric-label">Avg. Transaction (AED)</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="targetAchievement">0%</div>
                        <div class="metric-label">Target Achievement</div>
                    </div>
                </div>
            </div>

            <!-- Tabs for different views -->
            <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab" aria-selected="true">Overview</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="performance-tab" data-bs-toggle="tab" data-bs-target="#performance" type="button" role="tab" aria-selected="false">Performance</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="trends-tab" data-bs-toggle="tab" data-bs-target="#trends" type="button" role="tab" aria-selected="false">Trends</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="insights-tab" data-bs-toggle="tab" data-bs-target="#insights" type="button" role="tab" aria-selected="false">Insights</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="recommendations-tab" data-bs-toggle="tab" data-bs-target="#recommendations" type="button" role="tab" aria-selected="false">Recommendations</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="offers-tab" data-bs-toggle="tab" data-bs-target="#offers" type="button" role="tab" aria-selected="false">Offers</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="feedback-analysis-tab" data-bs-toggle="tab" data-bs-target="#feedback-analysis" type="button" role="tab" aria-selected="false">Feedback Analysis</button>
                </li>
            </ul>

            <div class="tab-content" id="dashboardTabsContent">
                <!-- Overview Tab -->
                <div class="tab-pane fade show active" id="overview" role="tabpanel">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Sales & Transactions Trend</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="salesTrendChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Branch Sales Distribution</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="branchSalesChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Daily Sales Details</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" aria-label="Daily sales details table">
                                            <thead>
                                                <tr>
                                                    <th>Date</th>
                                                    <th>Branch</th>
                                                    <th>Channel</th>
                                                    <th>Transactions</th>
                                                    <th>Sales (AED)</th>
                                                    <th>Average per Order</th>
                                                    <th>Offer Type</th>
                                                    <th>Offer Status</th>
                                                </tr>
                                            </thead>
                                            <tbody id="dailySalesTable">
                                                <!-- Table content will be populated by JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Performance Tab -->
                <div class="tab-pane fade" id="performance" role="tabpanel">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Branch Performance Radar</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="branchPerformanceRadarChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Branch Performance Ranking</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="branchPerformanceRankingChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Performance Metrics</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="text-center">
                                                <h3>Best Branch</h3>
                                                <div class="branch-badge" id="bestBranch">-</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="text-center">
                                                <h3>Highest Transactions</h3>
                                                <div class="branch-badge" id="highestTransactionsBranch">-</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="text-center">
                                                <h3>Highest Avg. Sale</h3>
                                                <div class="branch-badge" id="highestAvgSaleBranch">-</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Trends Tab -->
                <div class="tab-pane fade" id="trends" role="tabpanel">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Daily Trends</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="dailyTrendsChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Weekly Trends</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="weeklyTrendsChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Moving Average Analysis</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="movingAverageChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Insights Tab -->
                <div class="tab-pane fade" id="insights" role="tabpanel">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">AI Insights Analysis</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Anomaly Detection</h6>
                                    <div id="anomalyDetection">
                                        <div class="alert alert-warning">
                                            <i class="fas fa-exclamation-triangle"></i> 
                                            <strong>Anomaly Detection:</strong> 
                                            <p id="anomalyText">Analyzing data...</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6>Predictive Analytics</h6>
                                    <div id="predictiveAnalytics">
                                        <div class="alert alert-info">
                                            <i class="fas fa-chart-line"></i> 
                                            <strong>Sales Prediction:</strong> 
                                            <p id="predictionText">Generating prediction...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-4">
                                <div class="col-md-12">
                                    <h6>Key Findings</h6>
                                    <div id="keyFindings">
                                        <ul class="list-group" id="keyFindingsList">
                                            <!-- Key findings will be populated by JavaScript -->
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recommendations Tab -->
                <div class="tab-pane fade" id="recommendations" role="tabpanel">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">30-Day Action Plan</h5>
                        </div>
                        <div class="card-body">
                            <div class="accordion" id="recommendationsAccordion">
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#recommendations1" aria-expanded="true">
                                            Short-term Actions
                                        </button>
                                    </h2>
                                    <div id="recommendations1" class="accordion-collapse collapse show" data-bs-parent="#recommendationsAccordion">
                                        <div class="accordion-body">
                                            <ul id="shortTermRecommendations">
                                                <!-- Recommendations will be populated by JavaScript -->
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#recommendations2">
                                            Medium-term Strategy Adjustments
                                        </button>
                                    </h2>
                                    <div id="recommendations2" class="accordion-collapse collapse" data-bs-parent="#recommendationsAccordion">
                                        <div class="accordion-body">
                                            <ul id="mediumTermRecommendations">
                                                <!-- Recommendations will be populated by JavaScript -->
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#recommendations3">
                                            Long-term Development Plans
                                        </button>
                                    </h2>
                                    <div id="recommendations3" class="accordion-collapse collapse" data-bs-parent="#recommendationsAccordion">
                                        <div class="accordion-body">
                                            <ul id="longTermRecommendations">
                                                <!-- Recommendations will be populated by JavaScript -->
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Offers Tab -->
                <div class="tab-pane fade" id="offers" role="tabpanel">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Offer Management System</h5>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addOfferModal" aria-label="Add new offer">
                                <i class="fas fa-plus"></i> Add Offer
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" aria-label="Offers management table">
                                    <thead>
                                        <tr>
                                            <th>Offer Name</th>
                                            <th>Type</th>
                                            <th>Discount</th>
                                            <th>Start Date</th>
                                            <th>End Date</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="offersTable">
                                        <!-- Offers will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Feedback Analysis Tab -->
                <div class="tab-pane fade" id="feedback-analysis" role="tabpanel">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="metric-card">
                                <div class="metric-value" id="totalFeedback">0</div>
                                <div class="metric-label">Total Feedback</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="metric-card">
                                <div class="metric-value" id="avgRating">0.0</div>
                                <div class="metric-label">Average Rating</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="metric-card">
                                <div class="metric-value" id="positiveFeedback">0%</div>
                                <div class="metric-label">Positive Feedback</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="metric-card">
                                <div class="metric-value" id="negativeFeedback">0%</div>
                                <div class="metric-label">Negative Feedback</div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Feedback by Category</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container" style="height: 300px;">
                                        <canvas id="feedbackCategoryChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Rating Distribution</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container" style="height: 300px;">
                                        <canvas id="ratingDistributionChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Recent Feedback</h5>
                                </div>
                                <div class="card-body">
                                    <div id="recentFeedbackList">
                                        <!-- Recent feedback will be populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Entry Page -->
        <div id="data-entry-page" class="page-content" style="display: none;">
            <div class="page-header">
                <h1>Data Entry</h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item active">Data Entry</li>
                    </ol>
                </nav>
            </div>

            <!-- Data Management Section -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Data Management</h5>
                </div>
                <div class="card-body">
                    <div class="data-management-card">
                        <div class="auto-save-toggle">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="autoSaveToggle" checked>
                                <label class="form-check-label" for="autoSaveToggle">
                                    Auto-save enabled
                                </label>
                            </div>
                            <span id="saveStatus" class="save-status save-saved">Saved</span>
                        </div>
                        
                        <div class="last-saved">
                            Last saved: <span id="lastSavedTime">Never</span>
                        </div>
                        
                        <div class="data-stats">
                            <div class="stat-item">
                                <div class="stat-value" id="salesRecordsCount">0</div>
                                <div class="stat-label">Sales Records</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="offersCount">0</div>
                                <div class="stat-label">Offers</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="feedbackCount">0</div>
                                <div class="stat-label">Feedback</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="totalDataSize">0 KB</div>
                                <div class="stat-label">Data Size</div>
                            </div>
                        </div>
                        
                        <div class="btn-group w-100 mb-3" role="group">
                            <button type="button" class="btn btn-outline-primary" onclick="saveData()">
                                <i class="fas fa-save"></i> Save Data
                            </button>
                            <button type="button" class="btn btn-outline-success" onclick="exportData()">
                                <i class="fas fa-download"></i> Export Backup
                            </button>
                            <button type="button" class="btn btn-outline-info" onclick="showImportModal()">
                                <i class="fas fa-upload"></i> Import Data
                            </button>
                            <button type="button" class="btn btn-outline-warning" onclick="clearAllData()">
                                <i class="fas fa-trash-alt"></i> Clear All Data
                            </button>
                            <button type="button" class="btn btn-outline-secondary" onclick="resetToSample()">
                                <i class="fas fa-undo"></i> Reset to Sample
                            </button>
                            <button type="button" class="btn btn-outline-danger" onclick="exportToPDF()">
                                <i class="fas fa-file-pdf"></i> Export PDF
                            </button>
                        </div>
                        
                        <div class="mb-3">
                            <button class="btn btn-sm btn-outline-secondary" onclick="undoLastAction()">
                                <i class="fas fa-undo"></i> Undo Last Action
                            </button>
                            <span class="ms-2 text-muted" id="undoStatus">No actions to undo</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Excel Import Section -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Excel Import</h5>
                </div>
                <div class="card-body">
                    <div class="excel-upload-section">
                        <h6><i class="fas fa-file-excel"></i> Import Sales Data from Excel</h6>
                        
                        <div class="excel-format-info">
                            <strong>Excel Format Requirements:</strong>
                            <ul class="mb-0">
                                <li><strong>Required columns:</strong> Date, Branch, Channel, Transactions, Sales, Offer Type, Offer Status</li>
                                <li><strong>Optional columns:</strong> Average per Order (calculated automatically), Notes</li>
                                <li><strong>Date format:</strong> YYYY-MM-DD (e.g., 2025-10-01)</li>
                                <li><strong>Branch names:</strong> Must match exactly: Crispy Chicken-Hamdan St, Crispy Chicken Khaldia, etc.</li>
                                <li><strong>Channels:</strong> Delivery, Dine-in, Takeaway</li>
                                <li><strong>Offer Types:</strong> Normal Day, Chicken Day, Ultimate</li>
                                <li><strong>Offer Status:</strong> Active, No Offer</li>
                                <li><strong>Transactions:</strong> Must be a positive integer</li>
                                <li><strong>Sales:</strong> Must be a positive number (AED)</li>
                            </ul>
                            <div class="mt-2">
                                <strong>Sample Format:</strong>
                                <table class="table table-sm mt-2">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Branch</th>
                                            <th>Channel</th>
                                            <th>Transactions</th>
                                            <th>Sales</th>
                                            <th>Offer Type</th>
                                            <th>Offer Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>2025-10-01</td>
                                            <td>Crispy Chicken-Hamdan St</td>
                                            <td>Delivery</td>
                                            <td>73</td>
                                            <td>3216.00</td>
                                            <td>Normal Day</td>
                                            <td>No Offer</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <small class="text-muted">
                                <i class="fas fa-info-circle"></i> 
                                The system will automatically calculate the average per order if not provided. 
                                Duplicate records (same date, branch, and channel) will be automatically removed.
                            </small>
                            <hr>
                            <small><a href="#" onclick="downloadExcelTemplate()" class="text-primary">
                                <i class="fas fa-download"></i> Download Excel Template
                            </a></small>
                        </div>
                        
                        <div class="file-drop-area" id="fileDropArea">
                            <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                            <p class="mb-0">Drag and drop your Excel file here or <a href="#" id="browseLink">browse files</a></p>
                            <input type="file" id="excelFileInput" accept=".xlsx,.xls" class="d-none" aria-label="Select Excel file">
                        </div>
                        
                        <div class="progress d-none" id="importProgress">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                        </div>
                        
                        <div class="mt-3">
                            <button class="btn btn-primary d-none" id="importExcelBtn" onclick="processExcelFile()">
                                <i class="fas fa-file-import"></i> Import Excel Data
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Add New Sales Data</h5>
                        </div>
                        <div class="card-body">
                            <form id="salesDataForm" novalidate>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="dateInput" class="form-label">Date</label>
                                        <input type="date" class="form-control" id="dateInput" required aria-describedby="dateInputHelp">
                                        <div class="invalid-feedback" id="dateInputFeedback"></div>
                                        <div id="dateInputHelp" class="form-text">Enter the date of the sales record</div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="branchInput" class="form-label">Branch</label>
                                        <select class="form-select" id="branchInput" required aria-describedby="branchInputHelp">
                                            <option value="">Select Branch</option>
                                            <option value="Crispy Chicken-Hamdan St">Crispy Chicken-Hamdan St</option>
                                            <option value="Crispy Chicken Khaldia">Crispy Chicken Khaldia</option>
                                            <option value="Crispy Chicken Shabiya 11">Crispy Chicken Shabiya 11</option>
                                            <option value="Crispy Chicken Muroor">Crispy Chicken Muroor</option>
                                            <option value="Crispy Chicken Al Barsha">Crispy Chicken Al Barsha</option>
                                            <option value="Crispy Chicken Al Satwa">Crispy Chicken Al Satwa</option>
                                            <option value="Crispy Chicken Al Rgga">Crispy Chicken Al Rgga</option>
                                        </select>
                                        <div class="invalid-feedback" id="branchInputFeedback"></div>
                                        <div id="branchInputHelp" class="form-text">Select the branch where the sale occurred</div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="channelInput" class="form-label">Channel</label>
                                        <select class="form-select" id="channelInput" required aria-describedby="channelInputHelp">
                                            <option value="">Select Channel</option>
                                            <option value="Delivery">Delivery</option>
                                            <option value="Dine-in">Dine-in</option>
                                            <option value="Takeaway">Takeaway</option>
                                        </select>
                                        <div class="invalid-feedback" id="channelInputFeedback"></div>
                                        <div id="channelInputHelp" class="form-text">Select the sales channel</div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="transactionsInput" class="form-label">Transactions</label>
                                        <input type="number" class="form-control" id="transactionsInput" min="0" required aria-describedby="transactionsInputHelp">
                                        <div class="form-text">Enter the number of transactions</div>
                                        <div class="invalid-feedback" id="transactionsInputFeedback"></div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="salesInput" class="form-label">Sales (AED)</label>
                                        <input type="number" class="form-control" id="salesInput" min="0" step="0.01" required aria-describedby="salesInputHelp">
                                        <div class="form-text">Enter the total sales amount in AED</div>
                                        <div class="invalid-feedback" id="salesInputFeedback"></div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="averageInput" class="form-label">Average per Order</label>
                                        <input type="number" class="form-control" id="averageInput" min="0" step="0.01" readonly aria-describedby="averageInputHelp">
                                        <div class="form-text">Calculated automatically</div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="offerTypeInput" class="form-label">Offer Type</label>
                                        <select class="form-select" id="offerTypeInput" required aria-describedby="offerTypeInputHelp">
                                            <option value="">Select Offer Type</option>
                                            <option value="Normal Day">Normal Day</option>
                                            <option value="Chicken Day">Chicken Day</option>
                                            <option value="Ultimate">Ultimate</option>
                                        </select>
                                        <div class="invalid-feedback" id="offerTypeInputFeedback"></div>
                                        <div id="offerTypeInputHelp" class="form-text">Select the offer type in effect</div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="offerStatusInput" class="form-label">Offer Status</label>
                                        <select class="form-select" id="offerStatusInput" required aria-describedby="offerStatusInputHelp">
                                            <option value="">Select Status</option>
                                            <option value="Active">Active</option>
                                            <option value="No Offer">No Offer</option>
                                        </select>
                                        <div class="invalid-feedback" id="offerStatusInputFeedback"></div>
                                        <div id="offerStatusInputHelp" class="form-text">Select if the offer was active</div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="notesInput" class="form-label">Notes</label>
                                    <textarea class="form-control" id="notesInput" rows="2" placeholder="Additional notes (optional)" aria-describedby="notesInputHelp"></textarea>
                                    <div id="notesInputHelp" class="form-text">Optional notes about the sales record</div>
                                </div>
                                
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="fas fa-save"></i> Save Data
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Add Customer Feedback</h5>
                        </div>
                        <div class="card-body">
                            <form id="feedbackForm" novalidate>
                                <div class="mb-3">
                                    <label for="feedbackDate" class="form-label">Date</label>
                                    <input type="date" class="form-control" id="feedbackDate" required aria-describedby="feedbackDateHelp">
                                    <div class="invalid-feedback" id="feedbackDateFeedback"></div>
                                    <div id="feedbackDateHelp" class="form-text">Enter the date of the feedback</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="feedbackBranch" class="form-label">Branch</label>
                                    <select class="form-select" id="feedbackBranch" required aria-describedby="feedbackBranchHelp">
                                        <option value="">Select Branch</option>
                                        <option value="Crispy Chicken-Hamdan St">Crispy Chicken-Hamdan St</option>
                                        <option value="Crispy Chicken Khaldia">Crispy Chicken Khaldia</option>
                                        <option value="Crispy Chicken Shabiya 11">Crispy Chicken Shabiya 11</option>
                                        <option value="Crispy Chicken Muroor">Crispy Chicken Muroor</option>
                                        <option value="Crispy Chicken Al Barsha">Crispy Chicken Al Barsha</option>
                                        <option value="Crispy Chicken Al Satwa">Crispy Chicken Al Satwa</option>
                                        <option value="Crispy Chicken Al Rgga">Crispy Chicken Al Rgga</option>
                                    </select>
                                    <div class="invalid-feedback" id="feedbackBranchFeedback"></div>
                                    <div id="feedbackBranchHelp" class="form-text">Select the branch where the feedback was received</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Rating</label>
                                    <div class="rating-input" id="feedbackRating" role="radiogroup" aria-label="Rating">
                                        <i class="fas fa-star" data-rating="1" role="radio" tabindex="0" aria-label="1 star"></i>
                                        <i class="fas fa-star" data-rating="2" role="radio" tabindex="0" aria-label="2 stars"></i>
                                        <i class="fas fa-star" data-rating="3" role="radio" tabindex="0" aria-label="3 stars"></i>
                                        <i class="fas fa-star" data-rating="4" role="radio" tabindex="0" aria-label="4 stars"></i>
                                        <i class="fas fa-star" data-rating="5" role="radio" tabindex="0" aria-label="5 stars"></i>
                                    </div>
                                    <input type="hidden" id="feedbackRatingValue" value="0" aria-required="true">
                                    <div class="invalid-feedback" id="feedbackRatingFeedback"></div>
                                    <div class="form-text">Select a rating from 1 to 5 stars</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="feedbackCategory" class="form-label">Category</label>
                                    <select class="form-select" id="feedbackCategory" required aria-describedby="feedbackCategoryHelp">
                                        <option value="">Select Category</option>
                                        <option value="Service">Service</option>
                                        <option value="Food">Food</option>
                                        <option value="Cleanliness">Cleanliness</option>
                                        <option value="Other">Other</option>
                                    </select>
                                    <div class="invalid-feedback" id="feedbackCategoryFeedback"></div>
                                    <div id="feedbackCategoryHelp" class="form-text">Select the category of feedback</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="feedbackComment" class="form-label">Comment</label>
                                    <textarea class="form-control" id="feedbackComment" rows="3" required placeholder="Please share your experience..." aria-describedby="feedbackCommentHelp"></textarea>
                                    <div class="invalid-feedback" id="feedbackCommentFeedback"></div>
                                    <div id="feedbackCommentHelp" class="form-text">Please provide detailed feedback about your experience</div>
                                </div>
                                
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="fas fa-save"></i> Submit Feedback
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Data Records</h5>
                        </div>
                        <div class="card-body">
                            <ul class="nav nav-tabs mb-3" id="dataTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="sales-tab" data-bs-toggle="tab" data-bs-target="#sales" type="button" role="tab" aria-selected="true">Sales Data</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="feedback-tab" data-bs-toggle="tab" data-bs-target="#feedback" type="button" role="tab" aria-selected="false">Customer Feedback</button>
                                </li>
                            </ul>
                            
                            <div class="tab-content" id="dataTabsContent">
                                <div class="tab-pane fade show active" id="sales" role="tabpanel">
                                    <div class="table-responsive">
                                        <table class="table table-hover" aria-label="Sales data table">
                                            <thead>
                                                <tr>
                                                    <th>Date</th>
                                                    <th>Branch</th>
                                                    <th>Channel</th>
                                                    <th>Transactions</th>
                                                    <th>Sales (AED)</th>
                                                    <th>Average per Order</th>
                                                    <th>Offer Type</th>
                                                    <th>Offer Status</th>
                                                    <th>Notes</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="dataTable">
                                                <!-- Table content will be populated by JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="feedback" role="tabpanel">
                                    <div class="table-responsive">
                                        <table class="table table-hover" aria-label="Feedback data table">
                                            <thead>
                                                <tr>
                                                    <th>Date</th>
                                                    <th>Branch</th>
                                                    <th>Rating</th>
                                                    <th>Category</th>
                                                    <th>Comment</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="feedbackTable">
                                                <!-- Feedback table content will be populated by JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Target Plan Page -->
        <div id="target-plan-page" class="page-content" style="display: none;">
            <div class="page-header">
                <h1>Management Target Plan</h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item active">Target Plan</li>
                    </ol>
                </nav>
            </div>

            <!-- Monthly Target Overview -->
            <div class="target-plan-card mb-4">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h3 class="mb-3">October 2025 Target Overview</h3>
                        <div class="target-progress mb-3">
                            <div class="target-progress-bar" id="monthlyTargetProgress" style="width: 0%">
                                0%
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="target-metric">
                                    <span class="target-metric-label">Monthly Target</span>
                                    <span class="target-metric-value" id="monthlyTargetValue">AED 0</span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="target-metric">
                                    <span class="target-metric-label">Current Achievement</span>
                                    <span class="target-metric-value" id="currentAchievementValue">AED 0</span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="target-metric">
                                    <span class="target-metric-label">Remaining</span>
                                    <span class="target-metric-value" id="remainingTargetValue">AED 0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 text-center">
                        <div class="target-summary-grid">
                            <div class="target-summary-item">
                                <div class="target-summary-value" id="daysRemaining">0</div>
                                <div class="target-summary-label">Days Remaining</div>
                            </div>
                            <div class="target-summary-item">
                                <div class="target-summary-value" id="dailyTargetNeeded">AED 0</div>
                                <div class="target-summary-label">Daily Target Needed</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Branch-wise Targets -->
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Branch-wise Target Performance</h5>
                    <div>
                        <button class="btn btn-sm btn-outline-primary me-2" onclick="exportTargetPlan()">
                            <i class="fas fa-download"></i> Export
                        </button>
                        <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#editTargetModal">
                            <i class="fas fa-edit"></i> Edit Targets
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row" id="branchTargetsContainer">
                        <!-- Branch targets will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Target Allocation Chart -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Target Allocation by Branch</h5>
                        </div>
                        <div class="card-body">
                            <div class="target-allocation-chart">
                                <canvas id="targetAllocationChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Target vs Achievement</h5>
                        </div>
                        <div class="card-body">
                            <div class="target-allocation-chart">
                                <canvas id="targetVsAchievementChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Target History and Projections -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Target History & Projections</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="targetHistoryChart"></canvas>
                    </div>
                    <div class="target-timeline">
                        <h6 class="mb-3">Target Milestones</h6>
                        <div id="targetTimeline">
                            <!-- Timeline items will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Management Report Page -->
        <div id="management-report-page" class="page-content" style="display: none;">
            <div class="page-header">
                <h1>Management Report</h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item active">Management Report</li>
                    </ol>
                </nav>
            </div>

            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Executive Summary</h5>
                </div>
                <div class="card-body">
                    <p>This report analyzes Crispy Chicken's sales data from <span id="reportDateRange">October 1-14, 2025</span>. During this period, the company achieved total sales of <span id="reportTotalSales">0</span> AED with <span id="reportTotalTransactions">0</span> transactions completed. The average transaction value was <span id="reportAvgTransaction">0</span> AED. Overall, the company performed well during this period, with particularly strong performance from the Hamdan St and Khaldia branches.</p>
                    <p>During the reporting period, we observed that weekend sales were significantly higher than weekdays, indicating that our marketing activities are more effective on weekends. Additionally, the Ultimate offer type had the highest conversion rate, suggesting we should promote more of these offers in the future.</p>
                </div>
            </div>

            <!-- Monthly Summary Section -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Monthly Summary</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" aria-label="Monthly summary table">
                            <thead>
                                <tr>
                                    <th>Month</th>
                                    <th>Branch</th>
                                    <th>Total Orders</th>
                                    <th>Total Sales (AED)</th>
                                    <th>Average Order (AED)</th>
                                    <th>Growth vs Last Month (%)</th>
                                    <th>Growth vs Last Year (%)</th>
                                    <th>Best Day</th>
                                </tr>
                            </thead>
                            <tbody id="monthlySummaryTable">
                                <!-- Table content will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Branch Performance Analysis</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="branchPerformanceChart"></canvas>
                            </div>
                            <div class="mt-3">
                                <h6>Key Findings:</h6>
                                <ul id="branchPerformanceFindings">
                                    <!-- Findings will be populated by JavaScript -->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Daily & Weekly Performance</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="dailyWeeklyPerformanceChart"></canvas>
                            </div>
                            <div class="mt-3">
                                <h6>Key Findings:</h6>
                                <ul id="dailyWeeklyFindings">
                                    <!-- Findings will be populated by JavaScript -->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Monthly Trend Analysis</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="monthlyTrendChart"></canvas>
                            </div>
                            <div class="mt-3">
                                <h6>Key Findings:</h6>
                                <ul id="monthlyTrendFindings">
                                    <!-- Findings will be populated by JavaScript -->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Target Distribution Plan</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="targetPlanChart"></canvas>
                            </div>
                            <div class="mt-3">
                                <h6>Target Distribution Recommendations:</h6>
                                <ul id="targetPlanFindings">
                                    <!-- Findings will be populated by JavaScript -->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">Customer Feedback Analysis</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="text-center">
                                <h3 id="reportTotalFeedback">0</h3>
                                <p>Total Feedback</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center">
                                <h3 id="reportAvgRating">0.0</h3>
                                <p>Average Rating</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center">
                                <h3 id="reportPositiveFeedback">0%</h3>
                                <p>Positive Feedback (4-5 stars)</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <h6>Top Feedback Categories</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="chart-container" style="height: 250px;">
                                    <canvas id="feedbackCategoryReportChart"></canvas>
                                </div>
                            </div>
="col-md-6">
                                <                            <div classdiv class="chart-container" style="height: 250px;">
                                    <canvas id="feedbackRatingReportChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <h6>Feedback Insights</h6>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i> 
                            <strong>Key Feedback Insights:</strong> 
                            <ul id="feedbackInsightsList">
                                <!-- Insights will be populated by JavaScript -->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">Management Recommendations</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <h6>Short-term Recommendations</h6>
                            <ul id="shortTermManagementRecommendations">
                                <!-- Recommendations will be populated by JavaScript -->
                            </ul>
                        </div>
                        <div class="col-md-4">
                            <h6>Medium-term Strategy Adjustments</h6>
                            <ul id="mediumTermManagementRecommendations">
                                <!-- Recommendations will be populated by JavaScript -->
                            </ul>
                        </div>
                        <div class="col-md-4">
                            <h6>Long-term Development Plans</h6>
                            <ul id="longTermManagementRecommendations">
                                <!-- Recommendations will be populated by JavaScript -->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Feedback Management Page -->
        <div id="feedback-management-page" class="page-content" style="display: none;">
            <div class="page-header">
                <h1>Customer Feedback Management</h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item active">Feedback Management</li>
                    </ol>
                </nav>
            </div>

            <!-- Feedback Summary Cards -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="feedbackTotal">0</div>
                        <div class="metric-label">Total Feedback</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="feedbackAvgRating">0.0</div>
                        <div class="metric-label">Average Rating</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="feedbackPositive">0%</div>
                        <div class="metric-label">Positive Feedback</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="feedbackNegative">0%</div>
                        <div class="metric-label">Negative Feedback</div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Feedback Management Tabs -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Feedback Management</h5>
                </div>
                <div class="card-body">
                    <ul class="nav nav-tabs" id="feedbackManagementTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="feedback-overview-tab" data-bs-toggle="tab" data-bs-target="#feedback-overview" type="button" role="tab" aria-selected="true">Overview</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="feedback-branch-tab" data-bs-toggle="tab" data-bs-target="#feedback-branch" type="button" role="tab" aria-selected="false">Branch Performance</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="feedback-category-tab" data-bs-toggle="tab" data-bs-target="#feedback-category" type="button" role="tab" aria-selected="false">Category Management</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="feedback-list-tab" data-bs-toggle="tab" data-bs-target="#feedback-list" type="button" role="tab" aria-selected="false">Feedback List</button>
                        </li>
                    </ul>
                    
                    <div class="tab-content" id="feedbackManagementTabsContent">
                        <!-- Overview Tab -->
                        <div class="tab-pane fade show active" id="feedback-overview" role="tabpanel">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="mb-0">Feedback by Category</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="chart-container" style="height: 300px;">
                                                <canvas id="feedbackOverviewCategoryChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="mb-0">Rating Distribution</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="chart-container" style="height: 300px;">
                                                <canvas id="feedbackOverviewRatingChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Branch Performance Tab -->
                        <div class="tab-pane fade" id="feedback-branch" role="tabpanel">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5 class="mb-0">Branch Performance Overview</h5>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container" style="height: 300px;">
                                        <canvas id="feedbackBranchPerformanceChart"></canvas>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Branch Performance Metrics</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" aria-label="Branch performance metrics table">
                                            <thead>
                                                <tr>
                                                    <th>Branch</th>
                                                    <th>Total Feedback</th>
                                                    <th>Average Rating</th>
                                                    <th>Positive Feedback</th>
                                                    <th>Negative Feedback</th>
                                                    <th>Most Common Category</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="branchPerformanceTable">
                                                <!-- Branch performance data will be populated by JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Category Management Tab -->
                        <div class="tab-pane fade" id="feedback-category" role="tabpanel">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5 class="mb-0">Category Management</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <h6>Add New Category</h6>
                                            <form id="addCategoryForm">
                                                <div class="mb-3">
                                                    <label for="newCategoryName" class="form-label">Category Name</label>
                                                    <input type="text" class="form-control" id="newCategoryName" required aria-describedby="newCategoryNameHelp">
                                                    <div class="form-text">Enter a unique category name</div>
                                                    <div class="invalid-feedback" id="newCategoryNameFeedback"></div>
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label class="form-label">Category Color</label>
                                                    <div class="category-color-picker" id="categoryColorPicker">
                                                        <div class="color-option selected" style="background-color: #17a2b8;" data-color="#17a2b8"></div>
                                                        <div class="color-option" style="background-color: #ff6b35;" data-color="#ff6b35"></div>
                                                        <div class="color-option" style="background-color: #28a745;" data-color="#28a745"></div>
                                                        <div class="color-option" style="background-color: #ffc107;" data-color="#ffc107"></div>
                                                        <div class="color-option" style="background-color: #dc3545;" data-color="#dc3545"></div>
                                                        <div class="color-option" style="background-color: #6f42c1;" data-color="#6f42c1"></div>
                                                        <div class="color-option" style="background-color: #20c997;" data-color="#20c997"></div>
                                                        <div class="color-option" style="background-color: #fd7e14;" data-color="#fd7e14"></div>
                                                    </div>
                                                </div>
                                                
                                                <button type="submit" class="btn btn-primary">Add Category</button>
                                            </form>
                                        </div>
                                        <div class="col-md-6">
                                            <h6>Existing Categories</h6>
                                            <div id="existingCategories">
                                                <!-- Existing categories will be populated by JavaScript -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Feedback List Tab -->
                        <div class="tab-pane fade" id="feedback-list" role="tabpanel">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Customer Feedback List</h5>
                                </div>
                                <div class="card-body">
                                    <div id="feedbackListContainer">
                                        <!-- Feedback list will be populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Management Page -->
        <div id="data-management-page" class="page-content" style="display: none;">
            <div class="page-header">
                <h1>Advanced Data Management</h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item active">Data Management</li>
                    </ol>
                </nav>
            </div>

            <!-- Data Management Tabs -->
            <ul class="nav nav-tabs mb-4" id="dataManagementTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="save-slots-tab" data-bs-toggle="tab" data-bs-target="#save-slots" type="button" role="tab" aria-selected="true">Save Slots</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="backup-tab" data-bs-toggle="tab" data-bs-target="#backup" type="button" role="tab" aria-selected="false">Backup System</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="recovery-tab" data-bs-toggle="tab" data-bs-target="#recovery" type="button" role="tab" aria-selected="false">Data Recovery</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="import-export-tab" data-bs-toggle="tab" data-bs-target="#import-export" type="button" role="tab" aria-selected="false">Import/Export</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="integrity-tab" data-bs-toggle="tab" data-bs-target="#integrity" type="button" role="tab" aria-selected="false">Data Integrity</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="schedule-tab" data-bs-toggle="tab" data-bs-target="#schedule" type="button" role="tab" aria-selected="false">Backup Schedule</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="cloud-tab" data-bs-toggle="tab" data-bs-target="#cloud" type="button" role="tab" aria-selected="false">Cloud Storage</button>
                </li>
            </ul>

            <div class="tab-content" id="dataManagementTabsContent">
                <!-- Save Slots Tab -->
                <div class="tab-pane fade show active" id="save-slots" role="tabpanel">
                    <div class="card mb-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Save Slots Management</h5>
                            <div>
                                <button class="btn btn-sm btn-outline-primary me-2" onclick="createNewSaveSlot()">
                                    <i class="fas fa-plus"></i> New Save Slot
                                </button>
                                <button class="btn btn-sm btn-outline-success" onclick="quickSave()">
                                    <i class="fas fa-save"></i> Quick Save
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="saveSlotFilter">
                                            <option value="all">All Save Slots</option>
                                            <option value="recent">Recent (Last 7 Days)</option>
                                            <option value="week">This Week</option>
                                            <option value="month">This Month</option>
                                        </select>
                                        <label for="saveSlotFilter">Filter Save Slots</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="saveSlotSearch" placeholder="Search save slots">
                                        <label for="saveSlotSearch">Search Save Slots</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="saveSlotsContainer">
                                <!-- Save slots will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Save Slot Comparison</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-5">
                                    <div class="form-floating">
                                        <select class="form-select" id="compareSlot1">
                                            <option value="">Select First Save Slot</option>
                                        </select>
                                        <label for="compareSlot1">First Save Slot</label>
                                    </div>
                                </div>
                                <div class="col-md-2 d-flex align-items-center justify-content-center">
                                    <span>VS</span>
                                </div>
                                <div class="col-md-5">
                                    <div class="form-floating">
                                        <select class="form-select" id="compareSlot2">
                                            <option value="">Select Second Save Slot</option>
                                        </select>
                                        <label for="compareSlot2">Second Save Slot</label>
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-primary w-100" onclick="compareSaveSlots()">Compare Save Slots</button>
                            
                            <div id="saveSlotComparison" class="mt-4">
                                <!-- Comparison results will be displayed here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Backup Tab -->
                <div class="tab-pane fade" id="backup" role="tabpanel">
                    <div class="card mb-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Backup System</h5>
                            <button class="btn btn-primary" onclick="createBackup()">
                                <i class="fas fa-download"></i> Create Backup
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="backupType">
                                            <option value="full">Full Backup</option>
                                            <option value="incremental">Incremental Backup</option>
                                            <option value="differential">Differential Backup</option>
                                        </select>
                                        <label for="backupType">Backup Type</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="backupLocation">
                                            <option value="local">Local Storage</option>
                                            <option value="cloud">Cloud Storage</option>
                                            <option value="both">Both Locations</option>
                                        </select>
                                        <label for="backupLocation">Backup Location</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="compressBackup" checked>
                                <label class="form-check-label" for="compressBackup">
                                    Compress backup to save space
                                </label>
                            </div>
                            
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="encryptBackup">
                                <label class="form-check-label" for="encryptBackup">
                                    Encrypt backup for security
                                </label>
                            </div>
                            
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i> 
                                <strong>Backup Information:</strong> 
                                <ul class="mb-0">
                                    <li><strong>Full Backup:</strong> Complete backup of all data</li>
                                    <li><strong>Incremental Backup:</strong> Only changes since last backup</li>
                                    <li><strong>Differential Backup:</strong> All changes since last full backup</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Backup History</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="backupFilter">
                                            <option value="all">All Backups</option>
                                            <option value="automatic">Automatic Backups</option>
                                            <option value="manual">Manual Backups</option>
                                            <option value="scheduled">Scheduled Backups</option>
                                        </select>
                                        <label for="backupFilter">Filter Backups</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="backupLocationFilter">
                                            <option value="all">All Locations</option>
                                            <option value="local">Local Storage</option>
                                            <option value="cloud">Cloud Storage</option>
                                        </select>
                                        <label for="backupLocationFilter">Filter by Location</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="backupHistoryContainer">
                                <!-- Backup history will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recovery Tab -->
                <div class="tab-pane fade" id="recovery" role="tabpanel">
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">Data Recovery</h5>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle"></i> 
                                <strong>Warning:</strong> 
                                Recovery will replace your current data. Make sure to create a backup of your current data before proceeding with recovery.
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="recoverySource">
                                            <option value="backup">From Backup</option>
                                            <option value="saveSlot">From Save Slot</option>
                                            <option value="autoRecovery">Auto-Recovery Point</option>
                                        </select>
                                        <label for="recoverySource">Recovery Source</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="recoveryTarget">
                                            <option value="all">All Data</option>
                                            <option value="sales">Sales Data Only</option>
                                            <option value="feedback">Feedback Data Only</option>
                                            <option value="offers">Offers Data Only</option>
                                            <option value="targets">Target Plans Only</option>
                                        </select>
                                        <label for="recoveryTarget">Recovery Target</label>
                                    </div>
                                </div>
                            </div>
                            
                            <button class="btn btn-primary w-100" onclick="searchRecoveryPoints()">Search Recovery Points</button>
                            
                            <div id="recoveryPointsContainer" class="mt-4">
                                <!-- Recovery points will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Auto-Recovery Points</h5>
                        </div>
                        <div class="card-body">
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="enableAutoRecovery" checked>
                                <label class="form-check-label" for="enableAutoRecovery">
                                    Enable automatic recovery points
                                </label>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="number" class="form-control" id="autoRecoveryInterval" value="5" min="1" max="24">
                                        <label for="autoRecoveryInterval">Recovery Point Interval (hours)</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="number" class="form-control" id="maxRecoveryPoints" value="10" min="3" max="30">
                                        <label for="maxRecoveryPoints">Maximum Recovery Points</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i> 
                                <strong>Auto-Recovery Information:</strong> 
                                The system automatically creates recovery points at regular intervals. These points can be used to restore data in case of corruption or accidental deletion.
                            </div>
                            
                            <div id="autoRecoveryPointsContainer">
                                <!-- Auto-recovery points will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Import/Export Tab -->
                <div class="tab-pane fade" id="import-export" role="tabpanel">
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">Import Data</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="importDataType">
                                            <option value="all">All Data</option>
                                            <option value="sales">Sales Data Only</option>
                                            <option value="feedback">Feedback Data Only</option>
                                            <option value="offers">Offers Data Only</option>
                                            <option value="targets">Target Plans Only</option>
                                        </select>
                                        <label for="importDataType">Data Type to Import</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="importFormat">
                                            <option value="json">JSON Format</option>
                                            <option value="excel">Excel Format</option>
                                            <option value="csv">CSV Format</option>
                                        </select>
                                        <label for="importFormat">Import Format</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="validateImport" checked>
                                <label class="form-check-label" for="validateImport">
                                    Validate data before import
                                </label>
                            </div>
                            
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="mergeImport">
                                <label class="form-check-label" for="mergeImport">
                                    Merge with existing data (instead of replacing)
                                </label>
                            </div>
                            
                            <div class="file-drop-area" id="importFileDropArea">
                                <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                                <p class="mb-0">Drag and drop your file here or <a href="#" id="importBrowseLink">browse files</a></p>
                                <input type="file" id="importFileInput" class="d-none" aria-label="Select import file">
                            </div>
                            
                            <div class="progress d-none" id="importProgress">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                            </div>
                            
                            <button class="btn btn-primary w-100 mt-3 d-none" id="importBtn" onclick="performImport()">
                                <i class="fas fa-file-import"></i> Import Data
                            </button>
                            
                            <div id="importValidationResults" class="mt-4">
                                <!-- Import validation results will be displayed here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Export Data</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="exportDataType">
                                            <option value="all">All Data</option>
                                            <option value="sales">Sales Data Only</option>
                                            <option value="feedback">Feedback Data Only</option>
                                            <option value="offers">Offers Data Only</option>
                                            <option value="targets">Target Plans Only</option>
                                        </select>
                                        <label for="exportDataType">Data Type to Export</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="exportFormat">
                                            <option value="json">JSON Format</option>
                                            <option value="excel">Excel Format</option>
                                            <option value="csv">CSV Format</option>
                                            <option value="pdf">PDF Report</option>
                                        </select>
                                        <label for="exportFormat">Export Format</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="date" class="form-control" id="exportStartDate" value="2025-10-01">
                                        <label for="exportStartDate">Start Date</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="date" class="form-control" id="exportEndDate" value="2025-10-14">
                                        <label for="exportEndDate">End Date</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="compressExport">
                                <label class="form-check-label" for="compressExport">
                                    Compress export file
                                </label>
                            </div>
                            
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="includeMetadata" checked>
                                <label class="form-check-label" for="includeMetadata">
                                    Include metadata (timestamps, etc.)
                                </label>
                            </div>
                            
                            <button class="btn btn-primary w-100" onclick="performExport()">
                                <i class="fas fa-file-export"></i> Export Data
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Data Integrity Tab -->
                <div class="tab-pane fade" id="integrity" role="tabpanel">
                    <div class="card mb-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Data Integrity Checks</h5>
                            <button class="btn btn-primary" onclick="runIntegrityCheck()">
                                <i class="fas fa-shield-alt"></i> Run Integrity Check
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="checkSalesData" checked>
                                        <label class="form-check-label" for="checkSalesData">
                                            Check Sales Data
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="checkFeedbackData" checked>
                                        <label class="form-check-label" for="checkFeedbackData">
                                            Check Feedback Data
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="checkOffersData" checked>
                                        <label class="form-check-label" for="checkOffersData">
                                            Check Offers Data
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="checkTargetPlans" checked>
                                        <label class="form-check-label" for="checkTargetPlans">
                                            Check Target Plans
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="checkDataConsistency" checked>
                                        <label class="form-check-label" for="checkDataConsistency">
                                            Check Data Consistency
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="checkDataCompleteness" checked>
                                        <label class="form-check-label" for="checkDataCompleteness">
                                            Check Data Completeness
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i> 
                                <strong>Integrity Check Information:</strong> 
                                The system will check for data corruption, inconsistencies, and missing data. This process may take a few minutes depending on the amount of data.
                            </div>
                            
                            <div id="integrityCheckResults">
                                <!-- Integrity check results will be displayed here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Data Repair Options</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="autoRepairData">
                                        <label class="form-check-label" for="autoRepairData">
                                            Attempt to repair data automatically
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="createBackupBeforeRepair" checked>
                                        <label class="form-check-label" for="createBackupBeforeRepair">
                                            Create backup before attempting repair
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="logRepairActions" checked>
                                        <label class="form-check-label" for="logRepairActions">
                                            Log all repair actions
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="notifyOnRepair" checked>
                                        <label class="form-check-label" for="notifyOnRepair">
                                            Notify on repair completion
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <button class="btn btn-warning w-100" onclick="repairData()">
                                <i class="fas fa-tools"></i> Repair Data Issues
                            </button>
                            
                            <div id="dataRepairResults" class="mt-4">
                                <!-- Data repair results will be displayed here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Backup Schedule Tab -->
                <div class="tab-pane fade" id="schedule" role="tabpanel">
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">Backup Schedule</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="backupFrequency">
                                            <option value="daily">Daily</option>
                                            <option value="weekly">Weekly</option>
                                            <option value="monthly">Monthly</option>
                                            <option value="custom">Custom</option>
                                        </select>
                                        <label for="backupFrequency">Backup Frequency</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="time" class="form-control" id="backupTime" value="02:00">
                                        <label for="backupTime">Backup Time</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mb-3" id="customScheduleOptions" style="display: none;">
                                <div class="col-md-12">
                                    <div class="form-floating">
                                        <input type="number" class="form-control" id="customInterval" value="6" min="1" max="24">
                                        <label for="customInterval">Custom Interval (hours)</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="backupRetention">
                                            <option value="7">Keep for 7 days</option>
                                            <option value="14">Keep for 14 days</option>
                                            <option value="30">Keep for 30 days</option>
                                            <option value="90">Keep for 90 days</option>
                                            <option value="365">Keep for 1 year</option>
                                        </select>
                                        <label for="backupRetention">Backup Retention</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="backupTypeSchedule">
                                            <option value="full">Full Backup</option>
                                            <option value="incremental">Incremental Backup</option>
                                            <option value="differential">Differential Backup</option>
                                        </select>
                                        <label for="backupTypeSchedule">Default Backup Type</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="enableScheduledBackup">
                                <label class="form-check-label" for="enableScheduledBackup">
                                    Enable scheduled backups
                                </label>
                            </div>
                            
                            <button class="btn btn-primary w-100" onclick="saveBackupSchedule()">
                                <i class="fas fa-save"></i> Save Backup Schedule
                            </button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Scheduled Backups</h5>
                        </div>
                        <div class="card-body">
                            <div id="scheduledBackupsContainer">
                                <!-- Scheduled backups will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cloud Storage Tab -->
                <div class="tab-pane fade" id="cloud" role="tabpanel">
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">Cloud Storage Configuration</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="cloudProvider">
                                            <option value="dropbox">Dropbox</option>
                                            <option value="googledrive">Google Drive</option>
                                            <option value="onedrive">OneDrive</option>
                                            <option value="icloud">iCloud</option>
                                            <option value="custom">Custom Cloud Storage</option>
                                        </select>
                                        <label for="cloudProvider">Cloud Storage Provider</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="cloudFolder" placeholder="CrispyChicken/Backups">
                                        <label for="cloudFolder">Cloud Folder Path</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="password" class="form-control" id="cloudApiKey" placeholder="API Key">
                                        <label for="cloudApiKey">API Key / Access Token</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="cloudAccount" placeholder="user@example.com">
                                        <label for="cloudAccount">Account Email</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="enableCloudBackup">
                                <label class="form-check-label" for="enableCloudBackup">
                                    Enable cloud backup
                                </label>
                            </div>
                            
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="encryptCloudBackup" checked>
                                <label class="form-check-label" for="encryptCloudBackup">
                                    Encrypt cloud backups
                                </label>
                            </div>
                            
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="syncToCloud">
                                <label class="form-check-label" for="syncToCloud">
                                    Sync local saves to cloud
                                </label>
                            </div>
                            
                            <button class="btn btn-primary w-100" onclick="saveCloudSettings()">
                                <i class="fas fa-save"></i> Save Cloud Settings
                            </button>
                            
                            <button class="btn btn-outline-primary w-100 mt-2" onclick="testCloudConnection()">
                                <i class="fas fa-plug"></i> Test Cloud Connection
                            </button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Cloud Storage Status</h5>
                        </div>
                        <div class="card-body">
                            <div id="cloudStorageStatus">
                                <!-- Cloud storage status will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Target Modal -->
    <div class="modal fade" id="editTargetModal" tabindex="-1" aria-labelledby="editTargetModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editTargetModalLabel">Edit Monthly Targets</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editTargetForm">
                        <div class="mb-3">
                            <label for="targetMonth" class="form-label">Month</label>
                            <input type="month" class="form-control" id="targetMonth" value="2025-10" required>
                        </div>
                        <div class="mb-3">
                            <label for="totalMonthlyTarget" class="form-label">Total Monthly Target (AED)</label>
                            <input type="number" class="form-control" id="totalMonthlyTarget" min="0" step="100" required>
                            <div class="form-text">Enter the total target for all branches combined</div>
                        </div>
                        <h6>Branch-wise Targets</h6>
                        <div id="branchTargetInputs">
                            <!-- Branch target inputs will be populated by JavaScript -->
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveTargetPlan()">Save Targets</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Offer Modal -->
    <div class="modal fade" id="addOfferModal" tabindex="-1" aria-labelledby="addOfferModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addOfferModalLabel">Add New Offer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addOfferForm">
                        <div class="mb-3">
                            <label for="offerName" class="form-label">Offer Name</label>
                            <input type="text" class="form-control" id="offerName" required>
                        </div>
                        <div class="mb-3">
                            <label for="offerType" class="form-label">Offer Type</label>
                            <select class="form-select" id="offerType" required>
                                <option value="">Select Type</option>
                                <option value="Normal Day">Normal Day</option>
                                <option value="Chicken Day">Chicken Day</option>
                                <option value="Ultimate">Ultimate</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="offerDiscount" class="form-label">Discount (%)</label>
                            <input type="number" class="form-control" id="offerDiscount" min="0" max="100" required>
                        </div>
                        <div class="mb-3">
                            <label for="offerStartDate" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="offerStartDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="offerEndDate" class="form-label">End Date</label>
                            <input type="date" class="form-control" id="offerEndDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="offerStatus" class="form-label">Status</label>
                            <select class="form-select" id="offerStatus" required>
                                <option value="">Select Status</option>
                                <option value="Active">Active</option>
                                <option value="Inactive">Inactive</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addOffer()">Add Offer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div class="modal fade" id="importModal" tabindex="-1" aria-labelledby="importModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="importModalLabel">Import Data</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="importType" class="form-label">Import Type</label>
                        <select class="form-select" id="importType">
                            <option value="sales">Sales Data</option>
                            <option value="feedback">Customer Feedback</option>
                            <option value="both">Both</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="importFile" class="form-label">Select File</label>
                        <input type="file" class="form-control" id="importFile" accept=".xlsx,.xls,.json">
                    </div>
                    <div class="form-text">
                        Supported formats: Excel (.xlsx, .xls) and JSON (.json)
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="performImport()">Import</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
        // Global variables
        let salesData = [];
        let feedbackData = [];
        let offers = [];
        let targetPlan = {};
        let charts = {};
        let undoStack = [];
        let currentPage = 'dashboard';
        
        // Enhanced data management variables
        let saveSlots = [];
        let backups = [];
        let recoveryPoints = [];
        let scheduledBackups = [];
        let cloudSettings = {};
        let backupSchedule = {};
        let dataIntegrityResults = {};
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            loadSampleData();
            loadSampleTargetPlan();
            initializeDataManagement();
            updateDataStats();
            updateDashboard();
            updateFeedbackSummary();
            updateTargetPlan();
            updateRecommendations();
            loadFromLocalStorage();
        });
        
        // Initialize the application
        function initializeApp() {
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('startDate').value = today;
            document.getElementById('endDate').value = today;
            
            // Set current date for forms
            document.getElementById('dateInput').value = today;
            document.getElementById('feedbackDate').value = today;
            
            // Initialize rating input
            initializeRatingInput();
            
            // Initialize file drop area
            initializeFileDropArea();
            
            // Initialize category color picker
            initializeCategoryColorPicker();
        }
        
        // Initialize data management system
        function initializeDataManagement() {
            // Load save slots from localStorage
            loadSaveSlots();
            
            // Load backups from localStorage
            loadBackups();
            
            // Load recovery points from localStorage
            loadRecoveryPoints();
            
            // Load scheduled backups from localStorage
            loadScheduledBackups();
            
            // Load cloud settings from localStorage
            loadCloudSettings();
            
            // Load backup schedule from localStorage
            loadBackupSchedule();
            
            // Initialize data management tabs
            initializeDataManagementTabs();
            
            // Initialize file drop areas
            initializeFileDropAreas();
            
            // Initialize backup frequency change handler
            document.getElementById('backupFrequency').addEventListener('change', function() {
                const customOptions = document.getElementById('customScheduleOptions');
                if (this.value === 'custom') {
                    customOptions.style.display = 'block';
                } else {
                    customOptions.style.display = 'none';
                }
            });
        }
        
        // Initialize data management tabs
        function initializeDataManagementTabs() {
            // Add event listeners for tab changes
            document.querySelectorAll('#dataManagementTabs button').forEach(tab => {
                tab.addEventListener('shown.bs.tab', function(e) {
                    const target = e.target.getAttribute('data-bs-target');
                    
                    switch(target) {
                        case '#save-slots':
                            updateSaveSlots();
                            break;
                        case '#backup':
                            updateBackupHistory();
                            break;
                        case '#recovery':
                            updateRecoveryPoints();
                            break;
                        case '#integrity':
                            updateIntegrityCheckResults();
                            break;
                        case '#schedule':
                            updateScheduledBackups();
                            break;
                        case '#cloud':
                            updateCloudStorageStatus();
                            break;
                    }
                });
            });
        }
        
        // Initialize file drop areas
        function initializeFileDropAreas() {
            // Import file drop area
            const importFileDropArea = document.getElementById('importFileDropArea');
            const importFileInput = document.getElementById('importFileInput');
            const importBrowseLink = document.getElementById('importBrowseLink');
            
            if (importBrowseLink) {
                importBrowseLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    importFileInput.click();
                });
            }
            
            if (importFileInput) {
                importFileInput.addEventListener('change', function() {
                    if (this.files.length > 0) {
                        handleImportFileSelect(this.files[0]);
                    }
                });
            }
            
            if (importFileDropArea) {
                importFileDropArea.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('drag-over');
                });
                
                importFileDropArea.addEventListener('dragleave', function() {
                    this.classList.remove('drag-over');
                });
                
                importFileDropArea.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('drag-over');
                    
                    if (e.dataTransfer.files.length > 0) {
                        handleImportFileSelect(e.dataTransfer.files[0]);
                    }
                });
            }
        }
        
        // Handle import file selection
        function handleImportFileSelect(file) {
            const importFileDropArea = document.getElementById('importFileDropArea');
            const importBtn = document.getElementById('importBtn');
            
            // Update UI to show file selected
            if (importFileDropArea) {
                importFileDropArea.querySelector('p').textContent = `Selected: ${file.name}`;
            }
            
            // Show import button
            if (importBtn) {
                importBtn.classList.remove('d-none');
            }
            
            // Store selected file
            window.selectedImportFile = file;
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Navigation links
            document.querySelectorAll('.navbar-nav .nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const pageId = this.getAttribute('data-page');
                    showPage(pageId);
                });
            });
            
            // Sales data form
            document.getElementById('salesDataForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveSalesData();
            });
            
            // Feedback form
            document.getElementById('feedbackForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveFeedback();
            });
            
            // Add category form
            document.getElementById('addCategoryForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addFeedbackCategory();
            });
            
            // Auto-save toggle
            document.getElementById('autoSaveToggle').addEventListener('change', function() {
                updateSaveStatus();
            });
            
            // Auto-refresh checkbox
            document.getElementById('autoRefresh').addEventListener('change', function() {
                if (this.checked) {
                    updateDashboard();
                }
            });
            
            // Date inputs change event
            document.getElementById('startDate').addEventListener('change', function() {
                if (document.getElementById('autoRefresh').checked) {
                    updateDashboard();
                }
            });
            
            document.getElementById('endDate').addEventListener('change', function() {
                if (document.getElementById('autoRefresh').checked) {
                    updateDashboard();
                }
            });
            
            // Calculate average when sales or transactions change
            document.getElementById('salesInput').addEventListener('input', calculateAverage);
            document.getElementById('transactionsInput').addEventListener('input', calculateAverage);
        }
        
        // Initialize rating input
        function initializeRatingInput() {
            const ratingStars = document.querySelectorAll('#feedbackRating i');
            const ratingValue = document.getElementById('feedbackRatingValue');
            
            ratingStars.forEach(star => {
                star.addEventListener('click', function() {
                    const rating = parseInt(this.getAttribute('data-rating'));
                    ratingValue.value = rating;
                    
                    // Update visual state
                    ratingStars.forEach((s, i) => {
                        if (i < rating) {
                            s.classList.add('active');
                        } else {
                            s.classList.remove('active');
                        }
                    });
                    
                    // Clear validation error
                    document.getElementById('feedbackRating').classList.remove('is-invalid');
                    document.getElementById('feedbackRatingFeedback').textContent = '';
                });
                
                // Keyboard navigation
                star.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        this.click();
                    }
                });
            });
        }
        
        // Initialize file drop area
        function initializeFileDropArea() {
            const fileDropArea = document.getElementById('fileDropArea');
            const fileInput = document.getElementById('excelFileInput');
            const browseLink = document.getElementById('browseLink');
            
            // Browse link click
            browseLink.addEventListener('click', function(e) {
                e.preventDefault();
                fileInput.click();
            });
            
            // File input change
            fileInput.addEventListener('change', function() {
                if (this.files.length > 0) {
                    handleFileSelect(this.files[0]);
                }
            });
            
            // Drag and drop events
            fileDropArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('drag-over');
            });
            
            fileDropArea.addEventListener('dragleave', function() {
                this.classList.remove('drag-over');
            });
            
            fileDropArea.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                
                if (e.dataTransfer.files.length > 0) {
                    handleFileSelect(e.dataTransfer.files[0]);
                }
            });
        }
        
        // Initialize category color picker
        function initializeCategoryColorPicker() {
            const colorOptions = document.querySelectorAll('.color-option');
            colorOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Remove selected class from all options
                    colorOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    // Add selected class to clicked option
                    this.classList.add('selected');
                });
            });
        }
        
        // Handle file selection
        function handleFileSelect(file) {
            const fileDropArea = document.getElementById('fileDropArea');
            const importBtn = document.getElementById('importExcelBtn');
            
            // Update UI to show file selected
            fileDropArea.querySelector('p').textContent = `Selected: ${file.name}`;
            
            // Show import button
            importBtn.classList.remove('d-none');
            
            // Store selected file
            window.selectedFile = file;
        }
        
        // Calculate average per order
        function calculateAverage() {
            const sales = parseFloat(document.getElementById('salesInput').value) || 0;
            const transactions = parseInt(document.getElementById('transactionsInput').value) || 0;
            
            if (transactions > 0) {
                const average = sales / transactions;
                document.getElementById('averageInput').value = average.toFixed(2);
            } else {
                document.getElementById('averageInput').value = '0.00';
            }
        }
        
        // Show page
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(page => {
                page.style.display = 'none';
            });
            
            // Show selected page
            document.getElementById(`${pageId}-page`).style.display = 'block';
            
            // Update navigation
            document.querySelectorAll('.navbar-nav .nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`[data-page="${pageId}"]`).classList.add('active');
            
            // Update current page
            currentPage = pageId;
            
            // Update page-specific content
            switch(pageId) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'data-entry':
                    updateDataStats();
                    updateDataTable();
                    updateFeedbackTable();
                    break;
                case 'management-report':
                    updateManagementReport();
                    break;
                case 'target-plan':
                    updateTargetPlan();
                    break;
                case 'feedback-management':
                    updateFeedbackManagement();
                    break;
                case 'data-management':
                    updateDataManagement();
                    break;
            }
        }
        
        // Set date range
        function setDateRange(range) {
            const today = new Date();
            const startDate = document.getElementById('startDate');
            const endDate = document.getElementById('endDate');
            
            switch(range) {
                case 'today':
                    const todayStr = today.toISOString().split('T')[0];
                    startDate.value = todayStr;
                    endDate.value = todayStr;
                    break;
                case 'yesterday':
                    const yesterday = new Date(today);
                    yesterday.setDate(yesterday.getDate() - 1);
                    const yesterdayStr = yesterday.toISOString().split('T')[0];
                    startDate.value = yesterdayStr;
                    endDate.value = yesterdayStr;
                    break;
                case 'last7days':
                    const lastWeek = new Date(today);
                    lastWeek.setDate(lastWeek.getDate() - 7);
                    startDate.value = lastWeek.toISOString().split('T')[0];
                    endDate.value = today.toISOString().split('T')[0];
                    break;
                case 'last30days':
                    const lastMonth = new Date(today);
                    lastMonth.setDate(lastMonth.getDate() - 30);
                    startDate.value = lastMonth.toISOString().split('T')[0];
                    endDate.value = today.toISOString().split('T')[0];
                    break;
                case 'thismonth':
                    const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
                    startDate.value = firstDayOfMonth.toISOString().split('T')[0];
                    endDate.value = today.toISOString().split('T')[0];
                    break;
                case 'lastmonth':
                    const firstDayOfLastMonth = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                    const lastDayOfLastMonth = new Date(today.getFullYear(), today.getMonth(), 0);
                    startDate.value = firstDayOfLastMonth.toISOString().split('T')[0];
                    endDate.value = lastDayOfLastMonth.toISOString().split('T')[0];
                    break;
            }
            
            updateDashboard();
        }
        
        // Update dashboard
        function updateDashboard() {
            // Get date range
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            // Filter data based on date range
            let filteredSales = salesData.filter(sale => {
                const saleDate = new Date(sale.date);
                return saleDate >= new Date(startDate) && saleDate <= new Date(endDate);
            });
            
            // Apply branch filter
            const branchFilter = document.getElementById('branchFilter').value;
            if (branchFilter !== 'all') {
                filteredSales = filteredSales.filter(sale => sale.branch === branchFilter);
            }
            
            // Apply offer filter
            const offerFilter = document.getElementById('offerFilter').value;
            if (offerFilter !== 'all') {
                filteredSales = filteredSales.filter(sale => sale.offerType === offerFilter);
            }
            
            // Calculate metrics
            const totalSales = filteredSales.reduce((sum, sale) => sum + parseFloat(sale.sales), 0);
            const totalTransactions = filteredSales.reduce((sum, sale) => sum + parseInt(sale.transactions), 0);
            const avgTransaction = totalTransactions > 0 ? totalSales / totalTransactions : 0;
            
            // Calculate dynamic target based on historical data
            const avgDailySales = totalSales / Math.max(1, filteredSales.length);
            const targetSales = avgDailySales * 30; // Monthly target based on average daily sales
            const targetAchievement = targetSales > 0 ? Math.min(100, (totalSales / targetSales) * 100) : 0;
            
            // Update metric cards
            document.getElementById('totalSales').textContent = formatCurrency(totalSales);
            document.getElementById('totalTransactions').textContent = totalTransactions;
            document.getElementById('avgTransaction').textContent = formatCurrency(avgTransaction);
            document.getElementById('targetAchievement').textContent = `${targetAchievement.toFixed(1)}%`;
            
            // Update charts
            updateSalesTrendChart(filteredSales);
            updateBranchSalesChart(filteredSales);
            updateDailySalesTable(filteredSales);
            updatePerformanceCharts(filteredSales);
            updateTrendsCharts(filteredSales);
            updateInsights(filteredSales);
            updateFeedbackAnalysis(filteredSales);
        }
        
        // Format currency
        function formatCurrency(value) {
            return new Intl.NumberFormat('en-AE', {
                style: 'currency',
                currency: 'AED',
                minimumFractionDigits: 2
            }).format(value);
        }
        
        // Update sales trend chart
        function updateSalesTrendChart(data) {
            const ctx = document.getElementById('salesTrendChart');
            if (!ctx) return;
            
            // Group data by date
            const groupedData = {};
            data.forEach(sale => {
                if (!groupedData[sale.date]) {
                    groupedData[sale.date] = 0;
                }
                groupedData[sale.date] += parseFloat(sale.sales);
            });
            
            // Sort dates
            const sortedDates = Object.keys(groupedData).sort();
            
            // Destroy existing chart if it exists
            if (charts.salesTrend) {
                charts.salesTrend.destroy();
            }
            
            // Create new chart
            charts.salesTrend = new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: sortedDates,
                    datasets: [{
                        label: 'Sales (AED)',
                        data: sortedDates.map(date => groupedData[date]),
                        borderColor: '#ff6b35',
                        backgroundColor: 'rgba(255, 107, 53, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Sales: ${formatCurrency(context.parsed.y)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Update branch sales chart
        function updateBranchSalesChart(data) {
            const ctx = document.getElementById('branchSalesChart');
            if (!ctx) return;
            
            // Group data by branch
            const groupedData = {};
            data.forEach(sale => {
                if (!groupedData[sale.branch]) {
                    groupedData[sale.branch] = 0;
                }
                groupedData[sale.branch] += parseFloat(sale.sales);
            });
            
            // Destroy existing chart if it exists
            if (charts.branchSales) {
                charts.branchSales.destroy();
            }
            
            // Create new chart
            charts.branchSales = new Chart(ctx.getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(groupedData),
                    datasets: [{
                        data: Object.values(groupedData),
                        backgroundColor: [
                            '#ff6b35',
                            '#f7931e',
                            '#ffc107',
                            '#28a745',
                            '#17a2b8',
                            '#6f42c1',
                            '#dc3545'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${formatCurrency(context.parsed)}`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Update daily sales table
        function updateDailySalesTable(data) {
            const tbody = document.getElementById('dailySalesTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Sort data by date (newest first)
            const sortedData = [...data].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Limit to 10 records
            const displayData = sortedData.slice(0, 10);
            
            displayData.forEach(sale => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${sale.date}</td>
                    <td>${sale.branch}</td>
                    <td>${sale.channel}</td>
                    <td>${sale.transactions}</td>
                    <td>${formatCurrency(sale.sales)}</td>
                    <td>${formatCurrency(parseFloat(sale.sales) / parseInt(sale.transactions))}</td>
                    <td><span class="offer-badge offer-${sale.offerType.toLowerCase().replace(' ', '')}">${sale.offerType}</span></td>
                    <td><span class="badge ${sale.offerStatus === 'Active' ? 'bg-success' : 'bg-secondary'}">${sale.offerStatus}</span></td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Update performance charts
        function updatePerformanceCharts(data) {
            // Branch performance radar chart
            const radarCtx = document.getElementById('branchPerformanceRadarChart');
            if (!radarCtx) return;
            
            // Group data by branch
            const branchData = {};
            data.forEach(sale => {
                if (!branchData[sale.branch]) {
                    branchData[sale.branch] = {
                        sales: 0,
                        transactions: 0,
                        avgSale: 0
                    };
                }
                branchData[sale.branch].sales += parseFloat(sale.sales);
                branchData[sale.branch].transactions += parseInt(sale.transactions);
            });
            
            // Calculate average sales per branch
            Object.keys(branchData).forEach(branch => {
                const branchInfo = branchData[branch];
                branchInfo.avgSale = branchInfo.transactions > 0 ? branchInfo.sales / branchInfo.transactions : 0;
            });
            
            // Normalize data for radar chart
            const maxSales = Math.max(...Object.values(branchData).map(d => d.sales));
            const maxTransactions = Math.max(...Object.values(branchData).map(d => d.transactions));
            const maxAvgSale = Math.max(...Object.values(branchData).map(d => d.avgSale));
            
            // Destroy existing chart if it exists
            if (charts.branchPerformanceRadar) {
                charts.branchPerformanceRadar.destroy();
            }
            
            // Create new chart
            charts.branchPerformanceRadar = new Chart(radarCtx.getContext('2d'), {
                type: 'radar',
                data: {
                    labels: Object.keys(branchData),
                    datasets: [{
                        label: 'Sales',
                        data: Object.keys(branchData).map(branch => (branchData[branch].sales / maxSales) * 100),
                        borderColor: '#ff6b35',
                        backgroundColor: 'rgba(255, 107, 53, 0.2)'
                    }, {
                        label: 'Transactions',
                        data: Object.keys(branchData).map(branch => (branchData[branch].transactions / maxTransactions) * 100),
                        borderColor: '#f7931e',
                        backgroundColor: 'rgba(247, 147, 30, 0.2)'
                    }, {
                        label: 'Avg. Sale',
                        data: Object.keys(branchData).map(branch => (branchData[branch].avgSale / maxAvgSale) * 100),
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.2)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
            
            // Branch performance ranking chart
            const rankingCtx = document.getElementById('branchPerformanceRankingChart');
            if (!rankingCtx) return;
            
            // Destroy existing chart if it exists
            if (charts.branchPerformanceRanking) {
                charts.branchPerformanceRanking.destroy();
            }
            
            // Create new chart
            charts.branchPerformanceRanking = new Chart(rankingCtx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: Object.keys(branchData),
                    datasets: [{
                        label: 'Total Sales (AED)',
                        data: Object.values(branchData).map(d => d.sales),
                        backgroundColor: '#ff6b35'
                    }, {
                        label: 'Avg. Transaction (AED)',
                        data: Object.values(branchData).map(d => d.avgSale),
                        backgroundColor: '#f7931e'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Update performance metrics
            const bestBranch = Object.keys(branchData).reduce((a, b) => 
                branchData[a].sales > branchData[b].sales ? a : b
            );
            const highestTransactionsBranch = Object.keys(branchData).reduce((a, b) => 
                branchData[a].transactions > branchData[b].transactions ? a : b
            );
            const highestAvgSaleBranch = Object.keys(branchData).reduce((a, b) => 
                branchData[a].avgSale > branchData[b].avgSale ? a : b
            );
            
            const bestBranchEl = document.getElementById('bestBranch');
            const highestTransactionsBranchEl = document.getElementById('highestTransactionsBranch');
            const highestAvgSaleBranchEl = document.getElementById('highestAvgSaleBranch');
            
            if (bestBranchEl) bestBranchEl.textContent = bestBranch;
            if (highestTransactionsBranchEl) highestTransactionsBranchEl.textContent = highestTransactionsBranch;
            if (highestAvgSaleBranchEl) highestAvgSaleBranchEl.textContent = highestAvgSaleBranch;
        }
        
        // Update trends charts
        function updateTrendsCharts(data) {
            // Daily trends chart
            const dailyCtx = document.getElementById('dailyTrendsChart');
            if (!dailyCtx) return;
            
            // Group data by date
            const dailyData = {};
            data.forEach(sale => {
                if (!dailyData[sale.date]) {
                    dailyData[sale.date] = {
                        sales: 0,
                        transactions: 0
                    };
                }
                dailyData[sale.date].sales += parseFloat(sale.sales);
                dailyData[sale.date].transactions += parseInt(sale.transactions);
            });
            
            // Sort dates
            const sortedDates = Object.keys(dailyData).sort();
            
            // Destroy existing chart if it exists
            if (charts.dailyTrends) {
                charts.dailyTrends.destroy();
            }
            
            // Create new chart
            charts.dailyTrends = new Chart(dailyCtx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: sortedDates,
                    datasets: [{
                        label: 'Daily Sales',
                        data: sortedDates.map(date => dailyData[date].sales),
                        borderColor: '#ff6b35',
                        backgroundColor: 'rgba(255, 107, 53, 0.1)',
                        yAxisID: 'y',
                        tension: 0.3
                    }, {
                        label: 'Daily Transactions',
                        data: sortedDates.map(date => dailyData[date].transactions),
                        borderColor: '#17a2b8',
                        backgroundColor: 'rgba(23, 162, 184, 0.1)',
                        yAxisID: 'y1',
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
            
            // Weekly trends chart
            const weeklyCtx = document.getElementById('weeklyTrendsChart');
            if (!weeklyCtx) return;
            
            // Group data by week
            const weeklyData = {};
            data.forEach(sale => {
                const date = new Date(sale.date);
                const weekStart = new Date(date);
                weekStart.setDate(date.getDate() - date.getDay());
                const weekKey = weekStart.toISOString().split('T')[0];
                
                if (!weeklyData[weekKey]) {
                    weeklyData[weekKey] = {
                        sales: 0,
                        transactions: 0
                    };
                }
                weeklyData[weekKey].sales += parseFloat(sale.sales);
                weeklyData[weekKey].transactions += parseInt(sale.transactions);
            });
            
            // Sort weeks
            const sortedWeeks = Object.keys(weeklyData).sort();
            
            // Destroy existing chart if it exists
            if (charts.weeklyTrends) {
                charts.weeklyTrends.destroy();
            }
            
            // Create new chart
            charts.weeklyTrends = new Chart(weeklyCtx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: sortedWeeks.map(week => `Week ${sortedWeeks.indexOf(week) + 1}`),
                    datasets: [{
                        label: 'Weekly Sales',
                        data: sortedWeeks.map(week => weeklyData[week].sales),
                        backgroundColor: '#ff6b35'
                    }, {
                        label: 'Weekly Transactions',
                        data: sortedWeeks.map(week => weeklyData[week].transactions),
                        backgroundColor: '#17a2b8'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
            
            // Moving average chart
            const movingAvgCtx = document.getElementById('movingAverageChart');
            if (!movingAvgCtx) return;
            
            // Calculate moving average
            const windowSize = 3;
            const movingAvgData = [];
            
            sortedDates.forEach((date, index) => {
                if (index >= windowSize - 1) {
                    const window = sortedDates.slice(index - windowSize + 1, index + 1);
                    const avgSales = window.reduce((sum, d) => sum + dailyData[d].sales, 0) / windowSize;
                    movingAvgData.push({
                        date: date,
                        movingAvg: avgSales
                    });
                }
            });
            
            // Destroy existing chart if it exists
            if (charts.movingAverage) {
                charts.movingAverage.destroy();
            }
            
            // Create new chart
            charts.movingAverage = new Chart(movingAvgCtx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: movingAvgData.map(d => d.date),
                    datasets: [{
                        label: 'Moving Average (3 days)',
                        data: movingAvgData.map(d => d.movingAvg),
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.3
                    }, {
                        label: 'Actual Sales',
                        data: movingAvgData.map(d => dailyData[d.date].sales),
                        borderColor: '#ff6b35',
                        backgroundColor: 'rgba(255, 107, 53, 0.1)',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Update insights
        function updateInsights(data) {
            const anomalyText = document.getElementById('anomalyText');
            const predictionText = document.getElementById('predictionText');
            const keyFindingsList = document.getElementById('keyFindingsList');
            
            if (!anomalyText || !predictionText || !keyFindingsList) return;
            
            // Calculate average daily sales
            const dailySales = {};
            data.forEach(sale => {
                if (!dailySales[sale.date]) {
                    dailySales[sale.date] = 0;
                }
                dailySales[sale.date] += parseFloat(sale.sales);
            });
            
            const salesValues = Object.values(dailySales);
            const avgSales = salesValues.reduce((a, b) => a + b, 0) / salesValues.length;
            const stdDev = Math.sqrt(salesValues.reduce((sum, val) => sum + Math.pow(val - avgSales, 2), 0) / salesValues.length);
            
            // Find anomalies (values outside 2 standard deviations)
            const anomalies = salesValues.filter(val => Math.abs(val - avgSales) > 2 * stdDev);
            
            if (anomalies.length > 0) {
                anomalyText.textContent = `Detected ${anomalies.length} anomaly${anomalies.length > 1 ? 'ies' : ''} in daily sales. Values outside normal range: ${anomalies.map(a => formatCurrency(a)).join(', ')}`;
            } else {
                anomalyText.textContent = 'No anomalies detected in daily sales data.';
            }
            
            // Simple linear regression for trend
            const n = salesValues.length;
            const xValues = Array.from({length: n}, (_, i) => i);
            const yValues = salesValues;
            
            const sumX = xValues.reduce((a, b) => a + b, 0);
            const sumY = yValues.reduce((a, b) => a + b, 0);
            const sumXY = xValues.reduce((sum, x, i) => sum + x * yValues[i], 0);
            const sumXX = xValues.reduce((sum, x) => sum + x * x, 0);
            
            const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;
            
            // Predict next day
            const nextDay = n;
            const nextDayPrediction = slope * nextDay + intercept;
            
            predictionText.textContent = `Based on current trend, predicted sales for next day: ${formatCurrency(nextDayPrediction)}`;
            
            // Generate data-driven findings
            const findings = generateDataDrivenFindings(data);
            
            keyFindingsList.innerHTML = '';
            findings.forEach(finding => {
                const li = document.createElement('li');
                li.className = 'list-group-item';
                li.textContent = finding;
                keyFindingsList.appendChild(li);
            });
        }
        
        // Generate data-driven findings
        function generateDataDrivenFindings(data) {
            const findings = [];
            
            // Group data by day of week
            const dayOfWeekData = {};
            data.forEach(sale => {
                const dayOfWeek = new Date(sale.date).toLocaleDateString('en-US', { weekday: 'long' });
                if (!dayOfWeekData[dayOfWeek]) {
                    dayOfWeekData[dayOfWeek] = { sales: 0, transactions: 0 };
                }
                dayOfWeekData[dayOfWeek].sales += parseFloat(sale.sales);
                dayOfWeekData[dayOfWeek].transactions += parseInt(sale.transactions);
            });
            
            // Find best performing day
            const bestDay = Object.keys(dayOfWeekData).reduce((a, b) => 
                dayOfWeekData[a].sales > dayOfWeekData[b].sales ? a : b
            );
            const worstDay = Object.keys(dayOfWeekData).reduce((a, b) => 
                dayOfWeekData[a].sales < dayOfWeekData[b].sales ? a : b
            );
            
            findings.push(`${bestDay} is the best performing day with ${formatCurrency(dayOfWeekData[bestDay].sales)} in sales`);
            findings.push(`${worstDay} shows the lowest sales at ${formatCurrency(dayOfWeekData[worstDay].sales)}`);
            
            // Analyze offer performance
            const offerData = {};
            data.forEach(sale => {
                if (!offerData[sale.offerType]) {
                    offerData[sale.offerType] = { sales: 0, transactions: 0 };
                }
                offerData[sale.offerType].sales += parseFloat(sale.sales);
                offerData[sale.offerType].transactions += parseInt(sale.transactions);
            });
            
            const bestOffer = Object.keys(offerData).reduce((a, b) => 
                offerData[a].sales > offerData[b].sales ? a : b
            );
            
            findings.push(`${bestOffer} offer generates the highest revenue at ${formatCurrency(offerData[bestOffer].sales)}`);
            
            // Branch performance
            const branchData = {};
            data.forEach(sale => {
                if (!branchData[sale.branch]) {
                    branchData[sale.branch] = 0;
                }
                branchData[sale.branch] += parseFloat(sale.sales);
            });
            
            const topBranch = Object.keys(branchData).reduce((a, b) => 
                branchData[a] > branchData[b] ? a : b
            );
            
            const totalSales = Object.values(branchData).reduce((a, b) => a + b, 0);
            const topBranchPercentage = ((branchData[topBranch] / totalSales) * 100).toFixed(1);
            
            findings.push(`${topBranch} leads with ${topBranchPercentage}% of total sales`);
            
            return findings;
        }
        
        // Update feedback analysis
        function updateFeedbackAnalysis(data) {
            // Get feedback data for the date range
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            const filteredFeedback = feedbackData.filter(feedback => {
                const feedbackDate = new Date(feedback.date);
                return feedbackDate >= new Date(startDate) && feedbackDate <= new Date(endDate);
            });
            
            // Update summary cards
            const totalFeedback = filteredFeedback.length;
            const avgRating = totalFeedback > 0 
                ? (filteredFeedback.reduce((sum, f) => sum + f.rating, 0) / totalFeedback).toFixed(1)
                : '0.0';
            
            const positiveFeedback = totalFeedback > 0 
                ? ((filteredFeedback.filter(f => f.rating >= 4).length / totalFeedback) * 100).toFixed(1)
                : '0';
            
            // Update dashboard feedback metrics
            const totalFeedbackEl = document.getElementById('totalFeedback');
            const avgRatingEl = document.getElementById('avgRating');
            const positiveFeedbackEl = document.getElementById('positiveFeedback');
            
            if (totalFeedbackEl) totalFeedbackEl.textContent = totalFeedback;
            if (avgRatingEl) avgRatingEl.textContent = avgRating;
            if (positiveFeedbackEl) positiveFeedbackEl.textContent = `${positiveFeedback}%`;
            
            // Feedback by category chart
            const categoryCtx = document.getElementById('feedbackCategoryChart');
            if (categoryCtx) {
                // Group feedback by category
                const categoryData = {};
                filteredFeedback.forEach(feedback => {
                    if (!categoryData[feedback.category]) {
                        categoryData[feedback.category] = 0;
                    }
                    categoryData[feedback.category]++;
                });
                
                // Destroy existing chart if it exists
                if (charts.feedbackCategory) {
                    charts.feedbackCategory.destroy();
                }
                
                // Create new chart
                charts.feedbackCategory = new Chart(categoryCtx.getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: Object.keys(categoryData),
                        datasets: [{
                            data: Object.values(categoryData),
                            backgroundColor: [
                                '#17a2b8',
                                '#ff6b35',
                                '#28a745',
                                '#ffc107'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right'
                            }
                        }
                    }
                });
            }
            
            // Rating distribution chart
            const ratingCtx = document.getElementById('ratingDistributionChart');
            if (ratingCtx) {
                // Group feedback by rating
                const ratingData = {
                    '5': 0,
                    '4': 0,
                    '3': 0,
                    '2': 0,
                    '1': 0
                };
                
                filteredFeedback.forEach(feedback => {
                    ratingData[feedback.rating.toString()]++;
                });
                
                // Destroy existing chart if it exists
                if (charts.ratingDistribution) {
                    charts.ratingDistribution.destroy();
                }
                
                // Create new chart
                charts.ratingDistribution = new Chart(ratingCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(ratingData),
                        datasets: [{
                            label: 'Number of Ratings',
                            data: Object.values(ratingData),
                            backgroundColor: [
                                '#28a745',
                                '#28a745',
                                '#ffc107',
                                '#dc3545',
                                '#dc3545'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        }
                    }
                });
            }
            
            // Recent feedback list
            const recentFeedbackList = document.getElementById('recentFeedbackList');
            if (recentFeedbackList) {
                recentFeedbackList.innerHTML = '';
                
                // Sort feedback by date (newest first)
                const sortedFeedback = [...filteredFeedback].sort((a, b) => 
                    new Date(b.date) - new Date(a.date)
                );
                
                // Limit to 5 recent feedback
                const displayFeedback = sortedFeedback.slice(0, 5);
                
                displayFeedback.forEach(feedback => {
                    const feedbackCard = document.createElement('div');
                    feedbackCard.className = 'feedback-card';
                    
                    const ratingStars = '★'.repeat(feedback.rating) + '☆'.repeat(5 - feedback.rating);
                    
                    feedbackCard.innerHTML = `
                        <h6>${feedback.branch} - ${feedback.date}</h6>
                        <p>${feedback.comment}</p>
                        <div class="feedback-meta">
                            <span class="feedback-category category-${feedback.category.toLowerCase()}">${feedback.category}</span>
                            <span>${ratingStars} (${feedback.rating}/5)</span>
                        </div>
                    `;
                    
                    recentFeedbackList.appendChild(feedbackCard);
                });
            }
        }
        
        // Update data stats
        function updateDataStats() {
            const salesRecordsCountEl = document.getElementById('salesRecordsCount');
            const offersCountEl = document.getElementById('offersCount');
            const feedbackCountEl = document.getElementById('feedbackCount');
            const totalDataSizeEl = document.getElementById('totalDataSize');
            
            if (salesRecordsCountEl) salesRecordsCountEl.textContent = salesData.length;
            if (offersCountEl) offersCountEl.textContent = offers.length;
            if (feedbackCountEl) feedbackCountEl.textContent = feedbackData.length;
            
            // Calculate total data size
            const dataSize = new Blob([JSON.stringify(salesData)]).size;
            const feedbackSize = new Blob([JSON.stringify(feedbackData)]).size;
            const offersSize = new Blob([JSON.stringify(offers)]).size;
            const totalSize = (dataSize + feedbackSize + offersSize) / 1024; // KB
            
            if (totalDataSizeEl) totalDataSizeEl.textContent = `${totalSize.toFixed(2)} KB`;
        }
        
        // Update data table
        function updateDataTable() {
            const tbody = document.getElementById('dataTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Sort data by date (newest first)
            const sortedData = [...salesData].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedData.forEach((sale, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${sale.date}</td>
                    <td>${sale.branch}</td>
                    <td>${sale.channel}</td>
                    <td>${sale.transactions}</td>
                    <td>${formatCurrency(sale.sales)}</td>
                    <td>${formatCurrency(parseFloat(sale.sales) / parseInt(sale.transactions))}</td>
                    <td><span class="offer-badge offer-${sale.offerType.toLowerCase().replace(' ', '')}">${sale.offerType}</span></td>
                    <td><span class="badge ${sale.offerStatus === 'Active' ? 'bg-success' : 'bg-secondary'}">${sale.offerStatus}</span></td>
                    <td>${sale.notes || '-'}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteSalesRecord(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Update feedback table
        function updateFeedbackTable() {
            const tbody = document.getElementById('feedbackTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Sort data by date (newest first)
            const sortedFeedback = [...feedbackData].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedFeedback.forEach((feedback, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${feedback.date}</td>
                    <td>${feedback.branch}</td>
                    <td>${'★'.repeat(feedback.rating)} (${feedback.rating}/5)</td>
                    <td><span class="feedback-category category-${feedback.category.toLowerCase()}">${feedback.category}</span></td>
                    <td>${feedback.comment}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteFeedbackRecord(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Save sales data
        function saveSalesData() {
            try {
                // Get form values
                const formData = {
                    date: document.getElementById('dateInput').value,
                    branch: document.getElementById('branchInput').value,
                    channel: document.getElementById('channelInput').value,
                    transactions: parseInt(document.getElementById('transactionsInput').value),
                    sales: parseFloat(document.getElementById('salesInput').value),
                    average: parseFloat(document.getElementById('averageInput').value),
                    offerType: document.getElementById('offerTypeInput').value,
                    offerStatus: document.getElementById('offerStatusInput').value,
                    notes: document.getElementById('notesInput').value
                };
                
                // Validate form
                if (!validateSalesForm(formData)) {
                    return;
                }
                
                // Add to data array
                salesData.push(formData);
                
                // Add to undo stack
                undoStack.push({
                    action: 'add',
                    type: 'sales',
                    data: formData
                });
                
                // Update all UI components
                updateAllUI();
                
                // Reset form
                document.getElementById('salesDataForm').reset();
                document.getElementById('averageInput').value = '0.00';
                
                // Show notification
                showNotification('Sales data saved successfully!', 'success');
                
                // Auto-save if enabled
                if (document.getElementById('autoSaveToggle').checked) {
                    autoSave();
                }
                
                // Save to local storage
                saveToLocalStorage();
            } catch (error) {
                console.error('Error saving sales data:', error);
                showNotification(`Error saving data: ${error.message}`, 'danger');
            }
        }
        
        // Update all UI components after data change
        function updateAllUI() {
            updateDataStats();
            updateDataTable();
            updateFeedbackTable();
            updateDashboard();
            updateFeedbackSummary();
            updateManagementReport();
            updateFeedbackManagement();
            updateTargetPlan();
            updateOffersTable();
            
            // Update undo status
            const undoStatusEl = document.getElementById('undoStatus');
            if (undoStatusEl) {
                undoStatusEl.textContent = undoStack.length > 0 ? `${undoStack.length} actions available` : 'No actions to undo';
            }
        }
        
        // Validate sales form
        function validateSalesForm(data) {
            let isValid = true;
            
            // Clear previous validation
            document.querySelectorAll('.is-invalid').forEach(el => el.classList.remove('is-invalid'));
            document.querySelectorAll('.invalid-feedback').forEach(el => el.textContent = '');
            
            // Date validation
            if (!data.date || !isValidDate(data.date)) {
                document.getElementById('dateInput').classList.add('is-invalid');
                document.getElementById('dateInputFeedback').textContent = 'Valid date is required';
                isValid = false;
            }
            
            // Branch validation
            if (!data.branch || !isValidBranch(data.branch)) {
                document.getElementById('branchInput').classList.add('is-invalid');
                document.getElementById('branchInputFeedback').textContent = 'Valid branch is required';
                isValid = false;
            }
            
            // Channel validation
            if (!data.channel || !isValidChannel(data.channel)) {
                document.getElementById('channelInput').classList.add('is-invalid');
                document.getElementById('channelInputFeedback').textContent = 'Valid channel is required';
                isValid = false;
            }
            
            // Transactions validation
            if (isNaN(data.transactions) || data.transactions <= 0) {
                document.getElementById('transactionsInput').classList.add('is-invalid');
                document.getElementById('transactionsInputFeedback').textContent = 'Valid number of transactions is required';
                isValid = false;
            }
            
            // Sales validation
            if (isNaN(data.sales) || data.sales <= 0) {
                document.getElementById('salesInput').classList.add('is-invalid');
                document.getElementById('salesInputFeedback').textContent = 'Valid sales amount is required';
                isValid = false;
            }
            
            // Offer type validation
            if (!data.offerType || !isValidOfferType(data.offerType)) {
                document.getElementById('offerTypeInput').classList.add('is-invalid');
                document.getElementById('offerTypeInputFeedback').textContent = 'Valid offer type is required';
                isValid = false;
            }
            
            // Offer status validation
            if (!data.offerStatus || !isValidOfferStatus(data.offerStatus)) {
                document.getElementById('offerStatusInput').classList.add('is-invalid');
                document.getElementById('offerStatusInputFeedback').textContent = 'Valid offer status is required';
                isValid = false;
            }
            
            return isValid;
        }
        
        // Validation helper functions
        function isValidDate(dateString) {
            const date = new Date(dateString);
            return date instanceof Date && !isNaN(date);
        }
        
        function isValidBranch(branch) {
            const validBranches = [
                'Crispy Chicken-Hamdan St',
                'Crispy Chicken Khaldia',
                'Crispy Chicken Shabiya 11',
                'Crispy Chicken Muroor',
                'Crispy Chicken Al Barsha',
                'Crispy Chicken Al Satwa',
                'Crispy Chicken Al Rgga'
            ];
            return validBranches.includes(branch);
        }
        
        function isValidChannel(channel) {
            const validChannels = ['Delivery', 'Dine-in', 'Takeaway'];
            return validChannels.includes(channel);
        }
        
        function isValidOfferType(type) {
            const validTypes = ['Normal Day', 'Chicken Day', 'Ultimate'];
            return validTypes.includes(type);
        }
        
        function isValidOfferStatus(status) {
            const validStatuses = ['Active', 'No Offer'];
            return validStatuses.includes(status);
        }
        
        // Save feedback
        function saveFeedback() {
            try {
                // Get form values
                const formData = {
                    date: document.getElementById('feedbackDate').value,
                    branch: document.getElementById('feedbackBranch').value,
                    rating: parseInt(document.getElementById('feedbackRatingValue').value),
                    category: document.getElementById('feedbackCategory').value,
                    comment: document.getElementById('feedbackComment').value
                };
                
                // Validate form
                if (!validateFeedbackForm(formData)) {
                    return;
                }
                
                // Add to data array
                feedbackData.push(formData);
                
                // Add to undo stack
                undoStack.push({
                    action: 'add',
                    type: 'feedback',
                    data: formData
                });
                
                // Update all UI components
                updateAllUI();
                
                // Reset form
                document.getElementById('feedbackForm').reset();
                document.getElementById('feedbackRatingValue').value = '0';
                document.querySelectorAll('#feedbackRating i').forEach(star => {
                    star.classList.remove('active');
                });
                
                // Show notification
                showNotification('Feedback submitted successfully!', 'success');
                
                // Auto-save if enabled
                if (document.getElementById('autoSaveToggle').checked) {
                    autoSave();
                }
                
                // Save to local storage
                saveToLocalStorage();
            } catch (error) {
                console.error('Error saving feedback:', error);
                showNotification(`Error saving feedback: ${error.message}`, 'danger');
            }
        }
        
        // Validate feedback form
        function validateFeedbackForm(data) {
            let isValid = true;
            
            // Clear previous validation
            document.querySelectorAll('.is-invalid').forEach(el => el.classList.remove('is-invalid'));
            document.querySelectorAll('.invalid-feedback').forEach(el => el.textContent = '');
            
            // Date validation
            if (!data.date || !isValidDate(data.date)) {
                document.getElementById('feedbackDate').classList.add('is-invalid');
                document.getElementById('feedbackDateFeedback').textContent = 'Valid date is required';
                isValid = false;
            }
            
            // Branch validation
            if (!data.branch || !isValidBranch(data.branch)) {
                document.getElementById('feedbackBranch').classList.add('is-invalid');
                document.getElementById('feedbackBranchFeedback').textContent = 'Valid branch is required';
                isValid = false;
            }
            
            // Rating validation
            if (!data.rating || data.rating < 1) {
                document.getElementById('feedbackRating').classList.add('is-invalid');
                document.getElementById('feedbackRatingFeedback').textContent = 'Please select a rating';
                isValid = false;
            }
            
            // Category validation
            if (!data.category || !isValidFeedbackCategory(data.category)) {
                document.getElementById('feedbackCategory').classList.add('is-invalid');
                document.getElementById('feedbackCategoryFeedback').textContent = 'Valid category is required';
                isValid = false;
            }
            
            // Comment validation
            if (!data.comment || data.comment.trim().length < 10) {
                document.getElementById('feedbackComment').classList.add('is-invalid');
                document.getElementById('feedbackCommentFeedback').textContent = 'Please provide at least 10 characters for your comment';
                isValid = false;
            }
            
            return isValid;
        }
        
        function isValidFeedbackCategory(category) {
            const validCategories = ['Service', 'Food', 'Cleanliness', 'Other'];
            return validCategories.includes(category);
        }
        
        // Delete sales record
        function deleteSalesRecord(index) {
            if (confirm('Are you sure you want to delete this sales record?')) {
                const deletedRecord = salesData.splice(index, 1)[0];
                
                // Add to undo stack
                undoStack.push({
                    action: 'delete',
                    type: 'sales',
                    data: deletedRecord,
                    index: index
                });
                
                // Update all UI components
                updateAllUI();
                
                // Show notification
                showNotification('Sales record deleted successfully!', 'warning');
                
                // Auto-save if enabled
                if (document.getElementById('autoSaveToggle').checked) {
                    autoSave();
                }
                
                // Save to local storage
                saveToLocalStorage();
            }
        }
        
        // Delete feedback record
        function deleteFeedbackRecord(index) {
            if (confirm('Are you sure you want to delete this feedback record?')) {
                const deletedRecord = feedbackData.splice(index, 1)[0];
                
                // Add to undo stack
                undoStack.push({
                    action: 'delete',
                    type: 'feedback',
                    data: deletedRecord,
                    index: index
                });
                
                // Update all UI components
                updateAllUI();
                
                // Show notification
                showNotification('Feedback record deleted successfully!', 'warning');
                
                // Auto-save if enabled
                if (document.getElementById('autoSaveToggle').checked) {
                    autoSave();
                }
                
                // Save to local storage
                saveToLocalStorage();
            }
        }
        
        // Update save status
        function updateSaveStatus() {
            const statusElement = document.getElementById('saveStatus');
            const autoSaveToggle = document.getElementById('autoSaveToggle');
            
            if (autoSaveToggle.checked) {
                statusElement.textContent = 'Auto-save enabled';
                statusElement.className = 'save-status save-saved';
            } else {
                statusElement.textContent = 'Auto-save disabled';
                statusElement.className = 'save-status save-unsaved';
            }
        }
        
        // Save data
        function saveData() {
            // Simulate saving
            showLoadingOverlay(true);
            
            setTimeout(() => {
                showNotification('Data saved successfully!', 'success');
                const lastSavedTimeEl = document.getElementById('lastSavedTime');
                if (lastSavedTimeEl) lastSavedTimeEl.textContent = new Date().toLocaleString();
                
                const saveStatusEl = document.getElementById('saveStatus');
                if (saveStatusEl) {
                    saveStatusEl.textContent = 'Saved';
                    saveStatusEl.className = 'save-status save-saved';
                }
                showLoadingOverlay(false);
                
                // Save to local storage
                saveToLocalStorage();
            }, 1000);
        }
        
        // Auto-save
        function autoSave() {
            const statusElement = document.getElementById('saveStatus');
            if (statusElement) {
                statusElement.textContent = 'Saving...';
                statusElement.className = 'save-status save-saving';
            }
            
            // Simulate auto-save
            setTimeout(() => {
                if (statusElement) {
                    statusElement.textContent = 'Saved';
                    statusElement.className = 'save-status save-saved';
                }
                
                const lastSavedTimeEl = document.getElementById('lastSavedTime');
                if (lastSavedTimeEl) lastSavedTimeEl.textContent = new Date().toLocaleString();
                
                // Save to local storage
                saveToLocalStorage();
            }, 500);
        }
        
        // Export data
        function exportData() {
            try {
                // Prepare data for export
                const exportData = {
                    salesData: salesData,
                    feedbackData: feedbackData,
                    offers: offers,
                    targetPlan: targetPlan,
                    exportDate: new Date().toISOString()
                };
                
                // Create blob
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                // Create download link
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `crispy-chicken-data-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                // Clean up
                URL.revokeObjectURL(url);
                
                showNotification('Data exported successfully!', 'success');
            } catch (error) {
                console.error('Error exporting data:', error);
                showNotification(`Error exporting data: ${error.message}`, 'danger');
            }
        }
        
        // Show import modal
        function showImportModal() {
            const importModal = new bootstrap.Modal(document.getElementById('importModal'));
            importModal.show();
        }
        
        // Perform import
        function performImport() {
            const importType = document.getElementById('importType').value;
            const importFile = document.getElementById('importFile').files[0];
            
            if (!importFile) {
                showNotification('Please select a file to import', 'warning');
                return;
            }
            
            // Read file
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    
                    if (importFile.name.endsWith('.json')) {
                        // JSON import
                        const importedData = JSON.parse(content);
                        
                        if (importType === 'sales' || importType === 'both') {
                            if (importedData.salesData && Array.isArray(importedData.salesData)) {
                                salesData = importedData.salesData;
                                showNotification(`${importedData.salesData.length} sales records imported!`, 'success');
                            }
                        }
                        
                        if (importType === 'feedback' || importType === 'both') {
                            if (importedData.feedbackData && Array.isArray(importedData.feedbackData)) {
                                feedbackData = importedData.feedbackData;
                                showNotification(`${importedData.feedbackData.length} feedback records imported!`, 'success');
                            }
                        }
                        
                        if (importedData.offers && Array.isArray(importedData.offers)) {
                            offers = importedData.offers;
                        }
                        
                        if (importedData.targetPlan && typeof importedData.targetPlan === 'object') {
                            targetPlan = importedData.targetPlan;
                        }
                    } else if (importFile.name.endsWith('.xlsx') || importFile.name.endsWith('.xls')) {
                        // Excel import (simplified for demo)
                        showNotification('Excel import functionality would be implemented here', 'info');
                        return;
                    }
                    
                    // Update UI
                    updateAllUI();
                    
                    // Close modal
                    const importModal = bootstrap.Modal.getInstance(document.getElementById('importModal'));
                    if (importModal) importModal.hide();
                    
                    // Save to local storage
                    saveToLocalStorage();
                    
                } catch (error) {
                    showNotification('Error importing data: ' + error.message, 'danger');
                }
            };
            
            reader.readAsText(importFile);
        }
        
        // Clear all data
        function clearAllData() {
            if (confirm('Are you sure you want to clear all data? This action cannot be undone.')) {
                // Clear all data arrays
                salesData = [];
                feedbackData = [];
                offers = [];
                targetPlan = {};
                
                // Clear undo stack
                undoStack = [];
                
                // Clear LocalStorage
                localStorage.removeItem('crispyChickenData');
                
                // Update all UI components
                updateAllUI();
                
                // Clear forms
                const salesForm = document.getElementById('salesDataForm');
                if (salesForm) {
                    salesForm.reset();
                    document.getElementById('averageInput').value = '0.00';
                }
                
                const feedbackForm = document.getElementById('feedbackForm');
                if (feedbackForm) {
                    feedbackForm.reset();
                    document.getElementById('feedbackRatingValue').value = '0';
                    document.querySelectorAll('#feedbackRating i').forEach(star => {
                        star.classList.remove('active');
                    });
                }
                
                // Reset date inputs to today
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('startDate').value = today;
                document.getElementById('endDate').value = today;
                document.getElementById('dateInput').value = today;
                document.getElementById('feedbackDate').value = today;
                
                // Reset filters
                document.getElementById('branchFilter').value = 'all';
                document.getElementById('offerFilter').value = 'all';
                
                // Clear tables
                const dataTable = document.getElementById('dataTable');
                if (dataTable) dataTable.innerHTML = '';
                
                const feedbackTable = document.getElementById('feedbackTable');
                if (feedbackTable) feedbackTable.innerHTML = '';
                
                const offersTable = document.getElementById('offersTable');
                if (offersTable) offersTable.innerHTML = '';
                
                const dailySalesTable = document.getElementById('dailySalesTable');
                if (dailySalesTable) dailySalesTable.innerHTML = '';
                
                // Clear feedback lists
                const recentFeedbackList = document.getElementById('recentFeedbackList');
                if (recentFeedbackList) recentFeedbackList.innerHTML = '';
                
                const feedbackListContainer = document.getElementById('feedbackListContainer');
                if (feedbackListContainer) feedbackListContainer.innerHTML = '';
                
                // Clear findings and recommendations
                const keyFindingsList = document.getElementById('keyFindingsList');
                if (keyFindingsList) keyFindingsList.innerHTML = '';
                
                const shortTermRecommendations = document.getElementById('shortTermRecommendations');
                if (shortTermRecommendations) shortTermRecommendations.innerHTML = '';
                
                const mediumTermRecommendations = document.getElementById('mediumTermRecommendations');
                if (mediumTermRecommendations) mediumTermRecommendations.innerHTML = '';
                
                const longTermRecommendations = document.getElementById('longTermRecommendations');
                if (longTermRecommendations) longTermRecommendations.innerHTML = '';
                
                // Reset save status
                const saveStatusEl = document.getElementById('saveStatus');
                if (saveStatusEl) {
                    saveStatusEl.textContent = 'No data';
                    saveStatusEl.className = 'save-status save-unsaved';
                }
                
                const lastSavedTimeEl = document.getElementById('lastSavedTime');
                if (lastSavedTimeEl) lastSavedTimeEl.textContent = 'Never';
                
                // Reset undo status
                const undoStatusEl = document.getElementById('undoStatus');
                if (undoStatusEl) undoStatusEl.textContent = 'No actions to undo';
                
                // Clear anomaly and prediction text
                const anomalyTextEl = document.getElementById('anomalyText');
                if (anomalyTextEl) anomalyTextEl.textContent = 'No data available for analysis';
                
                const predictionTextEl = document.getElementById('predictionText');
                if (predictionTextEl) predictionTextEl.textContent = 'No data available for prediction';
                
                // Show success notification
                showNotification('All data cleared successfully!', 'warning');
                
                // Re-initialize dashboard with empty data
                if (currentPage === 'dashboard') {
                    setTimeout(() => {
                        updateDashboard();
                    }, 100);
                }
            }
        }
        
        // Reset to sample data
        function resetToSample() {
            if (confirm('Are you sure you want to reset to sample data? This will replace all current data.')) {
                loadSampleData();
                loadSampleTargetPlan();
                updateAllUI();
                
                showNotification('Data reset to sample data successfully!', 'success');
                
                // Save to local storage
                saveToLocalStorage();
            }
        }
        
        // Load sample data
        function loadSampleData() {
            // Sample sales data
            salesData = [
                {
                    date: '2025-10-01',
                    branch: 'Crispy Chicken-Hamdan St',
                    channel: 'Dine-in',
                    transactions: 45,
                    sales: 2250.00,
                    average: 50.00,
                    offerType: 'Normal Day',
                    offerStatus: 'No Offer',
                    notes: 'Good start to the month'
                },
                {
                    date: '2025-10-01',
                    branch: 'Crispy Chicken Khaldia',
                    channel: 'Delivery',
                    transactions: 32,
                    sales: 1600.00,
                    average: 50.00,
                    offerType: 'Normal Day',
                    offerStatus: 'No Offer',
                    notes: ''
                },
                {
                    date: '2025-10-02',
                    branch: 'Crispy Chicken-Hamdan St',
                    channel: 'Takeaway',
                    transactions: 38,
                    sales: 1900.00,
                    average: 50.00,
                    offerType: 'Chicken Day',
                    offerStatus: 'Active',
                    notes: 'Chicken Day promotion successful'
                },
                {
                    date: '2025-10-03',
                    branch: 'Crispy Chicken Al Barsha',
                    channel: 'Dine-in',
                    transactions: 28,
                    sales: 1680.00,
                    average: 60.00,
                    offerType: 'Ultimate',
                    offerStatus: 'Active',
                    notes: 'Higher average transaction value'
                },
                {
                    date: '2025-10-04',
                    branch: 'Crispy Chicken-Hamdan St',
                    channel: 'Delivery',
                    transactions: 52,
                    sales: 2600.00,
                    average: 50.00,
                    offerType: 'Normal Day',
                    offerStatus: 'No Offer',
                    notes: 'High delivery volume'
                },
                {
                    date: '2025-10-05',
                    branch: 'Crispy Chicken Khaldia',
                    channel: 'Dine-in',
                    transactions: 41,
                    sales: 2050.00,
                    average: 50.00,
                    offerType: 'Normal Day',
                    offerStatus: 'No Offer',
                    notes: ''
                },
                {
                    date: '2025-10-06',
                    branch: 'Crispy Chicken-Hamdan St',
                    channel: 'Takeaway',
                    transactions: 58,
                    sales: 2900.00,
                    average: 50.00,
                    offerType: 'Ultimate',
                    offerStatus: 'Active',
                    notes: 'Ultimate offer performing well'
                },
                {
                    date: '2025-10-07',
                    branch: 'Crispy Chicken Al Barsha',
                    channel: 'Delivery',
                    transactions: 35,
                    sales: 2100.00,
                    average: 60.00,
                    offerType: 'Chicken Day',
                    offerStatus: 'Active',
                    notes: 'Strong delivery performance'
                },
                {
                    date: '2025-10-08',
                    branch: 'Crispy Chicken-Hamdan St',
                    channel: 'Dine-in',
                    transactions: 49,
                    sales: 2450.00,
                    average: 50.00,
                    offerType: 'Normal Day',
                    offerStatus: 'No Offer',
                    notes: 'Weekend dine-in traffic up'
                },
                {
                    date: '2025-10-09',
                    branch: 'Crispy Chicken Khaldia',
                    channel: 'Takeaway',
                    transactions: 36,
                    sales: 1800.00,
                    average: 50.00,
                    offerType: 'Normal Day',
                    offerStatus: 'No Offer',
                    notes: ''
                },
                {
                    date: '2025-10-10',
                    branch: 'Crispy Chicken-Hamdan St',
                    channel: 'Delivery',
                    transactions: 55,
                    sales: 2750.00,
                    average: 50.00,
                    offerType: 'Chicken Day',
                    offerStatus: 'Active',
                    notes: 'Excellent delivery numbers'
                },
                {
                    date: '2025-10-11',
                    branch: 'Crispy Chicken Al Barsha',
                    channel: 'Dine-in',
                    transactions: 30,
                    sales: 1800.00,
                    average: 60.00,
                    offerType: 'Ultimate',
                    offerStatus: 'Active',
                    notes: 'Consistent high average'
                },
                {
                    date: '2025-10-12',
                    branch: 'Crispy Chicken-Hamdan St',
                    channel: 'Takeaway',
                    transactions: 42,
                    sales: 2100.00,
                    average: 50.00,
                    offerType: 'Normal Day',
                    offerStatus: 'No Offer',
                    notes: 'Mid-week slowdown'
                },
                {
                    date: '2025-10-13',
                    branch: 'Crispy Chicken Khaldia',
                    channel: 'Delivery',
                    transactions: 48,
                    sales: 2400.00,
                    average: 50.00,
                    offerType: 'Ultimate',
                    offerStatus: 'Active',
                    notes: 'Ultimate offer popular'
                },
                {
                    date: '2025-10-14',
                    branch: 'Crispy Chicken-Hamdan St',
                    channel: 'Dine-in',
                    transactions: 52,
                    sales: 2600.00,
                    average: 50.00,
                    offerType: 'Chicken Day',
                    offerStatus: 'Active',
                    notes: 'Strong weekend performance'
                }
            ];
            
            // Sample feedback data
            feedbackData = [
                {
                    date: '2025-10-01',
                    branch: 'Crispy Chicken-Hamdan St',
                    rating: 5,
                    category: 'Service',
                    comment: 'Excellent service and friendly staff. Will definitely return!'
                },
                {
                    date: '2025-10-02',
                    branch: 'Crispy Chicken Khaldia',
                    rating: 4,
                    category: 'Food',
                    comment: 'Food quality is good but could be hotter when served.'
                },
                {
                    date: '2025-10-03',
                    branch: 'Crispy Chicken Al Barsha',
                    rating: 5,
                    category: 'Cleanliness',
                    comment: 'The restaurant was spotless and well-maintained.'
                },
                {
                    date: '2025-10-04',
                    branch: 'Crispy Chicken-Hamdan St',
                    rating: 3,
                    category: 'Service',
                    comment: 'Service was a bit slow during peak hours.'
                },
                {
                    date: '2025-10-05',
                    branch: 'Crispy Chicken Khaldia',
                    rating: 4,
                    category: 'Food',
                    comment: 'Great flavors and generous portions.'
                },
                {
                    date: '2025-10-06',
                    branch: 'Crispy Chicken Al Barsha',
                    rating: 5,
                    category: 'Service',
                    comment: 'Staff went above and beyond to accommodate our large group.'
                },
                {
                    date: '2025-10-07',
                    branch: 'Crispy Chicken-Hamdan St',
                    rating: 4,
                    category: 'Cleanliness',
                    comment: 'Clean environment but tables could be wiped more frequently.'
                },
                {
                    date: '2025-10-08',
                    branch: 'Crispy Chicken Khaldia',
                    rating: 5,
                    category: 'Food',
                    comment: 'Best chicken in town! The Ultimate offer is fantastic value.'
                },
                {
                    date: '2025-10-09',
                    branch: 'Crispy Chicken Al Barsha',
                    rating: 3,
                    category: 'Service',
                    comment: 'Order took longer than expected but staff was apologetic.'
                },
                {
                    date: '2025-10-10',
                    branch: 'Crispy Chicken-Hamdan St',
                    rating: 5,
                    category: 'Service',
                    comment: 'Outstanding service from the moment we walked in.'
                }
            ];
            
            // Sample offers data
            offers = [
                {
                    name: 'Ultimate Combo',
                    type: 'Ultimate',
                    discount: 25,
                    startDate: '2025-10-01',
                    endDate: '2025-10-31',
                    status: 'Active'
                },
                {
                    name: 'Chicken Day Special',
                    type: 'Chicken Day',
                    discount: 15,
                    startDate: '2025-10-01',
                    endDate: '2025-10-31',
                    status: 'Active'
                },
                {
                    name: 'Weekend Family Deal',
                    type: 'Normal Day',
                    discount: 10,
                    startDate: '2025-10-06',
                    endDate: '2025-10-08',
                    status: 'Inactive'
                }
            ];
        }
        
        // Load sample target plan
        function loadSampleTargetPlan() {
            targetPlan = {
                '2025-10': {
                    totalTarget: 360000,
                    branches: {
                        'Crispy Chicken-Hamdan St': 126000,
                        'Crispy Chicken Khaldia': 90000,
                        'Crispy Chicken Shabiya 11': 54000,
                        'Crispy Chicken Muroor': 36000,
                        'Crispy Chicken Al Barsha': 36000,
                        'Crispy Chicken Al Satwa': 18000,
                        'Crispy Chicken Al Rgga': 18000
                    }
                }
            };
        }
        
        // Update feedback summary
        function updateFeedbackSummary() {
            const totalFeedback = feedbackData.length;
            const avgRating = totalFeedback > 0 
                ? (feedbackData.reduce((sum, f) => sum + f.rating, 0) / totalFeedback).toFixed(1)
                : '0.0';
            
            const positiveFeedback = totalFeedback > 0 
                ? ((feedbackData.filter(f => f.rating >= 4).length / totalFeedback) * 100).toFixed(1)
                : '0';
            
            // Update dashboard feedback metrics
            const totalFeedbackEl = document.getElementById('totalFeedback');
            const avgRatingEl = document.getElementById('avgRating');
            const positiveFeedbackEl = document.getElementById('positiveFeedback');
            
            if (totalFeedbackEl) totalFeedbackEl.textContent = totalFeedback;
            if (avgRatingEl) avgRatingEl.textContent = avgRating;
            if (positiveFeedbackEl) positiveFeedbackEl.textContent = `${positiveFeedback}%`;
            
            // Update management report feedback metrics
            const reportTotalFeedbackEl = document.getElementById('reportTotalFeedback');
            const reportAvgRatingEl = document.getElementById('reportAvgRating');
            const reportPositiveFeedbackEl = document.getElementById('reportPositiveFeedback');
            
            if (reportTotalFeedbackEl) reportTotalFeedbackEl.textContent = totalFeedback;
            if (reportAvgRatingEl) reportAvgRatingEl.textContent = avgRating;
            if (reportPositiveFeedbackEl) reportPositiveFeedbackEl.textContent = `${positiveFeedback}%`;
            
            // Update feedback management metrics
            const feedbackTotalEl = document.getElementById('feedbackTotal');
            const feedbackAvgRatingEl = document.getElementById('feedbackAvgRating');
            const feedbackPositiveEl = document.getElementById('feedbackPositive');
            
            if (feedbackTotalEl) feedbackTotalEl.textContent = totalFeedback;
            if (feedbackAvgRatingEl) feedbackAvgRatingEl.textContent = avgRating;
            if (feedbackPositiveEl) feedbackPositiveEl.textContent = `${positiveFeedback}%`;
        }
        
        // Update target plan
        function updateTargetPlan() {
            const currentMonth = '2025-10';
            const currentTargetPlan = targetPlan[currentMonth];
            
            if (!currentTargetPlan) {
                return;
            }
            
            // Calculate current achievement
            const currentMonthSales = salesData
                .filter(sale => sale.date.startsWith(currentMonth))
                .reduce((sum, sale) => sum + parseFloat(sale.sales), 0);
            
            const totalTarget = currentTargetPlan.totalTarget;
            const achievementPercentage = totalTarget > 0 ? (currentMonthSales / totalTarget) * 100 : 0;
            const remainingTarget = totalTarget - currentMonthSales;
            
            // Calculate days remaining in month
            const today = new Date();
            const lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            const daysRemaining = Math.max(0, Math.ceil((lastDayOfMonth - today) / (1000 * 60 * 60 * 24)));
            
            // Calculate daily target needed
            const dailyTargetNeeded = daysRemaining > 0 ? remainingTarget / daysRemaining : 0;
            
            // Update UI elements
            const monthlyTargetValueEl = document.getElementById('monthlyTargetValue');
            const currentAchievementValueEl = document.getElementById('currentAchievementValue');
            const remainingTargetValueEl = document.getElementById('remainingTargetValue');
            const daysRemainingEl = document.getElementById('daysRemaining');
            const dailyTargetNeededEl = document.getElementById('dailyTargetNeeded');
            const monthlyTargetProgressEl = document.getElementById('monthlyTargetProgress');
            
            if (monthlyTargetValueEl) monthlyTargetValueEl.textContent = formatCurrency(totalTarget);
            if (currentAchievementValueEl) currentAchievementValueEl.textContent = formatCurrency(currentMonthSales);
            if (remainingTargetValueEl) remainingTargetValueEl.textContent = formatCurrency(remainingTarget);
            if (daysRemainingEl) daysRemainingEl.textContent = daysRemaining;
            if (dailyTargetNeededEl) dailyTargetNeededEl.textContent = formatCurrency(dailyTargetNeeded);
            if (monthlyTargetProgressEl) {
                monthlyTargetProgressEl.style.width = `${achievementPercentage.toFixed(1)}%`;
                monthlyTargetProgressEl.textContent = `${achievementPercentage.toFixed(1)}%`;
            }
            
            // Update branch targets
            updateBranchTargets();
            
            // Update charts
            updateTargetCharts();
            
            // Update timeline
            updateTargetTimeline();
        }
        
        // Update branch targets
        function updateBranchTargets() {
            const container = document.getElementById('branchTargetsContainer');
            if (!container) return;
            
            const currentMonth = '2025-10';
            const currentTargetPlan = targetPlan[currentMonth];
            
            if (!currentTargetPlan) {
                return;
            }
            
            container.innerHTML = '';
            
            const branches = Object.keys(currentTargetPlan.branches);
            
            branches.forEach(branch => {
                const target = currentTargetPlan.branches[branch];
                const achievement = calculateBranchAchievement(branch, currentMonth);
                const percentage = (achievement / target) * 100;
                
                const statusClass = percentage >= 100 ? 'target-achieved' : 
                                  percentage >= 75 ? 'target-pending' : 'target-critical';
                
                const card = document.createElement('div');
                card.className = 'branch-target-card';
                card.innerHTML = `
                    <div class="branch-target-header">
                        <div class="branch-target-name">${branch}</div>
                        <span class="branch-target-badge ${statusClass}">${percentage.toFixed(1)}%</span>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="target-metric">
                                <span class="target-metric-label">Target</span>
                                <span class="target-metric-value">${formatCurrency(target)}</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="target-metric">
                                <span class="target-metric-label">Achieved</span>
                                <span class="target-metric-value">${formatCurrency(achievement)}</span>
                            </div>
                        </div>
                    </div>
                    <div class="target-progress">
                        <div class="target-progress-bar" style="width: ${percentage}%"></div>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }
        
        // Calculate branch achievement
        function calculateBranchAchievement(branch, month) {
            const branchSales = salesData
                .filter(sale => sale.date.startsWith(month) && sale.branch === branch)
                .reduce((sum, sale) => sum + parseFloat(sale.sales), 0);
            
            const target = targetPlan[month]?.branches?.[branch] || 0;
            return branchSales;
        }
        
        // Update target charts
        function updateTargetCharts() {
            const currentMonth = '2025-10';
            const currentTargetPlan = targetPlan[currentMonth];
            
            if (!currentTargetPlan) {
                return;
            }
            
            // Target allocation chart
            const allocationCtx = document.getElementById('targetAllocationChart');
            if (allocationCtx) {
                const branches = Object.keys(currentTargetPlan.branches);
                const targets = branches.map(branch => currentTargetPlan.branches[branch]);
                const achievements = branches.map(branch => calculateBranchAchievement(branch, currentMonth));
                
                if (charts.targetAllocation) {
                    charts.targetAllocation.destroy();
                }
                
                charts.targetAllocation = new Chart(allocationCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: branches,
                        datasets: [{
                            label: 'Target',
                            data: targets,
                            backgroundColor: [
                                '#ff6b35',
                                '#f7931e',
                                '#ffc107',
                                '#28a745',
                                '#17a2b8',
                                '#6f42c1',
                                '#dc3545'
                            ]
                        }, {
                            label: 'Achievement',
                            data: achievements,
                            backgroundColor: [
                                'rgba(255, 107, 53, 0.5)',
                                'rgba(247, 147, 30, 0.5)',
                                'rgba(255, 193, 7, 0.5)',
                                'rgba(40, 167, 69, 0.5)',
                                'rgba(23, 162, 184, 0.5)',
                                'rgba(111, 66, 193, 0.5)',
                                'rgba(220, 53, 69, 0.5)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${formatCurrency(context.parsed)}`;
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Target vs achievement chart
            const vsAchievementCtx = document.getElementById('targetVsAchievementChart');
            if (vsAchievementCtx) {
                const branches = Object.keys(currentTargetPlan.branches);
                const targets = branches.map(branch => currentTargetPlan.branches[branch]);
                const achievements = branches.map(branch => calculateBranchAchievement(branch, currentMonth));
                
                if (charts.targetVsAchievement) {
                    charts.targetVsAchievement.destroy();
                }
                
                charts.targetVsAchievement = new Chart(vsAchievementCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: branches,
                        datasets: [{
                            label: 'Target',
                            data: targets,
                            backgroundColor: 'rgba(255, 107, 53, 0.5)'
                        }, {
                            label: 'Achievement',
                            data: achievements,
                            backgroundColor: 'rgba(40, 167, 69, 0.8)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return formatCurrency(value);
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Update target timeline
        function updateTargetTimeline() {
            const container = document.getElementById('targetTimeline');
            if (!container) return;
            
            const currentMonth = '2025-10';
            const milestones = [
                { date: '2025-10-01', text: 'Month starts - Target set at AED 360,000' },
                { date: '2025-10-07', text: 'Week 1 - 25% of target achieved' },
                { date: '2025-10-14', text: 'Week 2 - 50% of target achieved' },
                { date: '2025-10-21', text: 'Week 3 - 75% of target projected' },
                { date: '2025-10-31', text: 'Month end - Target completion expected' }
            ];
            
            container.innerHTML = '';
            
            milestones.forEach(milestone => {
                const item = document.createElement('div');
                item.className = 'timeline-item';
                item.innerHTML = `
                    <div class="timeline-date">${milestone.date}</div>
                    <div class="timeline-content">${milestone.text}</div>
                `;
                container.appendChild(item);
            });
        }
        
        // Update management report
        function updateManagementReport() {
            // Calculate metrics for the report
            const totalSales = salesData.reduce((sum, sale) => sum + parseFloat(sale.sales), 0);
            const totalTransactions = salesData.reduce((sum, sale) => sum + parseInt(sale.transactions), 0);
            const avgTransaction = totalTransactions > 0 ? totalSales / totalTransactions : 0;
            
            // Update executive summary
            const reportTotalSalesEl = document.getElementById('reportTotalSales');
            const reportTotalTransactionsEl = document.getElementById('reportTotalTransactions');
            const reportAvgTransactionEl = document.getElementById('reportAvgTransaction');
            
            if (reportTotalSalesEl) reportTotalSalesEl.textContent = formatCurrency(totalSales);
            if (reportTotalTransactionsEl) reportTotalTransactionsEl.textContent = totalTransactions;
            if (reportAvgTransactionEl) reportAvgTransactionEl.textContent = formatCurrency(avgTransaction);
            
            // Update date range
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const reportDateRangeEl = document.getElementById('reportDateRange');
            if (reportDateRangeEl) reportDateRangeEl.textContent = `${startDate} to ${endDate}`;
            
            // Update charts
            updateManagementReportCharts();
            
            // Update findings and recommendations
            updateManagementReportFindings();
        }
        
        // Update management report charts
        function updateManagementReportCharts() {
            // Branch performance chart
            const branchCtx = document.getElementById('branchPerformanceChart');
            if (!branchCtx) return;
            
            // Group data by branch
            const branchData = {};
            salesData.forEach(sale => {
                if (!branchData[sale.branch]) {
                    branchData[sale.branch] = 0;
                }
                branchData[sale.branch] += parseFloat(sale.sales);
            });
            
            // Destroy existing chart if it exists
            if (charts.branchPerformance) {
                charts.branchPerformance.destroy();
            }
            
            // Create new chart
            charts.branchPerformance = new Chart(branchCtx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: Object.keys(branchData),
                    datasets: [{
                        label: 'Total Sales (AED)',
                        data: Object.values(branchData),
                        backgroundColor: '#ff6b35'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
            
            // Daily & weekly performance chart
            const dailyWeeklyCtx = document.getElementById('dailyWeeklyPerformanceChart');
            if (!dailyWeeklyCtx) return;
            
            // Group data by date
            const dailyData = {};
            salesData.forEach(sale => {
                if (!dailyData[sale.date]) {
                    dailyData[sale.date] = {
                        sales: 0,
                        transactions: 0
                    };
                }
                dailyData[sale.date].sales += parseFloat(sale.sales);
                dailyData[sale.date].transactions += parseInt(sale.transactions);
            });
            
            // Sort dates
            const sortedDates = Object.keys(dailyData).sort();
            
            // Destroy existing chart if it exists
            if (charts.dailyWeeklyPerformance) {
                charts.dailyWeeklyPerformance.destroy();
            }
            
            // Create new chart
            charts.dailyWeeklyPerformance = new Chart(dailyWeeklyCtx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: sortedDates,
                    datasets: [{
                        label: 'Daily Sales',
                        data: sortedDates.map(date => dailyData[date].sales),
                        borderColor: '#ff6b35',
                        backgroundColor: 'rgba(255, 107, 53, 0.1)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
            
            // Monthly trend chart
            const monthlyTrendCtx = document.getElementById('monthlyTrendChart');
            if (!monthlyTrendCtx) return;
            
            // Destroy existing chart if it exists
            if (charts.monthlyTrend) {
                charts.monthlyTrend.destroy();
            }
            
            // Create new chart
            charts.monthlyTrend = new Chart(monthlyTrendCtx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                    datasets: [{
                        label: 'Weekly Sales',
                        data: [45000, 52000, 48000, 55000],
                        borderColor: '#ff6b35',
                        backgroundColor: 'rgba(255, 107, 53, 0.1)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
            
            // Target distribution chart
            const targetCtx = document.getElementById('targetPlanChart');
            if (!targetCtx) return;
            
            // Destroy existing chart if it exists
            if (charts.targetPlan) {
                charts.targetPlan.destroy();
            }
            
            // Create new chart
            charts.targetPlan = new Chart(targetCtx.getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: ['Hamdan St', 'Khaldia', 'Al Barsha', 'Other Branches'],
                    datasets: [{
                        data: [35, 25, 20, 20],
                        backgroundColor: [
                            '#ff6b35',
                            '#f7931e',
                            '#ffc107',
                            '#28a745'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.parsed}%`;
                                }
                            }
                        }
                    }
                }
            });
            
            // Feedback charts for management report
            const feedbackCategoryCtx = document.getElementById('feedbackCategoryReportChart');
            if (feedbackCategoryCtx) {
                // Group feedback by category
                const categoryData = {};
                feedbackData.forEach(feedback => {
                    if (!categoryData[feedback.category]) {
                        categoryData[feedback.category] = 0;
                    }
                    categoryData[feedback.category]++;
                });
                
                // Destroy existing chart if it exists
                if (charts.feedbackCategoryReport) {
                    charts.feedbackCategoryReport.destroy();
                }
                
                // Create new chart
                charts.feedbackCategoryReport = new Chart(feedbackCategoryCtx.getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: Object.keys(categoryData),
                        datasets: [{
                            data: Object.values(categoryData),
                            backgroundColor: [
                                '#17a2b8',
                                '#ff6b35',
                                '#28a745',
                                '#ffc107'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
            
            const feedbackRatingCtx = document.getElementById('feedbackRatingReportChart');
            if (feedbackRatingCtx) {
                // Group feedback by rating
                const ratingData = {
                    '5': 0,
                    '4': 0,
                    '3': 0,
                    '2': 0,
                    '1': 0
                };
                
                feedbackData.forEach(feedback => {
                    ratingData[feedback.rating.toString()]++;
                });
                
                // Destroy existing chart if it exists
                if (charts.feedbackRatingReport) {
                    charts.feedbackRatingReport.destroy();
                }
                
                // Create new chart
                charts.feedbackRatingReport = new Chart(feedbackRatingCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(ratingData),
                        datasets: [{
                            label: 'Number of Ratings',
                            data: Object.values(ratingData),
                            backgroundColor: [
                                '#28a745',
                                '#28a745',
                                '#ffc107',
                                '#dc3545',
                                '#dc3545'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Update management report findings
        function updateManagementReportFindings() {
            // Branch performance findings
            const branchPerformanceFindings = document.getElementById('branchPerformanceFindings');
            if (branchPerformanceFindings) {
                branchPerformanceFindings.innerHTML = '';
                
                const branchFindings = [
                    'Hamdan St branch has the highest sales, accounting for 35% of total sales',
                    'Al Barsha branch has fewer transactions but the highest average transaction value',
                    'Al Satwa branch performs particularly well on weekends but relatively weak on weekdays'
                ];
                
                branchFindings.forEach(finding => {
                    const li = document.createElement('li');
                    li.textContent = finding;
                    branchPerformanceFindings.appendChild(li);
                });
            }
            
            // Daily & weekly findings
            const dailyWeeklyFindings = document.getElementById('dailyWeeklyFindings');
            if (dailyWeeklyFindings) {
                dailyWeeklyFindings.innerHTML = '';
                
                const weeklyFindings = [
                    'Saturday and Sunday are peak sales days, with 40% higher transaction volume than weekdays',
                    'Week 1 (Oct 1-7) had slightly higher sales than Week 2',
                    'Wednesday is typically the lowest transaction day of the week'
                ];
                
                weeklyFindings.forEach(finding => {
                    const li = document.createElement('li');
                    li.textContent = finding;
                    dailyWeeklyFindings.appendChild(li);
                });
            }
            
            // Monthly trend findings
            const monthlyTrendFindings = document.getElementById('monthlyTrendFindings');
            if (monthlyTrendFindings) {
                monthlyTrendFindings.innerHTML = '';
                
                const trendFindings = [
                    'Beginning and end of month typically show better sales performance',
                    'Middle of month has higher sales volatility, requiring further analysis',
                    'Overall sales show an upward trend with 12% month-over-month growth'
                ];
                
                trendFindings.forEach(finding => {
                    const li = document.createElement('li');
                    li.textContent = finding;
                    monthlyTrendFindings.appendChild(li);
                });
            }
            
            // Target plan findings
            const targetPlanFindings = document.getElementById('targetPlanFindings');
            if (targetPlanFindings) {
                targetPlanFindings.innerHTML = '';
                
                const targetFindings = [
                    'Hamdan St branch: 35% target share (based on historical performance)',
                    'Khaldia branch: 25% target share (based on traffic analysis)',
                    'Al Barsha branch: 20% target share (based on average transaction value)',
                    'Other branches: 20% target share (based on growth potential)'
                ];
                
                targetFindings.forEach(finding => {
                    const li = document.createElement('li');
                    li.textContent = finding;
                    targetPlanFindings.appendChild(li);
                });
            }
            
            // Feedback insights
            const feedbackInsightsList = document.getElementById('feedbackInsightsList');
            if (feedbackInsightsList) {
                feedbackInsightsList.innerHTML = '';
                
                const insights = [
                    'Service quality is consistently rated highest across all branches',
                    'Food quality shows room for improvement, particularly in Al Barsha branch',
                    'Customers appreciate cleanliness but suggest faster service during peak hours',
                    'Ultimate offer receives the most positive customer feedback'
                ];
                
                insights.forEach(insight => {
                    const li = document.createElement('li');
                    li.textContent = insight;
                    feedbackInsightsList.appendChild(li);
                });
            }
            
            // Management recommendations
            const shortTermRecs = document.getElementById('shortTermManagementRecommendations');
            if (shortTermRecs) {
                shortTermRecs.innerHTML = '';
                
                const shortTerm = [
                    'Increase weekend promotions at Hamdan St branch to handle high traffic',
                    'Introduce more family meal packages at Al Barsha branch to increase average transaction value',
                    'Optimize Muroor branch operating hours to match customer demand patterns',
                    'Add new product sampling activities at Khaldia branch to attract more customers'
                ];
                
                shortTerm.forEach(rec => {
                    const li = document.createElement('li');
                    li.textContent = rec;
                    shortTermRecs.appendChild(li);
                });
            }
            
            const mediumTermRecs = document.getElementById('mediumTermManagementRecommendations');
            if (mediumTermRecs) {
                mediumTermRecs.innerHTML = '';
                
                const mediumTerm = [
                    'Redistribute target sales indicators for each branch based on sales data',
                    'Create specific improvement plans for underperforming branches',
                    'Analyze ROI of different offer types and optimize promotion strategy',
                    'Evaluate new branch location possibilities to expand market coverage'
                ];
                
                mediumTerm.forEach(rec => {
                    const li = document.createElement('li');
                    li.textContent = rec;
                    mediumTermRecs.appendChild(li);
                });
            }
            
            const longTermRecs = document.getElementById('longTermManagementRecommendations');
            if (longTermRecs) {
                longTermRecs.innerHTML = '';
                
                const longTerm = [
                    'Develop customer loyalty program to increase retention rate',
                    'Consider launching online ordering and delivery services',
                    'Explore new product lines to increase revenue sources',
                    'Develop brand expansion plan to enter new market areas'
                ];
                
                longTerm.forEach(rec => {
                    const li = document.createElement('li');
                    li.textContent = rec;
                    longTermRecs.appendChild(li);
                });
            }
        }
        
        // Update feedback management
        function updateFeedbackManagement() {
            // Update overview charts
            const overviewCategoryCtx = document.getElementById('feedbackOverviewCategoryChart');
            if (overviewCategoryCtx) {
                // Group feedback by category
                const categoryData = {};
                feedbackData.forEach(feedback => {
                    if (!categoryData[feedback.category]) {
                        categoryData[feedback.category] = 0;
                    }
                    categoryData[feedback.category]++;
                });
                
                // Destroy existing chart if it exists
                if (charts.feedbackOverviewCategory) {
                    charts.feedbackOverviewCategory.destroy();
                }
                
                // Create new chart
                charts.feedbackOverviewCategory = new Chart(overviewCategoryCtx.getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: Object.keys(categoryData),
                        datasets: [{
                            data: Object.values(categoryData),
                            backgroundColor: [
                                '#17a2b8',
                                '#ff6b35',
                                '#28a745',
                                '#ffc107'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
            
            const overviewRatingCtx = document.getElementById('feedbackOverviewRatingChart');
            if (overviewRatingCtx) {
                // Group feedback by rating
                const ratingData = {
                    '5': 0,
                    '4': 0,
                    '3': 0,
                    '2': 0,
                    '1': 0
                };
                
                feedbackData.forEach(feedback => {
                    ratingData[feedback.rating.toString()]++;
                });
                
                // Destroy existing chart if it exists
                if (charts.feedbackOverviewRating) {
                    charts.feedbackOverviewRating.destroy();
                }
                
                // Create new chart
                charts.feedbackOverviewRating = new Chart(overviewRatingCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(ratingData),
                        datasets: [{
                            label: 'Number of Ratings',
                            data: Object.values(ratingData),
                            backgroundColor: [
                                '#28a745',
                                '#28a745',
                                '#ffc107',
                                '#dc3545',
                                '#dc3545'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        }
                    }
                });
            }
            
            // Update feedback list
            updateFeedbackList();
        }
        
        // Update feedback list
        function updateFeedbackList() {
            const container = document.getElementById('feedbackListContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Sort feedback by date (newest first)
            const sortedFeedback = [...feedbackData].sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            );
            
            sortedFeedback.forEach((feedback, index) => {
                const item = createFeedbackItem(feedback, index);
                container.appendChild(item);
            });
        }
        
        // Create feedback item
        function createFeedbackItem(feedback, index) {
            const item = document.createElement('div');
            item.className = 'feedback-list-item';
            
            const ratingStars = '★'.repeat(feedback.rating) + '☆'.repeat(5 - feedback.rating);
            
            item.innerHTML = `
                <div class="feedback-header">
                    <h6>${feedback.branch} - ${feedback.date}</h6>
                    <span class="feedback-category category-${feedback.category.toLowerCase()}">${feedback.category}</span>
                </div>
                <div class="feedback-body">
                    <p>${feedback.comment}</p>
                </div>
                <div class="feedback-footer">
                    <span>${ratingStars} (${feedback.rating}/5)</span>
                    <div class="feedback-actions">
                        <button class="btn btn-sm btn-primary" onclick="editFeedback(${index})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteFeedback(${index})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>
            `;
            
            return item;
        }
        
        // Add feedback category
        function addFeedbackCategory() {
            const categoryName = document.getElementById('newCategoryName').value;
            const color = document.querySelector('.color-option.selected').getAttribute('data-color');
            
            if (!categoryName) {
                document.getElementById('newCategoryName').classList.add('is-invalid');
                document.getElementById('newCategoryNameFeedback').textContent = 'Category name is required';
                return;
            }
            
            // Add to categories list (in a real app, this would be stored)
            showNotification(`Category "${categoryName}" added successfully!`, 'success');
            
            // Reset form
            document.getElementById('addCategoryForm').reset();
            
            // Update feedback management
            updateFeedbackManagement();
            
            // Save to local storage
            saveToLocalStorage();
        }
        
        // Edit feedback
        function editFeedback(index) {
            const feedback = feedbackData[index];
            
            // Populate form with feedback data
            document.getElementById('feedbackDate').value = feedback.date;
            document.getElementById('feedbackBranch').value = feedback.branch;
            document.getElementById('feedbackRatingValue').value = feedback.rating;
            document.getElementById('feedbackCategory').value = feedback.category;
            document.getElementById('feedbackComment').value = feedback.comment;
            
            // Update rating display
            document.querySelectorAll('#feedbackRating i').forEach((star, i) => {
                if (i < feedback.rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
            
            // Show data entry page with feedback tab active
            showPage('data-entry');
            document.getElementById('feedback-tab').click();
            
            // Scroll to feedback form
            document.getElementById('feedbackForm').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Delete feedback
        function deleteFeedback(index) {
            if (confirm('Are you sure you want to delete this feedback?')) {
                feedbackData.splice(index, 1);
                updateAllUI();
                showNotification('Feedback deleted successfully!', 'warning');
                
                // Save to local storage
                saveToLocalStorage();
            }
        }
        
        // Add offer
        function addOffer() {
            const offer = {
                name: document.getElementById('offerName').value,
                type: document.getElementById('offerType').value,
                discount: parseInt(document.getElementById('offerDiscount').value),
                startDate: document.getElementById('offerStartDate').value,
                endDate: document.getElementById('offerEndDate').value,
                status: document.getElementById('offerStatus').value
            };
            
            offers.push(offer);
            updateOffersTable();
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('addOfferModal'));
            if (modal) modal.hide();
            
            // Reset form
            document.getElementById('addOfferForm').reset();
            
            showNotification('Offer added successfully!', 'success');
            
            // Save to local storage
            saveToLocalStorage();
        }
        
        // Update offers table
        function updateOffersTable() {
            const tbody = document.getElementById('offersTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            offers.forEach((offer, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${offer.name}</td>
                    <td><span class="offer-badge offer-${offer.type.toLowerCase().replace(' ', '')}">${offer.type}</span></td>
                    <td>${offer.discount}%</td>
                    <td>${offer.startDate}</td>
                    <td>${offer.endDate}</td>
                    <td><span class="badge ${offer.status === 'Active' ? 'bg-success' : 'bg-secondary'}">${offer.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteOffer(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Delete offer
        function deleteOffer(index) {
            if (confirm('Are you sure you want to delete this offer?')) {
                offers.splice(index, 1);
                updateOffersTable();
                showNotification('Offer deleted successfully!', 'warning');
                
                // Save to local storage
                saveToLocalStorage();
            }
        }
        
        // Update data management
        function updateDataManagement() {
            updateSaveSlots();
            updateBackupHistory();
            updateRecoveryPoints();
            updateIntegrityCheckResults();
            updateScheduledBackups();
            updateCloudStorageStatus();
        }
        
        // Save slots management
        function createNewSaveSlot() {
            const name = prompt('Enter a name for this save slot:');
            if (!name) return;
            
            const description = prompt('Enter a description for this save slot (optional):');
            
            const saveSlot = {
                id: generateId(),
                name: name,
                description: description || '',
                date: new Date().toISOString(),
                data: {
                    salesData: [...salesData],
                    feedbackData: [...feedbackData],
                    offers: [...offers],
                    targetPlan: {...targetPlan}
                },
                stats: {
                    salesRecords: salesData.length,
                    feedbackRecords: feedbackData.length,
                    offers: offers.length,
                    targetPlans: Object.keys(targetPlan).length
                }
            };
            
            saveSlots.push(saveSlot);
            saveSaveSlots();
            updateSaveSlots();
            
            showNotification(`Save slot "${name}" created successfully!`, 'success');
        }
        
        function quickSave() {
            const saveSlot = {
                id: generateId(),
                name: `Quick Save ${new Date().toLocaleString()}`,
                description: 'Automatic quick save',
                date: new Date().toISOString(),
                data: {
                    salesData: [...salesData],
                    feedbackData: [...feedbackData],
                    offers: [...offers],
                    targetPlan: {...targetPlan}
                },
                stats: {
                    salesRecords: salesData.length,
                    feedbackRecords: feedbackData.length,
                    offers: offers.length,
                    targetPlans: Object.keys(targetPlan).length
                }
            };
            
            saveSlots.push(saveSlot);
            saveSaveSlots();
            updateSaveSlots();
            
            showNotification('Quick save created successfully!', 'success');
        }
        
        function loadSaveSlot(slotId) {
            const slot = saveSlots.find(s => s.id === slotId);
            if (!slot) return;
            
            if (confirm(`Are you sure you want to load the save slot "${slot.name}"? This will replace your current data.`)) {
                salesData = [...slot.data.salesData];
                feedbackData = [...slot.data.feedbackData];
                offers = [...slot.data.offers];
                targetPlan = {...slot.data.targetPlan};
                
                updateAllUI();
                saveToLocalStorage();
                
                showNotification(`Save slot "${slot.name}" loaded successfully!`, 'success');
            }
        }
        
        function deleteSaveSlot(slotId) {
            const slot = saveSlots.find(s => s.id === slotId);
            if (!slot) return;
            
            if (confirm(`Are you sure you want to delete the save slot "${slot.name}"?`)) {
                saveSlots = saveSlots.filter(s => s.id !== slotId);
                saveSaveSlots();
                updateSaveSlots();
                
                showNotification(`Save slot "${slot.name}" deleted successfully!`, 'warning');
            }
        }
        
        function updateSaveSlots() {
            const container = document.getElementById('saveSlotsContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Filter save slots
            const filter = document.getElementById('saveSlotFilter')?.value || 'all';
            const search = document.getElementById('saveSlotSearch')?.value || '';
            
            let filteredSlots = [...saveSlots];
            
            // Apply filter
            if (filter !== 'all') {
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                
                switch(filter) {
                    case 'recent':
                        const weekAgo = new Date(today);
                        weekAgo.setDate(weekAgo.getDate() - 7);
                        filteredSlots = filteredSlots.filter(slot => new Date(slot.date) >= weekAgo);
                        break;
                    case 'week':
                        const weekStart = new Date(today);
                        weekStart.setDate(weekStart.getDate() - today.getDay());
                        filteredSlots = filteredSlots.filter(slot => new Date(slot.date) >= weekStart);
                        break;
                    case 'month':
                        const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
                        filteredSlots = filteredSlots.filter(slot => new Date(slot.date) >= monthStart);
                        break;
                }
            }
            
            // Apply search
            if (search) {
                filteredSlots = filteredSlots.filter(slot => 
                    slot.name.toLowerCase().includes(search.toLowerCase()) ||
                    slot.description.toLowerCase().includes(search.toLowerCase())
                );
            }
            
            // Sort by date (newest first)
            filteredSlots.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Create save slot elements
            filteredSlots.forEach(slot => {
                const slotElement = createSaveSlotElement(slot);
                container.appendChild(slotElement);
            });
            
            // Update comparison dropdowns
            updateSaveSlotComparisonDropdowns();
        }
        
        function createSaveSlotElement(slot) {
            const slotDiv = document.createElement('div');
            slotDiv.className = 'save-slot';
            
            const date = new Date(slot.date);
            const formattedDate = date.toLocaleString();
            
            slotDiv.innerHTML = `
                <div class="save-slot-header">
                    <div class="save-slot-title">${slot.name}</div>
                    <div class="save-slot-date">${formattedDate}</div>
                </div>
                <div class="save-slot-description">${slot.description}</div>
                <div class="save-slot-stats">
                    <span>Sales: ${slot.stats.salesRecords}</span>
                    <span>Feedback: ${slot.stats.feedbackRecords}</span>
                    <span>Offers: ${slot.stats.offers}</span>
                    <span>Targets: ${slot.stats.targetPlans}</span>
                </div>
                <div class="save-slot-actions">
                    <button class="btn btn-sm btn-primary" onclick="loadSaveSlot('${slot.id}')">
                        <i class="fas fa-upload"></i> Load
                    </button>
                    <button class="btn btn-sm btn-outline-info" onclick="compareWithCurrent('${slot.id}')">
                        <i class="fas fa-exchange-alt"></i> Compare
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteSaveSlot('${slot.id}')">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            `;
            
            return slotDiv;
        }
        
        function updateSaveSlotComparisonDropdowns() {
            const dropdown1 = document.getElementById('compareSlot1');
            const dropdown2 = document.getElementById('compareSlot2');
            
            if (!dropdown1 || !dropdown2) return;
            
            // Clear existing options
            dropdown1.innerHTML = '<option value="">Select First Save Slot</option>';
            dropdown2.innerHTML = '<option value="">Select Second Save Slot</option>';
            
            // Add save slots as options
            saveSlots.forEach(slot => {
                const option1 = document.createElement('option');
                option1.value = slot.id;
                option1.textContent = `${slot.name} (${new Date(slot.date).toLocaleDateString()})`;
                dropdown1.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = slot.id;
                option2.textContent = `${slot.name} (${new Date(slot.date).toLocaleDateString()})`;
                dropdown2.appendChild(option2);
            });
        }
        
        function compareSaveSlots() {
            const slot1Id = document.getElementById('compareSlot1').value;
            const slot2Id = document.getElementById('compareSlot2').value;
            
            if (!slot1Id || !slot2Id) {
                showNotification('Please select two save slots to compare', 'warning');
                return;
            }
            
            if (slot1Id === slot2Id) {
                showNotification('Please select two different save slots', 'warning');
                return;
            }
            
            const slot1 = saveSlots.find(s => s.id === slot1Id);
            const slot2 = saveSlots.find(s => s.id === slot2Id);
            
            if (!slot1 || !slot2) return;
            
            const comparison = compareData(slot1.data, slot2.data);
            displaySaveSlotComparison(slot1, slot2, comparison);
        }
        
        function compareWithCurrent(slotId) {
            const slot = saveSlots.find(s => s.id === slotId);
            if (!slot) return;
            
            const currentData = {
                salesData: [...salesData],
                feedbackData: [...feedbackData],
                offers: [...offers],
                targetPlan: {...targetPlan}
            };
            
            const comparison = compareData(slot.data, currentData);
            displaySaveSlotComparison(slot, null, comparison);
        }
        
        function compareData(data1, data2) {
            const comparison = {
                salesData: {
                    added: [],
                    removed: [],
                    modified: []
                },
                feedbackData: {
                    added: [],
                    removed: [],
                    modified: []
                },
                offers: {
                    added: [],
                    removed: [],
                    modified: []
                },
                targetPlan: {
                    added: [],
                    removed: [],
                    modified: []
                }
            };
            
            // Compare sales data
            const salesIds1 = new Set(data1.salesData.map(s => `${s.date}-${s.branch}-${s.channel}`));
            const salesIds2 = new Set(data2.salesData.map(s => `${s.date}-${s.branch}-${s.channel}`));
            
            data1.salesData.forEach(sale => {
                const id = `${sale.date}-${sale.branch}-${sale.channel}`;
                if (!salesIds2.has(id)) {
                    comparison.salesData.removed.push(sale);
                }
            });
            
            data2.salesData.forEach(sale => {
                const id = `${sale.date}-${sale.branch}-${sale.channel}`;
                if (!salesIds1.has(id)) {
                    comparison.salesData.added.push(sale);
                }
            });
            
            // Similar comparison for feedback data, offers, and target plan
            // (Simplified for this example)
            
            return comparison;
        }
        
        function displaySaveSlotComparison(slot1, slot2, comparison) {
            const container = document.getElementById('saveSlotComparison');
            if (!container) return;
            
            container.innerHTML = '';
            
            const slot2Name = slot2 ? slot2.name : 'Current Data';
            const slot2Date = slot2 ? new Date(slot2.date).toLocaleString() : 'Now';
            
            container.innerHTML = `
                <div class="data-comparison">
                    <div class="comparison-header">
                        <div class="comparison-title">Save Slot Comparison</div>
                        <div class="comparison-dates">
                            ${slot1.name} (${new Date(slot1.date).toLocaleString()}) vs ${slot2Name} (${slot2Date})
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-4">
                            <h6>Sales Data</h6>
                            <table class="comparison-table">
                                <tr>
                                    <th>Added</th>
                                    <td class="added">${comparison.salesData.added.length}</td>
                                </tr>
                                <tr>
                                    <th>Removed</th>
                                    <td class="removed">${comparison.salesData.removed.length}</td>
                                </tr>
                                <tr>
                                    <th>Modified</th>
                                    <td class="modified">${comparison.salesData.modified.length}</td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-4">
                            <h6>Feedback Data</h6>
                            <table class="comparison-table">
                                <tr>
                                    <th>Added</th>
                                    <td class="added">${comparison.feedbackData.added.length}</td>
                                </tr>
                                <tr>
                                    <th>Removed</th>
                                    <td class="removed">${comparison.feedbackData.removed.length}</td>
                                </tr>
                                <tr>
                                    <th>Modified</th>
                                    <td class="modified">${comparison.feedbackData.modified.length}</td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-4">
                            <h6>Other Data</h6>
                            <table class="comparison-table">
                                <tr>
                                    <th>Offers</th>
                                    <td>${comparison.offers.added.length + comparison.offers.removed.length}</td>
                                </tr>
                                <tr>
                                    <th>Target Plans</th>
                                    <td>${comparison.targetPlan.added.length + comparison.targetPlan.removed.length}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Backup system
        function createBackup() {
            const backupType = document.getElementById('backupType').value;
            const backupLocation = document.getElementById('backupLocation').value;
            const compressBackup = document.getElementById('compressBackup').checked;
            const encryptBackup = document.getElementById('encryptBackup').checked;
            
            showLoadingOverlay(true);
            
            setTimeout(() => {
                const backup = {
                    id: generateId(),
                    type: backupType,
                    location: backupLocation,
                    date: new Date().toISOString(),
                    compressed: compressBackup,
                    encrypted: encryptBackup,
                    data: {
                        salesData: [...salesData],
                        feedbackData: [...feedbackData],
                        offers: [...offers],
                        targetPlan: {...targetPlan}
                    },
                    stats: {
                        salesRecords: salesData.length,
                        feedbackRecords: feedbackData.length,
                        offers: offers.length,
                        targetPlans: Object.keys(targetPlan).length
                    }
                };
                
                // If need to compress
                if (compressBackup) {
                    backup.data = LZString.compress(JSON.stringify(backup.data));
                    backup.compressed = true;
                }
                
                // If need to encrypt
                if (encryptBackup) {
                    // Simplified encryption example (actual application should use more secure encryption method)
                    backup.data = btoa(JSON.stringify(backup.data));
                    backup.encrypted = true;
                }
                
                backups.push(backup);
                saveBackups();
                updateBackupHistory();
                
                showLoadingOverlay(false);
                showNotification(`Backup created successfully! (${backupType})`, 'success');
            }, 1500);
        }
        
        // Data recovery
        function loadFromBackup(backupId) {
            const backup = backups.find(b => b.id === backupId);
            if (!backup) return;
            
            if (confirm(`Are you sure you want to restore from backup created on ${new Date(backup.date).toLocaleString()}? This will replace your current data.`)) {
                showLoadingOverlay(true);
                
                setTimeout(() => {
                    let data = backup.data;
                    
                    // If data is compressed, decompress
                    if (backup.compressed && typeof data === 'string') {
                        data = JSON.parse(LZString.decompress(data));
                    }
                    
                    // If data is encrypted, decrypt
                    if (backup.encrypted && typeof data === 'string') {
                        data = JSON.parse(atob(data));
                    }
                    
                    // Restore data
                    salesData = [...data.salesData];
                    feedbackData = [...data.feedbackData];
                    offers = [...data.offers];
                    targetPlan = {...data.targetPlan};
                    
                    // Update UI
                    updateAllUI();
                    saveToLocalStorage();
                    
                    showLoadingOverlay(false);
                    showNotification('Data restored successfully!', 'success');
                }, 1000);
            }
        }
        
        // Import/Export functions
        function performExport() {
            const exportDataType = document.getElementById('exportDataType').value;
            const exportFormat = document.getElementById('exportFormat').value;
            const exportStartDate = document.getElementById('exportStartDate').value;
            const exportEndDate = document.getElementById('exportEndDate').value;
            const compressExport = document.getElementById('compressExport').checked;
            const includeMetadata = document.getElementById('includeMetadata').checked;
            
            showLoadingOverlay(true);
            
            setTimeout(() => {
                let exportData = {};
                
                // Prepare export data based on selected data type
                if (exportDataType === 'all') {
                    exportData = {
                        salesData: salesData,
                        feedbackData: feedbackData,
                        offers: offers,
                        targetPlan: targetPlan
                    };
                } else if (exportDataType === 'sales') {
                    exportData = { salesData: salesData };
                } else if (exportDataType === 'feedback') {
                    exportData = { feedbackData: feedbackData };
                } else if (exportDataType === 'offers') {
                    exportData = { offers: offers };
                } else if (exportDataType === 'targets') {
                    exportData = { targetPlan: targetPlan };
                }
                
                // If need to include metadata
                if (includeMetadata) {
                    exportData.metadata = {
                        exportDate: new Date().toISOString(),
                        dateRange: {
                            start: exportStartDate,
                            end: exportEndDate
                        },
                        version: '1.0.0'
                    };
                }
                
                // Export based on selected format
                if (exportFormat === 'json') {
                    exportAsJSON(exportData, compressExport);
                } else if (exportFormat === 'excel') {
                    exportAsExcel(exportData);
                } else if (exportFormat === 'csv') {
                    exportAsCSV(exportData);
                } else if (exportFormat === 'pdf') {
                    exportAsPDF(exportData);
                }
                
                showLoadingOverlay(false);
                showNotification('Data exported successfully!', 'success');
            }, 1500);
        }
        
        function exportAsJSON(data, compress) {
            // Create blob
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            // Create download link
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `crispy-chicken-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            // Clean up
            URL.revokeObjectURL(url);
        }
        
        function exportAsExcel(data) {
            // Create workbook
            const workbook = XLSX.utils.book_new();
            
            // Add sales data worksheet
            if (data.salesData && data.salesData.length > 0) {
                const salesWS = XLSX.utils.json_to_sheet(data.salesData);
                XLSX.utils.book_append_sheet(workbook, salesWS, "Sales Data");
            }
            
            // Add feedback data worksheet
            if (data.feedbackData && data.feedbackData.length > 0) {
                const feedbackWS = XLSX.utils.json_to_sheet(data.feedbackData);
                XLSX.utils.book_append_sheet(workbook, feedbackWS, "Feedback Data");
            }
            
            // Add offers data worksheet
            if (data.offers && data.offers.length > 0) {
                const offersWS = XLSX.utils.json_to_sheet(data.offers);
                XLSX.utils.book_append_sheet(workbook, offersWS, "Offers");
            }
            
            // Export file
            const fileName = `crispy-chicken-data-${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(workbook, fileName);
        }
        
        function exportAsCSV(data) {
            // Simplified CSV export (only sales data)
            if (data.salesData && data.salesData.length > 0) {
                const csv = convertToCSV(data.salesData);
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `crispy-chicken-sales-${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
                URL.revokeObjectURL(url);
            }
        }
        
        function convertToCSV(data) {
            const headers = Object.keys(data[0]);
            const csvHeaders = headers.join(',');
            
            const csvRows = data.map(row => {
                return headers.map(header => {
                    const value = row[header];
                    return typeof value === 'string' && value.includes(',') ? `"${value}"` : value;
                }).join(',');
            });
            
            return csvHeaders + '\n' + csvRows.join('\n');
        }
        
        function exportAsPDF(data) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(18);
            doc.text('Crispy Chicken Analytics Report', 14, 22);
            
            // Add date
            doc.setFontSize(12);
            doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 14, 32);
            
            // Add sales data summary
            if (data.salesData && data.salesData.length > 0) {
                doc.setFontSize(14);
                doc.text('Sales Data Summary', 14, 42);
                
                doc.setFontSize(10);
                const totalSales = data.salesData.reduce((sum, sale) => sum + parseFloat(sale.sales), 0);
                const totalTransactions = data.salesData.reduce((sum, sale) => sum + parseInt(sale.transactions), 0);
                const avgTransaction = totalTransactions > 0 ? totalSales / totalTransactions : 0;
                
                doc.text(`Total Sales: ${formatCurrency(totalSales)}`, 14, 52);
                doc.text(`Total Transactions: ${totalTransactions}`, 14, 59);
                doc.text(`Average Transaction: ${formatCurrency(avgTransaction)}`, 14, 66);
            }
            
            // Add feedback data summary
            if (data.feedbackData && data.feedbackData.length > 0) {
                doc.setFontSize(14);
                doc.text('Feedback Summary', 14, 80);
                
                doc.setFontSize(10);
                const totalFeedback = data.feedbackData.length;
                const avgRating = data.feedbackData.reduce((sum, f) => sum + f.rating, 0) / totalFeedback;
                const positiveFeedback = data.feedbackData.filter(f => f.rating >= 4).length;
                const positivePercentage = (positiveFeedback / totalFeedback * 100).toFixed(1);
                
                doc.text(`Total Feedback: ${totalFeedback}`, 14, 90);
                doc.text(`Average Rating: ${avgRating.toFixed(1)}/5`, 14, 97);
                doc.text(`Positive Feedback: ${positivePercentage}%`, 14, 104);
            }
            
            // Save PDF
            doc.save(`crispy-chicken-report-${new Date().toISOString().split('T')[0]}.pdf`);
        }
        
        // Data integrity check
        function runIntegrityCheck() {
            const checkSalesData = document.getElementById('checkSalesData').checked;
            const checkFeedbackData = document.getElementById('checkFeedbackData').checked;
            const checkOffersData = document.getElementById('checkOffersData').checked;
            const checkTargetPlans = document.getElementById('checkTargetPlans').checked;
            const checkDataConsistency = document.getElementById('checkDataConsistency').checked;
            const checkDataCompleteness = document.getElementById('checkDataCompleteness').checked;
            
            showLoadingOverlay(true);
            
            setTimeout(() => {
                const results = {
                    salesData: { issues: [], status: 'passed' },
                    feedbackData: { issues: [], status: 'passed' },
                    offersData: { issues: [], status: 'passed' },
                    targetPlans: { issues: [], status: 'passed' },
                    consistency: { issues: [], status: 'passed' },
                    completeness: { issues: [], status: 'passed' }
                };
                
                // Check sales data
                if (checkSalesData) {
                    salesData.forEach((sale, index) => {
                        // Check required fields
                        if (!sale.date || !sale.branch || !sale.channel) {
                            results.salesData.issues.push({
                                index: index,
                                type: 'missing_field',
                                message: 'Missing required field'
                            });
                            results.salesData.status = 'failed';
                        }
                        
                        // Check data types
                        if (isNaN(parseFloat(sale.sales)) || isNaN(parseInt(sale.transactions))) {
                            results.salesData.issues.push({
                                index: index,
                                type: 'invalid_type',
                                message: 'Invalid data type for sales or transactions'
                            });
                            results.salesData.status = 'failed';
                        }
                        
                        // Check logical consistency
                        if (parseFloat(sale.sales) < 0 || parseInt(sale.transactions) < 0) {
                            results.salesData.issues.push({
                                index: index,
                                type: 'logical_error',
                                message: 'Sales or transactions cannot be negative'
                            });
                            results.salesData.status = 'failed';
                        }
                    });
                }
                
                // Check feedback data
                if (checkFeedbackData) {
                    feedbackData.forEach((feedback, index) => {
                        // Check required fields
                        if (!feedback.date || !feedback.branch || !feedback.comment) {
                            results.feedbackData.issues.push({
                                index: index,
                                type: 'missing_field',
                                message: 'Missing required field'
                            });
                            results.feedbackData.status = 'failed';
                        }
                        
                        // Check rating range
                        if (isNaN(feedback.rating) || feedback.rating < 1 || feedback.rating > 5) {
                            results.feedbackData.issues.push({
                                index: index,
                                type: 'invalid_range',
                                message: 'Rating must be between 1 and 5'
                            });
                            results.feedbackData.status = 'failed';
                        }
                    });
                }
                
                // Check offers data
                if (checkOffersData) {
                    offers.forEach((offer, index) => {
                        // Check date logic
                        if (new Date(offer.endDate) < new Date(offer.startDate)) {
                            results.offersData.issues.push({
                                index: index,
                                type: 'date_logic',
                                message: 'End date is before start date'
                            });
                            results.offersData.status = 'failed';
                        }
                        
                        // Check discount range
                        if (isNaN(offer.discount) || offer.discount < 0 || offer.discount > 100) {
                            results.offersData.issues.push({
                                index: index,
                                type: 'invalid_range',
                                message: 'Discount must be between 0 and 100'
                            });
                            results.offersData.status = 'failed';
                        }
                    });
                }
                
                // Check data consistency
                if (checkDataConsistency) {
                    // Check if sales data branches match target plan branches
                    const salesBranches = new Set(salesData.map(sale => sale.branch));
                    const targetBranches = new Set(Object.keys(targetPlan['2025-10']?.branches || {}));
                    
                    for (const branch of salesBranches) {
                        if (!targetBranches.has(branch)) {
                            results.consistency.issues.push({
                                type: 'branch_mismatch',
                                message: `Branch "${branch}" exists in sales data but not in target plan`
                            });
                            results.consistency.status = 'warning';
                        }
                    }
                }
                
                // Check data completeness
                if (checkDataCompleteness) {
                    // Check for duplicate sales records
                    const salesRecords = new Set();
                    salesData.forEach((sale, index) => {
                        const key = `${sale.date}-${sale.branch}-${sale.channel}`;
                        if (salesRecords.has(key)) {
                            results.completeness.issues.push({
                                index: index,
                                type: 'duplicate_record',
                                message: 'Duplicate sales record'
                            });
                            results.completeness.status = 'warning';
                        } else {
                            salesRecords.add(key);
                        }
                    });
                }
                
                // Display results
                displayIntegrityCheckResults(results);
                
                showLoadingOverlay(false);
                showNotification('Integrity check completed!', 'info');
            }, 2000);
        }
        
        function displayIntegrityCheckResults(results) {
            dataIntegrityResults = results;
            updateIntegrityCheckResults();
        }
        
        function updateIntegrityCheckResults() {
            const container = document.getElementById('integrityCheckResults');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (Object.keys(dataIntegrityResults).length === 0) {
                container.innerHTML = '<p>No integrity check results available. Run an integrity check to see results.</p>';
                return;
            }
            
            // Create results element
            const resultsDiv = document.createElement('div');
            resultsDiv.className = 'integrity-results';
            
            // Add summary
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'integrity-summary';
            
            let passedCount = 0;
            let warningCount = 0;
            let failedCount = 0;
            
            Object.values(dataIntegrityResults).forEach(result => {
                if (result.status === 'passed') passedCount++;
                else if (result.status === 'warning') warningCount++;
                else if (result.status === 'failed') failedCount++;
            });
            
            summaryDiv.innerHTML = `
                <h6>Integrity Check Summary</h6>
                <div class="row">
                    <div class="col-md-4">
                        <div class="integrity-stat passed">
                            <div class="stat-value">${passedCount}</div>
                            <div class="stat-label">Passed</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="integrity-stat warning">
                            <div class="stat-value">${warningCount}</div>
                            <div class="stat-label">Warnings</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="integrity-stat failed">
                            <div class="stat-value">${failedCount}</div>
                            <div class="stat-label">Failed</div>
                        </div>
                    </div>
                </div>
            `;
            
            resultsDiv.appendChild(summaryDiv);
            
            // Add detailed results
            const detailsDiv = document.createElement('div');
            detailsDiv.className = 'integrity-details';
            
            Object.entries(dataIntegrityResults).forEach(([category, result]) => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = `integrity-category ${result.status}`;
                
                const statusIcon = result.status === 'passed' ? 'check-circle' : 
                                  result.status === 'warning' ? 'exclamation-triangle' : 'times-circle';
                
                categoryDiv.innerHTML = `
                    <h6><i class="fas fa-${statusIcon}"></i> ${category}</h6>
                    <p>Status: ${result.status}</p>
                    ${result.issues.length > 0 ? `
                        <ul>
                            ${result.issues.map(issue => `<li>${issue.message}</li>`).join('')}
                        </ul>
                    ` : '<p>No issues found.</p>'}
                `;
                
                detailsDiv.appendChild(categoryDiv);
            });
            
            resultsDiv.appendChild(detailsDiv);
            container.appendChild(resultsDiv);
        }
        
        function repairData() {
            const autoRepairData = document.getElementById('autoRepairData').checked;
            const createBackupBeforeRepair = document.getElementById('createBackupBeforeRepair').checked;
            const logRepairActions = document.getElementById('logRepairActions').checked;
            const notifyOnRepair = document.getElementById('notifyOnRepair').checked;
            
            showLoadingOverlay(true);
            
            setTimeout(() => {
                let repairCount = 0;
                const repairLog = [];
                
                // If need to create backup
                if (createBackupBeforeRepair) {
                    const backup = {
                        id: generateId(),
                        type: 'pre-repair',
                        location: 'local',
                        date: new Date().toISOString(),
                        compressed: false,
                        encrypted: false,
                        data: {
                            salesData: [...salesData],
                            feedbackData: [...feedbackData],
                            offers: [...offers],
                            targetPlan: {...targetPlan}
                        },
                        stats: {
                            salesRecords: salesData.length,
                            feedbackRecords: feedbackData.length,
                            offers: offers.length,
                            targetPlans: Object.keys(targetPlan).length
                        }
                    };
                    
                    backups.push(backup);
                    saveBackups();
                    
                    if (logRepairActions) {
                        repairLog.push('Created backup before repair');
                    }
                }
                
                // Repair sales data
                if (dataIntegrityResults.salesData && dataIntegrityResults.salesData.issues.length > 0) {
                    dataIntegrityResults.salesData.issues.forEach(issue => {
                        if (autoRepairData) {
                            if (issue.type === 'missing_field') {
                                // Try to fix missing fields
                                const sale = salesData[issue.index];
                                if (!sale.date) sale.date = new Date().toISOString().split('T')[0];
                                if (!sale.branch) sale.branch = 'Crispy Chicken-Hamdan St';
                                if (!sale.channel) sale.channel = 'Dine-in';
                                
                                repairCount++;
                                if (logRepairActions) {
                                    repairLog.push(`Fixed missing fields in sales record at index ${issue.index}`);
                                }
                            } else if (issue.type === 'invalid_type') {
                                // Try to fix data types
                                const sale = salesData[issue.index];
                                if (isNaN(parseFloat(sale.sales))) sale.sales = 0;
                                if (isNaN(parseInt(sale.transactions))) sale.transactions = 0;
                                
                                repairCount++;
                                if (logRepairActions) {
                                    repairLog.push(`Fixed data types in sales record at index ${issue.index}`);
                                }
                            } else if (issue.type === 'logical_error') {
                                // Fix logical errors
                                const sale = salesData[issue.index];
                                if (parseFloat(sale.sales) < 0) sale.sales = 0;
                                if (parseInt(sale.transactions) < 0) sale.transactions = 0;
                                
                                repairCount++;
                                if (logRepairActions) {
                                    repairLog.push(`Fixed logical errors in sales record at index ${issue.index}`);
                                }
                            }
                        }
                    });
                }
                
                // Repair feedback data
                if (dataIntegrityResults.feedbackData && dataIntegrityResults.feedbackData.issues.length > 0) {
                    dataIntegrityResults.feedbackData.issues.forEach(issue => {
                        if (autoRepairData) {
                            if (issue.type === 'missing_field') {
                                // Try to fix missing fields
                                const feedback = feedbackData[issue.index];
                                if (!feedback.date) feedback.date = new Date().toISOString().split('T')[0];
                                if (!feedback.branch) feedback.branch = 'Crispy Chicken-Hamdan St';
                                if (!feedback.comment) feedback.comment = 'No comment provided';
                                
                                repairCount++;
                                if (logRepairActions) {
                                    repairLog.push(`Fixed missing fields in feedback record at index ${issue.index}`);
                                }
                            } else if (issue.type === 'invalid_range') {
                                // Fix rating range
                                const feedback = feedbackData[issue.index];
                                if (feedback.rating < 1) feedback.rating = 1;
                                if (feedback.rating > 5) feedback.rating = 5;
                                
                                repairCount++;
                                if (logRepairActions) {
                                    repairLog.push(`Fixed rating range in feedback record at index ${issue.index}`);
                                }
                            }
                        }
                    });
                }
                
                // Repair offers data
                if (dataIntegrityResults.offersData && dataIntegrityResults.offersData.issues.length > 0) {
                    dataIntegrityResults.offersData.issues.forEach(issue => {
                        if (autoRepairData) {
                            if (issue.type === 'date_logic') {
                                // Fix date logic
                                const offer = offers[issue.index];
                                if (new Date(offer.endDate) < new Date(offer.startDate)) {
                                    // Swap start and end dates
                                    const temp = offer.startDate;
                                    offer.startDate = offer.endDate;
                                    offer.endDate = temp;
                                    
                                    repairCount++;
                                    if (logRepairActions) {
                                        repairLog.push(`Fixed date logic in offer at index ${issue.index}`);
                                    }
                                }
                            } else if (issue.type === 'invalid_range') {
                                // Fix discount range
                                const offer = offers[issue.index];
                                if (offer.discount < 0) offer.discount = 0;
                                if (offer.discount > 100) offer.discount = 100;
                                
                                repairCount++;
                                if (logRepairActions) {
                                    repairLog.push(`Fixed discount range in offer at index ${issue.index}`);
                                }
                            }
                        }
                    });
                }
                
                // Update UI
                updateAllUI();
                saveToLocalStorage();
                
                // Display repair results
                const resultsDiv = document.getElementById('dataRepairResults');
                if (resultsDiv) {
                    resultsDiv.innerHTML = `
                        <div class="alert alert-${repairCount > 0 ? 'success' : 'info'}">
                            <h6>Repair Results</h6>
                            <p>${repairCount} issues repaired.</p>
                            ${logRepairActions ? `
                                <h6>Repair Log:</h6>
                                <ul>
                                    ${repairLog.map(log => `<li>${log}</li>`).join('')}
                                </ul>
                            ` : ''}
                        </div>
                    `;
                }
                
                showLoadingOverlay(false);
                
                if (notifyOnRepair) {
                    showNotification(`Data repair completed! ${repairCount} issues fixed.`, 'success');
                }
            }, 2000);
        }
        
        // Backup schedule
        function saveBackupSchedule() {
            const backupFrequency = document.getElementById('backupFrequency').value;
            const backupTime = document.getElementById('backupTime').value;
            const customInterval = document.getElementById('customInterval').value;
            const backupRetention = document.getElementById('backupRetention').value;
            const backupTypeSchedule = document.getElementById('backupTypeSchedule').value;
            const enableScheduledBackup = document.getElementById('enableScheduledBackup').checked;
            
            backupSchedule = {
                frequency: backupFrequency,
                time: backupTime,
                customInterval: customInterval,
                retention: backupRetention,
                type: backupTypeSchedule,
                enabled: enableScheduledBackup,
                lastRun: null
            };
            
            saveBackupScheduleToStorage();
            updateScheduledBackups();
            
            showNotification('Backup schedule saved successfully!', 'success');
            
            // If enabled, set next backup
            if (enableScheduledBackup) {
                scheduleNextBackup();
            }
        }
        
        function scheduleNextBackup() {
            if (!backupSchedule.enabled) return;
            
            const now = new Date();
            const [hours, minutes] = backupSchedule.time.split(':').map(Number);
            
            let nextBackup = new Date(now);
            nextBackup.setHours(hours, minutes, 0, 0);
            
            // If today's backup time has passed, set to tomorrow
            if (nextBackup <= now) {
                nextBackup.setDate(nextBackup.getDate() + 1);
            }
            
            // Calculate delay (milliseconds)
            const delay = nextBackup - now;
            
            // Set timer
            setTimeout(() => {
                runScheduledBackup();
                
                // Schedule next backup
                scheduleNextBackup();
            }, delay);
        }
        
        function runScheduledBackup() {
            const backup = {
                id: generateId(),
                type: backupSchedule.type,
                location: 'local',
                date: new Date().toISOString(),
                compressed: false,
                encrypted: false,
                data: {
                    salesData: [...salesData],
                    feedbackData: [...feedbackData],
                    offers: [...offers],
                    targetPlan: {...targetPlan}
                },
                stats: {
                    salesRecords: salesData.length,
                    feedbackRecords: feedbackData.length,
                    offers: offers.length,
                    targetPlans: Object.keys(targetPlan).length
                },
                status: 'completed'
            };
            
            backups.push(backup);
            saveBackups();
            
            // Add to scheduled backup history
            scheduledBackups.push(backup);
            saveScheduledBackups();
            
            // Update schedule backup last run time
            backupSchedule.lastRun = new Date().toISOString();
            saveBackupScheduleToStorage();
            
            // Clean up old backups
            cleanupOldBackups();
            
            // Update UI
            updateScheduledBackups();
            
            showNotification('Scheduled backup completed successfully!', 'success');
        }
        
        function cleanupOldBackups() {
            if (!backupSchedule.retention) return;
            
            const cutoffDate = new Date();
            cutoffDate.setDate(cutoffDate.getDate() - parseInt(backupSchedule.retention));
            
            // Clean up normal backups
            const originalBackupsLength = backups.length;
            backups = backups.filter(backup => new Date(backup.date) >= cutoffDate);
            
            if (backups.length < originalBackupsLength) {
                saveBackups();
            }
            
            // Clean up scheduled backup history
            const originalScheduledBackupsLength = scheduledBackups.length;
            scheduledBackups = scheduledBackups.filter(backup => new Date(backup.date) >= cutoffDate);
            
            if (scheduledBackups.length < originalScheduledBackupsLength) {
                saveScheduledBackups();
            }
        }
        
        function updateScheduledBackups() {
            const container = document.getElementById('scheduledBackupsContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (!backupSchedule.enabled) {
                container.innerHTML = '<p>Scheduled backups are disabled.</p>';
                return;
            }
            
            // Create schedule backup element
            const scheduleDiv = document.createElement('div');
            scheduleDiv.className = 'scheduled-backup';
            
            const frequencyText = backupSchedule.frequency === 'daily' ? 'Daily' :
                              backupSchedule.frequency === 'weekly' ? 'Weekly' :
                              backupSchedule.frequency === 'monthly' ? 'Monthly' :
                              `Every ${backupSchedule.customInterval} hours`;
            
            scheduleDiv.innerHTML = `
                <h6>Current Backup Schedule</h6>
                <p><strong>Frequency:</strong> ${frequencyText}</p>
                <p><strong>Time:</strong> ${backupSchedule.time}</p>
                <p><strong>Type:</strong> ${backupSchedule.type}</p>
                <p><strong>Retention:</strong> Keep for ${backupSchedule.retention} days</p>
                <p><strong>Last Run:</strong> ${backupSchedule.lastRun ? new Date(backupSchedule.lastRun).toLocaleString() : 'Never'}</p>
                <p><strong>Next Run:</strong> ${calculateNextBackupTime()}</p>
            `;
            
            container.appendChild(scheduleDiv);
            
            // Display scheduled backup history
            if (scheduledBackups.length > 0) {
                const historyDiv = document.createElement('div');
                historyDiv.className = 'scheduled-backup-history';
                
                historyDiv.innerHTML = '<h6>Scheduled Backup History</h6>';
                
                const historyList = document.createElement('ul');
                historyList.className = 'list-group';
                
                // Sort by date (newest first)
                const sortedBackups = [...scheduledBackups].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                // Only show recent 10 backups
                const recentBackups = sortedBackups.slice(0, 10);
                
                recentBackups.forEach(backup => {
                    const backupItem = document.createElement('li');
                    backupItem.className = 'list-group-item';
                    
                    const date = new Date(backup.date);
                    const formattedDate = date.toLocaleString();
                    
                    backupItem.innerHTML = `
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">${backup.type} Backup</h6>
                            <small>${formattedDate}</small>
                        </div>
                        <p class="mb-1">Status: ${backup.status}</p>
                        <small>Size: ${calculateDataSize(backup)}</small>
                    `;
                    
                    historyList.appendChild(backupItem);
                });
                
                historyDiv.appendChild(historyList);
                container.appendChild(historyDiv);
            }
        }
        
        function calculateNextBackupTime() {
            if (!backupSchedule.enabled) return 'Disabled';
            
            const now = new Date();
            const [hours, minutes] = backupSchedule.time.split(':').map(Number);
            
            let nextBackup = new Date(now);
            nextBackup.setHours(hours, minutes, 0, 0);
            
            // If today's backup time has passed, set to tomorrow
            if (nextBackup <= now) {
                nextBackup.setDate(nextBackup.getDate() + 1);
            }
            
            // Adjust based on frequency
            if (backupSchedule.frequency === 'weekly') {
                // Set to next week same day
                nextBackup.setDate(nextBackup.getDate() + 7);
            } else if (backupSchedule.frequency === 'monthly') {
                // Set to next month same day
                nextBackup.setMonth(nextBackup.getMonth() + 1);
            } else if (backupSchedule.frequency === 'custom') {
                // Set to custom interval after time
                nextBackup.setTime(nextBackup.getTime() + (backupSchedule.customInterval * 60 * 60 * 1000));
            }
            
            return nextBackup.toLocaleString();
        }
        
        // Cloud storage
        function saveCloudSettings() {
            const cloudProvider = document.getElementById('cloudProvider').value;
            const cloudFolder = document.getElementById('cloudFolder').value;
            const cloudApiKey = document.getElementById('cloudApiKey').value;
            const cloudAccount = document.getElementById('cloudAccount').value;
            const enableCloudBackup = document.getElementById('enableCloudBackup').checked;
            const encryptCloudBackup = document.getElementById('encryptCloudBackup').checked;
            const syncToCloud = document.getElementById('syncToCloud').checked;
            
            cloudSettings = {
                provider: cloudProvider,
                folder: cloudFolder,
                apiKey: cloudApiKey,
                account: cloudAccount,
                enabled: enableCloudBackup,
                encrypt: encryptCloudBackup,
                sync: syncToCloud
            };
            
            saveCloudSettingsToStorage();
            updateCloudStorageStatus();
            
            showNotification('Cloud settings saved successfully!', 'success');
        }
        
        function updateCloudStorageStatus() {
            const container = document.getElementById('cloudStorageStatus');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (!cloudSettings.enabled) {
                container.innerHTML = '<p>Cloud storage is disabled.</p>';
                return;
            }
            
            // Create cloud storage status element
            const statusDiv = document.createElement('div');
            statusDiv.className = 'cloud-storage-status';
            
            statusDiv.innerHTML = `
                <h6>Cloud Storage Settings</h6>
                <p><strong>Provider:</strong> ${cloudSettings.provider}</p>
                <p><strong>Folder:</strong> ${cloudSettings.folder}</p>
                <p><strong>Account:</strong> ${cloudSettings.account}</p>
                <p><strong>Encryption:</strong> ${cloudSettings.encrypt ? 'Enabled' : 'Disabled'}</p>
                <p><strong>Sync:</strong> ${cloudSettings.sync ? 'Enabled' : 'Disabled'}</p>
                <div class="mt-3">
                    <button class="btn btn-sm btn-primary" onclick="testCloudConnection()">
                        <i class="fas fa-plug"></i> Test Connection
                    </button>
                    <button class="btn btn-sm btn-success" onclick="syncToCloud()">
                        <i class="fas fa-sync"></i> Sync Now
                    </button>
                </div>
            `;
            
            container.appendChild(statusDiv);
            
            // Display cloud backup history
            const cloudBackups = backups.filter(backup => backup.location === 'cloud');
            
            if (cloudBackups.length > 0) {
                const historyDiv = document.createElement('div');
                historyDiv.className = 'cloud-backup-history';
                
                historyDiv.innerHTML = '<h6>Cloud Backup History</h6>';
                
                const historyList = document.createElement('ul');
                historyList.className = 'list-group';
                
                // Sort by date (newest first)
                const sortedBackups = [...cloudBackups].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                // Only show recent 10 backups
                const recentBackups = sortedBackups.slice(0, 10);
                
                recentBackups.forEach(backup => {
                    const backupItem = document.createElement('li');
                    backupItem.className = 'list-group-item';
                    
                    const date = new Date(backup.date);
                    const formattedDate = date.toLocaleString();
                    
                    backupItem.innerHTML = `
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">${backup.type} Backup</h6>
                            <small>${formattedDate}</small>
                        </div>
                        <p class="mb-1">Status: ${backup.status}</p>
                        <small>Size: ${calculateDataSize(backup)}</small>
                    `;
                    
                    historyList.appendChild(backupItem);
                });
                
                historyDiv.appendChild(historyList);
                container.appendChild(historyDiv);
            }
        }
        
        function testCloudConnection() {
            showLoadingOverlay(true);
            
            setTimeout(() => {
                showLoadingOverlay(false);
                
                // Simulate connection test
                const success = Math.random() > 0.2; // 80% success rate
                
                if (success) {
                    showNotification('Cloud connection test successful!', 'success');
                } else {
                    showNotification('Cloud connection test failed. Please check your settings.', 'danger');
                }
            }, 2000);
        }
        
        function syncToCloud() {
            if (!cloudSettings.enabled) {
                showNotification('Cloud storage is disabled. Please enable it in settings.', 'warning');
                return;
            }
            
            showLoadingOverlay(true);
            
            setTimeout(() => {
                // Create cloud backup
                const backup = {
                    id: generateId(),
                    type: 'manual',
                    location: 'cloud',
                    date: new Date().toISOString(),
                    compressed: cloudSettings.encrypt || false,
                    encrypted: cloudSettings.encrypt || false,
                    data: {
                        salesData: [...salesData],
                        feedbackData: [...feedbackData],
                        offers: [...offers],
                        targetPlan: {...targetPlan}
                    },
                    stats: {
                        salesRecords: salesData.length,
                        feedbackRecords: feedbackData.length,
                        offers: offers.length,
                        targetPlans: Object.keys(targetPlan).length
                    },
                    status: 'completed'
                };
                
                // If need to encrypt
                if (cloudSettings.encrypt) {
                    backup.data = btoa(JSON.stringify(backup.data));
                    backup.encrypted = true;
                }
                
                backups.push(backup);
                saveBackups();
                
                showLoadingOverlay(false);
                showNotification('Data synced to cloud successfully!', 'success');
                
                // Update cloud storage status
                updateCloudStorageStatus();
            }, 3000);
        }
        
        // Target plan functions
        function exportTargetPlan() {
            const currentMonth = '2025-10';
            const currentTargetPlan = targetPlan[currentMonth];
            
            if (!currentTargetPlan) {
                showNotification('No target plan available for export', 'warning');
                return;
            }
            
            // Prepare export data
            const exportData = {
                month: currentMonth,
                totalTarget: currentTargetPlan.totalTarget,
                branches: currentTargetPlan.branches,
                achievements: {}
            };
            
            // Calculate branch achievements
            Object.keys(currentTargetPlan.branches).forEach(branch => {
                const achievement = calculateBranchAchievement(branch, currentMonth);
                const target = currentTargetPlan.branches[branch];
                const percentage = (achievement / target) * 100;
                
                exportData.achievements[branch] = {
                    target: target,
                    achievement: achievement,
                    percentage: percentage
                };
            });
            
            // Create workbook
            const workbook = XLSX.utils.book_new();
            
            // Add target plan worksheet
            const targetWS = XLSX.utils.json_to_sheet([{
                Month: currentMonth,
                'Total Target': currentTargetPlan.totalTarget
            }]);
            XLSX.utils.book_append_sheet(workbook, targetWS, "Target Summary");
            
            // Add branch target worksheet
            const branchData = Object.keys(currentTargetPlan.branches).map(branch => ({
                Branch: branch,
                Target: currentTargetPlan.branches[branch],
                Achievement: exportData.achievements[branch].achievement,
                'Achievement %': exportData.achievements[branch].percentage.toFixed(2) + '%'
            }));
            
            const branchWS = XLSX.utils.json_to_sheet(branchData);
            XLSX.utils.book_append_sheet(workbook, branchWS, "Branch Targets");
            
            // Export file
            const fileName = `crispy-chicken-target-plan-${currentMonth}.xlsx`;
            XLSX.writeFile(workbook, fileName);
            
            showNotification('Target plan exported successfully!', 'success');
        }
        
        function saveTargetPlan() {
            const targetMonth = document.getElementById('targetMonth').value;
            const totalMonthlyTarget = parseFloat(document.getElementById('totalMonthlyTarget').value);
            
            if (!targetMonth || isNaN(totalMonthlyTarget) || totalMonthlyTarget <= 0) {
                showNotification('Please enter valid target details', 'warning');
                return;
            }
            
            // Get branch targets
            const branchTargets = {};
            const branchInputs = document.querySelectorAll('#branchTargetInputs .target-input-group');
            
            let totalBranchTarget = 0;
            branchInputs.forEach(input => {
                const branch = input.querySelector('label').textContent;
                const target = parseFloat(input.querySelector('input').value);
                
                if (!isNaN(target) && target > 0) {
                    branchTargets[branch] = target;
                    totalBranchTarget += target;
                }
            });
            
            // Check if branch targets sum equals total target
            if (Math.abs(totalBranchTarget - totalMonthlyTarget) > 0.01) {
                showNotification(`Branch targets (${formatCurrency(totalBranchTarget)}) must equal total target (${formatCurrency(totalMonthlyTarget)})`, 'warning');
                return;
            }
            
            // Save target plan
            if (!targetPlan[targetMonth]) {
                targetPlan[targetMonth] = {};
            }
            
            targetPlan[targetMonth].totalTarget = totalMonthlyTarget;
            targetPlan[targetMonth].branches = branchTargets;
            
            // Update UI
            updateTargetPlan();
            saveToLocalStorage();
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('editTargetModal'));
            if (modal) modal.hide();
            
            showNotification('Target plan saved successfully!', 'success');
        }
        
        // Download Excel template
        function downloadExcelTemplate() {
            // Create workbook
            const workbook = XLSX.utils.book_new();
            
            // Create sample data
            const sampleData = [
                {
                    'Date': '2025-10-01',
                    'Branch': 'Crispy Chicken-Hamdan St',
                    'Channel': 'Delivery',
                    'Transactions': 73,
                    'Sales': 3216.00,
                    'Offer Type': 'Normal Day',
                    'Offer Status': 'No Offer',
                    'Notes': 'Sample record'
                },
                {
                    'Date': '2025-10-01',
                    'Branch': 'Crispy Chicken Khaldia',
                    'Channel': 'Dine-in',
                    'Transactions': 52,
                    'Sales': 2600.00,
                    'Offer Type': 'Chicken Day',
                    'Offer Status': 'Active',
                    'Notes': 'Sample record'
                }
            ];
            
            // Create worksheet
            const worksheet = XLSX.utils.json_to_sheet(sampleData);
            XLSX.utils.book_append_sheet(workbook, worksheet, "Sales Data");
            
            // Export file
            XLSX.writeFile(workbook, "crispy-chicken-template.xlsx");
            
            showNotification('Excel template downloaded successfully!', 'success');
        }
        
        // Undo last action
        function undoLastAction() {
            if (undoStack.length === 0) {
                showNotification('No actions to undo', 'info');
                return;
            }
            
            const lastAction = undoStack.pop();
            
            if (lastAction.action === 'add') {
                // Undo add action
                if (lastAction.type === 'sales') {
                    const index = salesData.findIndex(sale => 
                        sale.date === lastAction.data.date && 
                        sale.branch === lastAction.data.branch && 
                        sale.channel === lastAction.data.channel
                    );
                    
                    if (index !== -1) {
                        salesData.splice(index, 1);
                    }
                } else if (lastAction.type === 'feedback') {
                    const index = feedbackData.findIndex(feedback => 
                        feedback.date === lastAction.data.date && 
                        feedback.branch === lastAction.data.branch && 
                        feedback.comment === lastAction.data.comment
                    );
                    
                    if (index !== -1) {
                        feedbackData.splice(index, 1);
                    }
                }
            } else if (lastAction.action === 'delete') {
                // Undo delete action
                if (lastAction.type === 'sales') {
                    salesData.splice(lastAction.index, 0, lastAction.data);
                } else if (lastAction.type === 'feedback') {
                    feedbackData.splice(lastAction.index, 0, lastAction.data);
                }
            }
            
            // Update UI
            updateAllUI();
            saveToLocalStorage();
            
            // Update undo status
            const undoStatusEl = document.getElementById('undoStatus');
            if (undoStatusEl) {
                undoStatusEl.textContent = undoStack.length > 0 ? `${undoStack.length} actions available` : 'No actions to undo';
            }
            
            showNotification('Last action undone successfully!', 'info');
        }
        
        // Initialize branch target inputs
        function initializeBranchTargetInputs() {
            const container = document.getElementById('branchTargetInputs');
            if (!container) return;
            
            container.innerHTML = '';
            
            const branches = [
                'Crispy Chicken-Hamdan St',
                'Crispy Chicken Khaldia',
                'Crispy Chicken Shabiya 11',
                'Crispy Chicken Muroor',
                'Crispy Chicken Al Barsha',
                'Crispy Chicken Al Satwa',
                'Crispy Chicken Al Rgga'
            ];
            
            branches.forEach(branch => {
                const inputGroup = document.createElement('div');
                inputGroup.className = 'target-input-group';
                
                inputGroup.innerHTML = `
                    <label>${branch}</label>
                    <input type="number" class="form-control" min="0" step="100" placeholder="0">
                    <div class="target-percentage-display">0%</div>
                `;
                
                container.appendChild(inputGroup);
                
                // Add input event listener
                const input = inputGroup.querySelector('input');
                const percentageDisplay = inputGroup.querySelector('.target-percentage-display');
                
                input.addEventListener('input', function() {
                    const value = parseFloat(this.value) || 0;
                    const totalTarget = parseFloat(document.getElementById('totalMonthlyTarget').value) || 0;
                    const percentage = totalTarget > 0 ? (value / totalTarget) * 100 : 0;
                    
                    percentageDisplay.textContent = `${percentage.toFixed(1)}%`;
                    
                    // Update color based on percentage
                    if (percentage < 80) {
                        percentageDisplay.style.backgroundColor = '#f8d7da';
                        percentageDisplay.style.color = '#721c24';
                    } else if (percentage > 120) {
                        percentageDisplay.style.backgroundColor = '#fff3cd';
                        percentageDisplay.style.color = '#856404';
                    } else {
                        percentageDisplay.style.backgroundColor = '#d4edda';
                        percentageDisplay.style.color = '#155724';
                    }
                });
            });
            
            // Add total target input event listener
            const totalTargetInput = document.getElementById('totalMonthlyTarget');
            if (totalTargetInput) {
                totalTargetInput.addEventListener('input', function() {
                    // Update all branch percentage displays
                    const totalTarget = parseFloat(this.value) || 0;
                    
                    document.querySelectorAll('#branchTargetInputs .target-input-group').forEach(group => {
                        const input = group.querySelector('input');
                        const percentageDisplay = group.querySelector('.target-percentage-display');
                        
                        const value = parseFloat(input.value) || 0;
                        const percentage = totalTarget > 0 ? (value / totalTarget) * 100 : 0;
                        
                        percentageDisplay.textContent = `${percentage.toFixed(1)}%`;
                        
                        // Update color based on percentage
                        if (percentage < 80) {
                            percentageDisplay.style.backgroundColor = '#f8d7da';
                            percentageDisplay.style.color = '#721c24';
                        } else if (percentage > 120) {
                            percentageDisplay.style.backgroundColor = '#fff3cd';
                            percentageDisplay.style.color = '#856404';
                        } else {
                            percentageDisplay.style.backgroundColor = '#d4edda';
                            percentageDisplay.style.color = '#155724';
                        }
                    });
                });
            }
        }
        
        // Edit target plan modal event listener
        document.getElementById('editTargetModal')?.addEventListener('show.bs.modal', function() {
            initializeBranchTargetInputs();
            
            // Set current month
            const currentMonth = new Date().toISOString().slice(0, 7);
            document.getElementById('targetMonth').value = currentMonth;
            
            // If have current month target plan, load it
            if (targetPlan[currentMonth]) {
                document.getElementById('totalMonthlyTarget').value = targetPlan[currentMonth].totalTarget;
                
                // Set branch targets
                Object.keys(targetPlan[currentMonth].branches).forEach(branch => {
                    const inputGroups = document.querySelectorAll('#branchTargetInputs .target-input-group');
                    
                    inputGroups.forEach(group => {
                        const label = group.querySelector('label');
                        if (label.textContent === branch) {
                            const input = group.querySelector('input');
                            input.value = targetPlan[currentMonth].branches[branch];
                            
                            // Trigger input event to update percentage display
                            input.dispatchEvent(new Event('input'));
                        }
                    });
                });
            }
        });
        
        // Update recommendations
        function updateRecommendations() {
            // Short-term recommendations
            const shortTermRecs = document.getElementById('shortTermRecommendations');
            if (shortTermRecs) {
                shortTermRecs.innerHTML = '';
                
                const shortTerm = [
                    'Increase weekend promotions at Hamdan St branch to handle high traffic',
                    'Introduce more family meal packages at Al Barsha branch to increase average transaction value',
                    'Optimize Muroor branch operating hours to match customer demand patterns',
                    'Add new product sampling activities at Khaldia branch to attract more customers'
                ];
                
                shortTerm.forEach(rec => {
                    const li = document.createElement('li');
                    li.textContent = rec;
                    shortTermRecs.appendChild(li);
                });
            }
            
            // Medium-term recommendations
            const mediumTermRecs = document.getElementById('mediumTermRecommendations');
            if (mediumTermRecs) {
                mediumTermRecs.innerHTML = '';
                
                const mediumTerm = [
                    'Redistribute target sales indicators for each branch based on sales data',
                    'Create specific improvement plans for underperforming branches',
                    'Analyze ROI of different offer types and optimize promotion strategy',
                    'Evaluate new branch location possibilities to expand market coverage'
                ];
                
                mediumTerm.forEach(rec => {
                    const li = document.createElement('li');
                    li.textContent = rec;
                    mediumTermRecs.appendChild(li);
                });
            }
            
            // Long-term recommendations
            const longTermRecs = document.getElementById('longTermRecommendations');
            if (longTermRecs) {
                longTermRecs.innerHTML = '';
                
                const longTerm = [
                    'Develop customer loyalty program to increase retention rate',
                    'Consider launching online ordering and delivery services',
                    'Explore new product lines to increase revenue sources',
                    'Develop brand expansion plan to enter new market areas'
                ];
                
                longTerm.forEach(rec => {
                    const li = document.createElement('li');
                    li.textContent = rec;
                    longTermRecs.appendChild(li);
                });
            }
        }
        
        // Excel import functions
        function processExcelFile() {
            if (!window.selectedFile) {
                showNotification('Please select a file first', 'warning');
                return;
            }
            
            showLoadingOverlay(true);
            const progressBar = document.querySelector('#importProgress .progress-bar');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // Assume data is in first worksheet
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                    
                    // Validate data format
                    if (!validateExcelData(jsonData)) {
                        showLoadingOverlay(false);
                        return;
                    }
                    
                    // Process data
                    let importedCount = 0;
                    const batchSize = 10;
                    let currentBatch = 0;
                    
                    function processBatch() {
                        const start = currentBatch * batchSize;
                        const end = Math.min(start + batchSize, jsonData.length);
                        
                        for (let i = start; i < end; i++) {
                            const row = jsonData[i];
                            
                            // Convert data format
                            const salesRecord = {
                                date: formatDate(row['Date']),
                                branch: row['Branch'],
                                channel: row['Channel'],
                                transactions: parseInt(row['Transactions']),
                                sales: parseFloat(row['Sales']),
                                average: parseFloat(row['Average per Order']) || parseFloat(row['Sales']) / parseInt(row['Transactions']),
                                offerType: row['Offer Type'],
                                offerStatus: row['Offer Status'],
                                notes: row['Notes'] || ''
                            };
                            
                            // Check if record already exists
                            const exists = salesData.some(sale => 
                                sale.date === salesRecord.date && 
                                sale.branch === salesRecord.branch && 
                                sale.channel === salesRecord.channel
                            );
                            
                            if (!exists) {
                                salesData.push(salesRecord);
                                importedCount++;
                            }
                        }
                        
                        currentBatch++;
                        const progress = (currentBatch * batchSize / jsonData.length) * 100;
                        progressBar.style.width = `${progress}%`;
                        
                        if (currentBatch * batchSize < jsonData.length) {
                            setTimeout(processBatch, 100);
                        } else {
                            // Processing complete
                            showLoadingOverlay(false);
                            updateAllUI();
                            saveToLocalStorage();
                            showNotification(`${importedCount} records imported successfully!`, 'success');
                            
                            // Reset progress bar
                            progressBar.style.width = '0%';
                            document.getElementById('importProgress').classList.add('d-none');
                            document.getElementById('importExcelBtn').classList.add('d-none');
                            
                            // Reset file selection
                            window.selectedFile = null;
                            document.getElementById('fileDropArea').querySelector('p').textContent = 
                                'Drag and drop your Excel file here or browse files';
                        }
                    }
                    
                    // Start processing batches
                    processBatch();
                    
                } catch (error) {
                    showLoadingOverlay(false);
                    showNotification(`Error processing Excel file: ${error.message}`, 'danger');
                }
            };
            
            reader.readAsArrayBuffer(window.selectedFile);
        }
        
        function validateExcelData(data) {
            if (!data || data.length === 0) {
                showNotification('Excel file is empty or invalid', 'danger');
                return false;
            }
            
            // Check required columns
            const requiredColumns = ['Date', 'Branch', 'Channel', 'Transactions', 'Sales', 'Offer Type', 'Offer Status'];
            const firstRow = data[0];
            
            for (const column of requiredColumns) {
                if (!(column in firstRow)) {
                    showNotification(`Missing required column: ${column}`, 'danger');
                    return false;
                }
            }
            
            return true;
        }
        
        function formatDate(dateString) {
            // Handle different date formats
            if (typeof dateString === 'number') {
                // Excel date serial number
                const date = new Date((dateString - 25569) * 86400 * 1000);
                return date.toISOString().split('T')[0];
            } else if (typeof dateString === 'string') {
                // Try to parse string date
                const date = new Date(dateString);
                if (!isNaN(date.getTime())) {
                    return date.toISOString().split('T')[0];
                }
            }
            
            // If cannot parse, return current date
            return new Date().toISOString().split('T')[0];
        }
        
        // Helper functions
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }
        
        function showLoadingOverlay(show) {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.style.display = show ? 'flex' : 'none';
            }
        }
        
        function showNotification(message, type) {
            const container = document.getElementById('notificationContainer');
            if (!container) return;
            
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} alert-dismissible fade show notification`;
            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;
            
            container.appendChild(notification);
            
            // Auto remove notification
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }
        
        function calculateDataSize(data) {
            // Simplified size calculation
            const size = JSON.stringify(data).length;
            if (size < 1024) {
                return `${size} B`;
            } else if (size < 1024 * 1024) {
                return `${(size / 1024).toFixed(2)} KB`;
            } else {
                return `${(size / (1024 * 1024)).toFixed(2)} MB`;
            }
        }
        
        function deleteBackup(backupId) {
            const backup = backups.find(b => b.id === backupId);
            if (!backup) return;
            
            if (confirm(`Are you sure you want to delete this backup from ${new Date(backup.date).toLocaleString()}?`)) {
                backups = backups.filter(b => b.id !== backupId);
                saveBackups();
                updateBackupHistory();
                
                showNotification('Backup deleted successfully!', 'warning');
            }
        }
        
        function updateBackupHistory() {
            const container = document.getElementById('backupHistoryContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Filter backups
            const filter = document.getElementById('backupFilter')?.value || 'all';
            const locationFilter = document.getElementById('backupLocationFilter')?.value || 'all';
            
            let filteredBackups = [...backups];
            
            // Apply filter
            if (filter !== 'all') {
                filteredBackups = filteredBackups.filter(backup => backup.type === filter);
            }
            
            if (locationFilter !== 'all') {
                filteredBackups = filteredBackups.filter(backup => backup.location === locationFilter);
            }
            
            // Sort by date (newest first)
            filteredBackups.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Create backup elements
            filteredBackups.forEach(backup => {
                const backupElement = createBackupElement(backup);
                container.appendChild(backupElement);
            });
        }
        
        function createBackupElement(backup) {
            const backupDiv = document.createElement('div');
            backupDiv.className = 'backup-item';
            
            const date = new Date(backup.date);
            const formattedDate = date.toLocaleString();
            
            backupDiv.innerHTML = `
                <div class="backup-header">
                    <div class="backup-title">${backup.type} Backup</div>
                    <div class="backup-date">${formattedDate}</div>
                </div>
                <div class="backup-details">
                    <span>Location: ${backup.location}</span>
                    <span>Size: ${calculateDataSize(backup)}</span>
                    ${backup.compressed ? '<span class="badge bg-info">Compressed</span>' : ''}
                    ${backup.encrypted ? '<span class="badge bg-warning">Encrypted</span>' : ''}
                </div>
                <div class="backup-stats">
                    <span>Sales: ${backup.stats.salesRecords}</span>
                    <span>Feedback: ${backup.stats.feedbackRecords}</span>
                    <span>Offers: ${backup.stats.offers}</span>
                    <span>Targets: ${backup.stats.targetPlans}</span>
                </div>
                <div class="backup-actions">
                    <button class="btn btn-sm btn-primary" onclick="loadFromBackup('${backup.id}')">
                        <i class="fas fa-upload"></i> Restore
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteBackup('${backup.id}')">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            `;
            
            return backupDiv;
        }
        
        function updateRecoveryPoints() {
            const container = document.getElementById('recoveryPointsContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Sort by date (newest first)
            recoveryPoints.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Create recovery point elements
            recoveryPoints.forEach(point => {
                const pointElement = createRecoveryPointElement(point);
                container.appendChild(pointElement);
            });
        }
        
        function createRecoveryPointElement(point) {
            const pointDiv = document.createElement('div');
            pointDiv.className = 'recovery-point';
            
            const date = new Date(point.date);
            const formattedDate = date.toLocaleString();
            
            pointDiv.innerHTML = `
                <div class="recovery-point-header">
                    <div class="recovery-point-title">${point.name}</div>
                    <div class="recovery-point-date">${formattedDate}</div>
                </div>
                <div class="recovery-point-details">
                    <span>Type: ${point.type}</span>
                    <span>Size: ${calculateDataSize(point)}</span>
                </div>
                <div class="recovery-point-stats">
                    <span>Sales: ${point.stats.salesRecords}</span>
                    <span>Feedback: ${point.stats.feedbackRecords}</span>
                    <span>Offers: ${point.stats.offers}</span>
                    <span>Targets: ${point.stats.targetPlans}</span>
                </div>
                <div class="recovery-point-actions">
                    <button class="btn btn-sm btn-primary" onclick="loadFromRecoveryPoint('${point.id}')">
                        <i class="fas fa-upload"></i> Restore
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteRecoveryPoint('${point.id}')">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            `;
            
            return pointDiv;
        }
        
        function loadFromRecoveryPoint(pointId) {
            const point = recoveryPoints.find(p => p.id === pointId);
            if (!point) return;
            
            if (confirm(`Are you sure you want to restore from recovery point "${point.name}" created on ${new Date(point.date).toLocaleString()}? This will replace your current data.`)) {
                showLoadingOverlay(true);
                
                setTimeout(() => {
                    // Restore data
                    salesData = [...point.data.salesData];
                    feedbackData = [...point.data.feedbackData];
                    offers = [...point.data.offers];
                    targetPlan = {...point.data.targetPlan};
                    
                    // Update UI
                    updateAllUI();
                    saveToLocalStorage();
                    
                    showLoadingOverlay(false);
                    showNotification('Data restored successfully!', 'success');
                }, 1000);
            }
        }
        
        function deleteRecoveryPoint(pointId) {
            const point = recoveryPoints.find(p => p.id === pointId);
            if (!point) return;
            
            if (confirm(`Are you sure you want to delete this recovery point?`)) {
                recoveryPoints = recoveryPoints.filter(p => p.id !== pointId);
                saveRecoveryPoints();
                updateRecoveryPoints();
                
                showNotification('Recovery point deleted successfully!', 'warning');
            }
        }
        
        function searchRecoveryPoints() {
            const source = document.getElementById('recoverySource').value;
            const target = document.getElementById('recoveryTarget').value;
            
            let points = [];
            
            if (source === 'backup') {
                points = backups.map(backup => ({
                    id: backup.id,
                    name: `Backup: ${backup.type}`,
                    date: backup.date,
                    type: 'backup',
                    data: backup.data,
                    stats: backup.stats
                }));
            } else if (source === 'saveSlot') {
                points = saveSlots.map(slot => ({
                    id: slot.id,
                    name: `Save Slot: ${slot.name}`,
                    date: slot.date,
                    type: 'saveSlot',
                    data: slot.data,
                    stats: slot.stats
                }));
            } else if (source === 'autoRecovery') {
                points = recoveryPoints;
            }
            
            // Filter by target
            if (target !== 'all') {
                points = points.map(point => {
                    const filteredData = {};
                    
                    if (target === 'sales') {
                        filteredData.salesData = point.data.salesData;
                    } else if (target === 'feedback') {
                        filteredData.feedbackData = point.data.feedbackData;
                    } else if (target === 'offers') {
                        filteredData.offers = point.data.offers;
                    } else if (target === 'targets') {
                        filteredData.targetPlan = point.data.targetPlan;
                    }
                    
                    return {
                        ...point,
                        data: filteredData,
                        stats: {
                            salesRecords: target === 'all' || target === 'sales' ? point.stats.salesRecords : 0,
                            feedbackRecords: target === 'all' || target === 'feedback' ? point.stats.feedbackRecords : 0,
                            offers: target === 'all' || target === 'offers' ? point.stats.offers : 0,
                            targetPlans: target === 'all' || target === 'targets' ? point.stats.targetPlans : 0
                        }
                    };
                });
            }
            
            // Display recovery points
            const container = document.getElementById('recoveryPointsContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Sort by date (newest first)
            points.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Create recovery point elements
            points.forEach(point => {
                const pointElement = createRecoveryPointElement(point);
                container.appendChild(pointElement);
            });
        }
        
        function performImport() {
            const importDataType = document.getElementById('importDataType').value;
            const importFormat = document.getElementById('importFormat').value;
            const importFile = window.selectedImportFile;
            
            if (!importFile) {
                showNotification('Please select a file first', 'warning');
                return;
            }
            
            showLoadingOverlay(true);
            const progressBar = document.querySelector('#importProgress .progress-bar');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    
                    if (importFormat === 'json') {
                        // JSON import
                        const importedData = JSON.parse(content);
                        
                        if (importDataType === 'all') {
                            salesData = importedData.salesData || [];
                            feedbackData = importedData.feedbackData || [];
                            offers = importedData.offers || [];
                            targetPlan = importedData.targetPlan || {};
                            showNotification('All data imported successfully!', 'success');
                        } else if (importDataType === 'sales') {
                            if (importedData.salesData && Array.isArray(importedData.salesData)) {
                                salesData = importedData.salesData;
                                showNotification(`${importedData.salesData.length} sales records imported!`, 'success');
                            }
                        } else if (importDataType === 'feedback') {
                            if (importedData.feedbackData && Array.isArray(importedData.feedbackData)) {
                                feedbackData = importedData.feedbackData;
                                showNotification(`${importedData.feedbackData.length} feedback records imported!`, 'success');
                            }
                        } else if (importDataType === 'offers') {
                            if (importedData.offers && Array.isArray(importedData.offers)) {
                                offers = importedData.offers;
                                showNotification(`${importedData.offers.length} offers imported!`, 'success');
                            }
                        } else if (importDataType === 'targets') {
                            if (importedData.targetPlan && typeof importedData.targetPlan === 'object') {
                                targetPlan = importedData.targetPlan;
                                showNotification('Target plans imported successfully!', 'success');
                            }
                        }
                    } else if (importFormat === 'excel') {
                        // Excel import (simplified for demo)
                        showNotification('Excel import functionality would be implemented here', 'info');
                        return;
                    }
                    
                    // Update UI
                    updateAllUI();
                    
                    // Save to local storage
                    saveToLocalStorage();
                    
                } catch (error) {
                    showNotification('Error importing data: ' + error.message, 'danger');
                }
            };
            
            reader.readAsText(importFile);
            
            // Update progress
            progressBar.style.width = '100%';
            
            setTimeout(() => {
                progressBar.style.width = '0%';
                document.getElementById('importProgress').classList.add('d-none');
                document.getElementById('importBtn').classList.add('d-none');
                
                // Reset file selection
                window.selectedImportFile = null;
                document.getElementById('importFileDropArea').querySelector('p').textContent = 
                    'Drag and drop your file here or browse files';
            }, 1000);
        }
        
        // Local storage functions
        function saveToLocalStorage() {
            const data = {
                salesData: salesData,
                feedbackData: feedbackData,
                offers: offers,
                targetPlan: targetPlan
            };
            
            localStorage.setItem('crispyChickenData', JSON.stringify(data));
        }
        
        function loadFromLocalStorage() {
            const savedData = localStorage.getItem('crispyChickenData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    salesData = data.salesData || [];
                    feedbackData = data.feedbackData || [];
                    offers = data.offers || [];
                    targetPlan = data.targetPlan || {};
                    
                    updateAllUI();
                } catch (error) {
                    console.error('Error loading data from localStorage:', error);
                }
            }
        }
        
        function saveSaveSlots() {
            localStorage.setItem('crispyChickenSaveSlots', JSON.stringify(saveSlots));
        }
        
        function loadSaveSlots() {
            const savedSlots = localStorage.getItem('crispyChickenSaveSlots');
            if (savedSlots) {
                try {
                    saveSlots = JSON.parse(savedSlots);
                } catch (error) {
                    console.error('Error loading save slots:', error);
                    saveSlots = [];
                }
            }
        }
        
        function saveBackups() {
            localStorage.setItem('crispyChickenBackups', JSON.stringify(backups));
        }
        
        function loadBackups() {
            const savedBackups = localStorage.getItem('crispyChickenBackups');
            if (savedBackups) {
                try {
                    backups = JSON.parse(savedBackups);
                } catch (error) {
                    console.error('Error loading backups:', error);
                    backups = [];
                }
            }
        }
        
        function saveRecoveryPoints() {
            localStorage.setItem('crispyChickenRecoveryPoints', JSON.stringify(recoveryPoints));
        }
        
        function loadRecoveryPoints() {
            const savedRecoveryPoints = localStorage.getItem('crispyChickenRecoveryPoints');
            if (savedRecoveryPoints) {
                try {
                    recoveryPoints = JSON.parse(savedRecoveryPoints);
                } catch (error) {
                    console.error('Error loading recovery points:', error);
                    recoveryPoints = [];
                }
            }
        }
        
        function saveScheduledBackups() {
            localStorage.setItem('crispyChickenScheduledBackups', JSON.stringify(scheduledBackups));
        }
        
        function loadScheduledBackups() {
            const savedScheduledBackups = localStorage.getItem('crispyChickenScheduledBackups');
            if (savedScheduledBackups) {
                try {
                    scheduledBackups = JSON.parse(savedScheduledBackups);
                } catch (error) {
                    console.error('Error loading scheduled backups:', error);
                    scheduledBackups = [];
                }
            }
        }
        
        function saveCloudSettingsToStorage() {
            localStorage.setItem('crispyChickenCloudSettings', JSON.stringify(cloudSettings));
        }
        
        function loadCloudSettings() {
            const savedCloudSettings = localStorage.getItem('crispyChickenCloudSettings');
            if (savedCloudSettings) {
                try {
                    cloudSettings = JSON.parse(savedCloudSettings);
                } catch (error) {
                    console.error('Error loading cloud settings:', error);
                    cloudSettings = {};
                }
            }
        }
        
        function saveBackupScheduleToStorage() {
            localStorage.setItem('crispyChickenBackupSchedule', JSON.stringify(backupSchedule));
        }
        
        function loadBackupSchedule() {
            const savedBackupSchedule = localStorage.getItem('crispyChickenBackupSchedule');
            if (savedBackupSchedule) {
                try {
                    backupSchedule = JSON.parse(savedBackupSchedule);
                } catch (error) {
                    console.error('Error loading backup schedule:', error);
                    backupSchedule = {};
                }
            }
        }
        
        // Export to PDF
        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(18);
            doc.text('Crispy Chicken Analytics Report', 14, 22);
            
            // Add date
            doc.setFontSize(12);
            doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 14, 32);
            
            // Add sales data summary
            const totalSales = salesData.reduce((sum, sale) => sum + parseFloat(sale.sales), 0);
            const totalTransactions = salesData.reduce((sum, sale) => sum + parseInt(sale.transactions), 0);
            const avgTransaction = totalTransactions > 0 ? totalSales / totalTransactions : 0;
            
            doc.setFontSize(14);
            doc.text('Sales Data Summary', 14, 42);
            
            doc.setFontSize(10);
            doc.text(`Total Sales: ${formatCurrency(totalSales)}`, 14, 52);
            doc.text(`Total Transactions: ${totalTransactions}`, 14, 59);
            doc.text(`Average Transaction: ${formatCurrency(avgTransaction)}`, 14, 66);
            
            // Add feedback data summary
            const totalFeedback = feedbackData.length;
            const avgRating = totalFeedback > 0 ? feedbackData.reduce((sum, f) => sum + f.rating, 0) / totalFeedback : 0;
            const positiveFeedback = totalFeedback > 0 ? feedbackData.filter(f => f.rating >= 4).length : 0;
            const positivePercentage = (positiveFeedback / totalFeedback * 100).toFixed(1);
            
            doc.setFontSize(14);
            doc.text('Feedback Summary', 14, 80);
            
            doc.setFontSize(10);
            doc.text(`Total Feedback: ${totalFeedback}`, 14, 90);
            doc.text(`Average Rating: ${avgRating.toFixed(1)}/5`, 14, 97);
            doc.text(`Positive Feedback: ${positivePercentage}%`, 14, 104);
            
            // Save PDF
            doc.save(`crispy-chicken-report-${new Date().toISOString().split('T')[0]}.pdf`);
            
            showNotification('PDF exported successfully!', 'success');
        }
    </script>
</body>
</html>
