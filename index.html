<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crispy Chicken Delivery Analytics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* All your existing CSS styles remain the same */
        .stat-card {
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .chart-container {
            position: relative;
            height: 300px;
        }
        .modal {
            transition: opacity 0.3s ease;
        }
        .table-row:hover {
            background-color: #f9fafb;
        }
        .btn-primary {
            transition: all 0.2s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
        }
        .branch-highlight {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        .analysis-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        .analysis-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        .insight-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .tab-active {
            border-bottom: 3px solid #f59e0b;
            color: #f59e0b;
        }
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #f59e0b;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-left: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .date-range-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: #f8fafc;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        .date-range-selector select {
            padding: 6px 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background-color: white;
        }
        .auto-offer-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            background-color: #dbeafe;
            color: #1e40af;
        }
        .offer-row-normal {
            background-color: #f8d7da;
        }
        .offer-row-chicken {
            background-color: #d4edda;
        }
        .offer-row-ultimate {
            background-color: #fff3cd;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(150%);
            transition: transform 0.3s ease-out;
        }
        .notification.show {
            transform: translateX(0);
        }
        .notification.success {
            background-color: #10b981;
        }
        .notification.error {
            background-color: #ef4444;
        }
        .notification.info {
            background-color: #3b82f6;
        }
        .offer-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-align: center;
        }
        .offer-badge-normal {
            background-color: #3b82f6;
            color: white;
        }
        .offer-badge-chicken {
            background-color: #f59e0b;
            color: white;
        }
        .offer-badge-ultimate {
            background-color: #8b5cf6;
            color: white;
        }
        .offer-metric-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            transition: all 0.3s ease;
            height: 100%;
        }
        .offer-metric-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        .offer-metric-value {
            font-size: 1.875rem;
            font-weight: 700;
            line-height: 1;
        }
        .offer-metric-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }
        .offer-metric-change {
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
        }
        .positive-change {
            color: #10b981;
        }
        .negative-change {
            color: #ef4444;
        }
        .neutral-change {
            color: #6b7280;
        }
        .offer-comparison-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            transition: all 0.3s ease;
        }
        .offer-comparison-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        .offer-performance-bar {
            height: 8px;
            border-radius: 4px;
            margin-top: 8px;
            background-color: #e5e7eb;
            overflow: hidden;
        }
        .offer-performance-fill {
            height: 100%;
            border-radius: 4px;
        }
        .sub-tab {
            padding: 8px 16px;
            font-weight: 500;
            color: #6b7280;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .sub-tab:hover {
            color: #374151;
        }
        .sub-tab.active {
            color: #f59e0b;
            border-bottom-color: #f59e0b;
        }
        .error-message {
            color: #ef4444;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }
        .success-message {
            color: #10b981;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }
        .filter-section {
            background-color: #f8fafc;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
        }
        .filter-group {
            display: flex;
            flex-wrap: gap: 12px;
            margin-bottom: 12px;
        }
        .filter-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .filter-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
        }
        .filter-control {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .filter-control select, .filter-control input {
            padding: 6px 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background-color: white;
            flex: 1;
        }
        .filter-control input[type="date"] {
            padding: 6px 10px;
        }
        .filter-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        .btn-icon {
            padding: 8px 12px;
            border-radius: 6px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.2s ease;
        }
        .btn-icon:hover {
            transform: translateY(-2px);
        }
        .btn-icon.btn-secondary {
            background-color: #6b7280;
            color: white;
        }
        .btn-icon.btn-primary {
            background-color: #3b82f6;
            color: white;
        }
        .btn-icon.btn-success {
            background-color: #10b981;
            color: white;
        }
        .btn-icon.btn-danger {
            background-color: #ef4444;
            color: white;
        }
        .btn-icon.btn-indigo {
            background-color: #6366f1;
            color: white;
        }
        .data-table-container {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .table-header {
            background-color: #f9fafb;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .table-body {
            max-height: 500px;
            overflow-y: auto;
        }
        .table-row:hover {
            background-color: #f9fafb;
        }
        .table-row.highlight {
            background-color: #dbeafe;
        }
        .table-row.offer-row-normal {
            background-color: #f8d7da;
        }
        .table-row.offer-row-chicken {
            background-color: #d4edda;
        }
        .table-row.offer-row-ultimate {
            background-color: #fff3cd;
        }
        .offer-type-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-align: center;
        }
        .offer-type-badge-normal {
            background-color: #3b82f6;
            color: white;
        }
        .offer-type-badge-chicken {
            background-color: #f59e0b;
            color: white;
        }
        .offer-type-badge-ultimate {
            background-color: #8b5cf6;
            color: white;
        }
        .empty-state {
            text-align: center;
            padding: 2rem;
            color: #6b7280;
        }
        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #d1d5db;
        }
        .empty-state-text {
            font-size: 1.125rem;
            color: #9ca3af;
        }
        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
        }
        .pagination button {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .pagination button:hover:not(:disabled) {
            background-color: #f3f4f6;
        }
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .pagination .page-info {
            font-size: 0.875rem;
            color: #6b7280;
        }
        .pagination .page-number {
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.375rem;
            font-weight: 500;
        }
        .pagination .page-number.active {
            background-color: #f59e0b;
            color: white;
        }
        .pagination .page-number:not(.active):hover:not(:disabled) {
            background-color: #f3f4f6;
        }
        .stats-summary {
            display: flex;
            justify-content: space-between;
            background-color: #f8fafc;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        .stats-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        .stats-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #374151;
        }
        .stats-label {
            font-size: 0.875rem;
            color: #6b7280;
        }
        .chart-wrapper {
            position: relative;
            height: 350px;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: white;
            border-radius: 0.75rem;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 1.5rem;
            position: relative;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #111827;
        }
        .close-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            color: #6b7280;
        }
        .close-btn:hover {
            color: #374151;
        }
        .form-group {
            margin-bottom: 1rem;
        }
        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
        }
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .form-error {
            color: #ef4444;
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }
        .btn-group {
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }
        .btn-secondary {
            background-color: #6b7280;
            color: white;
        }
        .btn-danger {
            background-color: #ef4444;
            color: white;
        }
        .btn:hover {
            transform: translateY(-2px);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-amber-50 to-orange-100 min-h-screen">
    <div class="max-w-7xl mx-auto p-4 md:p-8">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold text-gray-800">🍗 Crispy Chicken Delivery Analytics</h1>
                    <p class="text-gray-600 mt-2">October 1-14, 2025 - Advanced Performance Analysis</p>
                </div>
                <div class="flex items-center">
                    <span id="loadingIndicator" class="loading-spinner hidden"></span>
                    <span id="updateStatus" class="text-sm text-gray-600 ml-2"></span>
                </div>
            </div>
            
            <!-- Controls -->
            <div class="flex flex-wrap gap-3 mt-4">
                <select id="branchSelector" class="px-4 py-2 border-2 border-amber-500 rounded-lg font-semibold bg-white" aria-label="Select branch">
                    <option value="All">All Branches</option>
                    <option value="Crispy Chicken-Hamdan St">Hamdan St</option>
                    <option value="Crispy Chicken Khaldia">Khaldia</option>
                    <option value="Crispy Chicken Shabiya 11">Shabiya 11</option>
                    <option value="Crispy Chicken Muroor">Muroor</option>
                    <option value="Crispy Chicken Al Barsha">Al Barsha</option>
                    <option value="Crispy Chicken Al Satwa">Al Satwa</option>
                    <option value="Crispy Chicken Al Rgga">Al Rgga</option>
                </select>
                
                <div class="date-range-selector">
                    <span class="text-sm font-medium text-gray-700">Period:</span>
                    <select id="startDay" class="text-sm" aria-label="Select start day">
                        <option value="1">Oct 1</option>
                        <option value="2">Oct 2</option>
                        <option value="3">Oct 3</option>
                        <option value="4">Oct 4</option>
                        <option value="5">Oct 5</option>
                        <option value="6">Oct 6</option>
                        <option value="7">Oct 7</option>
                        <option value="8">Oct 8</option>
                        <option value="9">Oct 9</option>
                        <option value="10">Oct 10</option>
                        <option value="11">Oct 11</option>
                        <option value="12">Oct 12</option>
                        <option value="13">Oct 13</option>
                        <option value="14">Oct 14</option>
                    </select>
                    <span class="text-gray-500">to</span>
                    <select id="endDay" class="text-sm" aria-label="Select end day">
                        <option value="1">Oct 1</option>
                        <option value="2">Oct 2</option>
                        <option value="3">Oct 3</option>
                        <option value="4">Oct 4</option>
                        <option value="5">Oct 5</option>
                        <option value="6">Oct 6</option>
                        <option value="7">Oct 7</option>
                        <option value="8">Oct 8</option>
                        <option value="9">Oct 9</option>
                        <option value="10">Oct 10</option>
                        <option value="11">Oct 11</option>
                        <option value="12">Oct 12</option>
                        <option value="13">Oct 13</option>
                        <option value="14">Oct 14</option>
                    </select>
                    <button id="applyDateRange" class="px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600 transition-colors">
                        Apply
                    </button>
                    <button id="resetDateRange" class="px-3 py-1 bg-gray-500 text-white text-sm rounded hover:bg-gray-600 transition-colors">
                        Reset
                    </button>
                </div>
                
                <select id="analysisType" class="px-4 py-2 border-2 border-blue-500 rounded-lg font-semibold bg-white" aria-label="Select analysis type">
                    <option value="performance">Performance Analysis</option>
                    <option value="trends">Trend Analysis</option>
                    <option value="comparison">Branch Comparison</option>
                    <option value="forecasting">Forecasting</option>
                </select>
                
                <label class="px-4 py-2 bg-blue-500 text-white rounded-lg font-semibold cursor-pointer hover:bg-blue-600 transition-all flex items-center gap-2">
                    <i data-lucide="upload" class="w-5 h-5"></i>
                    Upload Excel
                    <input type="file" id="fileUpload" accept=".xlsx,.xls" class="hidden" />
                </label>
                
                <button id="downloadTemplate" class="px-4 py-2 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600 transition-all flex items-center gap-2">
                    <i data-lucide="download" class="w-5 h-5"></i>
                    Template
                </button>
                
                <button id="addEntry" class="px-4 py-2 bg-purple-500 text-white rounded-lg font-semibold hover:bg-purple-600 transition-all flex items-center gap-2">
                    <i data-lucide="plus" class="w-5 h-5"></i>
                    Add Entry
                </button>
                
                <button id="manageOffers" class="px-4 py-2 bg-indigo-500 text-white rounded-lg font-semibold hover:bg-indigo-600 transition-all flex items-center gap-2">
                    <i data-lucide="tag" class="w-5 h-5"></i>
                    Manage Offers
                </button>
                
                <button id="generateReport" class="px-4 py-2 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600 transition-all flex items-center gap-2">
                    <i data-lucide="file-text" class="w-5 h-5"></i>
                    Generate Report
                </button>
            </div>
        </div>

        <!-- Analysis Tabs -->
        <div class="bg-white rounded-lg shadow-lg p-4 mb-6">
            <div class="flex flex-wrap gap-6 border-b">
                <button class="tab-btn pb-3 px-1 font-medium text-gray-600 hover:text-amber-600 tab-active" data-tab="overview">
                    Overview
                </button>
                <button class="tab-btn pb-3 px-1 font-medium text-gray-600 hover:text-amber-600" data-tab="performance">
                    Performance Metrics
                </button>
                <button class="tab-btn pb-3 px-1 font-medium text-gray-600 hover:text-amber-600" data-tab="trends">
                    Trend Analysis
                </button>
                <button class="tab-btn pb-3 px-1 font-medium text-gray-600 hover:text-amber-600" data-tab="offers">
                    Offers Management
                </button>
            </div>
        </div>

        <!-- Tab Content: Overview -->
        <div id="overview-tab" class="tab-content">
            <!-- KPI Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                <div class="stat-card bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Total Transactions</h3>
                        <i data-lucide="shopping-cart" class="w-8 h-8 text-blue-500"></i>
                    </div>
                    <p id="totalTransactions" class="text-3xl font-bold text-gray-800">0</p>
                    <p class="text-sm text-gray-600 mt-2">All branches</p>
                    <div class="mt-4">
                        <div class="flex items-center text-green-600">
                            <i data-lucide="trending-up" class="w-4 h-4 mr-1"></i>
                            <span class="text-sm font-medium">+12.5% from last period</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Total Sales</h3>
                        <i data-lucide="dollar-sign" class="w-8 h-8 text-green-500"></i>
                    </div>
                    <p id="totalSales" class="text-3xl font-bold text-gray-800">0 AED</p>
                    <p class="text-sm text-gray-600 mt-2">Revenue generated</p>
                    <div class="mt-4">
                        <div class="flex items-center text-green-600">
                            <i data-lucide="trending-up" class="w-4 h-4 mr-1"></i>
                            <span class="text-sm font-medium">+8.3% from last period</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Average Order Value</h3>
                        <i data-lucide="receipt" class="w-8 h-8 text-amber-500"></i>
                    </div>
                    <p id="avgOrderValue" class="text-3xl font-bold text-gray-800">0 AED</p>
                    <p class="text-sm text-gray-600 mt-2">Per transaction</p>
                    <div class="mt-4">
                        <div class="flex items-center text-red-600">
                            <i data-lucide="trending-down" class="w-4 h-4 mr-1"></i>
                            <span class="text-sm font-medium">-2.1% from last period</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Peak Performance</h3>
                        <i data-lucide="activity" class="w-8 h-8 text-purple-500"></i>
                    </div>
                    <p id="peakPerformance" class="text-3xl font-bold text-gray-800">-</p>
                    <p class="text-sm text-gray-600 mt-2">Best performing branch</p>
                    <div class="mt-4">
                        <div class="flex items-center text-green-600">
                            <i data-lucide="award" class="w-4 h-4 mr-1"></i>
                            <span class="text-sm font-medium">Top performer</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Transactions Trend</h3>
                    <div class="chart-container">
                        <canvas id="transactionsChart"></canvas>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Sales Trend</h3>
                    <div class="chart-container">
                        <canvas id="salesChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Branch Comparison</h3>
                    <div class="chart-container">
                        <canvas id="branchChart"></canvas>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Weekly Performance</h3>
                    <div class="chart-container">
                        <canvas id="weeklyChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Content: Performance Metrics -->
        <div id="performance-tab" class="tab-content hidden">
            <!-- Performance Analysis Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                <div class="analysis-card rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Peak Performance Hours</h3>
                        <i data-lucide="clock" class="w-6 h-6 text-blue-500"></i>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Highest Traffic:</span>
                            <span id="peakHours" class="text-sm font-semibold">6:00 PM - 8:00 PM</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Avg Orders/Hour:</span>
                            <span id="avgOrdersHour" class="text-sm font-semibold">24.5</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Peak Day:</span>
                            <span id="peakDay" class="text-sm font-semibold">Saturday</span>
                        </div>
                    </div>
                </div>

                <div class="analysis-card rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Order Value Analysis</h3>
                        <i data-lucide="trending-up" class="w-6 h-6 text-green-500"></i>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Highest Order:</span>
                            <span id="highestOrder" class="text-sm font-semibold">485 AED</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Lowest Order:</span>
                            <span id="lowestOrder" class="text-sm font-semibold">35 AED</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Most Common:</span>
                            <span id="mostCommon" class="text-sm font-semibold">85-120 AED</span>
                        </div>
                    </div>
                </div>

                <div class="analysis-card rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Efficiency Metrics</h3>
                        <i data-lucide="zap" class="w-6 h-6 text-purple-500"></i>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Orders/Employee:</span>
                            <span id="ordersEmployee" class="text-sm font-semibold">18.2</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Prep Time:</span>
                            <span id="prepTime" class="text-sm font-semibold">12 min</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Delivery Time:</span>
                            <span id="deliveryTime" class="text-sm font-semibold">28 min</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Hourly Performance Distribution</h3>
                    <div class="chart-wrapper">
                        <canvas id="hourlyChart"></canvas>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Day of Week Analysis</h3>
                    <div class="chart-wrapper">
                        <canvas id="dayOfWeekChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Content: Trend Analysis -->
        <div id="trends-tab" class="tab-content hidden">
            <!-- Trend Analysis Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                <div class="analysis-card rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-bold text-gray-800">Growth Rate</h3>
                        <i data-lucide="trending-up" class="w-5 h-5 text-green-500"></i>
                    </div>
                    <p id="growthRate" class="text-2xl font-bold text-green-600">+12.7%</p>
                    <p class="text-sm text-gray-600 mt-1">vs last period</p>
                </div>

                <div class="analysis-card rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-bold text-gray-800">Seasonality Index</h3>
                        <i data-lucide="calendar" class="w-5 h-5 text-blue-500"></i>
                    </div>
                    <p id="seasonalityIndex" class="text-2xl font-bold text-blue-600">1.24</p>
                    <p class="text-sm text-gray-600 mt-1">Above average</p>
                </div>

                <div class="analysis-card rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-bold text-gray-800">Volatility</h3>
                        <i data-lucide="activity" class="w-5 h-5 text-purple-500"></i>
                    </div>
                    <p id="volatility" class="text-2xl font-bold text-purple-600">18.3%</p>
                    <p class="text-sm text-gray-600 mt-1">Sales variation</p>
                </div>

                <div class="analysis-card rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-bold text-gray-800">Momentum</h3>
                        <i data-lucide="bar-chart-2" class="w-5 h-5 text-amber-500"></i>
                    </div>
                    <p id="momentum" class="text-2xl font-bold text-amber-600">Strong</p>
                    <p class="text-sm text-gray-600 mt-1">Upward trend</p>
                </div>
            </div>

            <!-- Trend Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Moving Average Trend</h3>
                    <div class="chart-wrapper">
                        <canvas id="movingAvgChart"></canvas>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Growth Rate Analysis</h3>
                    <div class="chart-wrapper">
                        <canvas id="growthRateChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Content: Offers Management -->
        <div id="offers-tab" class="tab-content hidden">
            <!-- Offers Dashboard -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800">Offers Performance Dashboard</h3>
                    <button id="addOfferBtn" class="px-4 py-2 bg-indigo-500 text-white rounded-lg font-semibold hover:bg-indigo-600 transition-all flex items-center gap-2">
                        <i data-lucide="plus" class="w-5 h-5"></i>
                        Add/Edit Offer
                    </button>
                </div>
                
                <!-- Sub-tabs for Offer Analysis -->
                <div class="flex flex-wrap gap-4 mb-6 border-b">
                    <button class="sub-tab active" data-offer-tab="overview">Overview</button>
                    <button class="sub-tab" data-offer-tab="performance">Performance</button>
                    <button class="sub-tab" data-offer-tab="comparison">Comparison</button>
                    <button class="sub-tab" data-offer-tab="table">Data Table</button>
                </div>
                
                <!-- Offer Overview Content -->
                <div id="offer-overview-content" class="offer-tab-content">
                    <!-- KPI Cards for Offers -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                        <div class="offer-metric-card">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="text-lg font-semibold text-gray-800">Total Offers</h4>
                                <i data-lucide="tag" class="w-5 h-5 text-indigo-500"></i>
                            </div>
                            <p id="totalOffers" class="offer-metric-value text-indigo-600">0</p>
                            <p class="offer-metric-label">Active offers</p>
                            <div class="offer-metric-change positive-change">
                                <i data-lucide="trending-up" class="w-3 h-3 mr-1"></i>
                                <span>+2 from last week</span>
                            </div>
                        </div>
                        
                        <div class="offer-metric-card">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="text-lg font-semibold text-gray-800">Offer Revenue</h4>
                                <i data-lucide="dollar-sign" class="w-5 h-5 text-green-500"></i>
                            </div>
                            <p id="offerRevenue" class="offer-metric-value text-green-600">0 AED</p>
                            <p class="offer-metric-label">Total revenue from offers</p>
                            <div class="offer-metric-change positive-change">
                                <i data-lucide="trending-up" class="w-3 h-3 mr-1"></i>
                                <span>+15.3% vs normal days</span>
                            </div>
                        </div>
                        
                        <div class="offer-metric-card">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="text-lg font-semibold text-gray-800">Conversion Rate</h4>
                                <i data-lucide="percent" class="w-5 h-5 text-amber-500"></i>
                            </div>
                            <p id="offerConversion" class="offer-metric-value text-amber-600">0%</p>
                            <p class="offer-metric-label">Offer to sales conversion</p>
                            <div class="offer-metric-change neutral-change">
                                <i data-lucide="minus" class="w-3 h-3 mr-1"></i>
                                <span>No change from last week</span>
                            </div>
                        </div>
                        
                        <div class="offer-metric-card">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="text-lg font-semibold text-gray-800">Top Offer</h4>
                                <i data-lucide="award" class="w-5 h-5 text-purple-500"></i>
                            </div>
                            <p id="topOffer" class="offer-metric-value text-purple-600">-</p>
                            <p class="offer-metric-label">Best performing offer</p>
                            <div class="offer-metric-change positive-change">
                                <i data-lucide="trending-up" class="w-3 h-3 mr-1"></i>
                                <span>+22% higher sales</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Offer Performance Chart -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Offer Performance by Type</h3>
                            <div class="chart-wrapper">
                                <canvas id="offerTypeChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Offer Impact on Sales</h3>
                            <div class="chart-wrapper">
                                <canvas id="offerImpactChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Top Performing Offers -->
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">Top Performing Offers</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="topOffersContainer">
                            <!-- Top offers will be inserted here -->
                        </div>
                    </div>
                </div>
                
                <!-- Offer Performance Content -->
                <div id="offer-performance-content" class="offer-tab-content hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Offer Performance by Day</h3>
                            <div class="chart-wrapper">
                                <canvas id="offerDayChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Offer Performance by Branch</h3>
                            <div class="chart-wrapper">
                                <canvas id="offerBranchChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Offer Performance Table -->
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">Offer Performance Details</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Offer Type</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Total Transactions</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Total Sales (AED)</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Avg Transaction Value</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Performance vs Normal</th>
                                    </tr>
                                </thead>
                                <tbody id="offerPerformanceTableBody">
                                    <!-- Table rows will be inserted here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Offer Comparison Content -->
                <div id="offer-comparison-content" class="offer-tab-content hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Offer Type Comparison</h3>
                            <div class="chart-wrapper">
                                <canvas id="offerComparisonChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Offer ROI Analysis</h3>
                            <div class="chart-wrapper">
                                <canvas id="offerRoiChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Offer Comparison Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="offerComparisonCards">
                        <!-- Comparison cards will be inserted here -->
                    </div>
                </div>
                
                <!-- Data Table Content -->
                <div id="offer-table-content" class="offer-tab-content hidden">
                    <div class="data-table-container">
                        <div class="table-header">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-bold text-gray-800">Offers Data Table</h3>
                                <div class="flex gap-2">
                                    <button id="exportOfferData" class="btn-icon btn-success">
                                        <i data-lucide="download" class="w-4 h-4 inline mr-1"></i>
                                        Export
                                    </button>
                                    <button id="refreshOfferData" class="btn-icon btn-primary">
                                        <i data-lucide="refresh-cw" class="w-4 h-4 inline mr-1"></i>
                                        Refresh
                                    </button>
                                </div>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="table-header">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Date</th>
                                            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Day</th>
                                            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Branch</th>
                                            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Transactions</th>
                                            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Sales (AED)</th>
                                            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Offer Type</th>
                                            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Offer Status</th>
                                            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Notes</th>
                                            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="offerTableBody">
                                        <!-- Table rows will be inserted here -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="pagination">
                                <div class="page-info">
                                    Showing <span id="currentPage">1</span> of <span id="totalPages">1</span>
                                </div>
                                <div class="flex gap-2">
                                    <button id="prevPage" class="btn-icon btn-secondary">
                                        <i data-lucide="chevron-left" class="w-4 h-4"></i>
                                    </button>
                                    <button id="nextPage" class="btn-icon btn-secondary">
                                        <i data-lucide="chevron-right" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6 overflow-x-auto">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Delivery Data (<span id="recordCount">0</span> records)</h3>
            <div class="overflow-x-auto">
                <table class="w-full min-w-max">
                    <thead class="table-header">
                        <tr>
                            <th class="px-4 py-3 text-left">Date</th>
                            <th class="px-4 py-3 text-left">Branch</th>
                            <th class="px-4 py-3 text-left">Transactions</th>
                            <th class="px-4 py-3 text-left">Sales (AED)</th>
                            <th class="px-4 py-3 text-left">Avg/Order</th>
                            <th class="px-4 py-3 text-left">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody">
                        <!-- Table rows will be inserted here -->
                    </tbody>
                </table>
            </div>
            <p id="tableFooter" class="text-sm text-gray-500 mt-2 hidden">Showing first 20 records</p>
        </div>
    </div>

    <!-- Data Entry Modal -->
    <div id="dataModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="modal-content">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 id="modalTitle" class="text-xl font-bold text-gray-800">Add New Entry</h3>
                        <button id="closeModal" class="text-gray-500 hover:text-gray-700">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                            <input type="text" id="modalDate" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="October 1st, 2025">
                            <div id="modalDateError" class="error-message"></div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Branch</label>
                            <select id="modalBranch" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                <option value="">Select a branch</option>
                                <option value="Crispy Chicken-Hamdan St">Crispy Chicken-Hamdan St</option>
                                <option value="Crispy Chicken Khaldia">Crispy Chicken Khaldia</option>
                                <option value="Crispy Chicken Shabiya 11">Crispy Chicken Shabiya 11</option>
                                <option value="Crispy Chicken Muroor">Crispy Chicken Muroor</option>
                                <option value="Crispy Chicken Al Barsha">Crispy Chicken Al Barsha</option>
                                <option value="Crispy Chicken Al Satwa">Crispy Chicken Al Satwa</option>
                                <option value="Crispy Chicken Al Rgga">Crispy Chicken Al Rgga</option>
                            </select>
                            <div id="modalBranchError" class="error-message"></div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Transactions</label>
                            <input type="number" id="modalTransactions" class="w-full px-3 py-2 border border-gray-300 rounded-md" min="0">
                            <div id="modalTransactionsError" class="error-message"></div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Sales (AED)</label>
                            <input type="number" id="modalSales" class="w-full px-3 py-2 border border-gray-300 rounded-md" min="0" step="0.01">
                            <div id="modalSalesError" class="error-message"></div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end gap-3 mt-6">
                        <button id="cancelModal" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                            Cancel
                        </button>
                        <button id="saveModal" class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 flex items-center gap-2">
                            <i data-lucide="save" class="w-4 h-4"></i>
                            Save Entry
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Offer Modal -->
    <div id="offerModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="modal-content">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-800">إضافة / تعديل عرض</h3>
                    <button id="closeOfferModal" class="text-gray-500 hover:text-gray-700">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">التاريخ</label>
                        <input type="date" id="offerModalDate" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        <div id="offerModalDateError" class="error-message"></div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">الفرع</label>
                        <select id="offerModalBranch" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            <option value="Crispy Chicken-Hamdan St">Crispy Chicken-Hamdan St</option>
                            <option value="Crispy Chicken Khaldia">Crispy Chicken Khaldia</option>
                            <option value="Crispy Chicken Shabiya 11">Crispy Chicken Shabiya 11</option>
                            <option value="Crispy Chicken Muroor">Crispy Chicken Muroor</option>
                            <option value="Crispy Chicken Al Barsha">Crispy Chicken Al Barsha</option>
                            <option value="Crispy Chicken Al Satwa">Crispy Chicken Al Satwa</option>
                            <option value="Crispy Chicken Al Rgga">Crispy Chicken Al Rgga</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">نوع العرض</label>
                        <select id="offerModalType" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            <option value="Normal Day">Normal Day</option>
                            <option value="Chicken Day">Chicken Day</option>
                            <option value="Ultimate Offer">Ultimate Offer</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ملاحظات</label>
                        <input type="text" id="offerModalNotes" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="أدخل ملاحظاتك هنا">
                    </div>
                </div>
                
                <div class="flex justify-end gap-3 mt-6">
                    <button id="cancelOfferModal" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                        إغلاق
                    </button>
                    <button id="saveOfferBtn" class="px-4 py-2 bg-indigo-500 text-white rounded-md hover:bg-indigo-600 flex items-center gap-2">
                        <i data-lucide="save" class="w-4 h-4"></i>
                        حفظ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification" class="notification"></div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Sample data with consistent date format
        let deliveryData = [
            { date: 'October 1st, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 73, sales: 3216 },
            { date: 'October 1st, 2025', branch: 'Crispy Chicken Khaldia', transactions: 38, sales: 1859.8 },
            { date: 'October 1st, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 39, sales: 1965 },
            { date: 'October 1st, 2025', branch: 'Crispy Chicken Muroor', transactions: 42, sales: 2024 },
            { date: 'October 1st, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 24, sales: 1376 },
            { date: 'October 1st, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 11, sales: 387 },
            { date: 'October 1st, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 5, sales: 204 },
            { date: 'October 2nd, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 62, sales: 3238 },
            { date: 'October 2nd, 2025', branch: 'Crispy Chicken Khaldia', transactions: 28, sales: 1492 },
            { date: 'October 2nd, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 44, sales: 2057 },
            { date: 'October 2nd, 2025', branch: 'Crispy Chicken Muroor', transactions: 40, sales: 1945 },
            { date: 'October 2nd, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 30, sales: 1644 },
            { date: 'October 2nd, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 10, sales: 527 },
            { date: 'October 2nd, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 4, sales: 146 },
            { date: 'October 3rd, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 72, sales: 3100 },
            { date: 'October 3rd, 2025', branch: 'Crispy Chicken Khaldia', transactions: 46, sales: 2930 },
            { date: 'October 3rd, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 40, sales: 1828 },
            { date: 'October 3rd, 2025', branch: 'Crispy Chicken Muroor', transactions: 32, sales: 1617 },
            { date: 'October 3rd, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 29, sales: 1127 },
            { date: 'October 3rd, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 11, sales: 427 },
            { date: 'October 3rd, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 10, sales: 475 },
            { date: 'October 4th, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 84, sales: 4833 },
            { date: 'October 4th, 2025', branch: 'Crispy Chicken Khaldia', transactions: 43, sales: 2400 },
            { date: 'October 4th, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 31, sales: 1447 },
            { date: 'October 4th, 2025', branch: 'Crispy Chicken Muroor', transactions: 36, sales: 2299 },
            { date: 'October 4th, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 20, sales: 936 },
            { date: 'October 4th, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 11, sales: 566 },
            { date: 'October 4th, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 15, sales: 554 },
            { date: 'October 5th, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 76, sales: 2921 },
            { date: 'October 5th, 2025', branch: 'Crispy Chicken Khaldia', transactions: 43, sales: 1982 },
            { date: 'October 5th, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 29, sales: 1344 },
            { date: 'October 5th, 2025', branch: 'Crispy Chicken Muroor', transactions: 20, sales: 1126 },
            { date: 'October 5th, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 25, sales: 1089 },
            { date: 'October 5th, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 13, sales: 462 },
            { date: 'October 5th, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 8, sales: 241 },
            { date: 'October 6th, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 101, sales: 4363, offerType: 'Ultimate Offer', offerStatus: 'Offer', notes: '12 PCS' },
            { date: 'October 6th, 2025', branch: 'Crispy Chicken Khaldia', transactions: 54, sales: 2113 },
            { date: 'October 6th, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 61, sales: 2714.8 },
            { date: 'October 6th, 2025', branch: 'Crispy Chicken Muroor', transactions: 47, sales: 2124 },
            { date: 'October 6th, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 57, sales: 4201 },
            { date: 'October 6th, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 20, sales: 848 },
            { date: 'October 6th, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 18, sales: 708 },
            { date: 'October 7th, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 119, sales: 5056 },
            { date: 'October 7th, 2025', branch: 'Crispy Chicken Khaldia', transactions: 50, sales: 2175 },
            { date: 'October 7th, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 80, sales: 3475 },
            { date: 'October 7th, 2025', branch: 'Crispy Chicken Muroor', transactions: 46, sales: 1957 },
            { date: 'October 7th, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 44, sales: 2590 },
            { date: 'October 7th, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 18, sales: 705 },
            { date: 'October 7th, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 19, sales: 823 },
            { date: 'October 8th, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 58, sales: 2568 },
            { date: 'October 8th, 2025', branch: 'Crispy Chicken Khaldia', transactions: 24, sales: 1037 },
            { date: 'October 8th, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 30, sales: 1574 },
            { date: 'October 8th, 2025', branch: 'Crispy Chicken Muroor', transactions: 81, sales: 1404 },
            { date: 'October 8th, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 29, sales: 1891 },
            { date: 'October 8th, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 5, sales: 148 },
            { date: 'October 8th, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 10, sales: 519 },
            { date: 'October 9th, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 53, sales: 2738 },
            { date: 'October 9th, 2025', branch: 'Crispy Chicken Khaldia', transactions: 31, sales: 2112 },
            { date: 'October 9th, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 35, sales: 1487 },
            { date: 'October 9th, 2025', branch: 'Crispy Chicken Muroor', transactions: 35, sales: 1978 },
            { date: 'October 9th, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 17, sales: 733 },
            { date: 'October 9th, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 5, sales: 184 },
            { date: 'October 9th, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 13, sales: 408 },
            { date: 'October 10th, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 65, sales: 2900 },
            { date: 'October 10th, 2025', branch: 'Crispy Chicken Khaldia', transactions: 46, sales: 2943 },
            { date: 'October 10th, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 45, sales: 2411 },
            { date: 'October 10th, 2025', branch: 'Crispy Chicken Muroor', transactions: 39, sales: 2261 },
            { date: 'October 10th, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 25, sales: 1523 },
            { date: 'October 10th, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 12, sales: 976 },
            { date: 'October 10th, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 10, sales: 573 },
            { date: 'October 11th, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 78, sales: 4313 },
            { date: 'October 11th, 2025', branch: 'Crispy Chicken Khaldia', transactions: 48, sales: 3452 },
            { date: 'October 11th, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 34, sales: 1711 },
            { date: 'October 11th, 2025', branch: 'Crispy Chicken Muroor', transactions: 28, sales: 1654 },
            { date: 'October 11th, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 20, sales: 778 },
            { date: 'October 11th, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 10, sales: 391 },
            { date: 'October 11th, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 9, sales: 275 },
            { date: 'October 12th, 2025', branch: 'Crispy Chicken-Hamdan St', transactions: 51, sales: 2146 },
            { date: 'October 12th, 2025', branch: 'Crispy Chicken Khaldia', transactions: 33, sales: 1802 },
            { date: 'October 12th, 2025', branch: 'Crispy Chicken Shabiya 11', transactions: 32, sales: 1331 },
            { date: 'October 12th, 2025', branch: 'Crispy Chicken Muroor', transactions: 23, sales: 1195 },
            { date: 'October 12th, 2025', branch: 'Crispy Chicken Al Barsha', transactions: 22, sales: 1233 },
            { date: 'October 12th, 2025', branch: 'Crispy Chicken Al Satwa', transactions: 4, sales: 153 },
            { date: 'October 12th, 2025', branch: 'Crispy Chicken Al Rgga', transactions: 6, sales: 232, offerType: 'Normal Day', offerStatus: 'No Offer' }
        ];

        // Auto-generated offers data
        let autoGeneratedOffers = [];

        let selectedBranch = 'All';
        let selectedStartDate = null;
        let selectedEndDate = null;
        let editingIndex = null;
        let editingOfferIndex = null;
        
        // Chart instances
        let transactionsChartInstance = null;
        let salesChartInstance = null;
        let branchChartInstance = null;
        let weeklyChartInstance = null;
        let dailyBranchChartInstance = null;
        let hourlyChartInstance = null;
        let dayOfWeekChartInstance = null;
        let movingAvgChartInstance = null;
        let growthRateChartInstance = null;
        
        // Offer chart instances
        let offerTypeChartInstance = null;
        let offerImpactChartInstance = null;
        let offerDayChartInstance = null;
        let offerBranchChartInstance = null;
        let offerComparisonChartInstance = null;
        let offerRoiChartInstance = null;
        
        // DOM elements
        const branchSelector = document.getElementById('branchSelector');
        const startDay = document.getElementById('startDay');
        const endDay = document.getElementById('endDay');
        const applyDateRange = document.getElementById('applyDateRange');
        const resetDateRange = document.getElementById('resetDateRange');
        const analysisType = document.getElementById('analysisType');
        const fileUpload = document.getElementById('fileUpload');
        const downloadTemplateBtn = document.getElementById('downloadTemplate');
        const addEntryBtn = document.getElementById('addEntry');
        const manageOffersBtn = document.getElementById('manageOffers');
        const generateReportBtn = document.getElementById('generateReport');
        const dataModal = document.getElementById('dataModal');
        const closeModalBtn = document.getElementById('closeModal');
        const cancelModalBtn = document.getElementById('cancelModal');
        const saveModalBtn = document.getElementById('saveModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalDate = document.getElementById('modalDate');
        const modalBranch = document.getElementById('modalBranch');
        const modalTransactions = document.getElementById('modalTransactions');
        const modalSales = document.getElementById('modalSales');
        const dataTableBody = document.getElementById('dataTableBody');
        const recordCount = document.getElementById('recordCount');
        const tableFooter = document.getElementById('tableFooter');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const updateStatus = document.getElementById('updateStatus');
        
        // Offer Modal DOM elements
        const offerModal = document.getElementById('offerModal');
        const addOfferBtn = document.getElementById('addOfferBtn');
        const closeOfferModalBtn = document.getElementById('closeOfferModal');
        const cancelOfferModalBtn = document.getElementById('cancelOfferModal');
        const saveOfferBtn = document.getElementById('saveOfferBtn');
        const offerModalDate = document.getElementById('offerModalDate');
        const offerModalBranch = document.getElementById('offerModalBranch');
        const offerModalType = document.getElementById('offerModalType');
        const offerModalNotes = document.getElementById('offerModalNotes');
        const offerTableBody = document.getElementById('offerTableBody');
        
        // Tab functionality
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tabName = button.getAttribute('data-tab');
                
                // Update active tab button
                tabButtons.forEach(btn => btn.classList.remove('tab-active'));
                button.classList.add('tab-active');
                
                // Show corresponding tab content
                tabContents.forEach(content => {
                    content.classList.add('hidden');
                    if (content.id === `${tabName}-tab`) {
                        content.classList.remove('hidden');
                    }
                });
                
                // Update charts for specific tabs
                if (tabName === 'performance') {
                    updatePerformanceCharts();
                } else if (tabName === 'trends') {
                    updateTrendCharts();
                } else if (tabName === 'offers') {
                    updateOffersDashboard();
                }
            });
        });
        
        // Event listeners
        branchSelector.addEventListener('change', function() {
            selectedBranch = this.value;
            showLoadingIndicator();
            setTimeout(() => {
                updateDashboard();
                highlightSelectedBranch();
                hideLoadingIndicator();
                showUpdateStatus('Dashboard updated successfully');
            }, 500);
        });

        startDay.addEventListener('change', function() {
            // Ensure end day is not before start day
            if (parseInt(endDay.value) < parseInt(this.value)) {
                endDay.value = this.value;
            }
        });

        endDay.addEventListener('change', function() {
            // Ensure start day is not after end day
            if (parseInt(startDay.value) > parseInt(this.value)) {
                startDay.value = this.value;
            }
        });

        applyDateRange.addEventListener('click', function() {
            selectedStartDate = parseInt(startDay.value);
            selectedEndDate = parseInt(endDay.value);
            showLoadingIndicator();
            setTimeout(() => {
                updateDashboard();
                hideLoadingIndicator();
                showUpdateStatus(`Date range applied: Oct ${selectedStartDate} to Oct ${selectedEndDate}`);
            }, 300);
        });

        resetDateRange.addEventListener('click', function() {
            selectedStartDate = null;
            selectedEndDate = null;
            startDay.value = '1';
            endDay.value = '14';
            showLoadingIndicator();
            setTimeout(() => {
                updateDashboard();
                hideLoadingIndicator();
                showUpdateStatus('Date range reset to show all data');
            }, 300);
        });

        analysisType.addEventListener('change', function() {
            showLoadingIndicator();
            setTimeout(() => {
                updateDashboard();
                hideLoadingIndicator();
                showUpdateStatus('Analysis type changed');
            }, 300);
        });

        fileUpload.addEventListener('change', handleFileUpload);
        downloadTemplateBtn.addEventListener('click', downloadTemplate);
        addEntryBtn.addEventListener('click', handleAddEntry);
        manageOffersBtn.addEventListener('click', () => {
            // Switch to offers tab
            document.querySelector('[data-tab="offers"]').click();
        });
        generateReportBtn.addEventListener('click', generateReport);
        closeModalBtn.addEventListener('click', closeModal);
        cancelModalBtn.addEventListener('click', closeModal);
        saveModalBtn.addEventListener('click', handleSaveEntry);
        
        // Offer Modal Event Listeners
        addOfferBtn.addEventListener('click', () => {
            // Reset form for new offer
            editingOfferIndex = null;
            offerModalDate.value = '';
            offerModalNotes.value = '';
            offerModalType.value = 'Normal Day';
            offerModalBranch.value = 'Crispy Chicken-Hamdan St';
            
            // Clear any previous error messages
            document.getElementById('offerModalDateError').textContent = '';
            
            // Show the modal
            offerModal.style.display = 'flex';
        });
        
        closeOfferModalBtn.addEventListener('click', () => offerModal.style.display = 'none');
        cancelOfferModalBtn.addEventListener('click', () => offerModal.style.display = 'none');
        
        saveOfferBtn.addEventListener('click', () => {
            const dateValue = offerModalDate.value;
            const branchValue = offerModalBranch.value;
            const offerTypeValue = offerModalType.value;
            const notesValue = offerModalNotes.value;

            // Clear previous error messages
            document.getElementById('offerModalDateError').textContent = '';
            
            // Validate input
            if (!dateValue) { 
                document.getElementById('offerModalDateError').textContent = 'Date is required';
                return; 
            }
            
            // Format date to match the data format
            const formattedDate = formatDateForDisplay(dateValue);
            
            // Check if we're editing an existing offer
            const existingIndex = deliveryData.findIndex(item => 
                item.date === formattedDate && item.branch === branchValue
            );
            
            if (existingIndex !== -1) {
                // Update existing entry
                deliveryData[existingIndex] = {
                    ...deliveryData[existingIndex],
                    offerType: offerTypeValue,
                    offerStatus: offerTypeValue === 'Normal Day' ? 'No Offer' : 'Offer',
                    notes: notesValue
                };
            } else {
                // Add new entry
                deliveryData.push({
                    date: formattedDate,
                    branch: branchValue,
                    transactions: 0,
                    sales: 0,
                    offerType: offerTypeValue,
                    offerStatus: offerTypeValue === 'Normal Day' ? 'No Offer' : 'Offer',
                    notes: notesValue
                });
            }
            
            // Update all relevant components
            updateDashboard();
            updateOffersDashboard();
            
            // Close modal and reset form
            offerModal.style.display = 'none';
            offerModalDate.value = '';
            offerModalNotes.value = '';
            offerModalType.value = 'Normal Day';
            offerModalBranch.value = 'Crispy Chicken-Hamdan St';
            editingOfferIndex = null;
            
            showNotification('Offer updated successfully!', 'success');
        });
        
        // Offer sub-tabs event listeners
        const offerSubTabs = document.querySelectorAll('.sub-tab');
        const offerTabContents = document.querySelectorAll('.offer-tab-content');

        offerSubTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.getAttribute('data-offer-tab');
                
                // Update active sub-tab button
                offerSubTabs.forEach(btn => btn.classList.remove('active'));
                tab.classList.add('active');
                
                // Show corresponding sub-tab content
                offerTabContents.forEach(content => {
                    content.classList.add('hidden');
                    if (content.id === `offer-${tabName}-content`) {
                        content.classList.remove('hidden');
                    }
                });
                
                // Update specific offer charts based on the active sub-tab
                if (tabName === 'overview') {
                    updateOfferOverviewCharts();
                } else if (tabName === 'performance') {
                    updateOfferPerformanceCharts();
                } else if (tabName === 'comparison') {
                    updateOfferComparisonCharts();
                } else if (tabName === 'table') {
                    renderOfferTable();
                }
            });
        });

        // Export and refresh buttons
        document.getElementById('exportOfferData')?.addEventListener('click', exportOfferData);
        document.getElementById('refreshOfferData')?.addEventListener('click', () => {
            showLoadingIndicator();
            setTimeout(() => {
                updateOffersDashboard();
                hideLoadingIndicator();
                showUpdateStatus('Offer data refreshed');
            }, 500);
        });

        // Initialize dashboard
        updateDashboard();

        // Helper functions
        function showLoadingIndicator() {
            loadingIndicator.classList.remove('hidden');
        }

        function hideLoadingIndicator() {
            loadingIndicator.classList.add('hidden');
        }

        function showUpdateStatus(message) {
            updateStatus.textContent = message;
            setTimeout(() => {
                updateStatus.textContent = '';
            }, 3000);
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function formatDateForDisplay(dateString) {
            const date = new Date(dateString);
            const day = date.getDate();
            const suffix = getDaySuffix(day);
            const month = date.toLocaleDateString('en-US', { month: 'long' });
            const year = date.getFullYear();
            
            return `${month} ${day}${suffix}, ${year}`;
        }

        function getDaySuffix(day) {
            if (day >= 11 && day <= 13) {
                return 'th';
            }
            switch (day % 10) {
                case 1: return 'st';
                case 2: return 'nd';
                case 3: return 'rd';
                default: return 'th';
            }
        }

        function getDayOfWeek(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { weekday: 'long' });
        }

        function getDayNumber(dateString) {
            const date = new Date(dateString);
            return date.getDate();
        }

        function closeModal() {
            dataModal.classList.add('hidden');
            // Reset form
            modalDate.value = '';
            modalBranch.value = '';
            modalTransactions.value = '';
            modalSales.value = '';
            editingIndex = null;
            
            // Clear error messages
            document.getElementById('modalDateError').textContent = '';
            document.getElementById('modalBranchError').textContent = '';
            document.getElementById('modalTransactionsError').textContent = '';
            document.getElementById('modalSalesError').textContent = '';
        }

        function handleAddEntry() {
            editingIndex = null;
            modalTitle.textContent = 'Add New Entry';
            modalDate.value = '';
            modalBranch.value = '';
            modalTransactions.value = '';
            modalSales.value = '';
            
            // Clear error messages
            document.getElementById('modalDateError').textContent = '';
            document.getElementById('modalBranchError').textContent = '';
            document.getElementById('modalTransactionsError').textContent = '';
            document.getElementById('modalSalesError').textContent = '';
            
            dataModal.classList.remove('hidden');
        }

        function handleSaveEntry() {
            // Get form values
            const dateValue = modalDate.value.trim();
            const branchValue = modalBranch.value;
            const transactionsValue = parseInt(modalTransactions.value);
            const salesValue = parseFloat(modalSales.value);
            
            // Clear previous error messages
            document.getElementById('modalDateError').textContent = '';
            document.getElementById('modalBranchError').textContent = '';
            document.getElementById('modalTransactionsError').textContent = '';
            document.getElementById('modalSalesError').textContent = '';
            
            // Validate input
            let isValid = true;
            
            if (!dateValue) {
                document.getElementById('modalDateError').textContent = 'Date is required';
                isValid = false;
            }
            
            if (!branchValue) {
                document.getElementById('modalBranchError').textContent = 'Branch is required';
                isValid = false;
            }
            
            if (isNaN(transactionsValue) || transactionsValue < 0) {
                document.getElementById('modalTransactionsError').textContent = 'Valid transactions count is required';
                isValid = false;
            }
            
            if (isNaN(salesValue) || salesValue < 0) {
                document.getElementById('modalSalesError').textContent = 'Valid sales amount is required';
                isValid = false;
            }
            
            if (!isValid) return;
            
            // Create new entry
            const newEntry = {
                date: dateValue,
                branch: branchValue,
                transactions: transactionsValue,
                sales: salesValue
            };
            
            if (editingIndex !== null) {
                // Update existing entry
                deliveryData[editingIndex] = newEntry;
                showNotification('Entry updated successfully!', 'success');
            } else {
                // Add new entry
                deliveryData.push(newEntry);
                showNotification('Entry added successfully!', 'success');
            }
            
            // Update dashboard
            updateDashboard();
            
            // Close modal
            closeModal();
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            showLoadingIndicator();
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                    
                    // Process the uploaded data
                    processUploadedData(jsonData);
                    
                    showNotification('Data uploaded successfully!', 'success');
                    hideLoadingIndicator();
                    showUpdateStatus('Data updated from Excel file');
                } catch (error) {
                    console.error('Error processing file:', error);
                    showNotification('Error processing file. Please check the format.', 'error');
                    hideLoadingIndicator();
                }
            };
            
            reader.readAsArrayBuffer(file);
        }

        function processUploadedData(jsonData) {
            // Clear existing data
            deliveryData = [];
            
            // Process each row
            jsonData.forEach(row => {
                // Extract data from row (adjust column names as needed)
                const date = row['Date'] || row['date'] || '';
                const branch = row['Branch'] || row['branch'] || '';
                const transactions = parseInt(row['Transactions'] || row['transactions'] || 0);
                const sales = parseFloat(row['Sales'] || row['sales'] || 0);
                
                // Add to delivery data if valid
                if (date && branch && !isNaN(transactions) && !isNaN(sales)) {
                    deliveryData.push({
                        date: date,
                        branch: branch,
                        transactions: transactions,
                        sales: sales
                    });
                }
            });
            
            // Update dashboard with new data
            updateDashboard();
        }

        function downloadTemplate() {
            // Create a template workbook
            const wb = XLSX.utils.book_new();
            const ws_data = [
                ['Date', 'Branch', 'Transactions', 'Sales (AED)'],
                ['October 1st, 2025', 'Crispy Chicken-Hamdan St', 73, 3216],
                ['October 1st, 2025', 'Crispy Chicken Khaldia', 38, 1859.8],
                // Add more sample rows if needed
            ];
            
            const ws = XLSX.utils.aoa_to_sheet(ws_data);
            XLSX.utils.book_append_sheet(wb, ws, "Delivery Data");
            
            // Save the file
            XLSX.writeFile(wb, "Crispy_Chicken_Delivery_Template.xlsx");
            
            showNotification('Template downloaded successfully!', 'success');
        }

        function generateReport() {
            showLoadingIndicator();
            
            setTimeout(() => {
                // Create a report workbook
                const wb = XLSX.utils.book_new();
                
                // Summary sheet
                const summaryData = [
                    ['Crispy Chicken Delivery Analytics Report'],
                    ['Generated on:', new Date().toLocaleDateString()],
                    ['Date Range:', selectedStartDate ? `Oct ${selectedStartDate} to Oct ${selectedEndDate}` : 'Oct 1 to Oct 14, 2025'],
                    ['Branch:', selectedBranch === 'All' ? 'All Branches' : selectedBranch],
                    [],
                    ['Summary Metrics'],
                    ['Total Transactions:', getTotalTransactions()],
                    ['Total Sales (AED):', getTotalSales()],
                    ['Average Transaction Value (AED):', getAverageTransactionValue()],
                    ['Peak Performance Day:', getPeakPerformanceDay()],
                    ['Best Performing Branch:', getBestPerformingBranch()]
                ];
                
                const summaryWs = XLSX.utils.aoa_to_sheet(summaryData);
                XLSX.utils.book_append_sheet(wb, summaryWs, "Summary");
                
                // Data sheet
                const dataWs = XLSX.utils.json_to_sheet(getFilteredData());
                XLSX.utils.book_append_sheet(wb, dataWs, "Delivery Data");
                
                // Save the report
                XLSX.writeFile(wb, "Crispy_Chicken_Delivery_Report.xlsx");
                
                hideLoadingIndicator();
                showNotification('Report generated successfully!', 'success');
            }, 1000);
        }

        function getFilteredData() {
            let filteredData = [...deliveryData];
            
            // Filter by branch
            if (selectedBranch !== 'All') {
                filteredData = filteredData.filter(item => item.branch === selectedBranch);
            }
            
            // Filter by date range
            if (selectedStartDate && selectedEndDate) {
                filteredData = filteredData.filter(item => {
                    const day = getDayNumber(item.date);
                    return day >= selectedStartDate && day <= selectedEndDate;
                });
            }
            
            return filteredData;
        }

        function getTotalTransactions() {
            const filteredData = getFilteredData();
            return filteredData.reduce((sum, item) => sum + item.transactions, 0);
        }

        function getTotalSales() {
            const filteredData = getFilteredData();
            return filteredData.reduce((sum, item) => sum + item.sales, 0).toFixed(2);
        }

        function getAverageTransactionValue() {
            const filteredData = getFilteredData();
            const totalTransactions = getTotalTransactions();
            const totalSales = parseFloat(getTotalSales());
            
            if (totalTransactions === 0) return 0;
            
            return (totalSales / totalTransactions).toFixed(2);
        }

        function getPeakPerformanceDay() {
            const filteredData = getFilteredData();
            
            // Group by date
            const dateGroups = {};
            filteredData.forEach(item => {
                if (!dateGroups[item.date]) {
                    dateGroups[item.date] = {
                        transactions: 0,
                        sales: 0
                    };
                }
                dateGroups[item.date].transactions += item.transactions;
                dateGroups[item.date].sales += item.sales;
            });
            
            // Find day with highest transactions
            let peakDay = '';
            let maxTransactions = 0;
            
            Object.keys(dateGroups).forEach(date => {
                if (dateGroups[date].transactions > maxTransactions) {
                    maxTransactions = dateGroups[date].transactions;
                    peakDay = date;
                }
            });
            
            return peakDay;
        }

        function getBestPerformingBranch() {
            const filteredData = getFilteredData();
            
            // Group by branch
            const branchGroups = {};
            filteredData.forEach(item => {
                if (!branchGroups[item.branch]) {
                    branchGroups[item.branch] = {
                        transactions: 0,
                        sales: 0
                    };
                }
                branchGroups[item.branch].transactions += item.transactions;
                branchGroups[item.branch].sales += item.sales;
            });
            
            // Find branch with highest sales
            let bestBranch = '';
            let maxSales = 0;
            
            Object.keys(branchGroups).forEach(branch => {
                if (branchGroups[branch].sales > maxSales) {
                    maxSales = branchGroups[branch].sales;
                    bestBranch = branch;
                }
            });
            
            return bestBranch;
        }

        function updateDashboard() {
            // Update data table
            renderDataTable();
            
            // Update charts based on active tab
            const activeTab = document.querySelector('.tab-btn.tab-active');
            if (activeTab) {
                const tabName = activeTab.getAttribute('data-tab');
                
                if (tabName === 'overview') {
                    updateOverviewCharts();
                } else if (tabName === 'performance') {
                    updatePerformanceCharts();
                } else if (tabName === 'trends') {
                    updateTrendCharts();
                } else if (tabName === 'offers') {
                    updateOffersDashboard();
                }
            }
            
            // Update record count
            recordCount.textContent = getFilteredData().length;
        }

        function renderDataTable() {
            const filteredData = getFilteredData();
            
            // Clear existing table rows
            dataTableBody.innerHTML = '';
            
            // Add rows for filtered data
            filteredData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.className = 'table-row';
                
                // Calculate average per order
                const avgPerOrder = item.transactions > 0 ? (item.sales / item.transactions).toFixed(2) : '0.00';
                
                // Add offer type badge if available
                let offerBadge = '';
                if (item.offerType) {
                    let badgeClass = 'offer-type-badge-normal';
                    if (item.offerType === 'Chicken Day') badgeClass = 'offer-type-badge-chicken';
                    if (item.offerType === 'Ultimate Offer') badgeClass = 'offer-type-badge-ultimate';
                    
                    offerBadge = `<span class="offer-type-badge ${badgeClass}">${item.offerType}</span>`;
                }
                
                row.innerHTML = `
                    <td class="px-4 py-3">${item.date}</td>
                    <td class="px-4 py-3">${item.branch}</td>
                    <td class="px-4 py-3">${item.transactions}</td>
                    <td class="px-4 py-3">${item.sales.toFixed(2)}</td>
                    <td class="px-4 py-3">${avgPerOrder}</td>
                    <td class="px-4 py-3">
                        <div class="flex gap-2">
                            <button class="text-blue-600 hover:text-blue-800" onclick="editEntry(${deliveryData.indexOf(item)})">
                                <i data-lucide="edit" class="w-4 h-4"></i>
                            </button>
                            <button class="text-red-600 hover:text-red-800" onclick="deleteEntry(${deliveryData.indexOf(item)})">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                            ${offerBadge}
                        </div>
                    </td>
                `;
                
                dataTableBody.appendChild(row);
            });
            
            // Re-initialize Lucide icons
            lucide.createIcons();
            
            // Show/hide table footer based on record count
            if (filteredData.length > 20) {
                tableFooter.classList.remove('hidden');
            } else {
                tableFooter.classList.add('hidden');
            }
        }

        function editEntry(index) {
            editingIndex = index;
            const entry = deliveryData[index];
            
            modalTitle.textContent = 'Edit Entry';
            modalDate.value = entry.date;
            modalBranch.value = entry.branch;
            modalTransactions.value = entry.transactions;
            modalSales.value = entry.sales;
            
            dataModal.classList.remove('hidden');
        }

        function deleteEntry(index) {
            if (confirm('Are you sure you want to delete this entry?')) {
                deliveryData.splice(index, 1);
                updateDashboard();
                showNotification('Entry deleted successfully!', 'success');
            }
        }

        function highlightSelectedBranch() {
            // Remove previous highlights
            document.querySelectorAll('.branch-highlight').forEach(el => {
                el.classList.remove('branch-highlight');
            });
            
            // Add highlight to selected branch in table
            if (selectedBranch !== 'All') {
                document.querySelectorAll('.table-row').forEach(row => {
                    const branchCell = row.cells[1];
                    if (branchCell && branchCell.textContent === selectedBranch) {
                        row.classList.add('branch-highlight');
                    }
                });
            }
        }

        function updateOverviewCharts() {
            // Get filtered data
            const filteredData = getFilteredData();
            
            // Update KPIs
            document.getElementById('totalTransactions').textContent = getTotalTransactions();
            document.getElementById('totalSales').textContent = getTotalSales() + ' AED';
            document.getElementById('avgOrderValue').textContent = getAverageTransactionValue() + ' AED';
            document.getElementById('peakPerformance').textContent = getBestPerformingBranch();
            
            // Update transactions chart
            updateTransactionsChart(filteredData);
            
            // Update sales chart
            updateSalesChart(filteredData);
            
            // Update branch comparison chart
            updateBranchComparisonChart(filteredData);
            
            // Update weekly performance chart
            updateWeeklyPerformanceChart(filteredData);
        }

        function updateTransactionsChart(data) {
            // Group by date
            const dateGroups = {};
            data.forEach(item => {
                if (!dateGroups[item.date]) {
                    dateGroups[item.date] = 0;
                }
                dateGroups[item.date] += item.transactions;
            });
            
            // Sort dates
            const sortedDates = Object.keys(dateGroups).sort((a, b) => {
                return new Date(a) - new Date(b);
            });
            
            // Prepare data for chart
            const labels = sortedDates.map(date => {
                const day = getDayNumber(date);
                return `Oct ${day}`;
            });
            
            const values = sortedDates.map(date => dateGroups[date]);
            
            // Get chart context
            const ctx = document.getElementById('transactionsChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (transactionsChartInstance) {
                transactionsChartInstance.destroy();
            }
            
            // Create new chart
            transactionsChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Transactions',
                        data: values,
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateSalesChart(data) {
            // Group by date
            const dateGroups = {};
            data.forEach(item => {
                if (!dateGroups[item.date]) {
                    dateGroups[item.date] = 0;
                }
                dateGroups[item.date] += item.sales;
            });
            
            // Sort dates
            const sortedDates = Object.keys(dateGroups).sort((a, b) => {
                return new Date(a) - new Date(b);
            });
            
            // Prepare data for chart
            const labels = sortedDates.map(date => {
                const day = getDayNumber(date);
                return `Oct ${day}`;
            });
            
            const values = sortedDates.map(date => dateGroups[date]);
            
            // Get chart context
            const ctx = document.getElementById('salesChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (salesChartInstance) {
                salesChartInstance.destroy();
            }
            
            // Create new chart
            salesChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Sales (AED)',
                        data: values,
                        backgroundColor: 'rgba(255, 159, 64, 0.6)',
                        borderColor: 'rgba(255, 159, 64, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateBranchComparisonChart(data) {
            // Group by branch
            const branchGroups = {};
            data.forEach(item => {
                if (!branchGroups[item.branch]) {
                    branchGroups[item.branch] = {
                        transactions: 0,
                        sales: 0
                    };
                }
                branchGroups[item.branch].transactions += item.transactions;
                branchGroups[item.branch].sales += item.sales;
            });
            
            // Prepare data for chart
            const branches = Object.keys(branchGroups);
            const transactions = branches.map(branch => branchGroups[branch].transactions);
            const sales = branches.map(branch => branchGroups[branch].sales);
            
            // Get chart context
            const ctx = document.getElementById('branchChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (branchChartInstance) {
                branchChartInstance.destroy();
            }
            
            // Create new chart
            branchChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: branches,
                    datasets: [
                        {
                            label: 'Transactions',
                            data: transactions,
                            borderColor: 'rgb(255, 99, 132)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        },
                        {
                            label: 'Sales (AED)',
                            data: sales,
                            borderColor: 'rgb(54, 162, 235)',
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    elements: {
                        line: {
                            borderWidth: 2
                        }
                    },
                    scales: {
                        r: {
                            angleLines: {
                                display: true
                            },
                            suggestedMin: 0
                        }
                    }
                }
            });
        }

        function updateWeeklyPerformanceChart(data) {
            // Group by day of week
            const dayGroups = {};
            data.forEach(item => {
                const dayOfWeek = getDayOfWeek(item.date);
                if (!dayGroups[dayOfWeek]) {
                    dayGroups[dayOfWeek] = {
                        transactions: 0,
                        sales: 0
                    };
                }
                dayGroups[dayOfWeek].transactions += item.transactions;
                dayGroups[dayOfWeek].sales += item.sales;
            });
            
            // Days of week in order
            const daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            
            // Prepare data for chart
            const labels = daysOfWeek;
            const transactions = daysOfWeek.map(day => dayGroups[day] ? dayGroups[day].transactions : 0);
            const sales = daysOfWeek.map(day => dayGroups[day] ? dayGroups[day].sales : 0);
            
            // Get chart context
            const ctx = document.getElementById('weeklyChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (weeklyChartInstance) {
                weeklyChartInstance.destroy();
            }
            
            // Create new chart
            weeklyChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Transactions',
                            data: transactions,
                            backgroundColor: 'rgba(153, 102, 255, 0.6)',
                            borderColor: 'rgba(153, 102, 255, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Sales (AED)',
                            data: sales,
                            backgroundColor: 'rgba(255, 159, 64, 0.6)',
                            borderColor: 'rgba(255, 159, 64, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updatePerformanceCharts() {
            // Get filtered data
            const filteredData = getFilteredData();
            
            // Update hourly performance chart
            updateHourlyPerformanceChart(filteredData);
            
            // Update day of week chart
            updateDayOfWeekChart(filteredData);
            
            // Update performance metrics
            updatePerformanceMetrics(filteredData);
        }

        function updateHourlyPerformanceChart(data) {
            // For this demo, we'll simulate hourly data
            const hours = ['12 AM', '2 AM', '4 AM', '6 AM', '8 AM', '10 AM', '12 PM', '2 PM', '4 PM', '6 PM', '8 PM', '10 PM'];
            
            // Simulate data based on typical patterns
            const transactions = hours.map((hour, index) => {
                // Simulate higher values during meal times (8 AM, 12 PM, 6 PM, 8 PM)
                if (index === 4 || index === 6 || index === 9 || index === 10) {
                    return Math.floor(Math.random() * 30) + 20;
                }
                return Math.floor(Math.random() * 15) + 5;
            });
            
            // Get chart context
            const ctx = document.getElementById('hourlyChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (hourlyChartInstance) {
                hourlyChartInstance.destroy();
            }
            
            // Create new chart
            hourlyChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: hours,
                    datasets: [{
                        label: 'Orders',
                        data: transactions,
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateDayOfWeekChart(data) {
            // Group by day of week
            const dayGroups = {};
            data.forEach(item => {
                const dayOfWeek = getDayOfWeek(item.date);
                if (!dayGroups[dayOfWeek]) {
                    dayGroups[dayOfWeek] = {
                        transactions: 0,
                        sales: 0
                    };
                }
                dayGroups[dayOfWeek].transactions += item.transactions;
                dayGroups[dayOfWeek].sales += item.sales;
            });
            
            // Days of week in order
            const daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            
            // Prepare data for chart
            const labels = daysOfWeek;
            const sales = daysOfWeek.map(day => dayGroups[day] ? dayGroups[day].sales : 0);
            
            // Get chart context
            const ctx = document.getElementById('dayOfWeekChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (dayOfWeekChartInstance) {
                dayOfWeekChartInstance.destroy();
            }
            
            // Create new chart
            dayOfWeekChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Sales (AED)',
                        data: sales,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.6)',
                            'rgba(54, 162, 235, 0.6)',
                            'rgba(255, 206, 86, 0.6)',
                            'rgba(75, 192, 192, 0.6)',
                            'rgba(153, 102, 255, 0.6)',
                            'rgba(255, 159, 64, 0.6)',
                            'rgba(199, 199, 199, 0.6)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)',
                            'rgba(199, 199, 199, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updatePerformanceMetrics(data) {
            // Calculate metrics
            const totalTransactions = data.reduce((sum, item) => sum + item.transactions, 0);
            const totalSales = data.reduce((sum, item) => sum + item.sales, 0);
            const avgTransactionValue = totalTransactions > 0 ? totalSales / totalTransactions : 0;
            
            // Find highest and lowest order values
            const orderValues = data.map(item => item.sales / item.transactions).filter(val => !isNaN(val) && val > 0);
            const highestOrder = orderValues.length > 0 ? Math.max(...orderValues).toFixed(2) : '0';
            const lowestOrder = orderValues.length > 0 ? Math.min(...orderValues).toFixed(2) : '0';
            
            // Update UI
            document.getElementById('peakHours').textContent = '6:00 PM - 8:00 PM';
            document.getElementById('avgOrdersHour').textContent = (totalTransactions / 14 / 7).toFixed(1); // Avg per hour across 14 days, 7 branches
            document.getElementById('peakDay').textContent = getPeakPerformanceDay();
            document.getElementById('highestOrder').textContent = `${highestOrder} AED`;
            document.getElementById('lowestOrder').textContent = `${lowestOrder} AED`;
            document.getElementById('mostCommon').textContent = '85-120 AED';
            document.getElementById('ordersEmployee').textContent = (totalTransactions / 50).toFixed(1); // Assuming 50 employees
            document.getElementById('prepTime').textContent = '12 min';
            document.getElementById('deliveryTime').textContent = '28 min';
        }

        function updateTrendCharts() {
            // Get filtered data
            const filteredData = getFilteredData();
            
            // Update moving average chart
            updateMovingAverageChart(filteredData);
            
            // Update growth rate chart
            updateGrowthRateChart(filteredData);
            
            // Update trend metrics
            updateTrendMetrics(filteredData);
        }

        function updateMovingAverageChart(data) {
            // Group by date
            const dateGroups = {};
            data.forEach(item => {
                if (!dateGroups[item.date]) {
                    dateGroups[item.date] = 0;
                }
                dateGroups[item.date] += item.sales;
            });
            
            // Sort dates
            const sortedDates = Object.keys(dateGroups).sort((a, b) => {
                return new Date(a) - new Date(b);
            });
            
            // Prepare data for chart
            const labels = sortedDates.map(date => {
                const day = getDayNumber(date);
                return `Oct ${day}`;
            });
            
            const values = sortedDates.map(date => dateGroups[date]);
            
            // Calculate 3-day moving average
            const movingAvg = [];
            for (let i = 0; i < values.length; i++) {
                if (i < 2) {
                    movingAvg.push(values[i]);
                } else {
                    const avg = (values[i-2] + values[i-1] + values[i]) / 3;
                    movingAvg.push(avg);
                }
            }
            
            // Get chart context
            const ctx = document.getElementById('movingAvgChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (movingAvgChartInstance) {
                movingAvgChartInstance.destroy();
            }
            
            // Create new chart
            movingAvgChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Daily Sales',
                            data: values,
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            tension: 0.3,
                            fill: false
                        },
                        {
                            label: '3-Day Moving Average',
                            data: movingAvg,
                            borderColor: 'rgb(255, 99, 132)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            tension: 0.3,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });
        }

        function updateGrowthRateChart(data) {
            // Group by date
            const dateGroups = {};
            data.forEach(item => {
                if (!dateGroups[item.date]) {
                    dateGroups[item.date] = 0;
                }
                dateGroups[item.date] += item.sales;
            });
            
            // Sort dates
            const sortedDates = Object.keys(dateGroups).sort((a, b) => {
                return new Date(a) - new Date(b);
            });
            
            // Prepare data for chart
            const labels = sortedDates.map(date => {
                const day = getDayNumber(date);
                return `Oct ${day}`;
            });
            
            const values = sortedDates.map(date => dateGroups[date]);
            
            // Calculate day-over-day growth rate
            const growthRates = [0]; // First day has no growth rate
            for (let i = 1; i < values.length; i++) {
                const growthRate = ((values[i] - values[i-1]) / values[i-1]) * 100;
                growthRates.push(growthRate);
            }
            
            // Get chart context
            const ctx = document.getElementById('growthRateChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (growthRateChartInstance) {
                growthRateChartInstance.destroy();
            }
            
            // Create new chart
            growthRateChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Growth Rate (%)',
                        data: growthRates,
                        backgroundColor: growthRates.map(rate => 
                            rate >= 0 ? 'rgba(75, 192, 192, 0.6)' : 'rgba(255, 99, 132, 0.6)'
                        ),
                        borderColor: growthRates.map(rate => 
                            rate >= 0 ? 'rgba(75, 192, 192, 1)' : 'rgba(255, 99, 132, 1)'
                        ),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });
        }

        function updateTrendMetrics(data) {
            // Calculate metrics
            const totalSales = data.reduce((sum, item) => sum + item.sales, 0);
            
            // Calculate growth rate (comparing first half to second half of period)
            const sortedData = [...data].sort((a, b) => new Date(a.date) - new Date(b.date));
            const midPoint = Math.floor(sortedData.length / 2);
            
            const firstHalfSales = sortedData.slice(0, midPoint).reduce((sum, item) => sum + item.sales, 0);
            const secondHalfSales = sortedData.slice(midPoint).reduce((sum, item) => sum + item.sales, 0);
            
            const growthRate = firstHalfSales > 0 ? ((secondHalfSales - firstHalfSales) / firstHalfSales * 100) : 0;
            
            // Calculate seasonality index (comparing to average)
            const avgDailySales = totalSales / 14; // Assuming 14 days
            const seasonalityIndex = avgDailySales > 0 ? totalSales / (avgDailySales * 14) : 1;
            
            // Calculate volatility (standard deviation of daily sales)
            const dailySales = {};
            data.forEach(item => {
                if (!dailySales[item.date]) {
                    dailySales[item.date] = 0;
                }
                dailySales[item.date] += item.sales;
            });
            
            const dailySalesValues = Object.values(dailySales);
            const mean = dailySalesValues.reduce((sum, val) => sum + val, 0) / dailySalesValues.length;
            const variance = dailySalesValues.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / dailySalesValues.length;
            const volatility = Math.sqrt(variance) / mean * 100; // Coefficient of variation as percentage
            
            // Determine momentum based on growth rate
            let momentum = 'Stable';
            if (growthRate > 10) momentum = 'Strong';
            else if (growthRate > 5) momentum = 'Moderate';
            else if (growthRate < -5) momentum = 'Declining';
            
            // Update UI
            document.getElementById('growthRate').textContent = `${growthRate >= 0 ? '+' : ''}${growthRate.toFixed(1)}%`;
            document.getElementById('seasonalityIndex').textContent = seasonalityIndex.toFixed(2);
            document.getElementById('volatility').textContent = `${volatility.toFixed(1)}%`;
            document.getElementById('momentum').textContent = momentum;
        }

        function updateOffersDashboard() {
            // Get filtered data
            const filteredData = getFilteredData();
            
            // Update offer metrics
            updateOfferMetrics(filteredData);
            
            // Update offer charts based on active sub-tab
            const activeSubTab = document.querySelector('.sub-tab.active');
            if (activeSubTab) {
                const subTabName = activeSubTab.getAttribute('data-offer-tab');
                
                if (subTabName === 'overview') {
                    updateOfferOverviewCharts();
                } else if (subTabName === 'performance') {
                    updateOfferPerformanceCharts();
                } else if (subTabName === 'comparison') {
                    updateOfferComparisonCharts();
                } else if (subTabName === 'table') {
                    renderOfferTable();
                }
            }
        }

        function updateOfferMetrics(data) {
            // Filter data with offers
            const offersData = data.filter(item => item.offerStatus === 'Offer');
            const normalData = data.filter(item => item.offerStatus === 'No Offer');
            
            // Calculate metrics
            const totalOffers = offersData.length;
            const offerRevenue = offersData.reduce((sum, item) => sum + item.sales, 0);
            const normalRevenue = normalData.reduce((sum, item) => sum + item.sales, 0);
            
            // Calculate conversion rate
            const totalTransactions = data.reduce((sum, item) => sum + item.transactions, 0);
            const offerTransactions = offersData.reduce((sum, item) => sum + item.transactions, 0);
            const conversionRate = totalTransactions > 0 ? (offerTransactions / totalTransactions * 100) : 0;
            
            // Find top performing offer type
            const offerTypeGroups = {};
            offersData.forEach(item => {
                if (!offerTypeGroups[item.offerType]) {
                    offerTypeGroups[item.offerType] = {
                        transactions: 0,
                        sales: 0
                    };
                }
                offerTypeGroups[item.offerType].transactions += item.transactions;
                offerTypeGroups[item.offerType].sales += item.sales;
            });
            
            let topOfferType = '';
            let maxSales = 0;
            
            Object.keys(offerTypeGroups).forEach(offerType => {
                if (offerTypeGroups[offerType].sales > maxSales) {
                    maxSales = offerTypeGroups[offerType].sales;
                    topOfferType = offerType;
                }
            });
            
            // Update UI
            document.getElementById('totalOffers').textContent = totalOffers;
            document.getElementById('offerRevenue').textContent = `${offerRevenue.toFixed(2)} AED`;
            document.getElementById('offerConversion').textContent = `${conversionRate.toFixed(1)}%`;
            document.getElementById('topOffer').textContent = topOfferType || '-';
            
            // Update top performing offers
            updateTopPerformingOffers(offersData);
        }

        function updateTopPerformingOffers(offersData) {
            const container = document.getElementById('topOffersContainer');
            container.innerHTML = '';
            
            // Group by offer type
            const offerTypeGroups = {};
            offersData.forEach(item => {
                if (!offerTypeGroups[item.offerType]) {
                    offerTypeGroups[item.offerType] = {
                        transactions: 0,
                        sales: 0,
                        count: 0
                    };
                }
                offerTypeGroups[item.offerType].transactions += item.transactions;
                offerTypeGroups[item.offerType].sales += item.sales;
                offerTypeGroups[item.offerType].count += 1;
            });
            
            // Sort by sales
            const sortedOfferTypes = Object.keys(offerTypeGroups).sort((a, b) => 
                offerTypeGroups[b].sales - offerTypeGroups[a].sales
            );
            
            // Create cards for top 3 offer types
            sortedOfferTypes.slice(0, 3).forEach((offerType, index) => {
                const group = offerTypeGroups[offerType];
                const avgTransaction = group.transactions > 0 ? group.sales / group.transactions : 0;
                
                // Get normal day data for comparison
                const normalData = deliveryData.filter(item => 
                    item.offerStatus === 'No Offer' && 
                    sortedOfferTypes.some(type => item.branch.includes(type.split(' ')[0]))
                );
                
                const normalSales = normalData.reduce((sum, item) => sum + item.sales, 0);
                const normalCount = normalData.length;
                const avgNormalSales = normalCount > 0 ? normalSales / normalCount : 0;
                const avgOfferSales = group.count > 0 ? group.sales / group.count : 0;
                
                const performance = avgNormalSales > 0 ? ((avgOfferSales - avgNormalSales) / avgNormalSales * 100) : 0;
                
                // Determine card color based on offer type
                let cardClass = 'bg-blue-50 border-blue-200';
                let textClass = 'text-blue-800';
                let badgeClass = 'offer-type-badge-normal';
                
                if (offerType === 'Chicken Day') {
                    cardClass = 'bg-amber-50 border-amber-200';
                    textClass = 'text-amber-800';
                    badgeClass = 'offer-type-badge-chicken';
                } else if (offerType === 'Ultimate Offer') {
                    cardClass = 'bg-purple-50 border-purple-200';
                    textClass = 'text-purple-800';
                    badgeClass = 'offer-type-badge-ultimate';
                }
                
                const card = document.createElement('div');
                card.className = `p-4 rounded-lg border ${cardClass}`;
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-semibold ${textClass}">${offerType}</h4>
                        <span class="offer-type-badge ${badgeClass}">#${index + 1}</span>
                    </div>
                    <p class="text-2xl font-bold ${textClass} mb-1">${group.sales.toFixed(2)} AED</p>
                    <p class="text-sm ${textClass} mb-2">${group.transactions} transactions</p>
                    <div class="flex justify-between items-center">
                        <span class="text-xs ${textClass}">Avg: ${avgTransaction.toFixed(2)} AED</span>
                        <span class="text-xs font-medium ${performance >= 0 ? 'text-green-600' : 'text-red-600'}">
                            ${performance >= 0 ? '+' : ''}${performance.toFixed(0)}% vs normal
                        </span>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        function updateOfferOverviewCharts() {
            // Get filtered data
            const filteredData = getFilteredData();
            
            // Update offer type chart
            updateOfferTypeChart(filteredData);
            
            // Update offer impact chart
            updateOfferImpactChart(filteredData);
        }

        function updateOfferTypeChart(data) {
            // Group by offer type
            const offerTypeGroups = {};
            data.forEach(item => {
                const offerType = item.offerType || 'No Offer';
                if (!offerTypeGroups[offerType]) {
                    offerTypeGroups[offerType] = {
                        transactions: 0,
                        sales: 0
                    };
                }
                offerTypeGroups[offerType].transactions += item.transactions;
                offerTypeGroups[offerType].sales += item.sales;
            });
            
            // Prepare data for chart
            const labels = Object.keys(offerTypeGroups);
            const sales = labels.map(offerType => offerTypeGroups[offerType].sales);
            
            // Get chart context
            const ctx = document.getElementById('offerTypeChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (offerTypeChartInstance) {
                offerTypeChartInstance.destroy();
            }
            
            // Create new chart
            offerTypeChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: sales,
                        backgroundColor: [
                            'rgba(54, 162, 235, 0.6)',
                            'rgba(255, 159, 64, 0.6)',
                            'rgba(153, 102, 255, 0.6)',
                            'rgba(75, 192, 192, 0.6)'
                        ],
                        borderColor: [
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 159, 64, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(75, 192, 192, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        }
                    }
                }
            });
        }

        function updateOfferImpactChart(data) {
            // Group by date and offer status
            const dateOfferGroups = {};
            data.forEach(item => {
                const date = item.date;
                const offerStatus = item.offerStatus || 'No Offer';
                
                if (!dateOfferGroups[date]) {
                    dateOfferGroups[date] = {
                        'Offer': 0,
                        'No Offer': 0
                    };
                }
                
                dateOfferGroups[date][offerStatus] += item.sales;
            });
            
            // Sort dates
            const sortedDates = Object.keys(dateOfferGroups).sort((a, b) => {
                return new Date(a) - new Date(b);
            });
            
            // Prepare data for chart
            const labels = sortedDates.map(date => {
                const day = getDayNumber(date);
                return `Oct ${day}`;
            });
            
            const offerSales = sortedDates.map(date => dateOfferGroups[date]['Offer']);
            const normalSales = sortedDates.map(date => dateOfferGroups[date]['No Offer']);
            
            // Get chart context
            const ctx = document.getElementById('offerImpactChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (offerImpactChartInstance) {
                offerImpactChartInstance.destroy();
            }
            
            // Create new chart
            offerImpactChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Offer Days',
                            data: offerSales,
                            backgroundColor: 'rgba(153, 102, 255, 0.6)',
                            borderColor: 'rgba(153, 102, 255, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Normal Days',
                            data: normalSales,
                            backgroundColor: 'rgba(75, 192, 192, 0.6)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateOfferPerformanceCharts() {
            // Get filtered data
            const filteredData = getFilteredData();
            
            // Update offer day chart
            updateOfferDayChart(filteredData);
            
            // Update offer branch chart
            updateOfferBranchChart(filteredData);
            
            // Update offer performance table
            updateOfferPerformanceTable(filteredData);
        }

        function updateOfferDayChart(data) {
            // Group by day of week and offer status
            const dayOfferGroups = {};
            data.forEach(item => {
                const dayOfWeek = getDayOfWeek(item.date);
                const offerStatus = item.offerStatus || 'No Offer';
                
                if (!dayOfferGroups[dayOfWeek]) {
                    dayOfferGroups[dayOfWeek] = {
                        'Offer': 0,
                        'No Offer': 0
                    };
                }
                
                dayOfferGroups[dayOfWeek][offerStatus] += item.sales;
            });
            
            // Days of week in order
            const daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            
            // Prepare data for chart
            const labels = daysOfWeek;
            const offerSales = daysOfWeek.map(day => dayOfferGroups[day] ? dayOfferGroups[day]['Offer'] : 0);
            const normalSales = daysOfWeek.map(day => dayOfferGroups[day] ? dayOfferGroups[day]['No Offer'] : 0);
            
            // Get chart context
            const ctx = document.getElementById('offerDayChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (offerDayChartInstance) {
                offerDayChartInstance.destroy();
            }
            
            // Create new chart
            offerDayChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Offer Days',
                            data: offerSales,
                            borderColor: 'rgb(153, 102, 255)',
                            backgroundColor: 'rgba(153, 102, 255, 0.2)',
                            tension: 0.3,
                            fill: false
                        },
                        {
                            label: 'Normal Days',
                            data: normalSales,
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            tension: 0.3,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });
        }

        function updateOfferBranchChart(data) {
            // Group by branch and offer status
            const branchOfferGroups = {};
            data.forEach(item => {
                const branch = item.branch;
                const offerStatus = item.offerStatus || 'No Offer';
                
                if (!branchOfferGroups[branch]) {
                    branchOfferGroups[branch] = {
                        'Offer': 0,
                        'No Offer': 0
                    };
                }
                
                branchOfferGroups[branch][offerStatus] += item.sales;
            });
            
            // Prepare data for chart
            const branches = Object.keys(branchOfferGroups);
            const offerSales = branches.map(branch => branchOfferGroups[branch]['Offer']);
            const normalSales = branches.map(branch => branchOfferGroups[branch]['No Offer']);
            
            // Get chart context
            const ctx = document.getElementById('offerBranchChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (offerBranchChartInstance) {
                offerBranchChartInstance.destroy();
            }
            
            // Create new chart
            offerBranchChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: branches,
                    datasets: [
                        {
                            label: 'Offer Days',
                            data: offerSales,
                            backgroundColor: 'rgba(153, 102, 255, 0.6)',
                            borderColor: 'rgba(153, 102, 255, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Normal Days',
                            data: normalSales,
                            backgroundColor: 'rgba(75, 192, 192, 0.6)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateOfferPerformanceTable(data) {
            const tableBody = document.getElementById('offerPerformanceTableBody');
            tableBody.innerHTML = '';
            
            // Group by offer type
            const offerTypeGroups = {};
            const normalGroup = {
                transactions: 0,
                sales: 0
            };
            
            data.forEach(item => {
                if (item.offerStatus === 'Offer') {
                    const offerType = item.offerType || 'Unknown';
                    if (!offerTypeGroups[offerType]) {
                        offerTypeGroups[offerType] = {
                            transactions: 0,
                            sales: 0
                        };
                    }
                    offerTypeGroups[offerType].transactions += item.transactions;
                    offerTypeGroups[offerType].sales += item.sales;
                } else {
                    normalGroup.transactions += item.transactions;
                    normalGroup.sales += item.sales;
                }
            });
            
            // Calculate average transaction values
            const normalAvgValue = normalGroup.transactions > 0 ? normalGroup.sales / normalGroup.transactions : 0;
            
            // Create table rows
            Object.keys(offerTypeGroups).forEach(offerType => {
                const group = offerTypeGroups[offerType];
                const avgTransactionValue = group.transactions > 0 ? group.sales / group.transactions : 0;
                const performanceVsNormal = normalAvgValue > 0 ? ((avgTransactionValue - normalAvgValue) / normalAvgValue * 100) : 0;
                
                const row = document.createElement('tr');
                row.className = 'table-row';
                
                // Determine badge class based on offer type
                let badgeClass = 'offer-type-badge-normal';
                if (offerType === 'Chicken Day') badgeClass = 'offer-type-badge-chicken';
                if (offerType === 'Ultimate Offer') badgeClass = 'offer-type-badge-ultimate';
                
                row.innerHTML = `
                    <td class="px-4 py-3">
                        <span class="offer-type-badge ${badgeClass}">${offerType}</span>
                    </td>
                    <td class="px-4 py-3">${group.transactions}</td>
                    <td class="px-4 py-3">${group.sales.toFixed(2)}</td>
                    <td class="px-4 py-3">${avgTransactionValue.toFixed(2)}</td>
                    <td class="px-4 py-3">
                        <span class="${performanceVsNormal >= 0 ? 'text-green-600' : 'text-red-600'} font-medium">
                            ${performanceVsNormal >= 0 ? '+' : ''}${performanceVsNormal.toFixed(1)}%
                        </span>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Add normal day row
            const normalRow = document.createElement('tr');
            normalRow.className = 'table-row';
            normalRow.innerHTML = `
                <td class="px-4 py-3">
                    <span class="offer-type-badge" style="background-color: #e5e7eb; color: #374151;">Normal Day</span>
                </td>
                <td class="px-4 py-3">${normalGroup.transactions}</td>
                <td class="px-4 py-3">${normalGroup.sales.toFixed(2)}</td>
                <td class="px-4 py-3">${normalAvgValue.toFixed(2)}</td>
                <td class="px-4 py-3">
                    <span class="text-gray-600 font-medium">Baseline</span>
                </td>
            `;
            
            tableBody.appendChild(normalRow);
        }

        function updateOfferComparisonCharts() {
            // Get filtered data
            const filteredData = getFilteredData();
            
            // Update offer comparison chart
            updateOfferComparisonChart(filteredData);
            
            // Update offer ROI chart
            updateOfferRoiChart(filteredData);
            
            // Update offer comparison cards
            updateOfferComparisonCards(filteredData);
        }

        function updateOfferComparisonChart(data) {
            // Group by offer type
            const offerTypeGroups = {};
            const normalGroup = {
                transactions: 0,
                sales: 0
            };
            
            data.forEach(item => {
                if (item.offerStatus === 'Offer') {
                    const offerType = item.offerType || 'Unknown';
                    if (!offerTypeGroups[offerType]) {
                        offerTypeGroups[offerType] = {
                            transactions: 0,
                            sales: 0
                        };
                    }
                    offerTypeGroups[offerType].transactions += item.transactions;
                    offerTypeGroups[offerType].sales += item.sales;
                } else {
                    normalGroup.transactions += item.transactions;
                    normalGroup.sales += item.sales;
                }
            });
            
            // Prepare data for chart
            const offerTypes = Object.keys(offerTypeGroups);
            const transactions = offerTypes.map(offerType => offerTypeGroups[offerType].transactions);
            const sales = offerTypes.map(offerType => offerTypeGroups[offerType].sales);
            
            // Calculate normal averages for comparison
            const normalAvgTransactions = normalGroup.transactions / Math.max(1, offerTypes.length);
            const normalAvgSales = normalGroup.sales / Math.max(1, offerTypes.length);
            
            // Get chart context
            const ctx = document.getElementById('offerComparisonChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (offerComparisonChartInstance) {
                offerComparisonChartInstance.destroy();
            }
            
            // Create new chart
            offerComparisonChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: offerTypes,
                    datasets: [
                        {
                            label: 'Transactions',
                            data: transactions,
                            borderColor: 'rgb(255, 99, 132)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        },
                        {
                            label: 'Sales (AED)',
                            data: sales,
                            borderColor: 'rgb(54, 162, 235)',
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    elements: {
                        line: {
                            borderWidth: 2
                        }
                    },
                    scales: {
                        r: {
                            angleLines: {
                                display: true
                            },
                            suggestedMin: 0
                        }
                    }
                }
            });
        }

        function updateOfferRoiChart(data) {
            // Group by offer type
            const offerTypeGroups = {};
            const normalGroup = {
                transactions: 0,
                sales: 0
            };
            
            data.forEach(item => {
                if (item.offerStatus === 'Offer') {
                    const offerType = item.offerType || 'Unknown';
                    if (!offerTypeGroups[offerType]) {
                        offerTypeGroups[offerType] = {
                            transactions: 0,
                            sales: 0,
                            count: 0
                        };
                    }
                    offerTypeGroups[offerType].transactions += item.transactions;
                    offerTypeGroups[offerType].sales += item.sales;
                    offerTypeGroups[offerType].count += 1;
                } else {
                    normalGroup.transactions += item.transactions;
                    normalGroup.sales += item.sales;
                }
            });
            
            // Calculate metrics
            const normalAvgSales = normalGroup.transactions > 0 ? normalGroup.sales / normalGroup.transactions : 0;
            
            const offerTypes = Object.keys(offerTypeGroups);
            const roiData = offerTypes.map(offerType => {
                const group = offerTypeGroups[offerType];
                const avgSales = group.transactions > 0 ? group.sales / group.transactions : 0;
                const uplift = normalAvgSales > 0 ? ((avgSales - normalAvgSales) / normalAvgSales * 100) : 0;
                
                // Simulate ROI based on uplift and offer type
                let cost = 0;
                if (offerType === 'Chicken Day') cost = 500;
                else if (offerType === 'Ultimate Offer') cost = 1000;
                else cost = 300;
                
                const additionalRevenue = group.sales - (group.transactions * normalAvgSales);
                const roi = cost > 0 ? ((additionalRevenue - cost) / cost * 100) : 0;
                
                return {
                    offerType: offerType,
                    roi: roi,
                    uplift: uplift,
                    additionalRevenue: additionalRevenue
                };
            });
            
            // Sort by ROI
            roiData.sort((a, b) => b.roi - a.roi);
            
            // Prepare data for chart
            const labels = roiData.map(item => item.offerType);
            const roiValues = roiData.map(item => item.roi);
            
            // Get chart context
            const ctx = document.getElementById('offerRoiChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (offerRoiChartInstance) {
                offerRoiChartInstance.destroy();
            }
            
            // Create new chart
            offerRoiChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ROI (%)',
                        data: roiValues,
                        backgroundColor: roiValues.map(roi => 
                            roi >= 0 ? 'rgba(75, 192, 192, 0.6)' : 'rgba(255, 99, 132, 0.6)'
                        ),
                        borderColor: roiValues.map(roi => 
                            roi >= 0 ? 'rgba(75, 192, 192, 1)' : 'rgba(255, 99, 132, 1)'
                        ),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });
        }

        function updateOfferComparisonCards(data) {
            const container = document.getElementById('offerComparisonCards');
            container.innerHTML = '';
            
            // Group by offer type
            const offerTypeGroups = {};
            const normalGroup = {
                transactions: 0,
                sales: 0
            };
            
            data.forEach(item => {
                if (item.offerStatus === 'Offer') {
                    const offerType = item.offerType || 'Unknown';
                    if (!offerTypeGroups[offerType]) {
                        offerTypeGroups[offerType] = {
                            transactions: 0,
                            sales: 0,
                            count: 0
                        };
                    }
                    offerTypeGroups[offerType].transactions += item.transactions;
                    offerTypeGroups[offerType].sales += item.sales;
                    offerTypeGroups[offerType].count += 1;
                } else {
                    normalGroup.transactions += item.transactions;
                    normalGroup.sales += item.sales;
                }
            });
            
            // Calculate metrics for each offer type
            const normalAvgSales = normalGroup.transactions > 0 ? normalGroup.sales / normalGroup.transactions : 0;
            
            const offerMetrics = Object.keys(offerTypeGroups).map(offerType => {
                const group = offerTypeGroups[offerType];
                const avgSales = group.transactions > 0 ? group.sales / group.transactions : 0;
                const uplift = normalAvgSales > 0 ? ((avgSales - normalAvgSales) / normalAvgSales * 100) : 0;
                
                // Simulate cost based on offer type
                let cost = 0;
                if (offerType === 'Chicken Day') cost = 500;
                else if (offerType === 'Ultimate Offer') cost = 1000;
                else cost = 300;
                
                const additionalRevenue = group.sales - (group.transactions * normalAvgSales);
                const roi = cost > 0 ? ((additionalRevenue - cost) / cost * 100) : 0;
                
                return {
                    offerType: offerType,
                    sales: group.sales,
                    transactions: group.transactions,
                    avgSales: avgSales,
                    uplift: uplift,
                    cost: cost,
                    additionalRevenue: additionalRevenue,
                    roi: roi
                };
            });
            
            // Sort by ROI
            offerMetrics.sort((a, b) => b.roi - a.roi);
            
            // Create cards for each offer type
            offerMetrics.forEach((metric, index) => {
                // Determine card color based on offer type
                let cardClass = 'bg-blue-50 border-blue-200';
                let textClass = 'text-blue-800';
                let badgeClass = 'offer-type-badge-normal';
                
                if (metric.offerType === 'Chicken Day') {
                    cardClass = 'bg-amber-50 border-amber-200';
                    textClass = 'text-amber-800';
                    badgeClass = 'offer-type-badge-chicken';
                } else if (metric.offerType === 'Ultimate Offer') {
                    cardClass = 'bg-purple-50 border-purple-200';
                    textClass = 'text-purple-800';
                    badgeClass = 'offer-type-badge-ultimate';
                }
                
                const card = document.createElement('div');
                card.className = `offer-comparison-card ${cardClass}`;
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <h4 class="font-semibold ${textClass}">${metric.offerType}</h4>
                        <span class="offer-type-badge ${badgeClass}">#${index + 1}</span>
                    </div>
                    
                    <div class="mb-3">
                        <div class="flex justify-between mb-1">
                            <span class="text-sm ${textClass}">ROI</span>
                            <span class="text-sm font-bold ${metric.roi >= 0 ? 'text-green-600' : 'text-red-600'}">
                                ${metric.roi >= 0 ? '+' : ''}${metric.roi.toFixed(1)}%
                            </span>
                        </div>
                        <div class="offer-performance-bar">
                            <div class="offer-performance-fill" style="width: ${Math.min(100, Math.max(0, metric.roi + 100))}%; background-color: ${metric.roi >= 0 ? '#10b981' : '#ef4444'};"></div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <div>
                            <p class="text-gray-600">Revenue</p>
                            <p class="font-semibold ${textClass}">${metric.sales.toFixed(2)} AED</p>
                        </div>
                        <div>
                            <p class="text-gray-600">Transactions</p>
                            <p class="font-semibold ${textClass}">${metric.transactions}</p>
                        </div>
                        <div>
                            <p class="text-gray-600">Avg. Value</p>
                            <p class="font-semibold ${textClass}">${metric.avgSales.toFixed(2)} AED</p>
                        </div>
                        <div>
                            <p class="text-gray-600">Uplift</p>
                            <p class="font-semibold ${metric.uplift >= 0 ? 'text-green-600' : 'text-red-600'}">
                                ${metric.uplift >= 0 ? '+' : ''}${metric.uplift.toFixed(1)}%
                            </p>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        function renderOfferTable() {
            const tableBody = document.getElementById('offerTableBody');
            tableBody.innerHTML = '';
            
            // Get filtered data
            const filteredData = getFilteredData();
            
            // Sort data by date (newest first)
            const sortedData = [...filteredData].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Add rows for filtered data
            sortedData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.className = 'table-row';
                
                // Add row class based on offer type
                if (item.offerType === 'Normal Day') {
                    row.classList.add('offer-row-normal');
                } else if (item.offerType === 'Chicken Day') {
                    row.classList.add('offer-row-chicken');
                } else if (item.offerType === 'Ultimate Offer') {
                    row.classList.add('offer-row-ultimate');
                }
                
                // Calculate average per order
                const avgPerOrder = item.transactions > 0 ? (item.sales / item.transactions).toFixed(2) : '0.00';
                
                // Get day of week
                const dayOfWeek = getDayOfWeek(item.date);
                
                // Add offer type badge if available
                let offerBadge = '';
                if (item.offerType) {
                    let badgeClass = 'offer-type-badge-normal';
                    if (item.offerType === 'Chicken Day') badgeClass = 'offer-type-badge-chicken';
                    if (item.offerType === 'Ultimate Offer') badgeClass = 'offer-type-badge-ultimate';
                    
                    offerBadge = `<span class="offer-type-badge ${badgeClass}">${item.offerType}</span>`;
                }
                
                // Add offer status badge
                let statusBadge = '';
                if (item.offerStatus === 'Offer') {
                    statusBadge = '<span class="auto-offer-indicator"><i data-lucide="tag" class="w-3 h-3"></i> Active</span>';
                } else {
                    statusBadge = '<span class="text-gray-500 text-sm">No Offer</span>';
                }
                
                row.innerHTML = `
                    <td class="px-4 py-3">${item.date}</td>
                    <td class="px-4 py-3">${dayOfWeek}</td>
                    <td class="px-4 py-3">${item.branch}</td>
                    <td class="px-4 py-3">${item.transactions}</td>
                    <td class="px-4 py-3">${item.sales.toFixed(2)}</td>
                    <td class="px-4 py-3">${offerBadge}</td>
                    <td class="px-4 py-3">${statusBadge}</td>
                    <td class="px-4 py-3">${item.notes || '-'}</td>
                    <td class="px-4 py-3">
                        <div class="flex gap-2">
                            <button class="text-blue-600 hover:text-blue-800" onclick="editOffer(${deliveryData.indexOf(item)})">
                                <i data-lucide="edit" class="w-4 h-4"></i>
                            </button>
                            <button class="text-red-600 hover:text-red-800" onclick="deleteOffer(${deliveryData.indexOf(item)})">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Re-initialize Lucide icons
            lucide.createIcons();
            
            // Update pagination
            updatePagination(sortedData.length);
        }

        function editOffer(index) {
            editingOfferIndex = index;
            const entry = deliveryData[index];
            
            // Format date for input
            const dateParts = entry.date.match(/(\w+) (\d+)(\w+), (\d+)/);
            let formattedDate = '';
            
            if (dateParts) {
                const month = dateParts[1];
                const day = dateParts[2];
                const year = dateParts[4];
                
                // Convert month name to number
                const monthNames = ["January", "February", "March", "April", "May", "June",
                    "July", "August", "September", "October", "November", "December"];
                const monthNumber = monthNames.indexOf(month) + 1;
                
                formattedDate = `${year}-${monthNumber.toString().padStart(2, '0')}-${day.padStart(2, '0')}`;
            }
            
            offerModalDate.value = formattedDate;
            offerModalBranch.value = entry.branch;
            offerModalType.value = entry.offerType || 'Normal Day';
            offerModalNotes.value = entry.notes || '';
            
            // Clear any previous error messages
            document.getElementById('offerModalDateError').textContent = '';
            
            // Show the modal
            offerModal.style.display = 'flex';
        }

        function deleteOffer(index) {
            if (confirm('Are you sure you want to delete this offer?')) {
                // Remove offer information but keep the sales data
                if (deliveryData[index].offerStatus === 'Offer') {
                    deliveryData[index].offerStatus = 'No Offer';
                    deliveryData[index].offerType = 'Normal Day';
                    deliveryData[index].notes = '';
                }
                
                updateDashboard();
                updateOffersDashboard();
                showNotification('Offer deleted successfully!', 'success');
            }
        }

        function exportOfferData() {
            showLoadingIndicator();
            
            setTimeout(() => {
                // Create a workbook
                const wb = XLSX.utils.book_new();
                
                // Get filtered data
                const filteredData = getFilteredData();
                
                // Prepare data for export
                const exportData = filteredData.map(item => ({
                    'Date': item.date,
                    'Day': getDayOfWeek(item.date),
                    'Branch': item.branch,
                    'Transactions': item.transactions,
                    'Sales (AED)': item.sales,
                    'Average per Order': item.transactions > 0 ? (item.sales / item.transactions).toFixed(2) : '0.00',
                    'Offer Type': item.offerType || 'Normal Day',
                    'Offer Status': item.offerStatus || 'No Offer',
                    'Notes': item.notes || ''
                }));
                
                // Create worksheet
                const ws = XLSX.utils.json_to_sheet(exportData);
                XLSX.utils.book_append_sheet(wb, ws, "Offers Data");
                
                // Save the file
                XLSX.writeFile(wb, "Crispy_Chicken_Offers_Data.xlsx");
                
                hideLoadingIndicator();
                showNotification('Offer data exported successfully!', 'success');
            }, 1000);
        }

        function updatePagination(totalItems) {
            const itemsPerPage = 20;
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            
            document.getElementById('currentPage').textContent = '1';
            document.getElementById('totalPages').textContent = totalPages;
            
            // Update pagination buttons
            const prevButton = document.getElementById('prevPage');
            const nextButton = document.getElementById('nextPage');
            
            prevButton.disabled = true;
            nextButton.disabled = totalPages <= 1;
        }
    </script>
</body>
</html>
